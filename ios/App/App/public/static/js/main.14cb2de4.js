/*! For license information please see main.14cb2de4.js.LICENSE.txt */
(()=>{var e={228:function(e,t){!function(e){"use strict";var t="1.9.4";function n(e){var t,n,r,i;for(n=1,r=arguments.length;n<r;n++)for(t in i=arguments[n])e[t]=i[t];return e}var r=Object.create||function(){function e(){}return function(t){return e.prototype=t,new e}}();function i(e,t){var n=Array.prototype.slice;if(e.bind)return e.bind.apply(e,n.call(arguments,1));var r=n.call(arguments,2);return function(){return e.apply(t,r.length?r.concat(n.call(arguments)):arguments)}}var s=0;function a(e){return"_leaflet_id"in e||(e._leaflet_id=++s),e._leaflet_id}function o(e,t,n){var r,i,s,a;return a=function(){r=!1,i&&(s.apply(n,i),i=!1)},s=function(){r?i=arguments:(e.apply(n,arguments),setTimeout(a,t),r=!0)},s}function l(e,t,n){var r=t[1],i=t[0],s=r-i;return e===r&&n?e:((e-i)%s+s)%s+i}function c(){return!1}function u(e,t){if(!1===t)return e;var n=Math.pow(10,void 0===t?6:t);return Math.round(e*n)/n}function d(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function h(e){return d(e).split(/\s+/)}function p(e,t){for(var n in Object.prototype.hasOwnProperty.call(e,"options")||(e.options=e.options?r(e.options):{}),t)e.options[n]=t[n];return e.options}function f(e,t,n){var r=[];for(var i in e)r.push(encodeURIComponent(n?i.toUpperCase():i)+"="+encodeURIComponent(e[i]));return(t&&-1!==t.indexOf("?")?"&":"?")+r.join("&")}var m=/\{ *([\w_ -]+) *\}/g;function g(e,t){return e.replace(m,function(e,n){var r=t[n];if(void 0===r)throw new Error("No value provided for variable "+e);return"function"===typeof r&&(r=r(t)),r})}var v=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function y(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1}var x="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function b(e){return window["webkit"+e]||window["moz"+e]||window["ms"+e]}var w=0;function _(e){var t=+new Date,n=Math.max(0,16-(t-w));return w=t+n,window.setTimeout(e,n)}var k=window.requestAnimationFrame||b("RequestAnimationFrame")||_,N=window.cancelAnimationFrame||b("CancelAnimationFrame")||b("CancelRequestAnimationFrame")||function(e){window.clearTimeout(e)};function S(e,t,n){if(!n||k!==_)return k.call(window,i(e,t));e.call(t)}function j(e){e&&N.call(window,e)}var E={__proto__:null,extend:n,create:r,bind:i,get lastId(){return s},stamp:a,throttle:o,wrapNum:l,falseFn:c,formatNum:u,trim:d,splitWords:h,setOptions:p,getParamString:f,template:g,isArray:v,indexOf:y,emptyImageUrl:x,requestFn:k,cancelFn:N,requestAnimFrame:S,cancelAnimFrame:j};function C(){}function T(e){if("undefined"!==typeof L&&L&&L.Mixin){e=v(e)?e:[e];for(var t=0;t<e.length;t++)e[t]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",(new Error).stack)}}C.extend=function(e){var t=function(){p(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},i=t.__super__=this.prototype,s=r(i);for(var a in s.constructor=t,t.prototype=s,this)Object.prototype.hasOwnProperty.call(this,a)&&"prototype"!==a&&"__super__"!==a&&(t[a]=this[a]);return e.statics&&n(t,e.statics),e.includes&&(T(e.includes),n.apply(null,[s].concat(e.includes))),n(s,e),delete s.statics,delete s.includes,s.options&&(s.options=i.options?r(i.options):{},n(s.options,e.options)),s._initHooks=[],s.callInitHooks=function(){if(!this._initHooksCalled){i.callInitHooks&&i.callInitHooks.call(this),this._initHooksCalled=!0;for(var e=0,t=s._initHooks.length;e<t;e++)s._initHooks[e].call(this)}},t},C.include=function(e){var t=this.prototype.options;return n(this.prototype,e),e.options&&(this.prototype.options=t,this.mergeOptions(e.options)),this},C.mergeOptions=function(e){return n(this.prototype.options,e),this},C.addInitHook=function(e){var t=Array.prototype.slice.call(arguments,1),n="function"===typeof e?e:function(){this[e].apply(this,t)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(n),this};var A={on:function(e,t,n){if("object"===typeof e)for(var r in e)this._on(r,e[r],t);else for(var i=0,s=(e=h(e)).length;i<s;i++)this._on(e[i],t,n);return this},off:function(e,t,n){if(arguments.length)if("object"===typeof e)for(var r in e)this._off(r,e[r],t);else{e=h(e);for(var i=1===arguments.length,s=0,a=e.length;s<a;s++)i?this._off(e[s]):this._off(e[s],t,n)}else delete this._events;return this},_on:function(e,t,n,r){if("function"===typeof t){if(!1===this._listens(e,t,n)){n===this&&(n=void 0);var i={fn:t,ctx:n};r&&(i.once=!0),this._events=this._events||{},this._events[e]=this._events[e]||[],this._events[e].push(i)}}else console.warn("wrong listener type: "+typeof t)},_off:function(e,t,n){var r,i,s;if(this._events&&(r=this._events[e]))if(1!==arguments.length)if("function"===typeof t){var a=this._listens(e,t,n);if(!1!==a){var o=r[a];this._firingCount&&(o.fn=c,this._events[e]=r=r.slice()),r.splice(a,1)}}else console.warn("wrong listener type: "+typeof t);else{if(this._firingCount)for(i=0,s=r.length;i<s;i++)r[i].fn=c;delete this._events[e]}},fire:function(e,t,r){if(!this.listens(e,r))return this;var i=n({},t,{type:e,target:this,sourceTarget:t&&t.sourceTarget||this});if(this._events){var s=this._events[e];if(s){this._firingCount=this._firingCount+1||1;for(var a=0,o=s.length;a<o;a++){var l=s[a],c=l.fn;l.once&&this.off(e,c,l.ctx),c.call(l.ctx||this,i)}this._firingCount--}}return r&&this._propagateEvent(i),this},listens:function(e,t,n,r){"string"!==typeof e&&console.warn('"string" type argument expected');var i=t;"function"!==typeof t&&(r=!!t,i=void 0,n=void 0);var s=this._events&&this._events[e];if(s&&s.length&&!1!==this._listens(e,i,n))return!0;if(r)for(var a in this._eventParents)if(this._eventParents[a].listens(e,t,n,r))return!0;return!1},_listens:function(e,t,n){if(!this._events)return!1;var r=this._events[e]||[];if(!t)return!!r.length;n===this&&(n=void 0);for(var i=0,s=r.length;i<s;i++)if(r[i].fn===t&&r[i].ctx===n)return i;return!1},once:function(e,t,n){if("object"===typeof e)for(var r in e)this._on(r,e[r],t,!0);else for(var i=0,s=(e=h(e)).length;i<s;i++)this._on(e[i],t,n,!0);return this},addEventParent:function(e){return this._eventParents=this._eventParents||{},this._eventParents[a(e)]=e,this},removeEventParent:function(e){return this._eventParents&&delete this._eventParents[a(e)],this},_propagateEvent:function(e){for(var t in this._eventParents)this._eventParents[t].fire(e.type,n({layer:e.target,propagatedFrom:e.target},e),!0)}};A.addEventListener=A.on,A.removeEventListener=A.clearAllEventListeners=A.off,A.addOneTimeEventListener=A.once,A.fireEvent=A.fire,A.hasEventListeners=A.listens;var I=C.extend(A);function P(e,t,n){this.x=n?Math.round(e):e,this.y=n?Math.round(t):t}var R=Math.trunc||function(e){return e>0?Math.floor(e):Math.ceil(e)};function O(e,t,n){return e instanceof P?e:v(e)?new P(e[0],e[1]):void 0===e||null===e?e:"object"===typeof e&&"x"in e&&"y"in e?new P(e.x,e.y):new P(e,t,n)}function M(e,t){if(e)for(var n=t?[e,t]:e,r=0,i=n.length;r<i;r++)this.extend(n[r])}function D(e,t){return!e||e instanceof M?e:new M(e,t)}function F(e,t){if(e)for(var n=t?[e,t]:e,r=0,i=n.length;r<i;r++)this.extend(n[r])}function z(e,t){return e instanceof F?e:new F(e,t)}function U(e,t,n){if(isNaN(e)||isNaN(t))throw new Error("Invalid LatLng object: ("+e+", "+t+")");this.lat=+e,this.lng=+t,void 0!==n&&(this.alt=+n)}function B(e,t,n){return e instanceof U?e:v(e)&&"object"!==typeof e[0]?3===e.length?new U(e[0],e[1],e[2]):2===e.length?new U(e[0],e[1]):null:void 0===e||null===e?e:"object"===typeof e&&"lat"in e?new U(e.lat,"lng"in e?e.lng:e.lon,e.alt):void 0===t?null:new U(e,t,n)}P.prototype={clone:function(){return new P(this.x,this.y)},add:function(e){return this.clone()._add(O(e))},_add:function(e){return this.x+=e.x,this.y+=e.y,this},subtract:function(e){return this.clone()._subtract(O(e))},_subtract:function(e){return this.x-=e.x,this.y-=e.y,this},divideBy:function(e){return this.clone()._divideBy(e)},_divideBy:function(e){return this.x/=e,this.y/=e,this},multiplyBy:function(e){return this.clone()._multiplyBy(e)},_multiplyBy:function(e){return this.x*=e,this.y*=e,this},scaleBy:function(e){return new P(this.x*e.x,this.y*e.y)},unscaleBy:function(e){return new P(this.x/e.x,this.y/e.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=R(this.x),this.y=R(this.y),this},distanceTo:function(e){var t=(e=O(e)).x-this.x,n=e.y-this.y;return Math.sqrt(t*t+n*n)},equals:function(e){return(e=O(e)).x===this.x&&e.y===this.y},contains:function(e){return e=O(e),Math.abs(e.x)<=Math.abs(this.x)&&Math.abs(e.y)<=Math.abs(this.y)},toString:function(){return"Point("+u(this.x)+", "+u(this.y)+")"}},M.prototype={extend:function(e){var t,n;if(!e)return this;if(e instanceof P||"number"===typeof e[0]||"x"in e)t=n=O(e);else if(t=(e=D(e)).min,n=e.max,!t||!n)return this;return this.min||this.max?(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(n.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(n.y,this.max.y)):(this.min=t.clone(),this.max=n.clone()),this},getCenter:function(e){return O((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,e)},getBottomLeft:function(){return O(this.min.x,this.max.y)},getTopRight:function(){return O(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(e){var t,n;return(e="number"===typeof e[0]||e instanceof P?O(e):D(e))instanceof M?(t=e.min,n=e.max):t=n=e,t.x>=this.min.x&&n.x<=this.max.x&&t.y>=this.min.y&&n.y<=this.max.y},intersects:function(e){e=D(e);var t=this.min,n=this.max,r=e.min,i=e.max,s=i.x>=t.x&&r.x<=n.x,a=i.y>=t.y&&r.y<=n.y;return s&&a},overlaps:function(e){e=D(e);var t=this.min,n=this.max,r=e.min,i=e.max,s=i.x>t.x&&r.x<n.x,a=i.y>t.y&&r.y<n.y;return s&&a},isValid:function(){return!(!this.min||!this.max)},pad:function(e){var t=this.min,n=this.max,r=Math.abs(t.x-n.x)*e,i=Math.abs(t.y-n.y)*e;return D(O(t.x-r,t.y-i),O(n.x+r,n.y+i))},equals:function(e){return!!e&&(e=D(e),this.min.equals(e.getTopLeft())&&this.max.equals(e.getBottomRight()))}},F.prototype={extend:function(e){var t,n,r=this._southWest,i=this._northEast;if(e instanceof U)t=e,n=e;else{if(!(e instanceof F))return e?this.extend(B(e)||z(e)):this;if(t=e._southWest,n=e._northEast,!t||!n)return this}return r||i?(r.lat=Math.min(t.lat,r.lat),r.lng=Math.min(t.lng,r.lng),i.lat=Math.max(n.lat,i.lat),i.lng=Math.max(n.lng,i.lng)):(this._southWest=new U(t.lat,t.lng),this._northEast=new U(n.lat,n.lng)),this},pad:function(e){var t=this._southWest,n=this._northEast,r=Math.abs(t.lat-n.lat)*e,i=Math.abs(t.lng-n.lng)*e;return new F(new U(t.lat-r,t.lng-i),new U(n.lat+r,n.lng+i))},getCenter:function(){return new U((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new U(this.getNorth(),this.getWest())},getSouthEast:function(){return new U(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(e){e="number"===typeof e[0]||e instanceof U||"lat"in e?B(e):z(e);var t,n,r=this._southWest,i=this._northEast;return e instanceof F?(t=e.getSouthWest(),n=e.getNorthEast()):t=n=e,t.lat>=r.lat&&n.lat<=i.lat&&t.lng>=r.lng&&n.lng<=i.lng},intersects:function(e){e=z(e);var t=this._southWest,n=this._northEast,r=e.getSouthWest(),i=e.getNorthEast(),s=i.lat>=t.lat&&r.lat<=n.lat,a=i.lng>=t.lng&&r.lng<=n.lng;return s&&a},overlaps:function(e){e=z(e);var t=this._southWest,n=this._northEast,r=e.getSouthWest(),i=e.getNorthEast(),s=i.lat>t.lat&&r.lat<n.lat,a=i.lng>t.lng&&r.lng<n.lng;return s&&a},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(e,t){return!!e&&(e=z(e),this._southWest.equals(e.getSouthWest(),t)&&this._northEast.equals(e.getNorthEast(),t))},isValid:function(){return!(!this._southWest||!this._northEast)}},U.prototype={equals:function(e,t){return!!e&&(e=B(e),Math.max(Math.abs(this.lat-e.lat),Math.abs(this.lng-e.lng))<=(void 0===t?1e-9:t))},toString:function(e){return"LatLng("+u(this.lat,e)+", "+u(this.lng,e)+")"},distanceTo:function(e){return q.distance(this,B(e))},wrap:function(){return q.wrapLatLng(this)},toBounds:function(e){var t=180*e/40075017,n=t/Math.cos(Math.PI/180*this.lat);return z([this.lat-t,this.lng-n],[this.lat+t,this.lng+n])},clone:function(){return new U(this.lat,this.lng,this.alt)}};var V={latLngToPoint:function(e,t){var n=this.projection.project(e),r=this.scale(t);return this.transformation._transform(n,r)},pointToLatLng:function(e,t){var n=this.scale(t),r=this.transformation.untransform(e,n);return this.projection.unproject(r)},project:function(e){return this.projection.project(e)},unproject:function(e){return this.projection.unproject(e)},scale:function(e){return 256*Math.pow(2,e)},zoom:function(e){return Math.log(e/256)/Math.LN2},getProjectedBounds:function(e){if(this.infinite)return null;var t=this.projection.bounds,n=this.scale(e);return new M(this.transformation.transform(t.min,n),this.transformation.transform(t.max,n))},infinite:!1,wrapLatLng:function(e){var t=this.wrapLng?l(e.lng,this.wrapLng,!0):e.lng;return new U(this.wrapLat?l(e.lat,this.wrapLat,!0):e.lat,t,e.alt)},wrapLatLngBounds:function(e){var t=e.getCenter(),n=this.wrapLatLng(t),r=t.lat-n.lat,i=t.lng-n.lng;if(0===r&&0===i)return e;var s=e.getSouthWest(),a=e.getNorthEast();return new F(new U(s.lat-r,s.lng-i),new U(a.lat-r,a.lng-i))}},q=n({},V,{wrapLng:[-180,180],R:6371e3,distance:function(e,t){var n=Math.PI/180,r=e.lat*n,i=t.lat*n,s=Math.sin((t.lat-e.lat)*n/2),a=Math.sin((t.lng-e.lng)*n/2),o=s*s+Math.cos(r)*Math.cos(i)*a*a,l=2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o));return this.R*l}}),K=6378137,H={R:K,MAX_LATITUDE:85.0511287798,project:function(e){var t=Math.PI/180,n=this.MAX_LATITUDE,r=Math.max(Math.min(n,e.lat),-n),i=Math.sin(r*t);return new P(this.R*e.lng*t,this.R*Math.log((1+i)/(1-i))/2)},unproject:function(e){var t=180/Math.PI;return new U((2*Math.atan(Math.exp(e.y/this.R))-Math.PI/2)*t,e.x*t/this.R)},bounds:function(){var e=K*Math.PI;return new M([-e,-e],[e,e])}()};function W(e,t,n,r){if(v(e))return this._a=e[0],this._b=e[1],this._c=e[2],void(this._d=e[3]);this._a=e,this._b=t,this._c=n,this._d=r}function G(e,t,n,r){return new W(e,t,n,r)}W.prototype={transform:function(e,t){return this._transform(e.clone(),t)},_transform:function(e,t){return t=t||1,e.x=t*(this._a*e.x+this._b),e.y=t*(this._c*e.y+this._d),e},untransform:function(e,t){return t=t||1,new P((e.x/t-this._b)/this._a,(e.y/t-this._d)/this._c)}};var Z=n({},q,{code:"EPSG:3857",projection:H,transformation:function(){var e=.5/(Math.PI*H.R);return G(e,.5,-e,.5)}()}),Q=n({},Z,{code:"EPSG:900913"});function J(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function Y(e,t){var n,r,i,s,a,o,l="";for(n=0,i=e.length;n<i;n++){for(r=0,s=(a=e[n]).length;r<s;r++)l+=(r?"L":"M")+(o=a[r]).x+" "+o.y;l+=t?Me.svg?"z":"x":""}return l||"M0 0"}var X=document.documentElement.style,$="ActiveXObject"in window,ee=$&&!document.addEventListener,te="msLaunchUri"in navigator&&!("documentMode"in document),ne=Oe("webkit"),re=Oe("android"),ie=Oe("android 2")||Oe("android 3"),se=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),ae=re&&Oe("Google")&&se<537&&!("AudioNode"in window),oe=!!window.opera,le=!te&&Oe("chrome"),ce=Oe("gecko")&&!ne&&!oe&&!$,ue=!le&&Oe("safari"),de=Oe("phantom"),he="OTransition"in X,pe=0===navigator.platform.indexOf("Win"),fe=$&&"transition"in X,me="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!ie,ge="MozPerspective"in X,ve=!window.L_DISABLE_3D&&(fe||me||ge)&&!he&&!de,ye="undefined"!==typeof orientation||Oe("mobile"),xe=ye&&ne,be=ye&&me,we=!window.PointerEvent&&window.MSPointerEvent,_e=!(!window.PointerEvent&&!we),ke="ontouchstart"in window||!!window.TouchEvent,Ne=!window.L_NO_TOUCH&&(ke||_e),Se=ye&&oe,je=ye&&ce,Ee=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Ce=function(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("testPassiveEventSupport",c,t),window.removeEventListener("testPassiveEventSupport",c,t)}catch(n){}return e}(),Te=!!document.createElement("canvas").getContext,Ae=!(!document.createElementNS||!J("svg").createSVGRect),Ie=!!Ae&&function(){var e=document.createElement("div");return e.innerHTML="<svg/>","http://www.w3.org/2000/svg"===(e.firstChild&&e.firstChild.namespaceURI)}(),Pe=!Ae&&function(){try{var e=document.createElement("div");e.innerHTML='<v:shape adj="1"/>';var t=e.firstChild;return t.style.behavior="url(#default#VML)",t&&"object"===typeof t.adj}catch(n){return!1}}(),Le=0===navigator.platform.indexOf("Mac"),Re=0===navigator.platform.indexOf("Linux");function Oe(e){return navigator.userAgent.toLowerCase().indexOf(e)>=0}var Me={ie:$,ielt9:ee,edge:te,webkit:ne,android:re,android23:ie,androidStock:ae,opera:oe,chrome:le,gecko:ce,safari:ue,phantom:de,opera12:he,win:pe,ie3d:fe,webkit3d:me,gecko3d:ge,any3d:ve,mobile:ye,mobileWebkit:xe,mobileWebkit3d:be,msPointer:we,pointer:_e,touch:Ne,touchNative:ke,mobileOpera:Se,mobileGecko:je,retina:Ee,passiveEvents:Ce,canvas:Te,svg:Ae,vml:Pe,inlineSvg:Ie,mac:Le,linux:Re},De=Me.msPointer?"MSPointerDown":"pointerdown",Fe=Me.msPointer?"MSPointerMove":"pointermove",ze=Me.msPointer?"MSPointerUp":"pointerup",Ue=Me.msPointer?"MSPointerCancel":"pointercancel",Be={touchstart:De,touchmove:Fe,touchend:ze,touchcancel:Ue},Ve={touchstart:Xe,touchmove:Ye,touchend:Ye,touchcancel:Ye},qe={},Ke=!1;function He(e,t,n){return"touchstart"===t&&Je(),Ve[t]?(n=Ve[t].bind(this,n),e.addEventListener(Be[t],n,!1),n):(console.warn("wrong event specified:",t),c)}function We(e,t,n){Be[t]?e.removeEventListener(Be[t],n,!1):console.warn("wrong event specified:",t)}function Ge(e){qe[e.pointerId]=e}function Ze(e){qe[e.pointerId]&&(qe[e.pointerId]=e)}function Qe(e){delete qe[e.pointerId]}function Je(){Ke||(document.addEventListener(De,Ge,!0),document.addEventListener(Fe,Ze,!0),document.addEventListener(ze,Qe,!0),document.addEventListener(Ue,Qe,!0),Ke=!0)}function Ye(e,t){if(t.pointerType!==(t.MSPOINTER_TYPE_MOUSE||"mouse")){for(var n in t.touches=[],qe)t.touches.push(qe[n]);t.changedTouches=[t],e(t)}}function Xe(e,t){t.MSPOINTER_TYPE_TOUCH&&t.pointerType===t.MSPOINTER_TYPE_TOUCH&&Gt(t),Ye(e,t)}function $e(e){var t,n,r={};for(n in e)t=e[n],r[n]=t&&t.bind?t.bind(e):t;return e=r,r.type="dblclick",r.detail=2,r.isTrusted=!1,r._simulated=!0,r}var et=200;function tt(e,t){e.addEventListener("dblclick",t);var n,r=0;function i(e){if(1===e.detail){if("mouse"!==e.pointerType&&(!e.sourceCapabilities||e.sourceCapabilities.firesTouchEvents)){var i=Qt(e);if(!i.some(function(e){return e instanceof HTMLLabelElement&&e.attributes.for})||i.some(function(e){return e instanceof HTMLInputElement||e instanceof HTMLSelectElement})){var s=Date.now();s-r<=et?2===++n&&t($e(e)):n=1,r=s}}}else n=e.detail}return e.addEventListener("click",i),{dblclick:t,simDblclick:i}}function nt(e,t){e.removeEventListener("dblclick",t.dblclick),e.removeEventListener("click",t.simDblclick)}var rt,it,st,at,ot,lt=St(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),ct=St(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),ut="webkitTransition"===ct||"OTransition"===ct?ct+"End":"transitionend";function dt(e){return"string"===typeof e?document.getElementById(e):e}function ht(e,t){var n=e.style[t]||e.currentStyle&&e.currentStyle[t];if((!n||"auto"===n)&&document.defaultView){var r=document.defaultView.getComputedStyle(e,null);n=r?r[t]:null}return"auto"===n?null:n}function pt(e,t,n){var r=document.createElement(e);return r.className=t||"",n&&n.appendChild(r),r}function ft(e){var t=e.parentNode;t&&t.removeChild(e)}function mt(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function gt(e){var t=e.parentNode;t&&t.lastChild!==e&&t.appendChild(e)}function vt(e){var t=e.parentNode;t&&t.firstChild!==e&&t.insertBefore(e,t.firstChild)}function yt(e,t){if(void 0!==e.classList)return e.classList.contains(t);var n=_t(e);return n.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(n)}function xt(e,t){if(void 0!==e.classList)for(var n=h(t),r=0,i=n.length;r<i;r++)e.classList.add(n[r]);else if(!yt(e,t)){var s=_t(e);wt(e,(s?s+" ":"")+t)}}function bt(e,t){void 0!==e.classList?e.classList.remove(t):wt(e,d((" "+_t(e)+" ").replace(" "+t+" "," ")))}function wt(e,t){void 0===e.className.baseVal?e.className=t:e.className.baseVal=t}function _t(e){return e.correspondingElement&&(e=e.correspondingElement),void 0===e.className.baseVal?e.className:e.className.baseVal}function kt(e,t){"opacity"in e.style?e.style.opacity=t:"filter"in e.style&&Nt(e,t)}function Nt(e,t){var n=!1,r="DXImageTransform.Microsoft.Alpha";try{n=e.filters.item(r)}catch(i){if(1===t)return}t=Math.round(100*t),n?(n.Enabled=100!==t,n.Opacity=t):e.style.filter+=" progid:"+r+"(opacity="+t+")"}function St(e){for(var t=document.documentElement.style,n=0;n<e.length;n++)if(e[n]in t)return e[n];return!1}function jt(e,t,n){var r=t||new P(0,0);e.style[lt]=(Me.ie3d?"translate("+r.x+"px,"+r.y+"px)":"translate3d("+r.x+"px,"+r.y+"px,0)")+(n?" scale("+n+")":"")}function Et(e,t){e._leaflet_pos=t,Me.any3d?jt(e,t):(e.style.left=t.x+"px",e.style.top=t.y+"px")}function Ct(e){return e._leaflet_pos||new P(0,0)}if("onselectstart"in document)rt=function(){Dt(window,"selectstart",Gt)},it=function(){zt(window,"selectstart",Gt)};else{var Tt=St(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);rt=function(){if(Tt){var e=document.documentElement.style;st=e[Tt],e[Tt]="none"}},it=function(){Tt&&(document.documentElement.style[Tt]=st,st=void 0)}}function At(){Dt(window,"dragstart",Gt)}function It(){zt(window,"dragstart",Gt)}function Pt(e){for(;-1===e.tabIndex;)e=e.parentNode;e.style&&(Lt(),at=e,ot=e.style.outlineStyle,e.style.outlineStyle="none",Dt(window,"keydown",Lt))}function Lt(){at&&(at.style.outlineStyle=ot,at=void 0,ot=void 0,zt(window,"keydown",Lt))}function Rt(e){do{e=e.parentNode}while((!e.offsetWidth||!e.offsetHeight)&&e!==document.body);return e}function Ot(e){var t=e.getBoundingClientRect();return{x:t.width/e.offsetWidth||1,y:t.height/e.offsetHeight||1,boundingClientRect:t}}var Mt={__proto__:null,TRANSFORM:lt,TRANSITION:ct,TRANSITION_END:ut,get:dt,getStyle:ht,create:pt,remove:ft,empty:mt,toFront:gt,toBack:vt,hasClass:yt,addClass:xt,removeClass:bt,setClass:wt,getClass:_t,setOpacity:kt,testProp:St,setTransform:jt,setPosition:Et,getPosition:Ct,get disableTextSelection(){return rt},get enableTextSelection(){return it},disableImageDrag:At,enableImageDrag:It,preventOutline:Pt,restoreOutline:Lt,getSizedParentNode:Rt,getScale:Ot};function Dt(e,t,n,r){if(t&&"object"===typeof t)for(var i in t)Vt(e,i,t[i],n);else for(var s=0,a=(t=h(t)).length;s<a;s++)Vt(e,t[s],n,r);return this}var Ft="_leaflet_events";function zt(e,t,n,r){if(1===arguments.length)Ut(e),delete e[Ft];else if(t&&"object"===typeof t)for(var i in t)qt(e,i,t[i],n);else if(t=h(t),2===arguments.length)Ut(e,function(e){return-1!==y(t,e)});else for(var s=0,a=t.length;s<a;s++)qt(e,t[s],n,r);return this}function Ut(e,t){for(var n in e[Ft]){var r=n.split(/\d/)[0];t&&!t(r)||qt(e,r,null,null,n)}}var Bt={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Vt(e,t,n,r){var i=t+a(n)+(r?"_"+a(r):"");if(e[Ft]&&e[Ft][i])return this;var s=function(t){return n.call(r||e,t||window.event)},o=s;!Me.touchNative&&Me.pointer&&0===t.indexOf("touch")?s=He(e,t,s):Me.touch&&"dblclick"===t?s=tt(e,s):"addEventListener"in e?"touchstart"===t||"touchmove"===t||"wheel"===t||"mousewheel"===t?e.addEventListener(Bt[t]||t,s,!!Me.passiveEvents&&{passive:!1}):"mouseenter"===t||"mouseleave"===t?(s=function(t){t=t||window.event,$t(e,t)&&o(t)},e.addEventListener(Bt[t],s,!1)):e.addEventListener(t,o,!1):e.attachEvent("on"+t,s),e[Ft]=e[Ft]||{},e[Ft][i]=s}function qt(e,t,n,r,i){i=i||t+a(n)+(r?"_"+a(r):"");var s=e[Ft]&&e[Ft][i];if(!s)return this;!Me.touchNative&&Me.pointer&&0===t.indexOf("touch")?We(e,t,s):Me.touch&&"dblclick"===t?nt(e,s):"removeEventListener"in e?e.removeEventListener(Bt[t]||t,s,!1):e.detachEvent("on"+t,s),e[Ft][i]=null}function Kt(e){return e.stopPropagation?e.stopPropagation():e.originalEvent?e.originalEvent._stopped=!0:e.cancelBubble=!0,this}function Ht(e){return Vt(e,"wheel",Kt),this}function Wt(e){return Dt(e,"mousedown touchstart dblclick contextmenu",Kt),e._leaflet_disable_click=!0,this}function Gt(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,this}function Zt(e){return Gt(e),Kt(e),this}function Qt(e){if(e.composedPath)return e.composedPath();for(var t=[],n=e.target;n;)t.push(n),n=n.parentNode;return t}function Jt(e,t){if(!t)return new P(e.clientX,e.clientY);var n=Ot(t),r=n.boundingClientRect;return new P((e.clientX-r.left)/n.x-t.clientLeft,(e.clientY-r.top)/n.y-t.clientTop)}var Yt=Me.linux&&Me.chrome?window.devicePixelRatio:Me.mac?3*window.devicePixelRatio:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Xt(e){return Me.edge?e.wheelDeltaY/2:e.deltaY&&0===e.deltaMode?-e.deltaY/Yt:e.deltaY&&1===e.deltaMode?20*-e.deltaY:e.deltaY&&2===e.deltaMode?60*-e.deltaY:e.deltaX||e.deltaZ?0:e.wheelDelta?(e.wheelDeltaY||e.wheelDelta)/2:e.detail&&Math.abs(e.detail)<32765?20*-e.detail:e.detail?e.detail/-32765*60:0}function $t(e,t){var n=t.relatedTarget;if(!n)return!0;try{for(;n&&n!==e;)n=n.parentNode}catch(r){return!1}return n!==e}var en={__proto__:null,on:Dt,off:zt,stopPropagation:Kt,disableScrollPropagation:Ht,disableClickPropagation:Wt,preventDefault:Gt,stop:Zt,getPropagationPath:Qt,getMousePosition:Jt,getWheelDelta:Xt,isExternalTarget:$t,addListener:Dt,removeListener:zt},tn=I.extend({run:function(e,t,n,r){this.stop(),this._el=e,this._inProgress=!0,this._duration=n||.25,this._easeOutPower=1/Math.max(r||.5,.2),this._startPos=Ct(e),this._offset=t.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=S(this._animate,this),this._step()},_step:function(e){var t=+new Date-this._startTime,n=1e3*this._duration;t<n?this._runFrame(this._easeOut(t/n),e):(this._runFrame(1),this._complete())},_runFrame:function(e,t){var n=this._startPos.add(this._offset.multiplyBy(e));t&&n._round(),Et(this._el,n),this.fire("step")},_complete:function(){j(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(e){return 1-Math.pow(1-e,this._easeOutPower)}}),nn=I.extend({options:{crs:Z,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(e,t){t=p(this,t),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(e),this._initLayout(),this._onResize=i(this._onResize,this),this._initEvents(),t.maxBounds&&this.setMaxBounds(t.maxBounds),void 0!==t.zoom&&(this._zoom=this._limitZoom(t.zoom)),t.center&&void 0!==t.zoom&&this.setView(B(t.center),t.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=ct&&Me.any3d&&!Me.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),Dt(this._proxy,ut,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(e,t,r){return t=void 0===t?this._zoom:this._limitZoom(t),e=this._limitCenter(B(e),t,this.options.maxBounds),r=r||{},this._stop(),this._loaded&&!r.reset&&!0!==r&&(void 0!==r.animate&&(r.zoom=n({animate:r.animate},r.zoom),r.pan=n({animate:r.animate,duration:r.duration},r.pan)),this._zoom!==t?this._tryAnimatedZoom&&this._tryAnimatedZoom(e,t,r.zoom):this._tryAnimatedPan(e,r.pan))?(clearTimeout(this._sizeTimer),this):(this._resetView(e,t,r.pan&&r.pan.noMoveStart),this)},setZoom:function(e,t){return this._loaded?this.setView(this.getCenter(),e,{zoom:t}):(this._zoom=e,this)},zoomIn:function(e,t){return e=e||(Me.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+e,t)},zoomOut:function(e,t){return e=e||(Me.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-e,t)},setZoomAround:function(e,t,n){var r=this.getZoomScale(t),i=this.getSize().divideBy(2),s=(e instanceof P?e:this.latLngToContainerPoint(e)).subtract(i).multiplyBy(1-1/r),a=this.containerPointToLatLng(i.add(s));return this.setView(a,t,{zoom:n})},_getBoundsCenterZoom:function(e,t){t=t||{},e=e.getBounds?e.getBounds():z(e);var n=O(t.paddingTopLeft||t.padding||[0,0]),r=O(t.paddingBottomRight||t.padding||[0,0]),i=this.getBoundsZoom(e,!1,n.add(r));if((i="number"===typeof t.maxZoom?Math.min(t.maxZoom,i):i)===1/0)return{center:e.getCenter(),zoom:i};var s=r.subtract(n).divideBy(2),a=this.project(e.getSouthWest(),i),o=this.project(e.getNorthEast(),i);return{center:this.unproject(a.add(o).divideBy(2).add(s),i),zoom:i}},fitBounds:function(e,t){if(!(e=z(e)).isValid())throw new Error("Bounds are not valid.");var n=this._getBoundsCenterZoom(e,t);return this.setView(n.center,n.zoom,t)},fitWorld:function(e){return this.fitBounds([[-90,-180],[90,180]],e)},panTo:function(e,t){return this.setView(e,this._zoom,{pan:t})},panBy:function(e,t){if(t=t||{},!(e=O(e).round()).x&&!e.y)return this.fire("moveend");if(!0!==t.animate&&!this.getSize().contains(e))return this._resetView(this.unproject(this.project(this.getCenter()).add(e)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new tn,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),t.noMoveStart||this.fire("movestart"),!1!==t.animate){xt(this._mapPane,"leaflet-pan-anim");var n=this._getMapPanePos().subtract(e).round();this._panAnim.run(this._mapPane,n,t.duration||.25,t.easeLinearity)}else this._rawPanBy(e),this.fire("move").fire("moveend");return this},flyTo:function(e,t,n){if(!1===(n=n||{}).animate||!Me.any3d)return this.setView(e,t,n);this._stop();var r=this.project(this.getCenter()),i=this.project(e),s=this.getSize(),a=this._zoom;e=B(e),t=void 0===t?a:t;var o=Math.max(s.x,s.y),l=o*this.getZoomScale(a,t),c=i.distanceTo(r)||1,u=1.42,d=u*u;function h(e){var t=(l*l-o*o+(e?-1:1)*d*d*c*c)/(2*(e?l:o)*d*c),n=Math.sqrt(t*t+1)-t;return n<1e-9?-18:Math.log(n)}function p(e){return(Math.exp(e)-Math.exp(-e))/2}function f(e){return(Math.exp(e)+Math.exp(-e))/2}function m(e){return p(e)/f(e)}var g=h(0);function v(e){return o*(f(g)/f(g+u*e))}function y(e){return o*(f(g)*m(g+u*e)-p(g))/d}function x(e){return 1-Math.pow(1-e,1.5)}var b=Date.now(),w=(h(1)-g)/u,_=n.duration?1e3*n.duration:1e3*w*.8;function k(){var n=(Date.now()-b)/_,s=x(n)*w;n<=1?(this._flyToFrame=S(k,this),this._move(this.unproject(r.add(i.subtract(r).multiplyBy(y(s)/c)),a),this.getScaleZoom(o/v(s),a),{flyTo:!0})):this._move(e,t)._moveEnd(!0)}return this._moveStart(!0,n.noMoveStart),k.call(this),this},flyToBounds:function(e,t){var n=this._getBoundsCenterZoom(e,t);return this.flyTo(n.center,n.zoom,t)},setMaxBounds:function(e){return e=z(e),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),e.isValid()?(this.options.maxBounds=e,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(e){var t=this.options.minZoom;return this.options.minZoom=e,this._loaded&&t!==e&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(e):this},setMaxZoom:function(e){var t=this.options.maxZoom;return this.options.maxZoom=e,this._loaded&&t!==e&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(e):this},panInsideBounds:function(e,t){this._enforcingBounds=!0;var n=this.getCenter(),r=this._limitCenter(n,this._zoom,z(e));return n.equals(r)||this.panTo(r,t),this._enforcingBounds=!1,this},panInside:function(e,t){var n=O((t=t||{}).paddingTopLeft||t.padding||[0,0]),r=O(t.paddingBottomRight||t.padding||[0,0]),i=this.project(this.getCenter()),s=this.project(e),a=this.getPixelBounds(),o=D([a.min.add(n),a.max.subtract(r)]),l=o.getSize();if(!o.contains(s)){this._enforcingBounds=!0;var c=s.subtract(o.getCenter()),u=o.extend(s).getSize().subtract(l);i.x+=c.x<0?-u.x:u.x,i.y+=c.y<0?-u.y:u.y,this.panTo(this.unproject(i),t),this._enforcingBounds=!1}return this},invalidateSize:function(e){if(!this._loaded)return this;e=n({animate:!1,pan:!0},!0===e?{animate:!0}:e);var t=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var r=this.getSize(),s=t.divideBy(2).round(),a=r.divideBy(2).round(),o=s.subtract(a);return o.x||o.y?(e.animate&&e.pan?this.panBy(o):(e.pan&&this._rawPanBy(o),this.fire("move"),e.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(i(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:t,newSize:r})):this},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(e){if(e=this._locateOptions=n({timeout:1e4,watch:!1},e),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var t=i(this._handleGeolocationResponse,this),r=i(this._handleGeolocationError,this);return e.watch?this._locationWatchId=navigator.geolocation.watchPosition(t,r,e):navigator.geolocation.getCurrentPosition(t,r,e),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(e){if(this._container._leaflet_id){var t=e.code,n=e.message||(1===t?"permission denied":2===t?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:t,message:"Geolocation error: "+n+"."})}},_handleGeolocationResponse:function(e){if(this._container._leaflet_id){var t=new U(e.coords.latitude,e.coords.longitude),n=t.toBounds(2*e.coords.accuracy),r=this._locateOptions;if(r.setView){var i=this.getBoundsZoom(n);this.setView(t,r.maxZoom?Math.min(i,r.maxZoom):i)}var s={latlng:t,bounds:n,timestamp:e.timestamp};for(var a in e.coords)"number"===typeof e.coords[a]&&(s[a]=e.coords[a]);this.fire("locationfound",s)}},addHandler:function(e,t){if(!t)return this;var n=this[e]=new t(this);return this._handlers.push(n),this.options[e]&&n.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch(t){this._container._leaflet_id=void 0,this._containerId=void 0}var e;for(e in void 0!==this._locationWatchId&&this.stopLocate(),this._stop(),ft(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(j(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload"),this._layers)this._layers[e].remove();for(e in this._panes)ft(this._panes[e]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(e,t){var n=pt("div","leaflet-pane"+(e?" leaflet-"+e.replace("Pane","")+"-pane":""),t||this._mapPane);return e&&(this._panes[e]=n),n},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var e=this.getPixelBounds();return new F(this.unproject(e.getBottomLeft()),this.unproject(e.getTopRight()))},getMinZoom:function(){return void 0===this.options.minZoom?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return void 0===this.options.maxZoom?void 0===this._layersMaxZoom?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(e,t,n){e=z(e),n=O(n||[0,0]);var r=this.getZoom()||0,i=this.getMinZoom(),s=this.getMaxZoom(),a=e.getNorthWest(),o=e.getSouthEast(),l=this.getSize().subtract(n),c=D(this.project(o,r),this.project(a,r)).getSize(),u=Me.any3d?this.options.zoomSnap:1,d=l.x/c.x,h=l.y/c.y,p=t?Math.max(d,h):Math.min(d,h);return r=this.getScaleZoom(p,r),u&&(r=Math.round(r/(u/100))*(u/100),r=t?Math.ceil(r/u)*u:Math.floor(r/u)*u),Math.max(i,Math.min(s,r))},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new P(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(e,t){var n=this._getTopLeftPoint(e,t);return new M(n,n.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(e){return this.options.crs.getProjectedBounds(void 0===e?this.getZoom():e)},getPane:function(e){return"string"===typeof e?this._panes[e]:e},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(e,t){var n=this.options.crs;return t=void 0===t?this._zoom:t,n.scale(e)/n.scale(t)},getScaleZoom:function(e,t){var n=this.options.crs;t=void 0===t?this._zoom:t;var r=n.zoom(e*n.scale(t));return isNaN(r)?1/0:r},project:function(e,t){return t=void 0===t?this._zoom:t,this.options.crs.latLngToPoint(B(e),t)},unproject:function(e,t){return t=void 0===t?this._zoom:t,this.options.crs.pointToLatLng(O(e),t)},layerPointToLatLng:function(e){var t=O(e).add(this.getPixelOrigin());return this.unproject(t)},latLngToLayerPoint:function(e){return this.project(B(e))._round()._subtract(this.getPixelOrigin())},wrapLatLng:function(e){return this.options.crs.wrapLatLng(B(e))},wrapLatLngBounds:function(e){return this.options.crs.wrapLatLngBounds(z(e))},distance:function(e,t){return this.options.crs.distance(B(e),B(t))},containerPointToLayerPoint:function(e){return O(e).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(e){return O(e).add(this._getMapPanePos())},containerPointToLatLng:function(e){var t=this.containerPointToLayerPoint(O(e));return this.layerPointToLatLng(t)},latLngToContainerPoint:function(e){return this.layerPointToContainerPoint(this.latLngToLayerPoint(B(e)))},mouseEventToContainerPoint:function(e){return Jt(e,this._container)},mouseEventToLayerPoint:function(e){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(e))},mouseEventToLatLng:function(e){return this.layerPointToLatLng(this.mouseEventToLayerPoint(e))},_initContainer:function(e){var t=this._container=dt(e);if(!t)throw new Error("Map container not found.");if(t._leaflet_id)throw new Error("Map container is already initialized.");Dt(t,"scroll",this._onScroll,this),this._containerId=a(t)},_initLayout:function(){var e=this._container;this._fadeAnimated=this.options.fadeAnimation&&Me.any3d,xt(e,"leaflet-container"+(Me.touch?" leaflet-touch":"")+(Me.retina?" leaflet-retina":"")+(Me.ielt9?" leaflet-oldie":"")+(Me.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var t=ht(e,"position");"absolute"!==t&&"relative"!==t&&"fixed"!==t&&"sticky"!==t&&(e.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var e=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Et(this._mapPane,new P(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(xt(e.markerPane,"leaflet-zoom-hide"),xt(e.shadowPane,"leaflet-zoom-hide"))},_resetView:function(e,t,n){Et(this._mapPane,new P(0,0));var r=!this._loaded;this._loaded=!0,t=this._limitZoom(t),this.fire("viewprereset");var i=this._zoom!==t;this._moveStart(i,n)._move(e,t)._moveEnd(i),this.fire("viewreset"),r&&this.fire("load")},_moveStart:function(e,t){return e&&this.fire("zoomstart"),t||this.fire("movestart"),this},_move:function(e,t,n,r){void 0===t&&(t=this._zoom);var i=this._zoom!==t;return this._zoom=t,this._lastCenter=e,this._pixelOrigin=this._getNewPixelOrigin(e),r?n&&n.pinch&&this.fire("zoom",n):((i||n&&n.pinch)&&this.fire("zoom",n),this.fire("move",n)),this},_moveEnd:function(e){return e&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return j(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(e){Et(this._mapPane,this._getMapPanePos().subtract(e))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(e){this._targets={},this._targets[a(this._container)]=this;var t=e?zt:Dt;t(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&t(window,"resize",this._onResize,this),Me.any3d&&this.options.transform3DLimit&&(e?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){j(this._resizeRequest),this._resizeRequest=S(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var e=this._getMapPanePos();Math.max(Math.abs(e.x),Math.abs(e.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(e,t){for(var n,r=[],i="mouseout"===t||"mouseover"===t,s=e.target||e.srcElement,o=!1;s;){if((n=this._targets[a(s)])&&("click"===t||"preclick"===t)&&this._draggableMoved(n)){o=!0;break}if(n&&n.listens(t,!0)){if(i&&!$t(s,e))break;if(r.push(n),i)break}if(s===this._container)break;s=s.parentNode}return r.length||o||i||!this.listens(t,!0)||(r=[this]),r},_isClickDisabled:function(e){for(;e&&e!==this._container;){if(e._leaflet_disable_click)return!0;e=e.parentNode}},_handleDOMEvent:function(e){var t=e.target||e.srcElement;if(!(!this._loaded||t._leaflet_disable_events||"click"===e.type&&this._isClickDisabled(t))){var n=e.type;"mousedown"===n&&Pt(t),this._fireDOMEvent(e,n)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(e,t,r){if("click"===e.type){var i=n({},e);i.type="preclick",this._fireDOMEvent(i,i.type,r)}var s=this._findEventTargets(e,t);if(r){for(var a=[],o=0;o<r.length;o++)r[o].listens(t,!0)&&a.push(r[o]);s=a.concat(s)}if(s.length){"contextmenu"===t&&Gt(e);var l=s[0],c={originalEvent:e};if("keypress"!==e.type&&"keydown"!==e.type&&"keyup"!==e.type){var u=l.getLatLng&&(!l._radius||l._radius<=10);c.containerPoint=u?this.latLngToContainerPoint(l.getLatLng()):this.mouseEventToContainerPoint(e),c.layerPoint=this.containerPointToLayerPoint(c.containerPoint),c.latlng=u?l.getLatLng():this.layerPointToLatLng(c.layerPoint)}for(o=0;o<s.length;o++)if(s[o].fire(t,c,!0),c.originalEvent._stopped||!1===s[o].options.bubblingMouseEvents&&-1!==y(this._mouseEvents,t))return}},_draggableMoved:function(e){return(e=e.dragging&&e.dragging.enabled()?e:this).dragging&&e.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var e=0,t=this._handlers.length;e<t;e++)this._handlers[e].disable()},whenReady:function(e,t){return this._loaded?e.call(t||this,{target:this}):this.on("load",e,t),this},_getMapPanePos:function(){return Ct(this._mapPane)||new P(0,0)},_moved:function(){var e=this._getMapPanePos();return e&&!e.equals([0,0])},_getTopLeftPoint:function(e,t){return(e&&void 0!==t?this._getNewPixelOrigin(e,t):this.getPixelOrigin()).subtract(this._getMapPanePos())},_getNewPixelOrigin:function(e,t){var n=this.getSize()._divideBy(2);return this.project(e,t)._subtract(n)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(e,t,n){var r=this._getNewPixelOrigin(n,t);return this.project(e,t)._subtract(r)},_latLngBoundsToNewLayerBounds:function(e,t,n){var r=this._getNewPixelOrigin(n,t);return D([this.project(e.getSouthWest(),t)._subtract(r),this.project(e.getNorthWest(),t)._subtract(r),this.project(e.getSouthEast(),t)._subtract(r),this.project(e.getNorthEast(),t)._subtract(r)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(e){return this.latLngToLayerPoint(e).subtract(this._getCenterLayerPoint())},_limitCenter:function(e,t,n){if(!n)return e;var r=this.project(e,t),i=this.getSize().divideBy(2),s=new M(r.subtract(i),r.add(i)),a=this._getBoundsOffset(s,n,t);return Math.abs(a.x)<=1&&Math.abs(a.y)<=1?e:this.unproject(r.add(a),t)},_limitOffset:function(e,t){if(!t)return e;var n=this.getPixelBounds(),r=new M(n.min.add(e),n.max.add(e));return e.add(this._getBoundsOffset(r,t))},_getBoundsOffset:function(e,t,n){var r=D(this.project(t.getNorthEast(),n),this.project(t.getSouthWest(),n)),i=r.min.subtract(e.min),s=r.max.subtract(e.max);return new P(this._rebound(i.x,-s.x),this._rebound(i.y,-s.y))},_rebound:function(e,t){return e+t>0?Math.round(e-t)/2:Math.max(0,Math.ceil(e))-Math.max(0,Math.floor(t))},_limitZoom:function(e){var t=this.getMinZoom(),n=this.getMaxZoom(),r=Me.any3d?this.options.zoomSnap:1;return r&&(e=Math.round(e/r)*r),Math.max(t,Math.min(n,e))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){bt(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(e,t){var n=this._getCenterOffset(e)._trunc();return!(!0!==(t&&t.animate)&&!this.getSize().contains(n))&&(this.panBy(n,t),!0)},_createAnimProxy:function(){var e=this._proxy=pt("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(e),this.on("zoomanim",function(e){var t=lt,n=this._proxy.style[t];jt(this._proxy,this.project(e.center,e.zoom),this.getZoomScale(e.zoom,1)),n===this._proxy.style[t]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){ft(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var e=this.getCenter(),t=this.getZoom();jt(this._proxy,this.project(e,t),this.getZoomScale(t,1))},_catchTransitionEnd:function(e){this._animatingZoom&&e.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(e,t,n){if(this._animatingZoom)return!0;if(n=n||{},!this._zoomAnimated||!1===n.animate||this._nothingToAnimate()||Math.abs(t-this._zoom)>this.options.zoomAnimationThreshold)return!1;var r=this.getZoomScale(t),i=this._getCenterOffset(e)._divideBy(1-1/r);return!(!0!==n.animate&&!this.getSize().contains(i))&&(S(function(){this._moveStart(!0,n.noMoveStart||!1)._animateZoom(e,t,!0)},this),!0)},_animateZoom:function(e,t,n,r){this._mapPane&&(n&&(this._animatingZoom=!0,this._animateToCenter=e,this._animateToZoom=t,xt(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:e,zoom:t,noUpdate:r}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(i(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&bt(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function rn(e,t){return new nn(e,t)}var sn=C.extend({options:{position:"topright"},initialize:function(e){p(this,e)},getPosition:function(){return this.options.position},setPosition:function(e){var t=this._map;return t&&t.removeControl(this),this.options.position=e,t&&t.addControl(this),this},getContainer:function(){return this._container},addTo:function(e){this.remove(),this._map=e;var t=this._container=this.onAdd(e),n=this.getPosition(),r=e._controlCorners[n];return xt(t,"leaflet-control"),-1!==n.indexOf("bottom")?r.insertBefore(t,r.firstChild):r.appendChild(t),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(ft(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(e){this._map&&e&&e.screenX>0&&e.screenY>0&&this._map.getContainer().focus()}}),an=function(e){return new sn(e)};nn.include({addControl:function(e){return e.addTo(this),this},removeControl:function(e){return e.remove(),this},_initControlPos:function(){var e=this._controlCorners={},t="leaflet-",n=this._controlContainer=pt("div",t+"control-container",this._container);function r(r,i){var s=t+r+" "+t+i;e[r+i]=pt("div",s,n)}r("top","left"),r("top","right"),r("bottom","left"),r("bottom","right")},_clearControlPos:function(){for(var e in this._controlCorners)ft(this._controlCorners[e]);ft(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var on=sn.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(e,t,n,r){return n<r?-1:r<n?1:0}},initialize:function(e,t,n){for(var r in p(this,n),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1,e)this._addLayer(e[r],r);for(r in t)this._addLayer(t[r],r,!0)},onAdd:function(e){this._initLayout(),this._update(),this._map=e,e.on("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(e){return sn.prototype.addTo.call(this,e),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(e,t){return this._addLayer(e,t),this._map?this._update():this},addOverlay:function(e,t){return this._addLayer(e,t,!0),this._map?this._update():this},removeLayer:function(e){e.off("add remove",this._onLayerChange,this);var t=this._getLayer(a(e));return t&&this._layers.splice(this._layers.indexOf(t),1),this._map?this._update():this},expand:function(){xt(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var e=this._map.getSize().y-(this._container.offsetTop+50);return e<this._section.clientHeight?(xt(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=e+"px"):bt(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return bt(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var e="leaflet-control-layers",t=this._container=pt("div",e),n=this.options.collapsed;t.setAttribute("aria-haspopup",!0),Wt(t),Ht(t);var r=this._section=pt("section",e+"-list");n&&(this._map.on("click",this.collapse,this),Dt(t,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var i=this._layersLink=pt("a",e+"-toggle",t);i.href="#",i.title="Layers",i.setAttribute("role","button"),Dt(i,{keydown:function(e){13===e.keyCode&&this._expandSafely()},click:function(e){Gt(e),this._expandSafely()}},this),n||this.expand(),this._baseLayersList=pt("div",e+"-base",r),this._separator=pt("div",e+"-separator",r),this._overlaysList=pt("div",e+"-overlays",r),t.appendChild(r)},_getLayer:function(e){for(var t=0;t<this._layers.length;t++)if(this._layers[t]&&a(this._layers[t].layer)===e)return this._layers[t]},_addLayer:function(e,t,n){this._map&&e.on("add remove",this._onLayerChange,this),this._layers.push({layer:e,name:t,overlay:n}),this.options.sortLayers&&this._layers.sort(i(function(e,t){return this.options.sortFunction(e.layer,t.layer,e.name,t.name)},this)),this.options.autoZIndex&&e.setZIndex&&(this._lastZIndex++,e.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;mt(this._baseLayersList),mt(this._overlaysList),this._layerControlInputs=[];var e,t,n,r,i=0;for(n=0;n<this._layers.length;n++)r=this._layers[n],this._addItem(r),t=t||r.overlay,e=e||!r.overlay,i+=r.overlay?0:1;return this.options.hideSingleBase&&(e=e&&i>1,this._baseLayersList.style.display=e?"":"none"),this._separator.style.display=t&&e?"":"none",this},_onLayerChange:function(e){this._handlingClick||this._update();var t=this._getLayer(a(e.target)),n=t.overlay?"add"===e.type?"overlayadd":"overlayremove":"add"===e.type?"baselayerchange":null;n&&this._map.fire(n,t)},_createRadioElement:function(e,t){var n='<input type="radio" class="leaflet-control-layers-selector" name="'+e+'"'+(t?' checked="checked"':"")+"/>",r=document.createElement("div");return r.innerHTML=n,r.firstChild},_addItem:function(e){var t,n=document.createElement("label"),r=this._map.hasLayer(e.layer);e.overlay?((t=document.createElement("input")).type="checkbox",t.className="leaflet-control-layers-selector",t.defaultChecked=r):t=this._createRadioElement("leaflet-base-layers_"+a(this),r),this._layerControlInputs.push(t),t.layerId=a(e.layer),Dt(t,"click",this._onInputClick,this);var i=document.createElement("span");i.innerHTML=" "+e.name;var s=document.createElement("span");return n.appendChild(s),s.appendChild(t),s.appendChild(i),(e.overlay?this._overlaysList:this._baseLayersList).appendChild(n),this._checkDisabledLayers(),n},_onInputClick:function(){if(!this._preventClick){var e,t,n=this._layerControlInputs,r=[],i=[];this._handlingClick=!0;for(var s=n.length-1;s>=0;s--)e=n[s],t=this._getLayer(e.layerId).layer,e.checked?r.push(t):e.checked||i.push(t);for(s=0;s<i.length;s++)this._map.hasLayer(i[s])&&this._map.removeLayer(i[s]);for(s=0;s<r.length;s++)this._map.hasLayer(r[s])||this._map.addLayer(r[s]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var e,t,n=this._layerControlInputs,r=this._map.getZoom(),i=n.length-1;i>=0;i--)e=n[i],t=this._getLayer(e.layerId).layer,e.disabled=void 0!==t.options.minZoom&&r<t.options.minZoom||void 0!==t.options.maxZoom&&r>t.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var e=this._section;this._preventClick=!0,Dt(e,"click",Gt),this.expand();var t=this;setTimeout(function(){zt(e,"click",Gt),t._preventClick=!1})}}),ln=function(e,t,n){return new on(e,t,n)},cn=sn.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(e){var t="leaflet-control-zoom",n=pt("div",t+" leaflet-bar"),r=this.options;return this._zoomInButton=this._createButton(r.zoomInText,r.zoomInTitle,t+"-in",n,this._zoomIn),this._zoomOutButton=this._createButton(r.zoomOutText,r.zoomOutTitle,t+"-out",n,this._zoomOut),this._updateDisabled(),e.on("zoomend zoomlevelschange",this._updateDisabled,this),n},onRemove:function(e){e.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(e){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(e.shiftKey?3:1))},_zoomOut:function(e){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(e.shiftKey?3:1))},_createButton:function(e,t,n,r,i){var s=pt("a",n,r);return s.innerHTML=e,s.href="#",s.title=t,s.setAttribute("role","button"),s.setAttribute("aria-label",t),Wt(s),Dt(s,"click",Zt),Dt(s,"click",i,this),Dt(s,"click",this._refocusOnMap,this),s},_updateDisabled:function(){var e=this._map,t="leaflet-disabled";bt(this._zoomInButton,t),bt(this._zoomOutButton,t),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||e._zoom===e.getMinZoom())&&(xt(this._zoomOutButton,t),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||e._zoom===e.getMaxZoom())&&(xt(this._zoomInButton,t),this._zoomInButton.setAttribute("aria-disabled","true"))}});nn.mergeOptions({zoomControl:!0}),nn.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new cn,this.addControl(this.zoomControl))});var un=function(e){return new cn(e)},dn=sn.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(e){var t="leaflet-control-scale",n=pt("div",t),r=this.options;return this._addScales(r,t+"-line",n),e.on(r.updateWhenIdle?"moveend":"move",this._update,this),e.whenReady(this._update,this),n},onRemove:function(e){e.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(e,t,n){e.metric&&(this._mScale=pt("div",t,n)),e.imperial&&(this._iScale=pt("div",t,n))},_update:function(){var e=this._map,t=e.getSize().y/2,n=e.distance(e.containerPointToLatLng([0,t]),e.containerPointToLatLng([this.options.maxWidth,t]));this._updateScales(n)},_updateScales:function(e){this.options.metric&&e&&this._updateMetric(e),this.options.imperial&&e&&this._updateImperial(e)},_updateMetric:function(e){var t=this._getRoundNum(e),n=t<1e3?t+" m":t/1e3+" km";this._updateScale(this._mScale,n,t/e)},_updateImperial:function(e){var t,n,r,i=3.2808399*e;i>5280?(t=i/5280,n=this._getRoundNum(t),this._updateScale(this._iScale,n+" mi",n/t)):(r=this._getRoundNum(i),this._updateScale(this._iScale,r+" ft",r/i))},_updateScale:function(e,t,n){e.style.width=Math.round(this.options.maxWidth*n)+"px",e.innerHTML=t},_getRoundNum:function(e){var t=Math.pow(10,(Math.floor(e)+"").length-1),n=e/t;return t*(n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1)}}),hn=function(e){return new dn(e)},pn='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',fn=sn.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Me.inlineSvg?pn+" ":"")+"Leaflet</a>"},initialize:function(e){p(this,e),this._attributions={}},onAdd:function(e){for(var t in e.attributionControl=this,this._container=pt("div","leaflet-control-attribution"),Wt(this._container),e._layers)e._layers[t].getAttribution&&this.addAttribution(e._layers[t].getAttribution());return this._update(),e.on("layeradd",this._addAttribution,this),this._container},onRemove:function(e){e.off("layeradd",this._addAttribution,this)},_addAttribution:function(e){e.layer.getAttribution&&(this.addAttribution(e.layer.getAttribution()),e.layer.once("remove",function(){this.removeAttribution(e.layer.getAttribution())},this))},setPrefix:function(e){return this.options.prefix=e,this._update(),this},addAttribution:function(e){return e?(this._attributions[e]||(this._attributions[e]=0),this._attributions[e]++,this._update(),this):this},removeAttribution:function(e){return e?(this._attributions[e]&&(this._attributions[e]--,this._update()),this):this},_update:function(){if(this._map){var e=[];for(var t in this._attributions)this._attributions[t]&&e.push(t);var n=[];this.options.prefix&&n.push(this.options.prefix),e.length&&n.push(e.join(", ")),this._container.innerHTML=n.join(' <span aria-hidden="true">|</span> ')}}});nn.mergeOptions({attributionControl:!0}),nn.addInitHook(function(){this.options.attributionControl&&(new fn).addTo(this)});var mn=function(e){return new fn(e)};sn.Layers=on,sn.Zoom=cn,sn.Scale=dn,sn.Attribution=fn,an.layers=ln,an.zoom=un,an.scale=hn,an.attribution=mn;var gn=C.extend({initialize:function(e){this._map=e},enable:function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});gn.addTo=function(e,t){return e.addHandler(t,this),this};var vn={Events:A},yn=Me.touch?"touchstart mousedown":"mousedown",xn=I.extend({options:{clickTolerance:3},initialize:function(e,t,n,r){p(this,r),this._element=e,this._dragStartTarget=t||e,this._preventOutline=n},enable:function(){this._enabled||(Dt(this._dragStartTarget,yn,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(xn._dragging===this&&this.finishDrag(!0),zt(this._dragStartTarget,yn,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(e){if(this._enabled&&(this._moved=!1,!yt(this._element,"leaflet-zoom-anim")))if(e.touches&&1!==e.touches.length)xn._dragging===this&&this.finishDrag();else if(!(xn._dragging||e.shiftKey||1!==e.which&&1!==e.button&&!e.touches)&&(xn._dragging=this,this._preventOutline&&Pt(this._element),At(),rt(),!this._moving)){this.fire("down");var t=e.touches?e.touches[0]:e,n=Rt(this._element);this._startPoint=new P(t.clientX,t.clientY),this._startPos=Ct(this._element),this._parentScale=Ot(n);var r="mousedown"===e.type;Dt(document,r?"mousemove":"touchmove",this._onMove,this),Dt(document,r?"mouseup":"touchend touchcancel",this._onUp,this)}},_onMove:function(e){if(this._enabled)if(e.touches&&e.touches.length>1)this._moved=!0;else{var t=e.touches&&1===e.touches.length?e.touches[0]:e,n=new P(t.clientX,t.clientY)._subtract(this._startPoint);(n.x||n.y)&&(Math.abs(n.x)+Math.abs(n.y)<this.options.clickTolerance||(n.x/=this._parentScale.x,n.y/=this._parentScale.y,Gt(e),this._moved||(this.fire("dragstart"),this._moved=!0,xt(document.body,"leaflet-dragging"),this._lastTarget=e.target||e.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),xt(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(n),this._moving=!0,this._lastEvent=e,this._updatePosition()))}},_updatePosition:function(){var e={originalEvent:this._lastEvent};this.fire("predrag",e),Et(this._element,this._newPos),this.fire("drag",e)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(e){bt(document.body,"leaflet-dragging"),this._lastTarget&&(bt(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),zt(document,"mousemove touchmove",this._onMove,this),zt(document,"mouseup touchend touchcancel",this._onUp,this),It(),it();var t=this._moved&&this._moving;this._moving=!1,xn._dragging=!1,t&&this.fire("dragend",{noInertia:e,distance:this._newPos.distanceTo(this._startPos)})}});function bn(e,t,n){var r,i,s,a,o,l,c,u,d,h=[1,4,2,8];for(i=0,c=e.length;i<c;i++)e[i]._code=Ln(e[i],t);for(a=0;a<4;a++){for(u=h[a],r=[],i=0,s=(c=e.length)-1;i<c;s=i++)o=e[i],l=e[s],o._code&u?l._code&u||((d=Pn(l,o,u,t,n))._code=Ln(d,t),r.push(d)):(l._code&u&&((d=Pn(l,o,u,t,n))._code=Ln(d,t),r.push(d)),r.push(o));e=r}return e}function wn(e,t){var n,r,i,s,a,o,l,c,u;if(!e||0===e.length)throw new Error("latlngs not passed");Mn(e)||(console.warn("latlngs are not flat! Only the first ring will be used"),e=e[0]);var d=B([0,0]),h=z(e);h.getNorthWest().distanceTo(h.getSouthWest())*h.getNorthEast().distanceTo(h.getNorthWest())<1700&&(d=_n(e));var p=e.length,f=[];for(n=0;n<p;n++){var m=B(e[n]);f.push(t.project(B([m.lat-d.lat,m.lng-d.lng])))}for(o=l=c=0,n=0,r=p-1;n<p;r=n++)i=f[n],s=f[r],a=i.y*s.x-s.y*i.x,l+=(i.x+s.x)*a,c+=(i.y+s.y)*a,o+=3*a;u=0===o?f[0]:[l/o,c/o];var g=t.unproject(O(u));return B([g.lat+d.lat,g.lng+d.lng])}function _n(e){for(var t=0,n=0,r=0,i=0;i<e.length;i++){var s=B(e[i]);t+=s.lat,n+=s.lng,r++}return B([t/r,n/r])}var kn,Nn={__proto__:null,clipPolygon:bn,polygonCenter:wn,centroid:_n};function Sn(e,t){if(!t||!e.length)return e.slice();var n=t*t;return e=Cn(e=An(e,n),n)}function jn(e,t,n){return Math.sqrt(On(e,t,n,!0))}function En(e,t,n){return On(e,t,n)}function Cn(e,t){var n=e.length,r=new(typeof Uint8Array!==void 0+""?Uint8Array:Array)(n);r[0]=r[n-1]=1,Tn(e,r,t,0,n-1);var i,s=[];for(i=0;i<n;i++)r[i]&&s.push(e[i]);return s}function Tn(e,t,n,r,i){var s,a,o,l=0;for(a=r+1;a<=i-1;a++)(o=On(e[a],e[r],e[i],!0))>l&&(s=a,l=o);l>n&&(t[s]=1,Tn(e,t,n,r,s),Tn(e,t,n,s,i))}function An(e,t){for(var n=[e[0]],r=1,i=0,s=e.length;r<s;r++)Rn(e[r],e[i])>t&&(n.push(e[r]),i=r);return i<s-1&&n.push(e[s-1]),n}function In(e,t,n,r,i){var s,a,o,l=r?kn:Ln(e,n),c=Ln(t,n);for(kn=c;;){if(!(l|c))return[e,t];if(l&c)return!1;o=Ln(a=Pn(e,t,s=l||c,n,i),n),s===l?(e=a,l=o):(t=a,c=o)}}function Pn(e,t,n,r,i){var s,a,o=t.x-e.x,l=t.y-e.y,c=r.min,u=r.max;return 8&n?(s=e.x+o*(u.y-e.y)/l,a=u.y):4&n?(s=e.x+o*(c.y-e.y)/l,a=c.y):2&n?(s=u.x,a=e.y+l*(u.x-e.x)/o):1&n&&(s=c.x,a=e.y+l*(c.x-e.x)/o),new P(s,a,i)}function Ln(e,t){var n=0;return e.x<t.min.x?n|=1:e.x>t.max.x&&(n|=2),e.y<t.min.y?n|=4:e.y>t.max.y&&(n|=8),n}function Rn(e,t){var n=t.x-e.x,r=t.y-e.y;return n*n+r*r}function On(e,t,n,r){var i,s=t.x,a=t.y,o=n.x-s,l=n.y-a,c=o*o+l*l;return c>0&&((i=((e.x-s)*o+(e.y-a)*l)/c)>1?(s=n.x,a=n.y):i>0&&(s+=o*i,a+=l*i)),o=e.x-s,l=e.y-a,r?o*o+l*l:new P(s,a)}function Mn(e){return!v(e[0])||"object"!==typeof e[0][0]&&"undefined"!==typeof e[0][0]}function Dn(e){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Mn(e)}function Fn(e,t){var n,r,i,s,a,o,l,c;if(!e||0===e.length)throw new Error("latlngs not passed");Mn(e)||(console.warn("latlngs are not flat! Only the first ring will be used"),e=e[0]);var u=B([0,0]),d=z(e);d.getNorthWest().distanceTo(d.getSouthWest())*d.getNorthEast().distanceTo(d.getNorthWest())<1700&&(u=_n(e));var h=e.length,p=[];for(n=0;n<h;n++){var f=B(e[n]);p.push(t.project(B([f.lat-u.lat,f.lng-u.lng])))}for(n=0,r=0;n<h-1;n++)r+=p[n].distanceTo(p[n+1])/2;if(0===r)c=p[0];else for(n=0,s=0;n<h-1;n++)if(a=p[n],o=p[n+1],(s+=i=a.distanceTo(o))>r){l=(s-r)/i,c=[o.x-l*(o.x-a.x),o.y-l*(o.y-a.y)];break}var m=t.unproject(O(c));return B([m.lat+u.lat,m.lng+u.lng])}var zn={__proto__:null,simplify:Sn,pointToSegmentDistance:jn,closestPointOnSegment:En,clipSegment:In,_getEdgeIntersection:Pn,_getBitCode:Ln,_sqClosestPointOnSegment:On,isFlat:Mn,_flat:Dn,polylineCenter:Fn},Un={project:function(e){return new P(e.lng,e.lat)},unproject:function(e){return new U(e.y,e.x)},bounds:new M([-180,-90],[180,90])},Bn={R:6378137,R_MINOR:6356752.314245179,bounds:new M([-20037508.34279,-15496570.73972],[20037508.34279,18764656.23138]),project:function(e){var t=Math.PI/180,n=this.R,r=e.lat*t,i=this.R_MINOR/n,s=Math.sqrt(1-i*i),a=s*Math.sin(r),o=Math.tan(Math.PI/4-r/2)/Math.pow((1-a)/(1+a),s/2);return r=-n*Math.log(Math.max(o,1e-10)),new P(e.lng*t*n,r)},unproject:function(e){for(var t,n=180/Math.PI,r=this.R,i=this.R_MINOR/r,s=Math.sqrt(1-i*i),a=Math.exp(-e.y/r),o=Math.PI/2-2*Math.atan(a),l=0,c=.1;l<15&&Math.abs(c)>1e-7;l++)t=s*Math.sin(o),t=Math.pow((1-t)/(1+t),s/2),o+=c=Math.PI/2-2*Math.atan(a*t)-o;return new U(o*n,e.x*n/r)}},Vn={__proto__:null,LonLat:Un,Mercator:Bn,SphericalMercator:H},qn=n({},q,{code:"EPSG:3395",projection:Bn,transformation:function(){var e=.5/(Math.PI*Bn.R);return G(e,.5,-e,.5)}()}),Kn=n({},q,{code:"EPSG:4326",projection:Un,transformation:G(1/180,1,-1/180,.5)}),Hn=n({},V,{projection:Un,transformation:G(1,0,-1,0),scale:function(e){return Math.pow(2,e)},zoom:function(e){return Math.log(e)/Math.LN2},distance:function(e,t){var n=t.lng-e.lng,r=t.lat-e.lat;return Math.sqrt(n*n+r*r)},infinite:!0});V.Earth=q,V.EPSG3395=qn,V.EPSG3857=Z,V.EPSG900913=Q,V.EPSG4326=Kn,V.Simple=Hn;var Wn=I.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(e){return e.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(e){return e&&e.removeLayer(this),this},getPane:function(e){return this._map.getPane(e?this.options[e]||e:this.options.pane)},addInteractiveTarget:function(e){return this._map._targets[a(e)]=this,this},removeInteractiveTarget:function(e){return delete this._map._targets[a(e)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(e){var t=e.target;if(t.hasLayer(this)){if(this._map=t,this._zoomAnimated=t._zoomAnimated,this.getEvents){var n=this.getEvents();t.on(n,this),this.once("remove",function(){t.off(n,this)},this)}this.onAdd(t),this.fire("add"),t.fire("layeradd",{layer:this})}}});nn.include({addLayer:function(e){if(!e._layerAdd)throw new Error("The provided object is not a Layer.");var t=a(e);return this._layers[t]||(this._layers[t]=e,e._mapToAdd=this,e.beforeAdd&&e.beforeAdd(this),this.whenReady(e._layerAdd,e)),this},removeLayer:function(e){var t=a(e);return this._layers[t]?(this._loaded&&e.onRemove(this),delete this._layers[t],this._loaded&&(this.fire("layerremove",{layer:e}),e.fire("remove")),e._map=e._mapToAdd=null,this):this},hasLayer:function(e){return a(e)in this._layers},eachLayer:function(e,t){for(var n in this._layers)e.call(t,this._layers[n]);return this},_addLayers:function(e){for(var t=0,n=(e=e?v(e)?e:[e]:[]).length;t<n;t++)this.addLayer(e[t])},_addZoomLimit:function(e){isNaN(e.options.maxZoom)&&isNaN(e.options.minZoom)||(this._zoomBoundLayers[a(e)]=e,this._updateZoomLevels())},_removeZoomLimit:function(e){var t=a(e);this._zoomBoundLayers[t]&&(delete this._zoomBoundLayers[t],this._updateZoomLevels())},_updateZoomLevels:function(){var e=1/0,t=-1/0,n=this._getZoomSpan();for(var r in this._zoomBoundLayers){var i=this._zoomBoundLayers[r].options;e=void 0===i.minZoom?e:Math.min(e,i.minZoom),t=void 0===i.maxZoom?t:Math.max(t,i.maxZoom)}this._layersMaxZoom=t===-1/0?void 0:t,this._layersMinZoom=e===1/0?void 0:e,n!==this._getZoomSpan()&&this.fire("zoomlevelschange"),void 0===this.options.maxZoom&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),void 0===this.options.minZoom&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Gn=Wn.extend({initialize:function(e,t){var n,r;if(p(this,t),this._layers={},e)for(n=0,r=e.length;n<r;n++)this.addLayer(e[n])},addLayer:function(e){var t=this.getLayerId(e);return this._layers[t]=e,this._map&&this._map.addLayer(e),this},removeLayer:function(e){var t=e in this._layers?e:this.getLayerId(e);return this._map&&this._layers[t]&&this._map.removeLayer(this._layers[t]),delete this._layers[t],this},hasLayer:function(e){return("number"===typeof e?e:this.getLayerId(e))in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(e){var t,n,r=Array.prototype.slice.call(arguments,1);for(t in this._layers)(n=this._layers[t])[e]&&n[e].apply(n,r);return this},onAdd:function(e){this.eachLayer(e.addLayer,e)},onRemove:function(e){this.eachLayer(e.removeLayer,e)},eachLayer:function(e,t){for(var n in this._layers)e.call(t,this._layers[n]);return this},getLayer:function(e){return this._layers[e]},getLayers:function(){var e=[];return this.eachLayer(e.push,e),e},setZIndex:function(e){return this.invoke("setZIndex",e)},getLayerId:function(e){return a(e)}}),Zn=function(e,t){return new Gn(e,t)},Qn=Gn.extend({addLayer:function(e){return this.hasLayer(e)?this:(e.addEventParent(this),Gn.prototype.addLayer.call(this,e),this.fire("layeradd",{layer:e}))},removeLayer:function(e){return this.hasLayer(e)?(e in this._layers&&(e=this._layers[e]),e.removeEventParent(this),Gn.prototype.removeLayer.call(this,e),this.fire("layerremove",{layer:e})):this},setStyle:function(e){return this.invoke("setStyle",e)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var e=new F;for(var t in this._layers){var n=this._layers[t];e.extend(n.getBounds?n.getBounds():n.getLatLng())}return e}}),Jn=function(e,t){return new Qn(e,t)},Yn=C.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(e){p(this,e)},createIcon:function(e){return this._createIcon("icon",e)},createShadow:function(e){return this._createIcon("shadow",e)},_createIcon:function(e,t){var n=this._getIconUrl(e);if(!n){if("icon"===e)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var r=this._createImg(n,t&&"IMG"===t.tagName?t:null);return this._setIconStyles(r,e),(this.options.crossOrigin||""===this.options.crossOrigin)&&(r.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),r},_setIconStyles:function(e,t){var n=this.options,r=n[t+"Size"];"number"===typeof r&&(r=[r,r]);var i=O(r),s=O("shadow"===t&&n.shadowAnchor||n.iconAnchor||i&&i.divideBy(2,!0));e.className="leaflet-marker-"+t+" "+(n.className||""),s&&(e.style.marginLeft=-s.x+"px",e.style.marginTop=-s.y+"px"),i&&(e.style.width=i.x+"px",e.style.height=i.y+"px")},_createImg:function(e,t){return(t=t||document.createElement("img")).src=e,t},_getIconUrl:function(e){return Me.retina&&this.options[e+"RetinaUrl"]||this.options[e+"Url"]}});function Xn(e){return new Yn(e)}var $n=Yn.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(e){return"string"!==typeof $n.imagePath&&($n.imagePath=this._detectIconPath()),(this.options.imagePath||$n.imagePath)+Yn.prototype._getIconUrl.call(this,e)},_stripUrl:function(e){var t=function(e,t,n){var r=t.exec(e);return r&&r[n]};return(e=t(e,/^url\((['"])?(.+)\1\)$/,2))&&t(e,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var e=pt("div","leaflet-default-icon-path",document.body),t=ht(e,"background-image")||ht(e,"backgroundImage");if(document.body.removeChild(e),t=this._stripUrl(t))return t;var n=document.querySelector('link[href$="leaflet.css"]');return n?n.href.substring(0,n.href.length-11-1):""}}),er=gn.extend({initialize:function(e){this._marker=e},addHooks:function(){var e=this._marker._icon;this._draggable||(this._draggable=new xn(e,e,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),xt(e,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&bt(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(e){var t=this._marker,n=t._map,r=this._marker.options.autoPanSpeed,i=this._marker.options.autoPanPadding,s=Ct(t._icon),a=n.getPixelBounds(),o=n.getPixelOrigin(),l=D(a.min._subtract(o).add(i),a.max._subtract(o).subtract(i));if(!l.contains(s)){var c=O((Math.max(l.max.x,s.x)-l.max.x)/(a.max.x-l.max.x)-(Math.min(l.min.x,s.x)-l.min.x)/(a.min.x-l.min.x),(Math.max(l.max.y,s.y)-l.max.y)/(a.max.y-l.max.y)-(Math.min(l.min.y,s.y)-l.min.y)/(a.min.y-l.min.y)).multiplyBy(r);n.panBy(c,{animate:!1}),this._draggable._newPos._add(c),this._draggable._startPos._add(c),Et(t._icon,this._draggable._newPos),this._onDrag(e),this._panRequest=S(this._adjustPan.bind(this,e))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(e){this._marker.options.autoPan&&(j(this._panRequest),this._panRequest=S(this._adjustPan.bind(this,e)))},_onDrag:function(e){var t=this._marker,n=t._shadow,r=Ct(t._icon),i=t._map.layerPointToLatLng(r);n&&Et(n,r),t._latlng=i,e.latlng=i,e.oldLatLng=this._oldLatLng,t.fire("move",e).fire("drag",e)},_onDragEnd:function(e){j(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",e)}}),tr=Wn.extend({options:{icon:new $n,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(e,t){p(this,t),this._latlng=B(e)},onAdd:function(e){this._zoomAnimated=this._zoomAnimated&&e.options.markerZoomAnimation,this._zoomAnimated&&e.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(e){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&e.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(e){var t=this._latlng;return this._latlng=B(e),this.update(),this.fire("move",{oldLatLng:t,latlng:this._latlng})},setZIndexOffset:function(e){return this.options.zIndexOffset=e,this.update()},getIcon:function(){return this.options.icon},setIcon:function(e){return this.options.icon=e,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var e=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(e)}return this},_initIcon:function(){var e=this.options,t="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),n=e.icon.createIcon(this._icon),r=!1;n!==this._icon&&(this._icon&&this._removeIcon(),r=!0,e.title&&(n.title=e.title),"IMG"===n.tagName&&(n.alt=e.alt||"")),xt(n,t),e.keyboard&&(n.tabIndex="0",n.setAttribute("role","button")),this._icon=n,e.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Dt(n,"focus",this._panOnFocus,this);var i=e.icon.createShadow(this._shadow),s=!1;i!==this._shadow&&(this._removeShadow(),s=!0),i&&(xt(i,t),i.alt=""),this._shadow=i,e.opacity<1&&this._updateOpacity(),r&&this.getPane().appendChild(this._icon),this._initInteraction(),i&&s&&this.getPane(e.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&zt(this._icon,"focus",this._panOnFocus,this),ft(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&ft(this._shadow),this._shadow=null},_setPos:function(e){this._icon&&Et(this._icon,e),this._shadow&&Et(this._shadow,e),this._zIndex=e.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(e){this._icon&&(this._icon.style.zIndex=this._zIndex+e)},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center).round();this._setPos(t)},_initInteraction:function(){if(this.options.interactive&&(xt(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),er)){var e=this.options.draggable;this.dragging&&(e=this.dragging.enabled(),this.dragging.disable()),this.dragging=new er(this),e&&this.dragging.enable()}},setOpacity:function(e){return this.options.opacity=e,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var e=this.options.opacity;this._icon&&kt(this._icon,e),this._shadow&&kt(this._shadow,e)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var e=this._map;if(e){var t=this.options.icon.options,n=t.iconSize?O(t.iconSize):O(0,0),r=t.iconAnchor?O(t.iconAnchor):O(0,0);e.panInside(this._latlng,{paddingTopLeft:r,paddingBottomRight:n.subtract(r)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function nr(e,t){return new tr(e,t)}var rr=Wn.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(e){this._renderer=e.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(e){return p(this,e),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&e&&Object.prototype.hasOwnProperty.call(e,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),ir=rr.extend({options:{fill:!0,radius:10},initialize:function(e,t){p(this,t),this._latlng=B(e),this._radius=this.options.radius},setLatLng:function(e){var t=this._latlng;return this._latlng=B(e),this.redraw(),this.fire("move",{oldLatLng:t,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(e){return this.options.radius=this._radius=e,this.redraw()},getRadius:function(){return this._radius},setStyle:function(e){var t=e&&e.radius||this._radius;return rr.prototype.setStyle.call(this,e),this.setRadius(t),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var e=this._radius,t=this._radiusY||e,n=this._clickTolerance(),r=[e+n,t+n];this._pxBounds=new M(this._point.subtract(r),this._point.add(r))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(e){return e.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function sr(e,t){return new ir(e,t)}var ar=ir.extend({initialize:function(e,t,r){if("number"===typeof t&&(t=n({},r,{radius:t})),p(this,t),this._latlng=B(e),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(e){return this._mRadius=e,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var e=[this._radius,this._radiusY||this._radius];return new F(this._map.layerPointToLatLng(this._point.subtract(e)),this._map.layerPointToLatLng(this._point.add(e)))},setStyle:rr.prototype.setStyle,_project:function(){var e=this._latlng.lng,t=this._latlng.lat,n=this._map,r=n.options.crs;if(r.distance===q.distance){var i=Math.PI/180,s=this._mRadius/q.R/i,a=n.project([t+s,e]),o=n.project([t-s,e]),l=a.add(o).divideBy(2),c=n.unproject(l).lat,u=Math.acos((Math.cos(s*i)-Math.sin(t*i)*Math.sin(c*i))/(Math.cos(t*i)*Math.cos(c*i)))/i;(isNaN(u)||0===u)&&(u=s/Math.cos(Math.PI/180*t)),this._point=l.subtract(n.getPixelOrigin()),this._radius=isNaN(u)?0:l.x-n.project([c,e-u]).x,this._radiusY=l.y-a.y}else{var d=r.unproject(r.project(this._latlng).subtract([this._mRadius,0]));this._point=n.latLngToLayerPoint(this._latlng),this._radius=this._point.x-n.latLngToLayerPoint(d).x}this._updateBounds()}});function or(e,t,n){return new ar(e,t,n)}var lr=rr.extend({options:{smoothFactor:1,noClip:!1},initialize:function(e,t){p(this,t),this._setLatLngs(e)},getLatLngs:function(){return this._latlngs},setLatLngs:function(e){return this._setLatLngs(e),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(e){for(var t,n,r=1/0,i=null,s=On,a=0,o=this._parts.length;a<o;a++)for(var l=this._parts[a],c=1,u=l.length;c<u;c++){var d=s(e,t=l[c-1],n=l[c],!0);d<r&&(r=d,i=s(e,t,n))}return i&&(i.distance=Math.sqrt(r)),i},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Fn(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(e,t){return t=t||this._defaultShape(),e=B(e),t.push(e),this._bounds.extend(e),this.redraw()},_setLatLngs:function(e){this._bounds=new F,this._latlngs=this._convertLatLngs(e)},_defaultShape:function(){return Mn(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(e){for(var t=[],n=Mn(e),r=0,i=e.length;r<i;r++)n?(t[r]=B(e[r]),this._bounds.extend(t[r])):t[r]=this._convertLatLngs(e[r]);return t},_project:function(){var e=new M;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,e),this._bounds.isValid()&&e.isValid()&&(this._rawPxBounds=e,this._updateBounds())},_updateBounds:function(){var e=this._clickTolerance(),t=new P(e,e);this._rawPxBounds&&(this._pxBounds=new M([this._rawPxBounds.min.subtract(t),this._rawPxBounds.max.add(t)]))},_projectLatlngs:function(e,t,n){var r,i,s=e[0]instanceof U,a=e.length;if(s){for(i=[],r=0;r<a;r++)i[r]=this._map.latLngToLayerPoint(e[r]),n.extend(i[r]);t.push(i)}else for(r=0;r<a;r++)this._projectLatlngs(e[r],t,n)},_clipPoints:function(){var e=this._renderer._bounds;if(this._parts=[],this._pxBounds&&this._pxBounds.intersects(e))if(this.options.noClip)this._parts=this._rings;else{var t,n,r,i,s,a,o,l=this._parts;for(t=0,r=0,i=this._rings.length;t<i;t++)for(n=0,s=(o=this._rings[t]).length;n<s-1;n++)(a=In(o[n],o[n+1],e,n,!0))&&(l[r]=l[r]||[],l[r].push(a[0]),a[1]===o[n+1]&&n!==s-2||(l[r].push(a[1]),r++))}},_simplifyPoints:function(){for(var e=this._parts,t=this.options.smoothFactor,n=0,r=e.length;n<r;n++)e[n]=Sn(e[n],t)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(e,t){var n,r,i,s,a,o,l=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(e))return!1;for(n=0,s=this._parts.length;n<s;n++)for(r=0,i=(a=(o=this._parts[n]).length)-1;r<a;i=r++)if((t||0!==r)&&jn(e,o[i],o[r])<=l)return!0;return!1}});function cr(e,t){return new lr(e,t)}lr._flat=Dn;var ur=lr.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return wn(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(e){var t=lr.prototype._convertLatLngs.call(this,e),n=t.length;return n>=2&&t[0]instanceof U&&t[0].equals(t[n-1])&&t.pop(),t},_setLatLngs:function(e){lr.prototype._setLatLngs.call(this,e),Mn(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Mn(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var e=this._renderer._bounds,t=this.options.weight,n=new P(t,t);if(e=new M(e.min.subtract(n),e.max.add(n)),this._parts=[],this._pxBounds&&this._pxBounds.intersects(e))if(this.options.noClip)this._parts=this._rings;else for(var r,i=0,s=this._rings.length;i<s;i++)(r=bn(this._rings[i],e,!0)).length&&this._parts.push(r)},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(e){var t,n,r,i,s,a,o,l,c=!1;if(!this._pxBounds||!this._pxBounds.contains(e))return!1;for(i=0,o=this._parts.length;i<o;i++)for(s=0,a=(l=(t=this._parts[i]).length)-1;s<l;a=s++)n=t[s],r=t[a],n.y>e.y!==r.y>e.y&&e.x<(r.x-n.x)*(e.y-n.y)/(r.y-n.y)+n.x&&(c=!c);return c||lr.prototype._containsPoint.call(this,e,!0)}});function dr(e,t){return new ur(e,t)}var hr=Qn.extend({initialize:function(e,t){p(this,t),this._layers={},e&&this.addData(e)},addData:function(e){var t,n,r,i=v(e)?e:e.features;if(i){for(t=0,n=i.length;t<n;t++)((r=i[t]).geometries||r.geometry||r.features||r.coordinates)&&this.addData(r);return this}var s=this.options;if(s.filter&&!s.filter(e))return this;var a=pr(e,s);return a?(a.feature=br(e),a.defaultOptions=a.options,this.resetStyle(a),s.onEachFeature&&s.onEachFeature(e,a),this.addLayer(a)):this},resetStyle:function(e){return void 0===e?this.eachLayer(this.resetStyle,this):(e.options=n({},e.defaultOptions),this._setLayerStyle(e,this.options.style),this)},setStyle:function(e){return this.eachLayer(function(t){this._setLayerStyle(t,e)},this)},_setLayerStyle:function(e,t){e.setStyle&&("function"===typeof t&&(t=t(e.feature)),e.setStyle(t))}});function pr(e,t){var n,r,i,s,a="Feature"===e.type?e.geometry:e,o=a?a.coordinates:null,l=[],c=t&&t.pointToLayer,u=t&&t.coordsToLatLng||mr;if(!o&&!a)return null;switch(a.type){case"Point":return fr(c,e,n=u(o),t);case"MultiPoint":for(i=0,s=o.length;i<s;i++)n=u(o[i]),l.push(fr(c,e,n,t));return new Qn(l);case"LineString":case"MultiLineString":return r=gr(o,"LineString"===a.type?0:1,u),new lr(r,t);case"Polygon":case"MultiPolygon":return r=gr(o,"Polygon"===a.type?1:2,u),new ur(r,t);case"GeometryCollection":for(i=0,s=a.geometries.length;i<s;i++){var d=pr({geometry:a.geometries[i],type:"Feature",properties:e.properties},t);d&&l.push(d)}return new Qn(l);case"FeatureCollection":for(i=0,s=a.features.length;i<s;i++){var h=pr(a.features[i],t);h&&l.push(h)}return new Qn(l);default:throw new Error("Invalid GeoJSON object.")}}function fr(e,t,n,r){return e?e(t,n):new tr(n,r&&r.markersInheritOptions&&r)}function mr(e){return new U(e[1],e[0],e[2])}function gr(e,t,n){for(var r,i=[],s=0,a=e.length;s<a;s++)r=t?gr(e[s],t-1,n):(n||mr)(e[s]),i.push(r);return i}function vr(e,t){return void 0!==(e=B(e)).alt?[u(e.lng,t),u(e.lat,t),u(e.alt,t)]:[u(e.lng,t),u(e.lat,t)]}function yr(e,t,n,r){for(var i=[],s=0,a=e.length;s<a;s++)i.push(t?yr(e[s],Mn(e[s])?0:t-1,n,r):vr(e[s],r));return!t&&n&&i.length>0&&i.push(i[0].slice()),i}function xr(e,t){return e.feature?n({},e.feature,{geometry:t}):br(t)}function br(e){return"Feature"===e.type||"FeatureCollection"===e.type?e:{type:"Feature",properties:{},geometry:e}}var wr={toGeoJSON:function(e){return xr(this,{type:"Point",coordinates:vr(this.getLatLng(),e)})}};function _r(e,t){return new hr(e,t)}tr.include(wr),ar.include(wr),ir.include(wr),lr.include({toGeoJSON:function(e){var t=!Mn(this._latlngs);return xr(this,{type:(t?"Multi":"")+"LineString",coordinates:yr(this._latlngs,t?1:0,!1,e)})}}),ur.include({toGeoJSON:function(e){var t=!Mn(this._latlngs),n=t&&!Mn(this._latlngs[0]),r=yr(this._latlngs,n?2:t?1:0,!0,e);return t||(r=[r]),xr(this,{type:(n?"Multi":"")+"Polygon",coordinates:r})}}),Gn.include({toMultiPoint:function(e){var t=[];return this.eachLayer(function(n){t.push(n.toGeoJSON(e).geometry.coordinates)}),xr(this,{type:"MultiPoint",coordinates:t})},toGeoJSON:function(e){var t=this.feature&&this.feature.geometry&&this.feature.geometry.type;if("MultiPoint"===t)return this.toMultiPoint(e);var n="GeometryCollection"===t,r=[];return this.eachLayer(function(t){if(t.toGeoJSON){var i=t.toGeoJSON(e);if(n)r.push(i.geometry);else{var s=br(i);"FeatureCollection"===s.type?r.push.apply(r,s.features):r.push(s)}}}),n?xr(this,{geometries:r,type:"GeometryCollection"}):{type:"FeatureCollection",features:r}}});var kr=_r,Nr=Wn.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(e,t,n){this._url=e,this._bounds=z(t),p(this,n)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(xt(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){ft(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(e){return this.options.opacity=e,this._image&&this._updateOpacity(),this},setStyle:function(e){return e.opacity&&this.setOpacity(e.opacity),this},bringToFront:function(){return this._map&&gt(this._image),this},bringToBack:function(){return this._map&&vt(this._image),this},setUrl:function(e){return this._url=e,this._image&&(this._image.src=e),this},setBounds:function(e){return this._bounds=z(e),this._map&&this._reset(),this},getEvents:function(){var e={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},setZIndex:function(e){return this.options.zIndex=e,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var e="IMG"===this._url.tagName,t=this._image=e?this._url:pt("img");xt(t,"leaflet-image-layer"),this._zoomAnimated&&xt(t,"leaflet-zoom-animated"),this.options.className&&xt(t,this.options.className),t.onselectstart=c,t.onmousemove=c,t.onload=i(this.fire,this,"load"),t.onerror=i(this._overlayOnError,this,"error"),(this.options.crossOrigin||""===this.options.crossOrigin)&&(t.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),e?this._url=t.src:(t.src=this._url,t.alt=this.options.alt)},_animateZoom:function(e){var t=this._map.getZoomScale(e.zoom),n=this._map._latLngBoundsToNewLayerBounds(this._bounds,e.zoom,e.center).min;jt(this._image,n,t)},_reset:function(){var e=this._image,t=new M(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),n=t.getSize();Et(e,t.min),e.style.width=n.x+"px",e.style.height=n.y+"px"},_updateOpacity:function(){kt(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var e=this.options.errorOverlayUrl;e&&this._url!==e&&(this._url=e,this._image.src=e)},getCenter:function(){return this._bounds.getCenter()}}),Sr=function(e,t,n){return new Nr(e,t,n)},jr=Nr.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var e="VIDEO"===this._url.tagName,t=this._image=e?this._url:pt("video");if(xt(t,"leaflet-image-layer"),this._zoomAnimated&&xt(t,"leaflet-zoom-animated"),this.options.className&&xt(t,this.options.className),t.onselectstart=c,t.onmousemove=c,t.onloadeddata=i(this.fire,this,"load"),e){for(var n=t.getElementsByTagName("source"),r=[],s=0;s<n.length;s++)r.push(n[s].src);this._url=n.length>0?r:[t.src]}else{v(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(t.style,"objectFit")&&(t.style.objectFit="fill"),t.autoplay=!!this.options.autoplay,t.loop=!!this.options.loop,t.muted=!!this.options.muted,t.playsInline=!!this.options.playsInline;for(var a=0;a<this._url.length;a++){var o=pt("source");o.src=this._url[a],t.appendChild(o)}}}});function Er(e,t,n){return new jr(e,t,n)}var Cr=Nr.extend({_initImage:function(){var e=this._image=this._url;xt(e,"leaflet-image-layer"),this._zoomAnimated&&xt(e,"leaflet-zoom-animated"),this.options.className&&xt(e,this.options.className),e.onselectstart=c,e.onmousemove=c}});function Tr(e,t,n){return new Cr(e,t,n)}var Ar=Wn.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(e,t){e&&(e instanceof U||v(e))?(this._latlng=B(e),p(this,t)):(p(this,e),this._source=t),this.options.content&&(this._content=this.options.content)},openOn:function(e){return(e=arguments.length?e:this._source._map).hasLayer(this)||e.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(e){return this._map?this.close():(arguments.length?this._source=e:e=this._source,this._prepareOpen(),this.openOn(e._map)),this},onAdd:function(e){this._zoomAnimated=e._zoomAnimated,this._container||this._initLayout(),e._fadeAnimated&&kt(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),e._fadeAnimated&&kt(this._container,1),this.bringToFront(),this.options.interactive&&(xt(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(e){e._fadeAnimated?(kt(this._container,0),this._removeTimeout=setTimeout(i(ft,void 0,this._container),200)):ft(this._container),this.options.interactive&&(bt(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(e){return this._latlng=B(e),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(e){return this._content=e,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var e={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&gt(this._container),this},bringToBack:function(){return this._map&&vt(this._container),this},_prepareOpen:function(e){var t=this._source;if(!t._map)return!1;if(t instanceof Qn){t=null;var n=this._source._layers;for(var r in n)if(n[r]._map){t=n[r];break}if(!t)return!1;this._source=t}if(!e)if(t.getCenter)e=t.getCenter();else if(t.getLatLng)e=t.getLatLng();else{if(!t.getBounds)throw new Error("Unable to get source layer LatLng.");e=t.getBounds().getCenter()}return this.setLatLng(e),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var e=this._contentNode,t="function"===typeof this._content?this._content(this._source||this):this._content;if("string"===typeof t)e.innerHTML=t;else{for(;e.hasChildNodes();)e.removeChild(e.firstChild);e.appendChild(t)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var e=this._map.latLngToLayerPoint(this._latlng),t=O(this.options.offset),n=this._getAnchor();this._zoomAnimated?Et(this._container,e.add(n)):t=t.add(e).add(n);var r=this._containerBottom=-t.y,i=this._containerLeft=-Math.round(this._containerWidth/2)+t.x;this._container.style.bottom=r+"px",this._container.style.left=i+"px"}},_getAnchor:function(){return[0,0]}});nn.include({_initOverlay:function(e,t,n,r){var i=t;return i instanceof e||(i=new e(r).setContent(t)),n&&i.setLatLng(n),i}}),Wn.include({_initOverlay:function(e,t,n,r){var i=n;return i instanceof e?(p(i,r),i._source=this):(i=t&&!r?t:new e(r,this)).setContent(n),i}});var Ir=Ar.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(e){return!(e=arguments.length?e:this._source._map).hasLayer(this)&&e._popup&&e._popup.options.autoClose&&e.removeLayer(e._popup),e._popup=this,Ar.prototype.openOn.call(this,e)},onAdd:function(e){Ar.prototype.onAdd.call(this,e),e.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof rr||this._source.on("preclick",Kt))},onRemove:function(e){Ar.prototype.onRemove.call(this,e),e.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof rr||this._source.off("preclick",Kt))},getEvents:function(){var e=Ar.prototype.getEvents.call(this);return(void 0!==this.options.closeOnClick?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(e.preclick=this.close),this.options.keepInView&&(e.moveend=this._adjustPan),e},_initLayout:function(){var e="leaflet-popup",t=this._container=pt("div",e+" "+(this.options.className||"")+" leaflet-zoom-animated"),n=this._wrapper=pt("div",e+"-content-wrapper",t);if(this._contentNode=pt("div",e+"-content",n),Wt(t),Ht(this._contentNode),Dt(t,"contextmenu",Kt),this._tipContainer=pt("div",e+"-tip-container",t),this._tip=pt("div",e+"-tip",this._tipContainer),this.options.closeButton){var r=this._closeButton=pt("a",e+"-close-button",t);r.setAttribute("role","button"),r.setAttribute("aria-label","Close popup"),r.href="#close",r.innerHTML='<span aria-hidden="true">&#215;</span>',Dt(r,"click",function(e){Gt(e),this.close()},this)}},_updateLayout:function(){var e=this._contentNode,t=e.style;t.width="",t.whiteSpace="nowrap";var n=e.offsetWidth;n=Math.min(n,this.options.maxWidth),n=Math.max(n,this.options.minWidth),t.width=n+1+"px",t.whiteSpace="",t.height="";var r=e.offsetHeight,i=this.options.maxHeight,s="leaflet-popup-scrolled";i&&r>i?(t.height=i+"px",xt(e,s)):bt(e,s),this._containerWidth=this._container.offsetWidth},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center),n=this._getAnchor();Et(this._container,t.add(n))},_adjustPan:function(){if(this.options.autoPan)if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning)this._autopanning=!1;else{var e=this._map,t=parseInt(ht(this._container,"marginBottom"),10)||0,n=this._container.offsetHeight+t,r=this._containerWidth,i=new P(this._containerLeft,-n-this._containerBottom);i._add(Ct(this._container));var s=e.layerPointToContainerPoint(i),a=O(this.options.autoPanPadding),o=O(this.options.autoPanPaddingTopLeft||a),l=O(this.options.autoPanPaddingBottomRight||a),c=e.getSize(),u=0,d=0;s.x+r+l.x>c.x&&(u=s.x+r-c.x+l.x),s.x-u-o.x<0&&(u=s.x-o.x),s.y+n+l.y>c.y&&(d=s.y+n-c.y+l.y),s.y-d-o.y<0&&(d=s.y-o.y),(u||d)&&(this.options.keepInView&&(this._autopanning=!0),e.fire("autopanstart").panBy([u,d]))}},_getAnchor:function(){return O(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),Pr=function(e,t){return new Ir(e,t)};nn.mergeOptions({closePopupOnClick:!0}),nn.include({openPopup:function(e,t,n){return this._initOverlay(Ir,e,t,n).openOn(this),this},closePopup:function(e){return(e=arguments.length?e:this._popup)&&e.close(),this}}),Wn.include({bindPopup:function(e,t){return this._popup=this._initOverlay(Ir,this._popup,e,t),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(e){return this._popup&&(this instanceof Qn||(this._popup._source=this),this._popup._prepareOpen(e||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return!!this._popup&&this._popup.isOpen()},setPopupContent:function(e){return this._popup&&this._popup.setContent(e),this},getPopup:function(){return this._popup},_openPopup:function(e){if(this._popup&&this._map){Zt(e);var t=e.layer||e.target;this._popup._source!==t||t instanceof rr?(this._popup._source=t,this.openPopup(e.latlng)):this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(e.latlng)}},_movePopup:function(e){this._popup.setLatLng(e.latlng)},_onKeyPress:function(e){13===e.originalEvent.keyCode&&this._openPopup(e)}});var Lr=Ar.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(e){Ar.prototype.onAdd.call(this,e),this.setOpacity(this.options.opacity),e.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(e){Ar.prototype.onRemove.call(this,e),e.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var e=Ar.prototype.getEvents.call(this);return this.options.permanent||(e.preclick=this.close),e},_initLayout:function(){var e="leaflet-tooltip "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=pt("div",e),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+a(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(e){var t,n,r=this._map,i=this._container,s=r.latLngToContainerPoint(r.getCenter()),a=r.layerPointToContainerPoint(e),o=this.options.direction,l=i.offsetWidth,c=i.offsetHeight,u=O(this.options.offset),d=this._getAnchor();"top"===o?(t=l/2,n=c):"bottom"===o?(t=l/2,n=0):"center"===o?(t=l/2,n=c/2):"right"===o?(t=0,n=c/2):"left"===o?(t=l,n=c/2):a.x<s.x?(o="right",t=0,n=c/2):(o="left",t=l+2*(u.x+d.x),n=c/2),e=e.subtract(O(t,n,!0)).add(u).add(d),bt(i,"leaflet-tooltip-right"),bt(i,"leaflet-tooltip-left"),bt(i,"leaflet-tooltip-top"),bt(i,"leaflet-tooltip-bottom"),xt(i,"leaflet-tooltip-"+o),Et(i,e)},_updatePosition:function(){var e=this._map.latLngToLayerPoint(this._latlng);this._setPosition(e)},setOpacity:function(e){this.options.opacity=e,this._container&&kt(this._container,e)},_animateZoom:function(e){var t=this._map._latLngToNewLayerPoint(this._latlng,e.zoom,e.center);this._setPosition(t)},_getAnchor:function(){return O(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Rr=function(e,t){return new Lr(e,t)};nn.include({openTooltip:function(e,t,n){return this._initOverlay(Lr,e,t,n).openOn(this),this},closeTooltip:function(e){return e.close(),this}}),Wn.include({bindTooltip:function(e,t){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Lr,this._tooltip,e,t),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(e){if(e||!this._tooltipHandlersAdded){var t=e?"off":"on",n={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?n.add=this._openTooltip:(n.mouseover=this._openTooltip,n.mouseout=this.closeTooltip,n.click=this._openTooltip,this._map?this._addFocusListeners():n.add=this._addFocusListeners),this._tooltip.options.sticky&&(n.mousemove=this._moveTooltip),this[t](n),this._tooltipHandlersAdded=!e}},openTooltip:function(e){return this._tooltip&&(this instanceof Qn||(this._tooltip._source=this),this._tooltip._prepareOpen(e)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(e){return this._tooltip&&this._tooltip.setContent(e),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(e){var t="function"===typeof e.getElement&&e.getElement();t&&(Dt(t,"focus",function(){this._tooltip._source=e,this.openTooltip()},this),Dt(t,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(e){var t="function"===typeof e.getElement&&e.getElement();t&&t.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(e){if(this._tooltip&&this._map)if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var t=this;this._map.once("moveend",function(){t._openOnceFlag=!1,t._openTooltip(e)})}else this._tooltip._source=e.layer||e.target,this.openTooltip(this._tooltip.options.sticky?e.latlng:void 0)},_moveTooltip:function(e){var t,n,r=e.latlng;this._tooltip.options.sticky&&e.originalEvent&&(t=this._map.mouseEventToContainerPoint(e.originalEvent),n=this._map.containerPointToLayerPoint(t),r=this._map.layerPointToLatLng(n)),this._tooltip.setLatLng(r)}});var Or=Yn.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(e){var t=e&&"DIV"===e.tagName?e:document.createElement("div"),n=this.options;if(n.html instanceof Element?(mt(t),t.appendChild(n.html)):t.innerHTML=!1!==n.html?n.html:"",n.bgPos){var r=O(n.bgPos);t.style.backgroundPosition=-r.x+"px "+-r.y+"px"}return this._setIconStyles(t,"icon"),t},createShadow:function(){return null}});function Mr(e){return new Or(e)}Yn.Default=$n;var Dr=Wn.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Me.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(e){p(this,e)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(e){e._addZoomLimit(this)},onRemove:function(e){this._removeAllTiles(),ft(this._container),e._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(gt(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(vt(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(e){return this.options.opacity=e,this._updateOpacity(),this},setZIndex:function(e){return this.options.zIndex=e,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var e=this._clampZoom(this._map.getZoom());e!==this._tileZoom&&(this._tileZoom=e,this._updateLevels()),this._update()}return this},getEvents:function(){var e={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=o(this._onMoveEnd,this.options.updateInterval,this)),e.move=this._onMove),this._zoomAnimated&&(e.zoomanim=this._animateZoom),e},createTile:function(){return document.createElement("div")},getTileSize:function(){var e=this.options.tileSize;return e instanceof P?e:new P(e,e)},_updateZIndex:function(){this._container&&void 0!==this.options.zIndex&&null!==this.options.zIndex&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(e){for(var t,n=this.getPane().children,r=-e(-1/0,1/0),i=0,s=n.length;i<s;i++)t=n[i].style.zIndex,n[i]!==this._container&&t&&(r=e(r,+t));isFinite(r)&&(this.options.zIndex=r+e(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Me.ielt9){kt(this._container,this.options.opacity);var e=+new Date,t=!1,n=!1;for(var r in this._tiles){var i=this._tiles[r];if(i.current&&i.loaded){var s=Math.min(1,(e-i.loaded)/200);kt(i.el,s),s<1?t=!0:(i.active?n=!0:this._onOpaqueTile(i),i.active=!0)}}n&&!this._noPrune&&this._pruneTiles(),t&&(j(this._fadeFrame),this._fadeFrame=S(this._updateOpacity,this))}},_onOpaqueTile:c,_initContainer:function(){this._container||(this._container=pt("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var e=this._tileZoom,t=this.options.maxZoom;if(void 0!==e){for(var n in this._levels)n=Number(n),this._levels[n].el.children.length||n===e?(this._levels[n].el.style.zIndex=t-Math.abs(e-n),this._onUpdateLevel(n)):(ft(this._levels[n].el),this._removeTilesAtZoom(n),this._onRemoveLevel(n),delete this._levels[n]);var r=this._levels[e],i=this._map;return r||((r=this._levels[e]={}).el=pt("div","leaflet-tile-container leaflet-zoom-animated",this._container),r.el.style.zIndex=t,r.origin=i.project(i.unproject(i.getPixelOrigin()),e).round(),r.zoom=e,this._setZoomTransform(r,i.getCenter(),i.getZoom()),c(r.el.offsetWidth),this._onCreateLevel(r)),this._level=r,r}},_onUpdateLevel:c,_onRemoveLevel:c,_onCreateLevel:c,_pruneTiles:function(){if(this._map){var e,t,n=this._map.getZoom();if(n>this.options.maxZoom||n<this.options.minZoom)this._removeAllTiles();else{for(e in this._tiles)(t=this._tiles[e]).retain=t.current;for(e in this._tiles)if((t=this._tiles[e]).current&&!t.active){var r=t.coords;this._retainParent(r.x,r.y,r.z,r.z-5)||this._retainChildren(r.x,r.y,r.z,r.z+2)}for(e in this._tiles)this._tiles[e].retain||this._removeTile(e)}}},_removeTilesAtZoom:function(e){for(var t in this._tiles)this._tiles[t].coords.z===e&&this._removeTile(t)},_removeAllTiles:function(){for(var e in this._tiles)this._removeTile(e)},_invalidateAll:function(){for(var e in this._levels)ft(this._levels[e].el),this._onRemoveLevel(Number(e)),delete this._levels[e];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(e,t,n,r){var i=Math.floor(e/2),s=Math.floor(t/2),a=n-1,o=new P(+i,+s);o.z=+a;var l=this._tileCoordsToKey(o),c=this._tiles[l];return c&&c.active?(c.retain=!0,!0):(c&&c.loaded&&(c.retain=!0),a>r&&this._retainParent(i,s,a,r))},_retainChildren:function(e,t,n,r){for(var i=2*e;i<2*e+2;i++)for(var s=2*t;s<2*t+2;s++){var a=new P(i,s);a.z=n+1;var o=this._tileCoordsToKey(a),l=this._tiles[o];l&&l.active?l.retain=!0:(l&&l.loaded&&(l.retain=!0),n+1<r&&this._retainChildren(i,s,n+1,r))}},_resetView:function(e){var t=e&&(e.pinch||e.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),t,t)},_animateZoom:function(e){this._setView(e.center,e.zoom,!0,e.noUpdate)},_clampZoom:function(e){var t=this.options;return void 0!==t.minNativeZoom&&e<t.minNativeZoom?t.minNativeZoom:void 0!==t.maxNativeZoom&&t.maxNativeZoom<e?t.maxNativeZoom:e},_setView:function(e,t,n,r){var i=Math.round(t);i=void 0!==this.options.maxZoom&&i>this.options.maxZoom||void 0!==this.options.minZoom&&i<this.options.minZoom?void 0:this._clampZoom(i);var s=this.options.updateWhenZooming&&i!==this._tileZoom;r&&!s||(this._tileZoom=i,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),void 0!==i&&this._update(e),n||this._pruneTiles(),this._noPrune=!!n),this._setZoomTransforms(e,t)},_setZoomTransforms:function(e,t){for(var n in this._levels)this._setZoomTransform(this._levels[n],e,t)},_setZoomTransform:function(e,t,n){var r=this._map.getZoomScale(n,e.zoom),i=e.origin.multiplyBy(r).subtract(this._map._getNewPixelOrigin(t,n)).round();Me.any3d?jt(e.el,i,r):Et(e.el,i)},_resetGrid:function(){var e=this._map,t=e.options.crs,n=this._tileSize=this.getTileSize(),r=this._tileZoom,i=this._map.getPixelWorldBounds(this._tileZoom);i&&(this._globalTileRange=this._pxBoundsToTileRange(i)),this._wrapX=t.wrapLng&&!this.options.noWrap&&[Math.floor(e.project([0,t.wrapLng[0]],r).x/n.x),Math.ceil(e.project([0,t.wrapLng[1]],r).x/n.y)],this._wrapY=t.wrapLat&&!this.options.noWrap&&[Math.floor(e.project([t.wrapLat[0],0],r).y/n.x),Math.ceil(e.project([t.wrapLat[1],0],r).y/n.y)]},_onMoveEnd:function(){this._map&&!this._map._animatingZoom&&this._update()},_getTiledPixelBounds:function(e){var t=this._map,n=t._animatingZoom?Math.max(t._animateToZoom,t.getZoom()):t.getZoom(),r=t.getZoomScale(n,this._tileZoom),i=t.project(e,this._tileZoom).floor(),s=t.getSize().divideBy(2*r);return new M(i.subtract(s),i.add(s))},_update:function(e){var t=this._map;if(t){var n=this._clampZoom(t.getZoom());if(void 0===e&&(e=t.getCenter()),void 0!==this._tileZoom){var r=this._getTiledPixelBounds(e),i=this._pxBoundsToTileRange(r),s=i.getCenter(),a=[],o=this.options.keepBuffer,l=new M(i.getBottomLeft().subtract([o,-o]),i.getTopRight().add([o,-o]));if(!(isFinite(i.min.x)&&isFinite(i.min.y)&&isFinite(i.max.x)&&isFinite(i.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var c in this._tiles){var u=this._tiles[c].coords;u.z===this._tileZoom&&l.contains(new P(u.x,u.y))||(this._tiles[c].current=!1)}if(Math.abs(n-this._tileZoom)>1)this._setView(e,n);else{for(var d=i.min.y;d<=i.max.y;d++)for(var h=i.min.x;h<=i.max.x;h++){var p=new P(h,d);if(p.z=this._tileZoom,this._isValidTile(p)){var f=this._tiles[this._tileCoordsToKey(p)];f?f.current=!0:a.push(p)}}if(a.sort(function(e,t){return e.distanceTo(s)-t.distanceTo(s)}),0!==a.length){this._loading||(this._loading=!0,this.fire("loading"));var m=document.createDocumentFragment();for(h=0;h<a.length;h++)this._addTile(a[h],m);this._level.el.appendChild(m)}}}}},_isValidTile:function(e){var t=this._map.options.crs;if(!t.infinite){var n=this._globalTileRange;if(!t.wrapLng&&(e.x<n.min.x||e.x>n.max.x)||!t.wrapLat&&(e.y<n.min.y||e.y>n.max.y))return!1}if(!this.options.bounds)return!0;var r=this._tileCoordsToBounds(e);return z(this.options.bounds).overlaps(r)},_keyToBounds:function(e){return this._tileCoordsToBounds(this._keyToTileCoords(e))},_tileCoordsToNwSe:function(e){var t=this._map,n=this.getTileSize(),r=e.scaleBy(n),i=r.add(n);return[t.unproject(r,e.z),t.unproject(i,e.z)]},_tileCoordsToBounds:function(e){var t=this._tileCoordsToNwSe(e),n=new F(t[0],t[1]);return this.options.noWrap||(n=this._map.wrapLatLngBounds(n)),n},_tileCoordsToKey:function(e){return e.x+":"+e.y+":"+e.z},_keyToTileCoords:function(e){var t=e.split(":"),n=new P(+t[0],+t[1]);return n.z=+t[2],n},_removeTile:function(e){var t=this._tiles[e];t&&(ft(t.el),delete this._tiles[e],this.fire("tileunload",{tile:t.el,coords:this._keyToTileCoords(e)}))},_initTile:function(e){xt(e,"leaflet-tile");var t=this.getTileSize();e.style.width=t.x+"px",e.style.height=t.y+"px",e.onselectstart=c,e.onmousemove=c,Me.ielt9&&this.options.opacity<1&&kt(e,this.options.opacity)},_addTile:function(e,t){var n=this._getTilePos(e),r=this._tileCoordsToKey(e),s=this.createTile(this._wrapCoords(e),i(this._tileReady,this,e));this._initTile(s),this.createTile.length<2&&S(i(this._tileReady,this,e,null,s)),Et(s,n),this._tiles[r]={el:s,coords:e,current:!0},t.appendChild(s),this.fire("tileloadstart",{tile:s,coords:e})},_tileReady:function(e,t,n){t&&this.fire("tileerror",{error:t,tile:n,coords:e});var r=this._tileCoordsToKey(e);(n=this._tiles[r])&&(n.loaded=+new Date,this._map._fadeAnimated?(kt(n.el,0),j(this._fadeFrame),this._fadeFrame=S(this._updateOpacity,this)):(n.active=!0,this._pruneTiles()),t||(xt(n.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:n.el,coords:e})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Me.ielt9||!this._map._fadeAnimated?S(this._pruneTiles,this):setTimeout(i(this._pruneTiles,this),250)))},_getTilePos:function(e){return e.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(e){var t=new P(this._wrapX?l(e.x,this._wrapX):e.x,this._wrapY?l(e.y,this._wrapY):e.y);return t.z=e.z,t},_pxBoundsToTileRange:function(e){var t=this.getTileSize();return new M(e.min.unscaleBy(t).floor(),e.max.unscaleBy(t).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var e in this._tiles)if(!this._tiles[e].loaded)return!1;return!0}});function Fr(e){return new Dr(e)}var zr=Dr.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(e,t){this._url=e,(t=p(this,t)).detectRetina&&Me.retina&&t.maxZoom>0?(t.tileSize=Math.floor(t.tileSize/2),t.zoomReverse?(t.zoomOffset--,t.minZoom=Math.min(t.maxZoom,t.minZoom+1)):(t.zoomOffset++,t.maxZoom=Math.max(t.minZoom,t.maxZoom-1)),t.minZoom=Math.max(0,t.minZoom)):t.zoomReverse?t.minZoom=Math.min(t.maxZoom,t.minZoom):t.maxZoom=Math.max(t.minZoom,t.maxZoom),"string"===typeof t.subdomains&&(t.subdomains=t.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(e,t){return this._url===e&&void 0===t&&(t=!0),this._url=e,t||this.redraw(),this},createTile:function(e,t){var n=document.createElement("img");return Dt(n,"load",i(this._tileOnLoad,this,t,n)),Dt(n,"error",i(this._tileOnError,this,t,n)),(this.options.crossOrigin||""===this.options.crossOrigin)&&(n.crossOrigin=!0===this.options.crossOrigin?"":this.options.crossOrigin),"string"===typeof this.options.referrerPolicy&&(n.referrerPolicy=this.options.referrerPolicy),n.alt="",n.src=this.getTileUrl(e),n},getTileUrl:function(e){var t={r:Me.retina?"@2x":"",s:this._getSubdomain(e),x:e.x,y:e.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var r=this._globalTileRange.max.y-e.y;this.options.tms&&(t.y=r),t["-y"]=r}return g(this._url,n(t,this.options))},_tileOnLoad:function(e,t){Me.ielt9?setTimeout(i(e,this,null,t),0):e(null,t)},_tileOnError:function(e,t,n){var r=this.options.errorTileUrl;r&&t.getAttribute("src")!==r&&(t.src=r),e(n,t)},_onTileRemove:function(e){e.tile.onload=null},_getZoomForUrl:function(){var e=this._tileZoom,t=this.options.maxZoom;return this.options.zoomReverse&&(e=t-e),e+this.options.zoomOffset},_getSubdomain:function(e){var t=Math.abs(e.x+e.y)%this.options.subdomains.length;return this.options.subdomains[t]},_abortLoading:function(){var e,t;for(e in this._tiles)if(this._tiles[e].coords.z!==this._tileZoom&&((t=this._tiles[e].el).onload=c,t.onerror=c,!t.complete)){t.src=x;var n=this._tiles[e].coords;ft(t),delete this._tiles[e],this.fire("tileabort",{tile:t,coords:n})}},_removeTile:function(e){var t=this._tiles[e];if(t)return t.el.setAttribute("src",x),Dr.prototype._removeTile.call(this,e)},_tileReady:function(e,t,n){if(this._map&&(!n||n.getAttribute("src")!==x))return Dr.prototype._tileReady.call(this,e,t,n)}});function Ur(e,t){return new zr(e,t)}var Br=zr.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(e,t){this._url=e;var r=n({},this.defaultWmsParams);for(var i in t)i in this.options||(r[i]=t[i]);var s=(t=p(this,t)).detectRetina&&Me.retina?2:1,a=this.getTileSize();r.width=a.x*s,r.height=a.y*s,this.wmsParams=r},onAdd:function(e){this._crs=this.options.crs||e.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var t=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[t]=this._crs.code,zr.prototype.onAdd.call(this,e)},getTileUrl:function(e){var t=this._tileCoordsToNwSe(e),n=this._crs,r=D(n.project(t[0]),n.project(t[1])),i=r.min,s=r.max,a=(this._wmsVersion>=1.3&&this._crs===Kn?[i.y,i.x,s.y,s.x]:[i.x,i.y,s.x,s.y]).join(","),o=zr.prototype.getTileUrl.call(this,e);return o+f(this.wmsParams,o,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+a},setParams:function(e,t){return n(this.wmsParams,e),t||this.redraw(),this}});function Vr(e,t){return new Br(e,t)}zr.WMS=Br,Ur.wms=Vr;var qr=Wn.extend({options:{padding:.1},initialize:function(e){p(this,e),a(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),xt(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var e={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(e.zoomanim=this._onAnimZoom),e},_onAnimZoom:function(e){this._updateTransform(e.center,e.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(e,t){var n=this._map.getZoomScale(t,this._zoom),r=this._map.getSize().multiplyBy(.5+this.options.padding),i=this._map.project(this._center,t),s=r.multiplyBy(-n).add(i).subtract(this._map._getNewPixelOrigin(e,t));Me.any3d?jt(this._container,s,n):Et(this._container,s)},_reset:function(){for(var e in this._update(),this._updateTransform(this._center,this._zoom),this._layers)this._layers[e]._reset()},_onZoomEnd:function(){for(var e in this._layers)this._layers[e]._project()},_updatePaths:function(){for(var e in this._layers)this._layers[e]._update()},_update:function(){var e=this.options.padding,t=this._map.getSize(),n=this._map.containerPointToLayerPoint(t.multiplyBy(-e)).round();this._bounds=new M(n,n.add(t.multiplyBy(1+2*e)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Kr=qr.extend({options:{tolerance:0},getEvents:function(){var e=qr.prototype.getEvents.call(this);return e.viewprereset=this._onViewPreReset,e},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){qr.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var e=this._container=document.createElement("canvas");Dt(e,"mousemove",this._onMouseMove,this),Dt(e,"click dblclick mousedown mouseup contextmenu",this._onClick,this),Dt(e,"mouseout",this._handleMouseOut,this),e._leaflet_disable_events=!0,this._ctx=e.getContext("2d")},_destroyContainer:function(){j(this._redrawRequest),delete this._ctx,ft(this._container),zt(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){for(var e in this._redrawBounds=null,this._layers)this._layers[e]._update();this._redraw()}},_update:function(){if(!this._map._animatingZoom||!this._bounds){qr.prototype._update.call(this);var e=this._bounds,t=this._container,n=e.getSize(),r=Me.retina?2:1;Et(t,e.min),t.width=r*n.x,t.height=r*n.y,t.style.width=n.x+"px",t.style.height=n.y+"px",Me.retina&&this._ctx.scale(2,2),this._ctx.translate(-e.min.x,-e.min.y),this.fire("update")}},_reset:function(){qr.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(e){this._updateDashArray(e),this._layers[a(e)]=e;var t=e._order={layer:e,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=t),this._drawLast=t,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(e){this._requestRedraw(e)},_removePath:function(e){var t=e._order,n=t.next,r=t.prev;n?n.prev=r:this._drawLast=r,r?r.next=n:this._drawFirst=n,delete e._order,delete this._layers[a(e)],this._requestRedraw(e)},_updatePath:function(e){this._extendRedrawBounds(e),e._project(),e._update(),this._requestRedraw(e)},_updateStyle:function(e){this._updateDashArray(e),this._requestRedraw(e)},_updateDashArray:function(e){if("string"===typeof e.options.dashArray){var t,n,r=e.options.dashArray.split(/[, ]+/),i=[];for(n=0;n<r.length;n++){if(t=Number(r[n]),isNaN(t))return;i.push(t)}e.options._dashArray=i}else e.options._dashArray=e.options.dashArray},_requestRedraw:function(e){this._map&&(this._extendRedrawBounds(e),this._redrawRequest=this._redrawRequest||S(this._redraw,this))},_extendRedrawBounds:function(e){if(e._pxBounds){var t=(e.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new M,this._redrawBounds.extend(e._pxBounds.min.subtract([t,t])),this._redrawBounds.extend(e._pxBounds.max.add([t,t]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var e=this._redrawBounds;if(e){var t=e.getSize();this._ctx.clearRect(e.min.x,e.min.y,t.x,t.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var e,t=this._redrawBounds;if(this._ctx.save(),t){var n=t.getSize();this._ctx.beginPath(),this._ctx.rect(t.min.x,t.min.y,n.x,n.y),this._ctx.clip()}this._drawing=!0;for(var r=this._drawFirst;r;r=r.next)e=r.layer,(!t||e._pxBounds&&e._pxBounds.intersects(t))&&e._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(e,t){if(this._drawing){var n,r,i,s,a=e._parts,o=a.length,l=this._ctx;if(o){for(l.beginPath(),n=0;n<o;n++){for(r=0,i=a[n].length;r<i;r++)s=a[n][r],l[r?"lineTo":"moveTo"](s.x,s.y);t&&l.closePath()}this._fillStroke(l,e)}}},_updateCircle:function(e){if(this._drawing&&!e._empty()){var t=e._point,n=this._ctx,r=Math.max(Math.round(e._radius),1),i=(Math.max(Math.round(e._radiusY),1)||r)/r;1!==i&&(n.save(),n.scale(1,i)),n.beginPath(),n.arc(t.x,t.y/i,r,0,2*Math.PI,!1),1!==i&&n.restore(),this._fillStroke(n,e)}},_fillStroke:function(e,t){var n=t.options;n.fill&&(e.globalAlpha=n.fillOpacity,e.fillStyle=n.fillColor||n.color,e.fill(n.fillRule||"evenodd")),n.stroke&&0!==n.weight&&(e.setLineDash&&e.setLineDash(t.options&&t.options._dashArray||[]),e.globalAlpha=n.opacity,e.lineWidth=n.weight,e.strokeStyle=n.color,e.lineCap=n.lineCap,e.lineJoin=n.lineJoin,e.stroke())},_onClick:function(e){for(var t,n,r=this._map.mouseEventToLayerPoint(e),i=this._drawFirst;i;i=i.next)(t=i.layer).options.interactive&&t._containsPoint(r)&&("click"!==e.type&&"preclick"!==e.type||!this._map._draggableMoved(t))&&(n=t);this._fireEvent(!!n&&[n],e)},_onMouseMove:function(e){if(this._map&&!this._map.dragging.moving()&&!this._map._animatingZoom){var t=this._map.mouseEventToLayerPoint(e);this._handleMouseHover(e,t)}},_handleMouseOut:function(e){var t=this._hoveredLayer;t&&(bt(this._container,"leaflet-interactive"),this._fireEvent([t],e,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(e,t){if(!this._mouseHoverThrottled){for(var n,r,s=this._drawFirst;s;s=s.next)(n=s.layer).options.interactive&&n._containsPoint(t)&&(r=n);r!==this._hoveredLayer&&(this._handleMouseOut(e),r&&(xt(this._container,"leaflet-interactive"),this._fireEvent([r],e,"mouseover"),this._hoveredLayer=r)),this._fireEvent(!!this._hoveredLayer&&[this._hoveredLayer],e),this._mouseHoverThrottled=!0,setTimeout(i(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(e,t,n){this._map._fireDOMEvent(t,n||t.type,e)},_bringToFront:function(e){var t=e._order;if(t){var n=t.next,r=t.prev;n&&(n.prev=r,r?r.next=n:n&&(this._drawFirst=n),t.prev=this._drawLast,this._drawLast.next=t,t.next=null,this._drawLast=t,this._requestRedraw(e))}},_bringToBack:function(e){var t=e._order;if(t){var n=t.next,r=t.prev;r&&(r.next=n,n?n.prev=r:r&&(this._drawLast=r),t.prev=null,t.next=this._drawFirst,this._drawFirst.prev=t,this._drawFirst=t,this._requestRedraw(e))}}});function Hr(e){return Me.canvas?new Kr(e):null}var Wr=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(e){return document.createElement("<lvml:"+e+' class="lvml">')}}catch(e){}return function(e){return document.createElement("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),Gr={_initContainer:function(){this._container=pt("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(qr.prototype._update.call(this),this.fire("update"))},_initPath:function(e){var t=e._container=Wr("shape");xt(t,"leaflet-vml-shape "+(this.options.className||"")),t.coordsize="1 1",e._path=Wr("path"),t.appendChild(e._path),this._updateStyle(e),this._layers[a(e)]=e},_addPath:function(e){var t=e._container;this._container.appendChild(t),e.options.interactive&&e.addInteractiveTarget(t)},_removePath:function(e){var t=e._container;ft(t),e.removeInteractiveTarget(t),delete this._layers[a(e)]},_updateStyle:function(e){var t=e._stroke,n=e._fill,r=e.options,i=e._container;i.stroked=!!r.stroke,i.filled=!!r.fill,r.stroke?(t||(t=e._stroke=Wr("stroke")),i.appendChild(t),t.weight=r.weight+"px",t.color=r.color,t.opacity=r.opacity,r.dashArray?t.dashStyle=v(r.dashArray)?r.dashArray.join(" "):r.dashArray.replace(/( *, *)/g," "):t.dashStyle="",t.endcap=r.lineCap.replace("butt","flat"),t.joinstyle=r.lineJoin):t&&(i.removeChild(t),e._stroke=null),r.fill?(n||(n=e._fill=Wr("fill")),i.appendChild(n),n.color=r.fillColor||r.color,n.opacity=r.fillOpacity):n&&(i.removeChild(n),e._fill=null)},_updateCircle:function(e){var t=e._point.round(),n=Math.round(e._radius),r=Math.round(e._radiusY||n);this._setPath(e,e._empty()?"M0 0":"AL "+t.x+","+t.y+" "+n+","+r+" 0,23592600")},_setPath:function(e,t){e._path.v=t},_bringToFront:function(e){gt(e._container)},_bringToBack:function(e){vt(e._container)}},Zr=Me.vml?Wr:J,Qr=qr.extend({_initContainer:function(){this._container=Zr("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Zr("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){ft(this._container),zt(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!this._map._animatingZoom||!this._bounds){qr.prototype._update.call(this);var e=this._bounds,t=e.getSize(),n=this._container;this._svgSize&&this._svgSize.equals(t)||(this._svgSize=t,n.setAttribute("width",t.x),n.setAttribute("height",t.y)),Et(n,e.min),n.setAttribute("viewBox",[e.min.x,e.min.y,t.x,t.y].join(" ")),this.fire("update")}},_initPath:function(e){var t=e._path=Zr("path");e.options.className&&xt(t,e.options.className),e.options.interactive&&xt(t,"leaflet-interactive"),this._updateStyle(e),this._layers[a(e)]=e},_addPath:function(e){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(e._path),e.addInteractiveTarget(e._path)},_removePath:function(e){ft(e._path),e.removeInteractiveTarget(e._path),delete this._layers[a(e)]},_updatePath:function(e){e._project(),e._update()},_updateStyle:function(e){var t=e._path,n=e.options;t&&(n.stroke?(t.setAttribute("stroke",n.color),t.setAttribute("stroke-opacity",n.opacity),t.setAttribute("stroke-width",n.weight),t.setAttribute("stroke-linecap",n.lineCap),t.setAttribute("stroke-linejoin",n.lineJoin),n.dashArray?t.setAttribute("stroke-dasharray",n.dashArray):t.removeAttribute("stroke-dasharray"),n.dashOffset?t.setAttribute("stroke-dashoffset",n.dashOffset):t.removeAttribute("stroke-dashoffset")):t.setAttribute("stroke","none"),n.fill?(t.setAttribute("fill",n.fillColor||n.color),t.setAttribute("fill-opacity",n.fillOpacity),t.setAttribute("fill-rule",n.fillRule||"evenodd")):t.setAttribute("fill","none"))},_updatePoly:function(e,t){this._setPath(e,Y(e._parts,t))},_updateCircle:function(e){var t=e._point,n=Math.max(Math.round(e._radius),1),r="a"+n+","+(Math.max(Math.round(e._radiusY),1)||n)+" 0 1,0 ",i=e._empty()?"M0 0":"M"+(t.x-n)+","+t.y+r+2*n+",0 "+r+2*-n+",0 ";this._setPath(e,i)},_setPath:function(e,t){e._path.setAttribute("d",t)},_bringToFront:function(e){gt(e._path)},_bringToBack:function(e){vt(e._path)}});function Jr(e){return Me.svg||Me.vml?new Qr(e):null}Me.vml&&Qr.include(Gr),nn.include({getRenderer:function(e){var t=e.options.renderer||this._getPaneRenderer(e.options.pane)||this.options.renderer||this._renderer;return t||(t=this._renderer=this._createRenderer()),this.hasLayer(t)||this.addLayer(t),t},_getPaneRenderer:function(e){if("overlayPane"===e||void 0===e)return!1;var t=this._paneRenderers[e];return void 0===t&&(t=this._createRenderer({pane:e}),this._paneRenderers[e]=t),t},_createRenderer:function(e){return this.options.preferCanvas&&Hr(e)||Jr(e)}});var Yr=ur.extend({initialize:function(e,t){ur.prototype.initialize.call(this,this._boundsToLatLngs(e),t)},setBounds:function(e){return this.setLatLngs(this._boundsToLatLngs(e))},_boundsToLatLngs:function(e){return[(e=z(e)).getSouthWest(),e.getNorthWest(),e.getNorthEast(),e.getSouthEast()]}});function Xr(e,t){return new Yr(e,t)}Qr.create=Zr,Qr.pointsToPath=Y,hr.geometryToLayer=pr,hr.coordsToLatLng=mr,hr.coordsToLatLngs=gr,hr.latLngToCoords=vr,hr.latLngsToCoords=yr,hr.getFeature=xr,hr.asFeature=br,nn.mergeOptions({boxZoom:!0});var $r=gn.extend({initialize:function(e){this._map=e,this._container=e._container,this._pane=e._panes.overlayPane,this._resetStateTimeout=0,e.on("unload",this._destroy,this)},addHooks:function(){Dt(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){zt(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){ft(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){0!==this._resetStateTimeout&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(e){if(!e.shiftKey||1!==e.which&&1!==e.button)return!1;this._clearDeferredResetState(),this._resetState(),rt(),At(),this._startPoint=this._map.mouseEventToContainerPoint(e),Dt(document,{contextmenu:Zt,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(e){this._moved||(this._moved=!0,this._box=pt("div","leaflet-zoom-box",this._container),xt(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(e);var t=new M(this._point,this._startPoint),n=t.getSize();Et(this._box,t.min),this._box.style.width=n.x+"px",this._box.style.height=n.y+"px"},_finish:function(){this._moved&&(ft(this._box),bt(this._container,"leaflet-crosshair")),it(),It(),zt(document,{contextmenu:Zt,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(e){if((1===e.which||1===e.button)&&(this._finish(),this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(i(this._resetState,this),0);var t=new F(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(t).fire("boxzoomend",{boxZoomBounds:t})}},_onKeyDown:function(e){27===e.keyCode&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});nn.addInitHook("addHandler","boxZoom",$r),nn.mergeOptions({doubleClickZoom:!0});var ei=gn.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(e){var t=this._map,n=t.getZoom(),r=t.options.zoomDelta,i=e.originalEvent.shiftKey?n-r:n+r;"center"===t.options.doubleClickZoom?t.setZoom(i):t.setZoomAround(e.containerPoint,i)}});nn.addInitHook("addHandler","doubleClickZoom",ei),nn.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var ti=gn.extend({addHooks:function(){if(!this._draggable){var e=this._map;this._draggable=new xn(e._mapPane,e._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),e.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),e.on("zoomend",this._onZoomEnd,this),e.whenReady(this._onZoomEnd,this))}xt(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){bt(this._map._container,"leaflet-grab"),bt(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var e=this._map;if(e._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var t=z(this._map.options.maxBounds);this._offsetLimit=D(this._map.latLngToContainerPoint(t.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(t.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;e.fire("movestart").fire("dragstart"),e.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(e){if(this._map.options.inertia){var t=this._lastTime=+new Date,n=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(n),this._times.push(t),this._prunePositions(t)}this._map.fire("move",e).fire("drag",e)},_prunePositions:function(e){for(;this._positions.length>1&&e-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var e=this._map.getSize().divideBy(2),t=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=t.subtract(e).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(e,t){return e-(e-t)*this._viscosity},_onPreDragLimit:function(){if(this._viscosity&&this._offsetLimit){var e=this._draggable._newPos.subtract(this._draggable._startPos),t=this._offsetLimit;e.x<t.min.x&&(e.x=this._viscousLimit(e.x,t.min.x)),e.y<t.min.y&&(e.y=this._viscousLimit(e.y,t.min.y)),e.x>t.max.x&&(e.x=this._viscousLimit(e.x,t.max.x)),e.y>t.max.y&&(e.y=this._viscousLimit(e.y,t.max.y)),this._draggable._newPos=this._draggable._startPos.add(e)}},_onPreDragWrap:function(){var e=this._worldWidth,t=Math.round(e/2),n=this._initialWorldOffset,r=this._draggable._newPos.x,i=(r-t+n)%e+t-n,s=(r+t+n)%e-t-n,a=Math.abs(i+n)<Math.abs(s+n)?i:s;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=a},_onDragEnd:function(e){var t=this._map,n=t.options,r=!n.inertia||e.noInertia||this._times.length<2;if(t.fire("dragend",e),r)t.fire("moveend");else{this._prunePositions(+new Date);var i=this._lastPos.subtract(this._positions[0]),s=(this._lastTime-this._times[0])/1e3,a=n.easeLinearity,o=i.multiplyBy(a/s),l=o.distanceTo([0,0]),c=Math.min(n.inertiaMaxSpeed,l),u=o.multiplyBy(c/l),d=c/(n.inertiaDeceleration*a),h=u.multiplyBy(-d/2).round();h.x||h.y?(h=t._limitOffset(h,t.options.maxBounds),S(function(){t.panBy(h,{duration:d,easeLinearity:a,noMoveStart:!0,animate:!0})})):t.fire("moveend")}}});nn.addInitHook("addHandler","dragging",ti),nn.mergeOptions({keyboard:!0,keyboardPanDelta:80});var ni=gn.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(e){this._map=e,this._setPanDelta(e.options.keyboardPanDelta),this._setZoomDelta(e.options.zoomDelta)},addHooks:function(){var e=this._map._container;e.tabIndex<=0&&(e.tabIndex="0"),Dt(e,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),zt(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var e=document.body,t=document.documentElement,n=e.scrollTop||t.scrollTop,r=e.scrollLeft||t.scrollLeft;this._map._container.focus(),window.scrollTo(r,n)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(e){var t,n,r=this._panKeys={},i=this.keyCodes;for(t=0,n=i.left.length;t<n;t++)r[i.left[t]]=[-1*e,0];for(t=0,n=i.right.length;t<n;t++)r[i.right[t]]=[e,0];for(t=0,n=i.down.length;t<n;t++)r[i.down[t]]=[0,e];for(t=0,n=i.up.length;t<n;t++)r[i.up[t]]=[0,-1*e]},_setZoomDelta:function(e){var t,n,r=this._zoomKeys={},i=this.keyCodes;for(t=0,n=i.zoomIn.length;t<n;t++)r[i.zoomIn[t]]=e;for(t=0,n=i.zoomOut.length;t<n;t++)r[i.zoomOut[t]]=-e},_addHooks:function(){Dt(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){zt(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(e){if(!(e.altKey||e.ctrlKey||e.metaKey)){var t,n=e.keyCode,r=this._map;if(n in this._panKeys){if(!r._panAnim||!r._panAnim._inProgress)if(t=this._panKeys[n],e.shiftKey&&(t=O(t).multiplyBy(3)),r.options.maxBounds&&(t=r._limitOffset(O(t),r.options.maxBounds)),r.options.worldCopyJump){var i=r.wrapLatLng(r.unproject(r.project(r.getCenter()).add(t)));r.panTo(i)}else r.panBy(t)}else if(n in this._zoomKeys)r.setZoom(r.getZoom()+(e.shiftKey?3:1)*this._zoomKeys[n]);else{if(27!==n||!r._popup||!r._popup.options.closeOnEscapeKey)return;r.closePopup()}Zt(e)}}});nn.addInitHook("addHandler","keyboard",ni),nn.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var ri=gn.extend({addHooks:function(){Dt(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){zt(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(e){var t=Xt(e),n=this._map.options.wheelDebounceTime;this._delta+=t,this._lastMousePos=this._map.mouseEventToContainerPoint(e),this._startTime||(this._startTime=+new Date);var r=Math.max(n-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(i(this._performZoom,this),r),Zt(e)},_performZoom:function(){var e=this._map,t=e.getZoom(),n=this._map.options.zoomSnap||0;e._stop();var r=this._delta/(4*this._map.options.wheelPxPerZoomLevel),i=4*Math.log(2/(1+Math.exp(-Math.abs(r))))/Math.LN2,s=n?Math.ceil(i/n)*n:i,a=e._limitZoom(t+(this._delta>0?s:-s))-t;this._delta=0,this._startTime=null,a&&("center"===e.options.scrollWheelZoom?e.setZoom(t+a):e.setZoomAround(this._lastMousePos,t+a))}});nn.addInitHook("addHandler","scrollWheelZoom",ri);var ii=600;nn.mergeOptions({tapHold:Me.touchNative&&Me.safari&&Me.mobile,tapTolerance:15});var si=gn.extend({addHooks:function(){Dt(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){zt(this._map._container,"touchstart",this._onDown,this)},_onDown:function(e){if(clearTimeout(this._holdTimeout),1===e.touches.length){var t=e.touches[0];this._startPos=this._newPos=new P(t.clientX,t.clientY),this._holdTimeout=setTimeout(i(function(){this._cancel(),this._isTapValid()&&(Dt(document,"touchend",Gt),Dt(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",t))},this),ii),Dt(document,"touchend touchcancel contextmenu",this._cancel,this),Dt(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function e(){zt(document,"touchend",Gt),zt(document,"touchend touchcancel",e)},_cancel:function(){clearTimeout(this._holdTimeout),zt(document,"touchend touchcancel contextmenu",this._cancel,this),zt(document,"touchmove",this._onMove,this)},_onMove:function(e){var t=e.touches[0];this._newPos=new P(t.clientX,t.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(e,t){var n=new MouseEvent(e,{bubbles:!0,cancelable:!0,view:window,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY});n._simulated=!0,t.target.dispatchEvent(n)}});nn.addInitHook("addHandler","tapHold",si),nn.mergeOptions({touchZoom:Me.touch,bounceAtZoomLimits:!0});var ai=gn.extend({addHooks:function(){xt(this._map._container,"leaflet-touch-zoom"),Dt(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){bt(this._map._container,"leaflet-touch-zoom"),zt(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(e){var t=this._map;if(e.touches&&2===e.touches.length&&!t._animatingZoom&&!this._zooming){var n=t.mouseEventToContainerPoint(e.touches[0]),r=t.mouseEventToContainerPoint(e.touches[1]);this._centerPoint=t.getSize()._divideBy(2),this._startLatLng=t.containerPointToLatLng(this._centerPoint),"center"!==t.options.touchZoom&&(this._pinchStartLatLng=t.containerPointToLatLng(n.add(r)._divideBy(2))),this._startDist=n.distanceTo(r),this._startZoom=t.getZoom(),this._moved=!1,this._zooming=!0,t._stop(),Dt(document,"touchmove",this._onTouchMove,this),Dt(document,"touchend touchcancel",this._onTouchEnd,this),Gt(e)}},_onTouchMove:function(e){if(e.touches&&2===e.touches.length&&this._zooming){var t=this._map,n=t.mouseEventToContainerPoint(e.touches[0]),r=t.mouseEventToContainerPoint(e.touches[1]),s=n.distanceTo(r)/this._startDist;if(this._zoom=t.getScaleZoom(s,this._startZoom),!t.options.bounceAtZoomLimits&&(this._zoom<t.getMinZoom()&&s<1||this._zoom>t.getMaxZoom()&&s>1)&&(this._zoom=t._limitZoom(this._zoom)),"center"===t.options.touchZoom){if(this._center=this._startLatLng,1===s)return}else{var a=n._add(r)._divideBy(2)._subtract(this._centerPoint);if(1===s&&0===a.x&&0===a.y)return;this._center=t.unproject(t.project(this._pinchStartLatLng,this._zoom).subtract(a),this._zoom)}this._moved||(t._moveStart(!0,!1),this._moved=!0),j(this._animRequest);var o=i(t._move,t,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=S(o,this,!0),Gt(e)}},_onTouchEnd:function(){this._moved&&this._zooming?(this._zooming=!1,j(this._animRequest),zt(document,"touchmove",this._onTouchMove,this),zt(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))):this._zooming=!1}});nn.addInitHook("addHandler","touchZoom",ai),nn.BoxZoom=$r,nn.DoubleClickZoom=ei,nn.Drag=ti,nn.Keyboard=ni,nn.ScrollWheelZoom=ri,nn.TapHold=si,nn.TouchZoom=ai,e.Bounds=M,e.Browser=Me,e.CRS=V,e.Canvas=Kr,e.Circle=ar,e.CircleMarker=ir,e.Class=C,e.Control=sn,e.DivIcon=Or,e.DivOverlay=Ar,e.DomEvent=en,e.DomUtil=Mt,e.Draggable=xn,e.Evented=I,e.FeatureGroup=Qn,e.GeoJSON=hr,e.GridLayer=Dr,e.Handler=gn,e.Icon=Yn,e.ImageOverlay=Nr,e.LatLng=U,e.LatLngBounds=F,e.Layer=Wn,e.LayerGroup=Gn,e.LineUtil=zn,e.Map=nn,e.Marker=tr,e.Mixin=vn,e.Path=rr,e.Point=P,e.PolyUtil=Nn,e.Polygon=ur,e.Polyline=lr,e.Popup=Ir,e.PosAnimation=tn,e.Projection=Vn,e.Rectangle=Yr,e.Renderer=qr,e.SVG=Qr,e.SVGOverlay=Cr,e.TileLayer=zr,e.Tooltip=Lr,e.Transformation=W,e.Util=E,e.VideoOverlay=jr,e.bind=i,e.bounds=D,e.canvas=Hr,e.circle=or,e.circleMarker=sr,e.control=an,e.divIcon=Mr,e.extend=n,e.featureGroup=Jn,e.geoJSON=_r,e.geoJson=kr,e.gridLayer=Fr,e.icon=Xn,e.imageOverlay=Sr,e.latLng=B,e.latLngBounds=z,e.layerGroup=Zn,e.map=rn,e.marker=nr,e.point=O,e.polygon=dr,e.polyline=cr,e.popup=Pr,e.rectangle=Xr,e.setOptions=p,e.stamp=a,e.svg=Jr,e.svgOverlay=Tr,e.tileLayer=Ur,e.tooltip=Rr,e.transformation=G,e.version=t,e.videoOverlay=Er;var oi=window.L;e.noConflict=function(){return window.L=oi,this},window.L=e}(t)},350:(e,t,n)=>{const r=n(7969),i=r.getBCHDigit(1335);t.getEncodedBits=function(e,t){const n=e.bit<<3|t;let s=n<<10;for(;r.getBCHDigit(s)-i>=0;)s^=1335<<r.getBCHDigit(s)-i;return 21522^(n<<10|s)}},443:(e,t,n)=>{"use strict";n.d(t,{$b:()=>i,Vy:()=>c});const r=[];var i;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(i||(i={}));const s={debug:i.DEBUG,verbose:i.VERBOSE,info:i.INFO,warn:i.WARN,error:i.ERROR,silent:i.SILENT},a=i.INFO,o={[i.DEBUG]:"log",[i.VERBOSE]:"log",[i.INFO]:"info",[i.WARN]:"warn",[i.ERROR]:"error"},l=function(e,t){if(t<e.logLevel)return;const n=(new Date).toISOString(),r=o[t];if(!r)throw new Error("Attempted to log a message with an invalid logType (value: ".concat(t,")"));for(var i=arguments.length,s=new Array(i>2?i-2:0),a=2;a<i;a++)s[a-2]=arguments[a];console[r]("[".concat(n,"]  ").concat(e.name,":"),...s)};class c{constructor(e){this.name=e,this._logLevel=a,this._logHandler=l,this._userLogHandler=null,r.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in i))throw new TypeError('Invalid value "'.concat(e,'" assigned to `logLevel`'));this._logLevel=e}setLogLevel(e){this._logLevel="string"===typeof e?s[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,i.DEBUG,...t),this._logHandler(this,i.DEBUG,...t)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,i.VERBOSE,...t),this._logHandler(this,i.VERBOSE,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,i.INFO,...t),this._logHandler(this,i.INFO,...t)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,i.WARN,...t),this._logHandler(this,i.WARN,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,i.ERROR,...t),this._logHandler(this,i.ERROR,...t)}}},579:(e,t,n)=>{"use strict";e.exports=n(1153)},900:(e,t,n)=>{const r=n(7421);function i(e){this.mode=r.NUMERIC,this.data=e.toString()}i.getBitsLength=function(e){return 10*Math.floor(e/3)+(e%3?e%3*3+1:0)},i.prototype.getLength=function(){return this.data.length},i.prototype.getBitsLength=function(){return i.getBitsLength(this.data.length)},i.prototype.write=function(e){let t,n,r;for(t=0;t+3<=this.data.length;t+=3)n=this.data.substr(t,3),r=parseInt(n,10),e.put(r,10);const i=this.data.length-t;i>0&&(n=this.data.substr(t),r=parseInt(n,10),e.put(r,3*i+1))},e.exports=i},1153:(e,t,n)=>{"use strict";var r=n(5043),i=Symbol.for("react.element"),s=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,s={},c=null,u=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)a.call(t,r)&&!l.hasOwnProperty(r)&&(s[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===s[r]&&(s[r]=t[r]);return{$$typeof:i,type:e,key:c,ref:u,props:s,_owner:o.current}}t.Fragment=s,t.jsx=c,t.jsxs=c},1166:(e,t)=>{const n=new Uint8Array(512),r=new Uint8Array(256);!function(){let e=1;for(let t=0;t<255;t++)n[t]=e,r[e]=t,e<<=1,256&e&&(e^=285);for(let t=255;t<512;t++)n[t]=n[t-255]}(),t.log=function(e){if(e<1)throw new Error("log("+e+")");return r[e]},t.exp=function(e){return n[e]},t.mul=function(e,t){return 0===e||0===t?0:n[r[e]+r[t]]}},1312:(e,t,n)=>{const r=n(1166);t.mul=function(e,t){const n=new Uint8Array(e.length+t.length-1);for(let i=0;i<e.length;i++)for(let s=0;s<t.length;s++)n[i+s]^=r.mul(e[i],t[s]);return n},t.mod=function(e,t){let n=new Uint8Array(e);for(;n.length-t.length>=0;){const e=n[0];for(let s=0;s<t.length;s++)n[s]^=r.mul(t[s],e);let i=0;for(;i<n.length&&0===n[i];)i++;n=n.slice(i)}return n},t.generateECPolynomial=function(e){let n=new Uint8Array([1]);for(let i=0;i<e;i++)n=t.mul(n,new Uint8Array([1,r.exp(i)]));return n}},1497:(e,t,n)=>{"use strict";var r=n(3218);function i(){}function s(){}s.resetWarningCache=i,e.exports=function(){function e(e,t,n,i,s,a){if(a!==r){var o=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw o.name="Invariant Violation",o}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:s,resetWarningCache:i};return n.PropTypes=n,n}},1805:(e,t,n)=>{const r=n(6272),i=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],s=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];t.getBlocksCount=function(e,t){switch(t){case r.L:return i[4*(e-1)+0];case r.M:return i[4*(e-1)+1];case r.Q:return i[4*(e-1)+2];case r.H:return i[4*(e-1)+3];default:return}},t.getTotalCodewordsCount=function(e,t){switch(t){case r.L:return s[4*(e-1)+0];case r.M:return s[4*(e-1)+1];case r.Q:return s[4*(e-1)+2];case r.H:return s[4*(e-1)+3];default:return}}},2182:(e,t,n)=>{const r=n(8293);t.render=function(e,t,n){let i=n,s=t;"undefined"!==typeof i||t&&t.getContext||(i=t,t=void 0),t||(s=function(){try{return document.createElement("canvas")}catch(e){throw new Error("You need to specify a canvas element")}}()),i=r.getOptions(i);const a=r.getImageWidth(e.modules.size,i),o=s.getContext("2d"),l=o.createImageData(a,a);return r.qrToImageData(l.data,e,i),function(e,t,n){e.clearRect(0,0,t.width,t.height),t.style||(t.style={}),t.height=n,t.width=n,t.style.height=n+"px",t.style.width=n+"px"}(o,s,a),o.putImageData(l,0,0),s},t.renderToDataURL=function(e,n,r){let i=r;"undefined"!==typeof i||n&&n.getContext||(i=n,n=void 0),i||(i={});const s=t.render(e,n,i),a=i.type||"image/png",o=i.rendererOpts||{};return s.toDataURL(a,o.quality)}},2555:(e,t,n)=>{"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function i(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:t+""}function s(e,t,n){return(t=i(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach(function(t){s(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}n.d(t,{A:()=>o})},2730:(e,t,n)=>{"use strict";var r=n(5043),i=n(8853);function s(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,o={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(o[e]=t,e=0;e<t.length;e++)a.add(t[e])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},f={};function m(e,t,n,r,i,s,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=s,this.removeEmptyString=a}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){g[e]=new m(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];g[t]=new m(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){g[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){g[e]=new m(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){g[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){g[e]=new m(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){g[e]=new m(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){g[e]=new m(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){g[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)});var v=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function x(e,t,n,r){var i=g.hasOwnProperty(t)?g[t]:null;(null!==i?0!==i.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!d.call(f,e)||!d.call(p,e)&&(h.test(e)?f[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(v,y);g[t]=new m(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(v,y);g[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(v,y);g[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)}),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)});var b=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=Symbol.for("react.element"),_=Symbol.for("react.portal"),k=Symbol.for("react.fragment"),N=Symbol.for("react.strict_mode"),S=Symbol.for("react.profiler"),j=Symbol.for("react.provider"),E=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),T=Symbol.for("react.suspense"),A=Symbol.for("react.suspense_list"),I=Symbol.for("react.memo"),P=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var L=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var R=Symbol.iterator;function O(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=R&&e[R]||e["@@iterator"])?e:null}var M,D=Object.assign;function F(e){if(void 0===M)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);M=t&&t[1]||""}return"\n"+M+e}var z=!1;function U(e,t){if(!e||z)return"";z=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&"string"===typeof c.stack){for(var i=c.stack.split("\n"),s=r.stack.split("\n"),a=i.length-1,o=s.length-1;1<=a&&0<=o&&i[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(i[a]!==s[o]){if(1!==a||1!==o)do{if(a--,0>--o||i[a]!==s[o]){var l="\n"+i[a].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=a&&0<=o);break}}}finally{z=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?F(e):""}function B(e){switch(e.tag){case 5:return F(e.type);case 16:return F("Lazy");case 13:return F("Suspense");case 19:return F("SuspenseList");case 0:case 2:case 15:return e=U(e.type,!1);case 11:return e=U(e.type.render,!1);case 1:return e=U(e.type,!0);default:return""}}function V(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case k:return"Fragment";case _:return"Portal";case S:return"Profiler";case N:return"StrictMode";case T:return"Suspense";case A:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case E:return(e.displayName||"Context")+".Consumer";case j:return(e._context.displayName||"Context")+".Provider";case C:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case I:return null!==(t=e.displayName||null)?t:V(e.type)||"Memo";case P:t=e._payload,e=e._init;try{return V(e(t))}catch(n){}}return null}function q(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return V(t);case 8:return t===N?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function K(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function H(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function W(e){e._valueTracker||(e._valueTracker=function(e){var t=H(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,s=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,s.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function G(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=H(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function Z(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Q(e,t){var n=t.checked;return D({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function J(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=K(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Y(e,t){null!=(t=t.checked)&&x(e,"checked",t,!1)}function X(e,t){Y(e,t);var n=K(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,K(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&Z(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+K(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(s(91));return D({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ie(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(s(92));if(te(n)){if(1<n.length)throw Error(s(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:K(n)}}function se(e,t){var n=K(t.value),r=K(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function ae(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function oe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?oe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,ue,de=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction(function(){return ue(e,t)})}:ue);function he(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fe=["Webkit","ms","Moz","O"];function me(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=me(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(pe).forEach(function(e){fe.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]})});var ve=D({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ve[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(s(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(s(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(s(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(s(62))}}function xe(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var be=null;function we(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var _e=null,ke=null,Ne=null;function Se(e){if(e=xi(e)){if("function"!==typeof _e)throw Error(s(280));var t=e.stateNode;t&&(t=wi(t),_e(e.stateNode,e.type,t))}}function je(e){ke?Ne?Ne.push(e):Ne=[e]:ke=e}function Ee(){if(ke){var e=ke,t=Ne;if(Ne=ke=null,Se(e),t)for(e=0;e<t.length;e++)Se(t[e])}}function Ce(e,t){return e(t)}function Te(){}var Ae=!1;function Ie(e,t,n){if(Ae)return e(t,n);Ae=!0;try{return Ce(e,t,n)}finally{Ae=!1,(null!==ke||null!==Ne)&&(Te(),Ee())}}function Pe(e,t){var n=e.stateNode;if(null===n)return null;var r=wi(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(s(231,t,typeof n));return n}var Le=!1;if(u)try{var Re={};Object.defineProperty(Re,"passive",{get:function(){Le=!0}}),window.addEventListener("test",Re,Re),window.removeEventListener("test",Re,Re)}catch(ue){Le=!1}function Oe(e,t,n,r,i,s,a,o,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(u){this.onError(u)}}var Me=!1,De=null,Fe=!1,ze=null,Ue={onError:function(e){Me=!0,De=e}};function Be(e,t,n,r,i,s,a,o,l){Me=!1,De=null,Oe.apply(Ue,arguments)}function Ve(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function qe(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Ke(e){if(Ve(e)!==e)throw Error(s(188))}function He(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ve(e)))throw Error(s(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var a=i.alternate;if(null===a){if(null!==(r=i.return)){n=r;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===n)return Ke(i),e;if(a===r)return Ke(i),t;a=a.sibling}throw Error(s(188))}if(n.return!==r.return)n=i,r=a;else{for(var o=!1,l=i.child;l;){if(l===n){o=!0,n=i,r=a;break}if(l===r){o=!0,r=i,n=a;break}l=l.sibling}if(!o){for(l=a.child;l;){if(l===n){o=!0,n=a,r=i;break}if(l===r){o=!0,r=a,n=i;break}l=l.sibling}if(!o)throw Error(s(189))}}if(n.alternate!==r)throw Error(s(190))}if(3!==n.tag)throw Error(s(188));return n.stateNode.current===n?e:t}(e))?We(e):null}function We(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=We(e);if(null!==t)return t;e=e.sibling}return null}var Ge=i.unstable_scheduleCallback,Ze=i.unstable_cancelCallback,Qe=i.unstable_shouldYield,Je=i.unstable_requestPaint,Ye=i.unstable_now,Xe=i.unstable_getCurrentPriorityLevel,$e=i.unstable_ImmediatePriority,et=i.unstable_UserBlockingPriority,tt=i.unstable_NormalPriority,nt=i.unstable_LowPriority,rt=i.unstable_IdlePriority,it=null,st=null;var at=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ot(e)/lt|0)|0},ot=Math.log,lt=Math.LN2;var ct=64,ut=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,s=e.pingedLanes,a=268435455&n;if(0!==a){var o=a&~i;0!==o?r=dt(o):0!==(s&=a)&&(r=dt(s))}else 0!==(a=n&~i)?r=dt(a):0!==s&&(r=dt(s));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&i)&&((i=r&-r)>=(s=t&-t)||16===i&&0!==(4194240&s)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-at(t)),r|=e[n],t&=~i;return r}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ft(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function gt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function vt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-at(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-at(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var xt=0;function bt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var wt,_t,kt,Nt,St,jt=!1,Et=[],Ct=null,Tt=null,At=null,It=new Map,Pt=new Map,Lt=[],Rt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ot(e,t){switch(e){case"focusin":case"focusout":Ct=null;break;case"dragenter":case"dragleave":Tt=null;break;case"mouseover":case"mouseout":At=null;break;case"pointerover":case"pointerout":It.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pt.delete(t.pointerId)}}function Mt(e,t,n,r,i,s){return null===e||e.nativeEvent!==s?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},null!==t&&(null!==(t=xi(t))&&_t(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function Dt(e){var t=yi(e.target);if(null!==t){var n=Ve(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=qe(n)))return e.blockedOn=t,void St(e.priority,function(){kt(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ft(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Qt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=xi(n))&&_t(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);be=r,n.target.dispatchEvent(r),be=null,t.shift()}return!0}function zt(e,t,n){Ft(e)&&n.delete(t)}function Ut(){jt=!1,null!==Ct&&Ft(Ct)&&(Ct=null),null!==Tt&&Ft(Tt)&&(Tt=null),null!==At&&Ft(At)&&(At=null),It.forEach(zt),Pt.forEach(zt)}function Bt(e,t){e.blockedOn===t&&(e.blockedOn=null,jt||(jt=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Ut)))}function Vt(e){function t(t){return Bt(t,e)}if(0<Et.length){Bt(Et[0],e);for(var n=1;n<Et.length;n++){var r=Et[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==Ct&&Bt(Ct,e),null!==Tt&&Bt(Tt,e),null!==At&&Bt(At,e),It.forEach(t),Pt.forEach(t),n=0;n<Lt.length;n++)(r=Lt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Lt.length&&null===(n=Lt[0]).blockedOn;)Dt(n),null===n.blockedOn&&Lt.shift()}var qt=b.ReactCurrentBatchConfig,Kt=!0;function Ht(e,t,n,r){var i=xt,s=qt.transition;qt.transition=null;try{xt=1,Gt(e,t,n,r)}finally{xt=i,qt.transition=s}}function Wt(e,t,n,r){var i=xt,s=qt.transition;qt.transition=null;try{xt=4,Gt(e,t,n,r)}finally{xt=i,qt.transition=s}}function Gt(e,t,n,r){if(Kt){var i=Qt(e,t,n,r);if(null===i)Kr(e,t,r,Zt,n),Ot(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return Ct=Mt(Ct,e,t,n,r,i),!0;case"dragenter":return Tt=Mt(Tt,e,t,n,r,i),!0;case"mouseover":return At=Mt(At,e,t,n,r,i),!0;case"pointerover":var s=i.pointerId;return It.set(s,Mt(It.get(s)||null,e,t,n,r,i)),!0;case"gotpointercapture":return s=i.pointerId,Pt.set(s,Mt(Pt.get(s)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(Ot(e,r),4&t&&-1<Rt.indexOf(e)){for(;null!==i;){var s=xi(i);if(null!==s&&wt(s),null===(s=Qt(e,t,n,r))&&Kr(e,t,r,Zt,n),s===i)break;i=s}null!==i&&r.stopPropagation()}else Kr(e,t,r,null,n)}}var Zt=null;function Qt(e,t,n,r){if(Zt=null,null!==(e=yi(e=we(r))))if(null===(t=Ve(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=qe(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Zt=e,null}function Jt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Xe()){case $e:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Yt=null,Xt=null,$t=null;function en(){if($t)return $t;var e,t,n=Xt,r=n.length,i="value"in Yt?Yt.value:Yt.textContent,s=i.length;for(e=0;e<r&&n[e]===i[e];e++);var a=r-e;for(t=1;t<=a&&n[r-t]===i[s-t];t++);return $t=i.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function sn(e){function t(t,n,r,i,s){for(var a in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=s,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return D(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var an,on,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=sn(cn),dn=D({},cn,{view:0,detail:0}),hn=sn(dn),pn=D({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Sn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(an=e.screenX-ln.screenX,on=e.screenY-ln.screenY):on=an=0,ln=e),an)},movementY:function(e){return"movementY"in e?e.movementY:on}}),fn=sn(pn),mn=sn(D({},pn,{dataTransfer:0})),gn=sn(D({},dn,{relatedTarget:0})),vn=sn(D({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=D({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),xn=sn(yn),bn=sn(D({},cn,{data:0})),wn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},_n={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},kn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Nn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=kn[e])&&!!t[e]}function Sn(){return Nn}var jn=D({},dn,{key:function(e){if(e.key){var t=wn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?_n[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Sn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),En=sn(jn),Cn=sn(D({},pn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Tn=sn(D({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Sn})),An=sn(D({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),In=D({},pn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Pn=sn(In),Ln=[9,13,27,32],Rn=u&&"CompositionEvent"in window,On=null;u&&"documentMode"in document&&(On=document.documentMode);var Mn=u&&"TextEvent"in window&&!On,Dn=u&&(!Rn||On&&8<On&&11>=On),Fn=String.fromCharCode(32),zn=!1;function Un(e,t){switch(e){case"keyup":return-1!==Ln.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Bn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Vn=!1;var qn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Kn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!qn[e.type]:"textarea"===t}function Hn(e,t,n,r){je(r),0<(t=Wr(t,"onChange")).length&&(n=new un("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Wn=null,Gn=null;function Zn(e){Fr(e,0)}function Qn(e){if(G(bi(e)))return e}function Jn(e,t){if("change"===e)return t}var Yn=!1;if(u){var Xn;if(u){var $n="oninput"in document;if(!$n){var er=document.createElement("div");er.setAttribute("oninput","return;"),$n="function"===typeof er.oninput}Xn=$n}else Xn=!1;Yn=Xn&&(!document.documentMode||9<document.documentMode)}function tr(){Wn&&(Wn.detachEvent("onpropertychange",nr),Gn=Wn=null)}function nr(e){if("value"===e.propertyName&&Qn(Gn)){var t=[];Hn(t,Gn,e,we(e)),Ie(Zn,t)}}function rr(e,t,n){"focusin"===e?(tr(),Gn=n,(Wn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ir(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Qn(Gn)}function sr(e,t){if("click"===e)return Qn(t)}function ar(e,t){if("input"===e||"change"===e)return Qn(t)}var or="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function lr(e,t){if(or(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!d.call(t,i)||!or(e[i],t[i]))return!1}return!0}function cr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ur(e,t){var n,r=cr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=cr(r)}}function dr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?dr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hr(){for(var e=window,t=Z();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=Z((e=t.contentWindow).document)}return t}function pr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function fr(e){var t=hr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&dr(n.ownerDocument.documentElement,n)){if(null!==r&&pr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var i=n.textContent.length,s=Math.min(r.start,i);r=void 0===r.end?s:Math.min(r.end,i),!e.extend&&s>r&&(i=r,r=s,s=i),i=ur(n,s);var a=ur(n,r);i&&a&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&((t=t.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),s>r?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var mr=u&&"documentMode"in document&&11>=document.documentMode,gr=null,vr=null,yr=null,xr=!1;function br(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;xr||null==gr||gr!==Z(r)||("selectionStart"in(r=gr)&&pr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},yr&&lr(yr,r)||(yr=r,0<(r=Wr(vr,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=gr)))}function wr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var _r={animationend:wr("Animation","AnimationEnd"),animationiteration:wr("Animation","AnimationIteration"),animationstart:wr("Animation","AnimationStart"),transitionend:wr("Transition","TransitionEnd")},kr={},Nr={};function Sr(e){if(kr[e])return kr[e];if(!_r[e])return e;var t,n=_r[e];for(t in n)if(n.hasOwnProperty(t)&&t in Nr)return kr[e]=n[t];return e}u&&(Nr=document.createElement("div").style,"AnimationEvent"in window||(delete _r.animationend.animation,delete _r.animationiteration.animation,delete _r.animationstart.animation),"TransitionEvent"in window||delete _r.transitionend.transition);var jr=Sr("animationend"),Er=Sr("animationiteration"),Cr=Sr("animationstart"),Tr=Sr("transitionend"),Ar=new Map,Ir="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Pr(e,t){Ar.set(e,t),l(t,[e])}for(var Lr=0;Lr<Ir.length;Lr++){var Rr=Ir[Lr];Pr(Rr.toLowerCase(),"on"+(Rr[0].toUpperCase()+Rr.slice(1)))}Pr(jr,"onAnimationEnd"),Pr(Er,"onAnimationIteration"),Pr(Cr,"onAnimationStart"),Pr("dblclick","onDoubleClick"),Pr("focusin","onFocus"),Pr("focusout","onBlur"),Pr(Tr,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Or="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Mr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Or));function Dr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,a,o,l,c){if(Be.apply(this,arguments),Me){if(!Me)throw Error(s(198));var u=De;Me=!1,De=null,Fe||(Fe=!0,ze=u)}}(r,t,void 0,e),e.currentTarget=null}function Fr(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var s=void 0;if(t)for(var a=r.length-1;0<=a;a--){var o=r[a],l=o.instance,c=o.currentTarget;if(o=o.listener,l!==s&&i.isPropagationStopped())break e;Dr(i,o,c),s=l}else for(a=0;a<r.length;a++){if(l=(o=r[a]).instance,c=o.currentTarget,o=o.listener,l!==s&&i.isPropagationStopped())break e;Dr(i,o,c),s=l}}}if(Fe)throw e=ze,Fe=!1,ze=null,e}function zr(e,t){var n=t[mi];void 0===n&&(n=t[mi]=new Set);var r=e+"__bubble";n.has(r)||(qr(t,e,2,!1),n.add(r))}function Ur(e,t,n){var r=0;t&&(r|=4),qr(n,e,r,t)}var Br="_reactListening"+Math.random().toString(36).slice(2);function Vr(e){if(!e[Br]){e[Br]=!0,a.forEach(function(t){"selectionchange"!==t&&(Mr.has(t)||Ur(t,!1,e),Ur(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Br]||(t[Br]=!0,Ur("selectionchange",!1,t))}}function qr(e,t,n,r){switch(Jt(t)){case 1:var i=Ht;break;case 4:i=Wt;break;default:i=Gt}n=i.bind(null,t,n,e),i=void 0,!Le||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Kr(e,t,n,r,i){var s=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var a=r.tag;if(3===a||4===a){var o=r.stateNode.containerInfo;if(o===i||8===o.nodeType&&o.parentNode===i)break;if(4===a)for(a=r.return;null!==a;){var l=a.tag;if((3===l||4===l)&&((l=a.stateNode.containerInfo)===i||8===l.nodeType&&l.parentNode===i))return;a=a.return}for(;null!==o;){if(null===(a=yi(o)))return;if(5===(l=a.tag)||6===l){r=s=a;continue e}o=o.parentNode}}r=r.return}Ie(function(){var r=s,i=we(n),a=[];e:{var o=Ar.get(e);if(void 0!==o){var l=un,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":l=En;break;case"focusin":c="focus",l=gn;break;case"focusout":c="blur",l=gn;break;case"beforeblur":case"afterblur":l=gn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=fn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Tn;break;case jr:case Er:case Cr:l=vn;break;case Tr:l=An;break;case"scroll":l=hn;break;case"wheel":l=Pn;break;case"copy":case"cut":case"paste":l=xn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Cn}var u=0!==(4&t),d=!u&&"scroll"===e,h=u?null!==o?o+"Capture":null:o;u=[];for(var p,f=r;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==h&&(null!=(m=Pe(f,h))&&u.push(Hr(f,m,p)))),d)break;f=f.return}0<u.length&&(o=new l(o,c,null,n,i),a.push({event:o,listeners:u}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||n===be||!(c=n.relatedTarget||n.fromElement)||!yi(c)&&!c[fi])&&(l||o)&&(o=i.window===i?i:(o=i.ownerDocument)?o.defaultView||o.parentWindow:window,l?(l=r,null!==(c=(c=n.relatedTarget||n.toElement)?yi(c):null)&&(c!==(d=Ve(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=r),l!==c)){if(u=fn,m="onMouseLeave",h="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(u=Cn,m="onPointerLeave",h="onPointerEnter",f="pointer"),d=null==l?o:bi(l),p=null==c?o:bi(c),(o=new u(m,f+"leave",l,n,i)).target=d,o.relatedTarget=p,m=null,yi(i)===r&&((u=new u(h,f+"enter",c,n,i)).target=p,u.relatedTarget=d,m=u),d=m,l&&c)e:{for(h=c,f=0,p=u=l;p;p=Gr(p))f++;for(p=0,m=h;m;m=Gr(m))p++;for(;0<f-p;)u=Gr(u),f--;for(;0<p-f;)h=Gr(h),p--;for(;f--;){if(u===h||null!==h&&u===h.alternate)break e;u=Gr(u),h=Gr(h)}u=null}else u=null;null!==l&&Zr(a,o,l,u,!1),null!==c&&null!==d&&Zr(a,d,c,u,!0)}if("select"===(l=(o=r?bi(r):window).nodeName&&o.nodeName.toLowerCase())||"input"===l&&"file"===o.type)var g=Jn;else if(Kn(o))if(Yn)g=ar;else{g=ir;var v=rr}else(l=o.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(g=sr);switch(g&&(g=g(e,r))?Hn(a,g,n,i):(v&&v(e,o,r),"focusout"===e&&(v=o._wrapperState)&&v.controlled&&"number"===o.type&&ee(o,"number",o.value)),v=r?bi(r):window,e){case"focusin":(Kn(v)||"true"===v.contentEditable)&&(gr=v,vr=r,yr=null);break;case"focusout":yr=vr=gr=null;break;case"mousedown":xr=!0;break;case"contextmenu":case"mouseup":case"dragend":xr=!1,br(a,n,i);break;case"selectionchange":if(mr)break;case"keydown":case"keyup":br(a,n,i)}var y;if(Rn)e:{switch(e){case"compositionstart":var x="onCompositionStart";break e;case"compositionend":x="onCompositionEnd";break e;case"compositionupdate":x="onCompositionUpdate";break e}x=void 0}else Vn?Un(e,n)&&(x="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(x="onCompositionStart");x&&(Dn&&"ko"!==n.locale&&(Vn||"onCompositionStart"!==x?"onCompositionEnd"===x&&Vn&&(y=en()):(Xt="value"in(Yt=i)?Yt.value:Yt.textContent,Vn=!0)),0<(v=Wr(r,x)).length&&(x=new bn(x,e,null,n,i),a.push({event:x,listeners:v}),y?x.data=y:null!==(y=Bn(n))&&(x.data=y))),(y=Mn?function(e,t){switch(e){case"compositionend":return Bn(t);case"keypress":return 32!==t.which?null:(zn=!0,Fn);case"textInput":return(e=t.data)===Fn&&zn?null:e;default:return null}}(e,n):function(e,t){if(Vn)return"compositionend"===e||!Rn&&Un(e,t)?(e=en(),$t=Xt=Yt=null,Vn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Dn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Wr(r,"onBeforeInput")).length&&(i=new bn("onBeforeInput","beforeinput",null,n,i),a.push({event:i,listeners:r}),i.data=y))}Fr(a,t)})}function Hr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Wr(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,s=i.stateNode;5===i.tag&&null!==s&&(i=s,null!=(s=Pe(e,n))&&r.unshift(Hr(e,s,i)),null!=(s=Pe(e,t))&&r.push(Hr(e,s,i))),e=e.return}return r}function Gr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Zr(e,t,n,r,i){for(var s=t._reactName,a=[];null!==n&&n!==r;){var o=n,l=o.alternate,c=o.stateNode;if(null!==l&&l===r)break;5===o.tag&&null!==c&&(o=c,i?null!=(l=Pe(n,s))&&a.unshift(Hr(n,l,o)):i||null!=(l=Pe(n,s))&&a.push(Hr(n,l,o))),n=n.return}0!==a.length&&e.push({event:t,listeners:a})}var Qr=/\r\n?/g,Jr=/\u0000|\uFFFD/g;function Yr(e){return("string"===typeof e?e:""+e).replace(Qr,"\n").replace(Jr,"")}function Xr(e,t,n){if(t=Yr(t),Yr(e)!==t&&n)throw Error(s(425))}function $r(){}var ei=null,ti=null;function ni(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ri="function"===typeof setTimeout?setTimeout:void 0,ii="function"===typeof clearTimeout?clearTimeout:void 0,si="function"===typeof Promise?Promise:void 0,ai="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof si?function(e){return si.resolve(null).then(e).catch(oi)}:ri;function oi(e){setTimeout(function(){throw e})}function li(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)){if(0===r)return e.removeChild(i),void Vt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=i}while(n);Vt(t)}function ci(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ui(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var di=Math.random().toString(36).slice(2),hi="__reactFiber$"+di,pi="__reactProps$"+di,fi="__reactContainer$"+di,mi="__reactEvents$"+di,gi="__reactListeners$"+di,vi="__reactHandles$"+di;function yi(e){var t=e[hi];if(t)return t;for(var n=e.parentNode;n;){if(t=n[fi]||n[hi]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ui(e);null!==e;){if(n=e[hi])return n;e=ui(e)}return t}n=(e=n).parentNode}return null}function xi(e){return!(e=e[hi]||e[fi])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function bi(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(s(33))}function wi(e){return e[pi]||null}var _i=[],ki=-1;function Ni(e){return{current:e}}function Si(e){0>ki||(e.current=_i[ki],_i[ki]=null,ki--)}function ji(e,t){ki++,_i[ki]=e.current,e.current=t}var Ei={},Ci=Ni(Ei),Ti=Ni(!1),Ai=Ei;function Ii(e,t){var n=e.type.contextTypes;if(!n)return Ei;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,s={};for(i in n)s[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function Pi(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Li(){Si(Ti),Si(Ci)}function Ri(e,t,n){if(Ci.current!==Ei)throw Error(s(168));ji(Ci,t),ji(Ti,n)}function Oi(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in t))throw Error(s(108,q(e)||"Unknown",i));return D({},n,r)}function Mi(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ei,Ai=Ci.current,ji(Ci,e),ji(Ti,Ti.current),!0}function Di(e,t,n){var r=e.stateNode;if(!r)throw Error(s(169));n?(e=Oi(e,t,Ai),r.__reactInternalMemoizedMergedChildContext=e,Si(Ti),Si(Ci),ji(Ci,e)):Si(Ti),ji(Ti,n)}var Fi=null,zi=!1,Ui=!1;function Bi(e){null===Fi?Fi=[e]:Fi.push(e)}function Vi(){if(!Ui&&null!==Fi){Ui=!0;var e=0,t=xt;try{var n=Fi;for(xt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Fi=null,zi=!1}catch(i){throw null!==Fi&&(Fi=Fi.slice(e+1)),Ge($e,Vi),i}finally{xt=t,Ui=!1}}return null}var qi=[],Ki=0,Hi=null,Wi=0,Gi=[],Zi=0,Qi=null,Ji=1,Yi="";function Xi(e,t){qi[Ki++]=Wi,qi[Ki++]=Hi,Hi=e,Wi=t}function $i(e,t,n){Gi[Zi++]=Ji,Gi[Zi++]=Yi,Gi[Zi++]=Qi,Qi=e;var r=Ji;e=Yi;var i=32-at(r)-1;r&=~(1<<i),n+=1;var s=32-at(t)+i;if(30<s){var a=i-i%5;s=(r&(1<<a)-1).toString(32),r>>=a,i-=a,Ji=1<<32-at(t)+i|n<<i|r,Yi=s+e}else Ji=1<<s|n<<i|r,Yi=e}function es(e){null!==e.return&&(Xi(e,1),$i(e,1,0))}function ts(e){for(;e===Hi;)Hi=qi[--Ki],qi[Ki]=null,Wi=qi[--Ki],qi[Ki]=null;for(;e===Qi;)Qi=Gi[--Zi],Gi[Zi]=null,Yi=Gi[--Zi],Gi[Zi]=null,Ji=Gi[--Zi],Gi[Zi]=null}var ns=null,rs=null,is=!1,ss=null;function as(e,t){var n=Ic(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function os(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ns=e,rs=ci(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ns=e,rs=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Qi?{id:Ji,overflow:Yi}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Ic(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ns=e,rs=null,!0);default:return!1}}function ls(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function cs(e){if(is){var t=rs;if(t){var n=t;if(!os(e,t)){if(ls(e))throw Error(s(418));t=ci(n.nextSibling);var r=ns;t&&os(e,t)?as(r,n):(e.flags=-4097&e.flags|2,is=!1,ns=e)}}else{if(ls(e))throw Error(s(418));e.flags=-4097&e.flags|2,is=!1,ns=e}}}function us(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ns=e}function ds(e){if(e!==ns)return!1;if(!is)return us(e),is=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ni(e.type,e.memoizedProps)),t&&(t=rs)){if(ls(e))throw hs(),Error(s(418));for(;t;)as(e,t),t=ci(t.nextSibling)}if(us(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(s(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){rs=ci(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}rs=null}}else rs=ns?ci(e.stateNode.nextSibling):null;return!0}function hs(){for(var e=rs;e;)e=ci(e.nextSibling)}function ps(){rs=ns=null,is=!1}function fs(e){null===ss?ss=[e]:ss.push(e)}var ms=b.ReactCurrentBatchConfig;function gs(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(s(309));var r=n.stateNode}if(!r)throw Error(s(147,e));var i=r,a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=i.refs;null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!==typeof e)throw Error(s(284));if(!n._owner)throw Error(s(290,e))}return e}function vs(e,t){throw e=Object.prototype.toString.call(t),Error(s(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ys(e){return(0,e._init)(e._payload)}function xs(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Lc(e,t)).index=0,e.sibling=null,e}function a(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=Dc(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function c(e,t,n,r){var s=n.type;return s===k?d(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===s||"object"===typeof s&&null!==s&&s.$$typeof===P&&ys(s)===t.type)?((r=i(t,n.props)).ref=gs(e,t,n),r.return=e,r):((r=Rc(n.type,n.key,n.props,null,e.mode,r)).ref=gs(e,t,n),r.return=e,r)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Fc(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function d(e,t,n,r,s){return null===t||7!==t.tag?((t=Oc(n,e.mode,r,s)).return=e,t):((t=i(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Dc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case w:return(n=Rc(t.type,t.key,t.props,null,e.mode,n)).ref=gs(e,null,t),n.return=e,n;case _:return(t=Fc(t,e.mode,n)).return=e,t;case P:return h(e,(0,t._init)(t._payload),n)}if(te(t)||O(t))return(t=Oc(t,e.mode,n,null)).return=e,t;vs(e,t)}return null}function p(e,t,n,r){var i=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==i?null:l(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case w:return n.key===i?c(e,t,n,r):null;case _:return n.key===i?u(e,t,n,r):null;case P:return p(e,t,(i=n._init)(n._payload),r)}if(te(n)||O(n))return null!==i?null:d(e,t,n,r,null);vs(e,n)}return null}function f(e,t,n,r,i){if("string"===typeof r&&""!==r||"number"===typeof r)return l(t,e=e.get(n)||null,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case w:return c(t,e=e.get(null===r.key?n:r.key)||null,r,i);case _:return u(t,e=e.get(null===r.key?n:r.key)||null,r,i);case P:return f(e,t,n,(0,r._init)(r._payload),i)}if(te(r)||O(r))return d(t,e=e.get(n)||null,r,i,null);vs(t,r)}return null}function m(i,s,o,l){for(var c=null,u=null,d=s,m=s=0,g=null;null!==d&&m<o.length;m++){d.index>m?(g=d,d=null):g=d.sibling;var v=p(i,d,o[m],l);if(null===v){null===d&&(d=g);break}e&&d&&null===v.alternate&&t(i,d),s=a(v,s,m),null===u?c=v:u.sibling=v,u=v,d=g}if(m===o.length)return n(i,d),is&&Xi(i,m),c;if(null===d){for(;m<o.length;m++)null!==(d=h(i,o[m],l))&&(s=a(d,s,m),null===u?c=d:u.sibling=d,u=d);return is&&Xi(i,m),c}for(d=r(i,d);m<o.length;m++)null!==(g=f(d,i,m,o[m],l))&&(e&&null!==g.alternate&&d.delete(null===g.key?m:g.key),s=a(g,s,m),null===u?c=g:u.sibling=g,u=g);return e&&d.forEach(function(e){return t(i,e)}),is&&Xi(i,m),c}function g(i,o,l,c){var u=O(l);if("function"!==typeof u)throw Error(s(150));if(null==(l=u.call(l)))throw Error(s(151));for(var d=u=null,m=o,g=o=0,v=null,y=l.next();null!==m&&!y.done;g++,y=l.next()){m.index>g?(v=m,m=null):v=m.sibling;var x=p(i,m,y.value,c);if(null===x){null===m&&(m=v);break}e&&m&&null===x.alternate&&t(i,m),o=a(x,o,g),null===d?u=x:d.sibling=x,d=x,m=v}if(y.done)return n(i,m),is&&Xi(i,g),u;if(null===m){for(;!y.done;g++,y=l.next())null!==(y=h(i,y.value,c))&&(o=a(y,o,g),null===d?u=y:d.sibling=y,d=y);return is&&Xi(i,g),u}for(m=r(i,m);!y.done;g++,y=l.next())null!==(y=f(m,i,g,y.value,c))&&(e&&null!==y.alternate&&m.delete(null===y.key?g:y.key),o=a(y,o,g),null===d?u=y:d.sibling=y,d=y);return e&&m.forEach(function(e){return t(i,e)}),is&&Xi(i,g),u}return function e(r,s,a,l){if("object"===typeof a&&null!==a&&a.type===k&&null===a.key&&(a=a.props.children),"object"===typeof a&&null!==a){switch(a.$$typeof){case w:e:{for(var c=a.key,u=s;null!==u;){if(u.key===c){if((c=a.type)===k){if(7===u.tag){n(r,u.sibling),(s=i(u,a.props.children)).return=r,r=s;break e}}else if(u.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===P&&ys(c)===u.type){n(r,u.sibling),(s=i(u,a.props)).ref=gs(r,u,a),s.return=r,r=s;break e}n(r,u);break}t(r,u),u=u.sibling}a.type===k?((s=Oc(a.props.children,r.mode,l,a.key)).return=r,r=s):((l=Rc(a.type,a.key,a.props,null,r.mode,l)).ref=gs(r,s,a),l.return=r,r=l)}return o(r);case _:e:{for(u=a.key;null!==s;){if(s.key===u){if(4===s.tag&&s.stateNode.containerInfo===a.containerInfo&&s.stateNode.implementation===a.implementation){n(r,s.sibling),(s=i(s,a.children||[])).return=r,r=s;break e}n(r,s);break}t(r,s),s=s.sibling}(s=Fc(a,r.mode,l)).return=r,r=s}return o(r);case P:return e(r,s,(u=a._init)(a._payload),l)}if(te(a))return m(r,s,a,l);if(O(a))return g(r,s,a,l);vs(r,a)}return"string"===typeof a&&""!==a||"number"===typeof a?(a=""+a,null!==s&&6===s.tag?(n(r,s.sibling),(s=i(s,a)).return=r,r=s):(n(r,s),(s=Dc(a,r.mode,l)).return=r,r=s),o(r)):n(r,s)}}var bs=xs(!0),ws=xs(!1),_s=Ni(null),ks=null,Ns=null,Ss=null;function js(){Ss=Ns=ks=null}function Es(e){var t=_s.current;Si(_s),e._currentValue=t}function Cs(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Ts(e,t){ks=e,Ss=Ns=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(xo=!0),e.firstContext=null)}function As(e){var t=e._currentValue;if(Ss!==e)if(e={context:e,memoizedValue:t,next:null},null===Ns){if(null===ks)throw Error(s(308));Ns=e,ks.dependencies={lanes:0,firstContext:e}}else Ns=Ns.next=e;return t}var Is=null;function Ps(e){null===Is?Is=[e]:Is.push(e)}function Ls(e,t,n,r){var i=t.interleaved;return null===i?(n.next=n,Ps(t)):(n.next=i.next,i.next=n),t.interleaved=n,Rs(e,r)}function Rs(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Os=!1;function Ms(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ds(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Fs(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function zs(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Cl)){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,Rs(e,n)}return null===(i=r.interleaved)?(t.next=t,Ps(r)):(t.next=i.next,i.next=t),r.interleaved=t,Rs(e,n)}function Us(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}function Bs(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,s=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===s?i=s=a:s=s.next=a,n=n.next}while(null!==n);null===s?i=s=t:s=s.next=t}else i=s=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Vs(e,t,n,r){var i=e.updateQueue;Os=!1;var s=i.firstBaseUpdate,a=i.lastBaseUpdate,o=i.shared.pending;if(null!==o){i.shared.pending=null;var l=o,c=l.next;l.next=null,null===a?s=c:a.next=c,a=l;var u=e.alternate;null!==u&&((o=(u=u.updateQueue).lastBaseUpdate)!==a&&(null===o?u.firstBaseUpdate=c:o.next=c,u.lastBaseUpdate=l))}if(null!==s){var d=i.baseState;for(a=0,u=c=l=null,o=s;;){var h=o.lane,p=o.eventTime;if((r&h)===h){null!==u&&(u=u.next={eventTime:p,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var f=e,m=o;switch(h=t,p=n,m.tag){case 1:if("function"===typeof(f=m.payload)){d=f.call(p,d,h);break e}d=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(h="function"===typeof(f=m.payload)?f.call(p,d,h):f)||void 0===h)break e;d=D({},d,h);break e;case 2:Os=!0}}null!==o.callback&&0!==o.lane&&(e.flags|=64,null===(h=i.effects)?i.effects=[o]:h.push(o))}else p={eventTime:p,lane:h,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===u?(c=u=p,l=d):u=u.next=p,a|=h;if(null===(o=o.next)){if(null===(o=i.shared.pending))break;o=(h=o).next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}if(null===u&&(l=d),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,null!==(t=i.shared.interleaved)){i=t;do{a|=i.lane,i=i.next}while(i!==t)}else null===s&&(i.shared.lanes=0);Ml|=a,e.lanes=a,e.memoizedState=d}}function qs(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!==typeof i)throw Error(s(191,i));i.call(r)}}}var Ks={},Hs=Ni(Ks),Ws=Ni(Ks),Gs=Ni(Ks);function Zs(e){if(e===Ks)throw Error(s(174));return e}function Qs(e,t){switch(ji(Gs,t),ji(Ws,e),ji(Hs,Ks),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Si(Hs),ji(Hs,t)}function Js(){Si(Hs),Si(Ws),Si(Gs)}function Ys(e){Zs(Gs.current);var t=Zs(Hs.current),n=le(t,e.type);t!==n&&(ji(Ws,e),ji(Hs,n))}function Xs(e){Ws.current===e&&(Si(Hs),Si(Ws))}var $s=Ni(0);function ea(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ta=[];function na(){for(var e=0;e<ta.length;e++)ta[e]._workInProgressVersionPrimary=null;ta.length=0}var ra=b.ReactCurrentDispatcher,ia=b.ReactCurrentBatchConfig,sa=0,aa=null,oa=null,la=null,ca=!1,ua=!1,da=0,ha=0;function pa(){throw Error(s(321))}function fa(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!or(e[n],t[n]))return!1;return!0}function ma(e,t,n,r,i,a){if(sa=a,aa=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ra.current=null===e||null===e.memoizedState?Xa:$a,e=n(r,i),ua){a=0;do{if(ua=!1,da=0,25<=a)throw Error(s(301));a+=1,la=oa=null,t.updateQueue=null,ra.current=eo,e=n(r,i)}while(ua)}if(ra.current=Ya,t=null!==oa&&null!==oa.next,sa=0,la=oa=aa=null,ca=!1,t)throw Error(s(300));return e}function ga(){var e=0!==da;return da=0,e}function va(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===la?aa.memoizedState=la=e:la=la.next=e,la}function ya(){if(null===oa){var e=aa.alternate;e=null!==e?e.memoizedState:null}else e=oa.next;var t=null===la?aa.memoizedState:la.next;if(null!==t)la=t,oa=e;else{if(null===e)throw Error(s(310));e={memoizedState:(oa=e).memoizedState,baseState:oa.baseState,baseQueue:oa.baseQueue,queue:oa.queue,next:null},null===la?aa.memoizedState=la=e:la=la.next=e}return la}function xa(e,t){return"function"===typeof t?t(e):t}function ba(e){var t=ya(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var r=oa,i=r.baseQueue,a=n.pending;if(null!==a){if(null!==i){var o=i.next;i.next=a.next,a.next=o}r.baseQueue=i=a,n.pending=null}if(null!==i){a=i.next,r=r.baseState;var l=o=null,c=null,u=a;do{var d=u.lane;if((sa&d)===d)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var h={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=h,o=r):c=c.next=h,aa.lanes|=d,Ml|=d}u=u.next}while(null!==u&&u!==a);null===c?o=r:c.next=l,or(r,t.memoizedState)||(xo=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){i=e;do{a=i.lane,aa.lanes|=a,Ml|=a,i=i.next}while(i!==e)}else null===i&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function wa(e){var t=ya(),n=t.queue;if(null===n)throw Error(s(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,a=t.memoizedState;if(null!==i){n.pending=null;var o=i=i.next;do{a=e(a,o.action),o=o.next}while(o!==i);or(a,t.memoizedState)||(xo=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,r]}function _a(){}function ka(e,t){var n=aa,r=ya(),i=t(),a=!or(r.memoizedState,i);if(a&&(r.memoizedState=i,xo=!0),r=r.queue,Oa(ja.bind(null,n,r,e),[e]),r.getSnapshot!==t||a||null!==la&&1&la.memoizedState.tag){if(n.flags|=2048,Aa(9,Sa.bind(null,n,r,i,t),void 0,null),null===Tl)throw Error(s(349));0!==(30&sa)||Na(n,t,i)}return i}function Na(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=aa.updateQueue)?(t={lastEffect:null,stores:null},aa.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Sa(e,t,n,r){t.value=n,t.getSnapshot=r,Ea(t)&&Ca(e)}function ja(e,t,n){return n(function(){Ea(t)&&Ca(e)})}function Ea(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!or(e,n)}catch(r){return!0}}function Ca(e){var t=Rs(e,1);null!==t&&nc(t,e,1,-1)}function Ta(e){var t=va();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:xa,lastRenderedState:e},t.queue=e,e=e.dispatch=Ga.bind(null,aa,e),[t.memoizedState,e]}function Aa(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=aa.updateQueue)?(t={lastEffect:null,stores:null},aa.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Ia(){return ya().memoizedState}function Pa(e,t,n,r){var i=va();aa.flags|=e,i.memoizedState=Aa(1|t,n,void 0,void 0===r?null:r)}function La(e,t,n,r){var i=ya();r=void 0===r?null:r;var s=void 0;if(null!==oa){var a=oa.memoizedState;if(s=a.destroy,null!==r&&fa(r,a.deps))return void(i.memoizedState=Aa(t,n,s,r))}aa.flags|=e,i.memoizedState=Aa(1|t,n,s,r)}function Ra(e,t){return Pa(8390656,8,e,t)}function Oa(e,t){return La(2048,8,e,t)}function Ma(e,t){return La(4,2,e,t)}function Da(e,t){return La(4,4,e,t)}function Fa(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function za(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,La(4,4,Fa.bind(null,t,e),n)}function Ua(){}function Ba(e,t){var n=ya();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&fa(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Va(e,t){var n=ya();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&fa(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function qa(e,t,n){return 0===(21&sa)?(e.baseState&&(e.baseState=!1,xo=!0),e.memoizedState=n):(or(n,t)||(n=mt(),aa.lanes|=n,Ml|=n,e.baseState=!0),t)}function Ka(e,t){var n=xt;xt=0!==n&&4>n?n:4,e(!0);var r=ia.transition;ia.transition={};try{e(!1),t()}finally{xt=n,ia.transition=r}}function Ha(){return ya().memoizedState}function Wa(e,t,n){var r=tc(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Za(e))Qa(t,n);else if(null!==(n=Ls(e,t,n,r))){nc(n,e,r,ec()),Ja(n,t,r)}}function Ga(e,t,n){var r=tc(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Za(e))Qa(t,i);else{var s=e.alternate;if(0===e.lanes&&(null===s||0===s.lanes)&&null!==(s=t.lastRenderedReducer))try{var a=t.lastRenderedState,o=s(a,n);if(i.hasEagerState=!0,i.eagerState=o,or(o,a)){var l=t.interleaved;return null===l?(i.next=i,Ps(t)):(i.next=l.next,l.next=i),void(t.interleaved=i)}}catch(c){}null!==(n=Ls(e,t,i,r))&&(nc(n,e,r,i=ec()),Ja(n,t,r))}}function Za(e){var t=e.alternate;return e===aa||null!==t&&t===aa}function Qa(e,t){ua=ca=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Ja(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}var Ya={readContext:As,useCallback:pa,useContext:pa,useEffect:pa,useImperativeHandle:pa,useInsertionEffect:pa,useLayoutEffect:pa,useMemo:pa,useReducer:pa,useRef:pa,useState:pa,useDebugValue:pa,useDeferredValue:pa,useTransition:pa,useMutableSource:pa,useSyncExternalStore:pa,useId:pa,unstable_isNewReconciler:!1},Xa={readContext:As,useCallback:function(e,t){return va().memoizedState=[e,void 0===t?null:t],e},useContext:As,useEffect:Ra,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Pa(4194308,4,Fa.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Pa(4194308,4,e,t)},useInsertionEffect:function(e,t){return Pa(4,2,e,t)},useMemo:function(e,t){var n=va();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=va();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Wa.bind(null,aa,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},va().memoizedState=e},useState:Ta,useDebugValue:Ua,useDeferredValue:function(e){return va().memoizedState=e},useTransition:function(){var e=Ta(!1),t=e[0];return e=Ka.bind(null,e[1]),va().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=aa,i=va();if(is){if(void 0===n)throw Error(s(407));n=n()}else{if(n=t(),null===Tl)throw Error(s(349));0!==(30&sa)||Na(r,t,n)}i.memoizedState=n;var a={value:n,getSnapshot:t};return i.queue=a,Ra(ja.bind(null,r,a,e),[e]),r.flags|=2048,Aa(9,Sa.bind(null,r,a,n,t),void 0,null),n},useId:function(){var e=va(),t=Tl.identifierPrefix;if(is){var n=Yi;t=":"+t+"R"+(n=(Ji&~(1<<32-at(Ji)-1)).toString(32)+n),0<(n=da++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=ha++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},$a={readContext:As,useCallback:Ba,useContext:As,useEffect:Oa,useImperativeHandle:za,useInsertionEffect:Ma,useLayoutEffect:Da,useMemo:Va,useReducer:ba,useRef:Ia,useState:function(){return ba(xa)},useDebugValue:Ua,useDeferredValue:function(e){return qa(ya(),oa.memoizedState,e)},useTransition:function(){return[ba(xa)[0],ya().memoizedState]},useMutableSource:_a,useSyncExternalStore:ka,useId:Ha,unstable_isNewReconciler:!1},eo={readContext:As,useCallback:Ba,useContext:As,useEffect:Oa,useImperativeHandle:za,useInsertionEffect:Ma,useLayoutEffect:Da,useMemo:Va,useReducer:wa,useRef:Ia,useState:function(){return wa(xa)},useDebugValue:Ua,useDeferredValue:function(e){var t=ya();return null===oa?t.memoizedState=e:qa(t,oa.memoizedState,e)},useTransition:function(){return[wa(xa)[0],ya().memoizedState]},useMutableSource:_a,useSyncExternalStore:ka,useId:Ha,unstable_isNewReconciler:!1};function to(e,t){if(e&&e.defaultProps){for(var n in t=D({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function no(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:D({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var ro={isMounted:function(e){return!!(e=e._reactInternals)&&Ve(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=ec(),i=tc(e),s=Fs(r,i);s.payload=t,void 0!==n&&null!==n&&(s.callback=n),null!==(t=zs(e,s,i))&&(nc(t,e,i,r),Us(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=ec(),i=tc(e),s=Fs(r,i);s.tag=1,s.payload=t,void 0!==n&&null!==n&&(s.callback=n),null!==(t=zs(e,s,i))&&(nc(t,e,i,r),Us(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=ec(),r=tc(e),i=Fs(n,r);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),null!==(t=zs(e,i,r))&&(nc(t,e,r,n),Us(t,e,r))}};function io(e,t,n,r,i,s,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,s,a):!t.prototype||!t.prototype.isPureReactComponent||(!lr(n,r)||!lr(i,s))}function so(e,t,n){var r=!1,i=Ei,s=t.contextType;return"object"===typeof s&&null!==s?s=As(s):(i=Pi(t)?Ai:Ci.current,s=(r=null!==(r=t.contextTypes)&&void 0!==r)?Ii(e,i):Ei),t=new t(n,s),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=ro,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=s),t}function ao(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&ro.enqueueReplaceState(t,t.state,null)}function oo(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs={},Ms(e);var s=t.contextType;"object"===typeof s&&null!==s?i.context=As(s):(s=Pi(t)?Ai:Ci.current,i.context=Ii(e,s)),i.state=e.memoizedState,"function"===typeof(s=t.getDerivedStateFromProps)&&(no(e,t,s,n),i.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(t=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&ro.enqueueReplaceState(i,i.state,null),Vs(e,n,i,r),i.state=e.memoizedState),"function"===typeof i.componentDidMount&&(e.flags|=4194308)}function lo(e,t){try{var n="",r=t;do{n+=B(r),r=r.return}while(r);var i=n}catch(s){i="\nError generating stack: "+s.message+"\n"+s.stack}return{value:e,source:t,stack:i,digest:null}}function co(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function uo(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var ho="function"===typeof WeakMap?WeakMap:Map;function po(e,t,n){(n=Fs(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Kl||(Kl=!0,Hl=r),uo(0,t)},n}function fo(e,t,n){(n=Fs(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){uo(0,t)}}var s=e.stateNode;return null!==s&&"function"===typeof s.componentDidCatch&&(n.callback=function(){uo(0,t),"function"!==typeof r&&(null===Wl?Wl=new Set([this]):Wl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function mo(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new ho;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=Sc.bind(null,e,t,n),t.then(e,e))}function go(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function vo(e,t,n,r,i){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Fs(-1,1)).tag=2,zs(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=i,e)}var yo=b.ReactCurrentOwner,xo=!1;function bo(e,t,n,r){t.child=null===e?ws(t,null,n,r):bs(t,e.child,n,r)}function wo(e,t,n,r,i){n=n.render;var s=t.ref;return Ts(t,i),r=ma(e,t,n,r,s,i),n=ga(),null===e||xo?(is&&n&&es(t),t.flags|=1,bo(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Ko(e,t,i))}function _o(e,t,n,r,i){if(null===e){var s=n.type;return"function"!==typeof s||Pc(s)||void 0!==s.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Rc(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,ko(e,t,s,r,i))}if(s=e.child,0===(e.lanes&i)){var a=s.memoizedProps;if((n=null!==(n=n.compare)?n:lr)(a,r)&&e.ref===t.ref)return Ko(e,t,i)}return t.flags|=1,(e=Lc(s,r)).ref=t.ref,e.return=t,t.child=e}function ko(e,t,n,r,i){if(null!==e){var s=e.memoizedProps;if(lr(s,r)&&e.ref===t.ref){if(xo=!1,t.pendingProps=r=s,0===(e.lanes&i))return t.lanes=e.lanes,Ko(e,t,i);0!==(131072&e.flags)&&(xo=!0)}}return jo(e,t,n,r,i)}function No(e,t,n){var r=t.pendingProps,i=r.children,s=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},ji(Ll,Pl),Pl|=n;else{if(0===(1073741824&n))return e=null!==s?s.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,ji(Ll,Pl),Pl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==s?s.baseLanes:n,ji(Ll,Pl),Pl|=r}else null!==s?(r=s.baseLanes|n,t.memoizedState=null):r=n,ji(Ll,Pl),Pl|=r;return bo(e,t,i,n),t.child}function So(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function jo(e,t,n,r,i){var s=Pi(n)?Ai:Ci.current;return s=Ii(t,s),Ts(t,i),n=ma(e,t,n,r,s,i),r=ga(),null===e||xo?(is&&r&&es(t),t.flags|=1,bo(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Ko(e,t,i))}function Eo(e,t,n,r,i){if(Pi(n)){var s=!0;Mi(t)}else s=!1;if(Ts(t,i),null===t.stateNode)qo(e,t),so(t,n,r),oo(t,n,r,i),r=!0;else if(null===e){var a=t.stateNode,o=t.memoizedProps;a.props=o;var l=a.context,c=n.contextType;"object"===typeof c&&null!==c?c=As(c):c=Ii(t,c=Pi(n)?Ai:Ci.current);var u=n.getDerivedStateFromProps,d="function"===typeof u||"function"===typeof a.getSnapshotBeforeUpdate;d||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==r||l!==c)&&ao(t,a,r,c),Os=!1;var h=t.memoizedState;a.state=h,Vs(t,r,a,i),l=t.memoizedState,o!==r||h!==l||Ti.current||Os?("function"===typeof u&&(no(t,n,u,r),l=t.memoizedState),(o=Os||io(t,n,o,r,h,l,c))?(d||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4194308)):("function"===typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),a.props=r,a.state=l,a.context=c,r=o):("function"===typeof a.componentDidMount&&(t.flags|=4194308),r=!1)}else{a=t.stateNode,Ds(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:to(t.type,o),a.props=c,d=t.pendingProps,h=a.context,"object"===typeof(l=n.contextType)&&null!==l?l=As(l):l=Ii(t,l=Pi(n)?Ai:Ci.current);var p=n.getDerivedStateFromProps;(u="function"===typeof p||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(o!==d||h!==l)&&ao(t,a,r,l),Os=!1,h=t.memoizedState,a.state=h,Vs(t,r,a,i);var f=t.memoizedState;o!==d||h!==f||Ti.current||Os?("function"===typeof p&&(no(t,n,p,r),f=t.memoizedState),(c=Os||io(t,n,c,r,h,f,l)||!1)?(u||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(r,f,l),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(r,f,l)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=f),a.props=r,a.state=f,a.context=l,r=c):("function"!==typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return Co(e,t,n,r,s,i)}function Co(e,t,n,r,i,s){So(e,t);var a=0!==(128&t.flags);if(!r&&!a)return i&&Di(t,n,!1),Ko(e,t,s);r=t.stateNode,yo.current=t;var o=a&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&a?(t.child=bs(t,e.child,null,s),t.child=bs(t,null,o,s)):bo(e,t,o,s),t.memoizedState=r.state,i&&Di(t,n,!0),t.child}function To(e){var t=e.stateNode;t.pendingContext?Ri(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Ri(0,t.context,!1),Qs(e,t.containerInfo)}function Ao(e,t,n,r,i){return ps(),fs(i),t.flags|=256,bo(e,t,n,r),t.child}var Io,Po,Lo,Ro,Oo={dehydrated:null,treeContext:null,retryLane:0};function Mo(e){return{baseLanes:e,cachePool:null,transitions:null}}function Do(e,t,n){var r,i=t.pendingProps,a=$s.current,o=!1,l=0!==(128&t.flags);if((r=l)||(r=(null===e||null!==e.memoizedState)&&0!==(2&a)),r?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),ji($s,1&a),null===e)return cs(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=i.children,e=i.fallback,o?(i=t.mode,o=t.child,l={mode:"hidden",children:l},0===(1&i)&&null!==o?(o.childLanes=0,o.pendingProps=l):o=Mc(l,i,0,null),e=Oc(e,i,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=Mo(n),t.memoizedState=Oo,e):Fo(t,l));if(null!==(a=e.memoizedState)&&null!==(r=a.dehydrated))return function(e,t,n,r,i,a,o){if(n)return 256&t.flags?(t.flags&=-257,zo(e,t,o,r=co(Error(s(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(a=r.fallback,i=t.mode,r=Mc({mode:"visible",children:r.children},i,0,null),(a=Oc(a,i,o,null)).flags|=2,r.return=t,a.return=t,r.sibling=a,t.child=r,0!==(1&t.mode)&&bs(t,e.child,null,o),t.child.memoizedState=Mo(o),t.memoizedState=Oo,a);if(0===(1&t.mode))return zo(e,t,o,null);if("$!"===i.data){if(r=i.nextSibling&&i.nextSibling.dataset)var l=r.dgst;return r=l,zo(e,t,o,r=co(a=Error(s(419)),r,void 0))}if(l=0!==(o&e.childLanes),xo||l){if(null!==(r=Tl)){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}0!==(i=0!==(i&(r.suspendedLanes|o))?0:i)&&i!==a.retryLane&&(a.retryLane=i,Rs(e,i),nc(r,e,i,-1))}return mc(),zo(e,t,o,r=co(Error(s(421))))}return"$?"===i.data?(t.flags|=128,t.child=e.child,t=Ec.bind(null,e),i._reactRetry=t,null):(e=a.treeContext,rs=ci(i.nextSibling),ns=t,is=!0,ss=null,null!==e&&(Gi[Zi++]=Ji,Gi[Zi++]=Yi,Gi[Zi++]=Qi,Ji=e.id,Yi=e.overflow,Qi=t),t=Fo(t,r.children),t.flags|=4096,t)}(e,t,l,i,r,a,n);if(o){o=i.fallback,l=t.mode,r=(a=e.child).sibling;var c={mode:"hidden",children:i.children};return 0===(1&l)&&t.child!==a?((i=t.child).childLanes=0,i.pendingProps=c,t.deletions=null):(i=Lc(a,c)).subtreeFlags=14680064&a.subtreeFlags,null!==r?o=Lc(r,o):(o=Oc(o,l,n,null)).flags|=2,o.return=t,i.return=t,i.sibling=o,t.child=i,i=o,o=t.child,l=null===(l=e.child.memoizedState)?Mo(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},o.memoizedState=l,o.childLanes=e.childLanes&~n,t.memoizedState=Oo,i}return e=(o=e.child).sibling,i=Lc(o,{mode:"visible",children:i.children}),0===(1&t.mode)&&(i.lanes=n),i.return=t,i.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=i,t.memoizedState=null,i}function Fo(e,t){return(t=Mc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function zo(e,t,n,r){return null!==r&&fs(r),bs(t,e.child,null,n),(e=Fo(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Uo(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Cs(e.return,t,n)}function Bo(e,t,n,r,i){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i)}function Vo(e,t,n){var r=t.pendingProps,i=r.revealOrder,s=r.tail;if(bo(e,t,r.children,n),0!==(2&(r=$s.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Uo(e,n,t);else if(19===e.tag)Uo(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(ji($s,r),0===(1&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===ea(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Bo(t,!1,i,n,s);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===ea(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Bo(t,!0,n,null,s);break;case"together":Bo(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function qo(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Ko(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Ml|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(s(153));if(null!==t.child){for(n=Lc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Lc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Ho(e,t){if(!is)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Wo(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=14680064&i.subtreeFlags,r|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Go(e,t,n){var r=t.pendingProps;switch(ts(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Wo(t),null;case 1:case 17:return Pi(t.type)&&Li(),Wo(t),null;case 3:return r=t.stateNode,Js(),Si(Ti),Si(Ci),na(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(ds(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==ss&&(ac(ss),ss=null))),Po(e,t),Wo(t),null;case 5:Xs(t);var i=Zs(Gs.current);if(n=t.type,null!==e&&null!=t.stateNode)Lo(e,t,n,r,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(s(166));return Wo(t),null}if(e=Zs(Hs.current),ds(t)){r=t.stateNode,n=t.type;var a=t.memoizedProps;switch(r[hi]=t,r[pi]=a,e=0!==(1&t.mode),n){case"dialog":zr("cancel",r),zr("close",r);break;case"iframe":case"object":case"embed":zr("load",r);break;case"video":case"audio":for(i=0;i<Or.length;i++)zr(Or[i],r);break;case"source":zr("error",r);break;case"img":case"image":case"link":zr("error",r),zr("load",r);break;case"details":zr("toggle",r);break;case"input":J(r,a),zr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!a.multiple},zr("invalid",r);break;case"textarea":ie(r,a),zr("invalid",r)}for(var l in ye(n,a),i=null,a)if(a.hasOwnProperty(l)){var c=a[l];"children"===l?"string"===typeof c?r.textContent!==c&&(!0!==a.suppressHydrationWarning&&Xr(r.textContent,c,e),i=["children",c]):"number"===typeof c&&r.textContent!==""+c&&(!0!==a.suppressHydrationWarning&&Xr(r.textContent,c,e),i=["children",""+c]):o.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&zr("scroll",r)}switch(n){case"input":W(r),$(r,a,!0);break;case"textarea":W(r),ae(r);break;case"select":case"option":break;default:"function"===typeof a.onClick&&(r.onclick=$r)}r=i,t.updateQueue=r,null!==r&&(t.flags|=4)}else{l=9===i.nodeType?i:i.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=oe(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=l.createElement(n,{is:r.is}):(e=l.createElement(n),"select"===n&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,n),e[hi]=t,e[pi]=r,Io(e,t,!1,!1),t.stateNode=e;e:{switch(l=xe(n,r),n){case"dialog":zr("cancel",e),zr("close",e),i=r;break;case"iframe":case"object":case"embed":zr("load",e),i=r;break;case"video":case"audio":for(i=0;i<Or.length;i++)zr(Or[i],e);i=r;break;case"source":zr("error",e),i=r;break;case"img":case"image":case"link":zr("error",e),zr("load",e),i=r;break;case"details":zr("toggle",e),i=r;break;case"input":J(e,r),i=Q(e,r),zr("invalid",e);break;case"option":default:i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=D({},r,{value:void 0}),zr("invalid",e);break;case"textarea":ie(e,r),i=re(e,r),zr("invalid",e)}for(a in ye(n,i),c=i)if(c.hasOwnProperty(a)){var u=c[a];"style"===a?ge(e,u):"dangerouslySetInnerHTML"===a?null!=(u=u?u.__html:void 0)&&de(e,u):"children"===a?"string"===typeof u?("textarea"!==n||""!==u)&&he(e,u):"number"===typeof u&&he(e,""+u):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(o.hasOwnProperty(a)?null!=u&&"onScroll"===a&&zr("scroll",e):null!=u&&x(e,a,u,l))}switch(n){case"input":W(e),$(e,r,!1);break;case"textarea":W(e),ae(e);break;case"option":null!=r.value&&e.setAttribute("value",""+K(r.value));break;case"select":e.multiple=!!r.multiple,null!=(a=r.value)?ne(e,!!r.multiple,a,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof i.onClick&&(e.onclick=$r)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Wo(t),null;case 6:if(e&&null!=t.stateNode)Ro(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(s(166));if(n=Zs(Gs.current),Zs(Hs.current),ds(t)){if(r=t.stateNode,n=t.memoizedProps,r[hi]=t,(a=r.nodeValue!==n)&&null!==(e=ns))switch(e.tag){case 3:Xr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Xr(r.nodeValue,n,0!==(1&e.mode))}a&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[hi]=t,t.stateNode=r}return Wo(t),null;case 13:if(Si($s),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(is&&null!==rs&&0!==(1&t.mode)&&0===(128&t.flags))hs(),ps(),t.flags|=98560,a=!1;else if(a=ds(t),null!==r&&null!==r.dehydrated){if(null===e){if(!a)throw Error(s(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(s(317));a[hi]=t}else ps(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Wo(t),a=!1}else null!==ss&&(ac(ss),ss=null),a=!0;if(!a)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&$s.current)?0===Rl&&(Rl=3):mc())),null!==t.updateQueue&&(t.flags|=4),Wo(t),null);case 4:return Js(),Po(e,t),null===e&&Vr(t.stateNode.containerInfo),Wo(t),null;case 10:return Es(t.type._context),Wo(t),null;case 19:if(Si($s),null===(a=t.memoizedState))return Wo(t),null;if(r=0!==(128&t.flags),null===(l=a.rendering))if(r)Ho(a,!1);else{if(0!==Rl||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=ea(e))){for(t.flags|=128,Ho(a,!1),null!==(r=l.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(a=n).flags&=14680066,null===(l=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=l.childLanes,a.lanes=l.lanes,a.child=l.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=l.memoizedProps,a.memoizedState=l.memoizedState,a.updateQueue=l.updateQueue,a.type=l.type,e=l.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return ji($s,1&$s.current|2),t.child}e=e.sibling}null!==a.tail&&Ye()>Vl&&(t.flags|=128,r=!0,Ho(a,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=ea(l))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Ho(a,!0),null===a.tail&&"hidden"===a.tailMode&&!l.alternate&&!is)return Wo(t),null}else 2*Ye()-a.renderingStartTime>Vl&&1073741824!==n&&(t.flags|=128,r=!0,Ho(a,!1),t.lanes=4194304);a.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=a.last)?n.sibling=l:t.child=l,a.last=l)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=Ye(),t.sibling=null,n=$s.current,ji($s,r?1&n|2:1&n),t):(Wo(t),null);case 22:case 23:return dc(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Pl)&&(Wo(t),6&t.subtreeFlags&&(t.flags|=8192)):Wo(t),null;case 24:case 25:return null}throw Error(s(156,t.tag))}function Zo(e,t){switch(ts(t),t.tag){case 1:return Pi(t.type)&&Li(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Js(),Si(Ti),Si(Ci),na(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Xs(t),null;case 13:if(Si($s),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(s(340));ps()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Si($s),null;case 4:return Js(),null;case 10:return Es(t.type._context),null;case 22:case 23:return dc(),null;default:return null}}Io=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Po=function(){},Lo=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,Zs(Hs.current);var s,a=null;switch(n){case"input":i=Q(e,i),r=Q(e,r),a=[];break;case"select":i=D({},i,{value:void 0}),r=D({},r,{value:void 0}),a=[];break;case"textarea":i=re(e,i),r=re(e,r),a=[];break;default:"function"!==typeof i.onClick&&"function"===typeof r.onClick&&(e.onclick=$r)}for(u in ye(n,r),n=null,i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&null!=i[u])if("style"===u){var l=i[u];for(s in l)l.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(o.hasOwnProperty(u)?a||(a=[]):(a=a||[]).push(u,null));for(u in r){var c=r[u];if(l=null!=i?i[u]:void 0,r.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(s in l)!l.hasOwnProperty(s)||c&&c.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in c)c.hasOwnProperty(s)&&l[s]!==c[s]&&(n||(n={}),n[s]=c[s])}else n||(a||(a=[]),a.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(a=a||[]).push(u,c)):"children"===u?"string"!==typeof c&&"number"!==typeof c||(a=a||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(o.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&zr("scroll",e),a||l===c||(a=[])):(a=a||[]).push(u,c))}n&&(a=a||[]).push("style",n);var u=a;(t.updateQueue=u)&&(t.flags|=4)}},Ro=function(e,t,n,r){n!==r&&(t.flags|=4)};var Qo=!1,Jo=!1,Yo="function"===typeof WeakSet?WeakSet:Set,Xo=null;function $o(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){Nc(e,t,r)}else n.current=null}function el(e,t,n){try{n()}catch(r){Nc(e,t,r)}}var tl=!1;function nl(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{if((i.tag&e)===e){var s=i.destroy;i.destroy=void 0,void 0!==s&&el(t,n,s)}i=i.next}while(i!==r)}}function rl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function il(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function sl(e){var t=e.alternate;null!==t&&(e.alternate=null,sl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[hi],delete t[pi],delete t[mi],delete t[gi],delete t[vi])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function al(e){return 5===e.tag||3===e.tag||4===e.tag}function ol(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||al(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ll(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=$r));else if(4!==r&&null!==(e=e.child))for(ll(e,t,n),e=e.sibling;null!==e;)ll(e,t,n),e=e.sibling}function cl(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(cl(e,t,n),e=e.sibling;null!==e;)cl(e,t,n),e=e.sibling}var ul=null,dl=!1;function hl(e,t,n){for(n=n.child;null!==n;)pl(e,t,n),n=n.sibling}function pl(e,t,n){if(st&&"function"===typeof st.onCommitFiberUnmount)try{st.onCommitFiberUnmount(it,n)}catch(o){}switch(n.tag){case 5:Jo||$o(n,t);case 6:var r=ul,i=dl;ul=null,hl(e,t,n),dl=i,null!==(ul=r)&&(dl?(e=ul,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):ul.removeChild(n.stateNode));break;case 18:null!==ul&&(dl?(e=ul,n=n.stateNode,8===e.nodeType?li(e.parentNode,n):1===e.nodeType&&li(e,n),Vt(e)):li(ul,n.stateNode));break;case 4:r=ul,i=dl,ul=n.stateNode.containerInfo,dl=!0,hl(e,t,n),ul=r,dl=i;break;case 0:case 11:case 14:case 15:if(!Jo&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){i=r=r.next;do{var s=i,a=s.destroy;s=s.tag,void 0!==a&&(0!==(2&s)||0!==(4&s))&&el(n,t,a),i=i.next}while(i!==r)}hl(e,t,n);break;case 1:if(!Jo&&($o(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(o){Nc(n,t,o)}hl(e,t,n);break;case 21:hl(e,t,n);break;case 22:1&n.mode?(Jo=(r=Jo)||null!==n.memoizedState,hl(e,t,n),Jo=r):hl(e,t,n);break;default:hl(e,t,n)}}function fl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Yo),t.forEach(function(t){var r=Cc.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}}function ml(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r];try{var a=e,o=t,l=o;e:for(;null!==l;){switch(l.tag){case 5:ul=l.stateNode,dl=!1;break e;case 3:case 4:ul=l.stateNode.containerInfo,dl=!0;break e}l=l.return}if(null===ul)throw Error(s(160));pl(a,o,i),ul=null,dl=!1;var c=i.alternate;null!==c&&(c.return=null),i.return=null}catch(u){Nc(i,t,u)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gl(t,e),t=t.sibling}function gl(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ml(t,e),vl(e),4&r){try{nl(3,e,e.return),rl(3,e)}catch(g){Nc(e,e.return,g)}try{nl(5,e,e.return)}catch(g){Nc(e,e.return,g)}}break;case 1:ml(t,e),vl(e),512&r&&null!==n&&$o(n,n.return);break;case 5:if(ml(t,e),vl(e),512&r&&null!==n&&$o(n,n.return),32&e.flags){var i=e.stateNode;try{he(i,"")}catch(g){Nc(e,e.return,g)}}if(4&r&&null!=(i=e.stateNode)){var a=e.memoizedProps,o=null!==n?n.memoizedProps:a,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===a.type&&null!=a.name&&Y(i,a),xe(l,o);var u=xe(l,a);for(o=0;o<c.length;o+=2){var d=c[o],h=c[o+1];"style"===d?ge(i,h):"dangerouslySetInnerHTML"===d?de(i,h):"children"===d?he(i,h):x(i,d,h,u)}switch(l){case"input":X(i,a);break;case"textarea":se(i,a);break;case"select":var p=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!a.multiple;var f=a.value;null!=f?ne(i,!!a.multiple,f,!1):p!==!!a.multiple&&(null!=a.defaultValue?ne(i,!!a.multiple,a.defaultValue,!0):ne(i,!!a.multiple,a.multiple?[]:"",!1))}i[pi]=a}catch(g){Nc(e,e.return,g)}}break;case 6:if(ml(t,e),vl(e),4&r){if(null===e.stateNode)throw Error(s(162));i=e.stateNode,a=e.memoizedProps;try{i.nodeValue=a}catch(g){Nc(e,e.return,g)}}break;case 3:if(ml(t,e),vl(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Vt(t.containerInfo)}catch(g){Nc(e,e.return,g)}break;case 4:default:ml(t,e),vl(e);break;case 13:ml(t,e),vl(e),8192&(i=e.child).flags&&(a=null!==i.memoizedState,i.stateNode.isHidden=a,!a||null!==i.alternate&&null!==i.alternate.memoizedState||(Bl=Ye())),4&r&&fl(e);break;case 22:if(d=null!==n&&null!==n.memoizedState,1&e.mode?(Jo=(u=Jo)||d,ml(t,e),Jo=u):ml(t,e),vl(e),8192&r){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!d&&0!==(1&e.mode))for(Xo=e,d=e.child;null!==d;){for(h=Xo=d;null!==Xo;){switch(f=(p=Xo).child,p.tag){case 0:case 11:case 14:case 15:nl(4,p,p.return);break;case 1:$o(p,p.return);var m=p.stateNode;if("function"===typeof m.componentWillUnmount){r=p,n=p.return;try{t=r,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(g){Nc(r,n,g)}}break;case 5:$o(p,p.return);break;case 22:if(null!==p.memoizedState){wl(h);continue}}null!==f?(f.return=p,Xo=f):wl(h)}d=d.sibling}e:for(d=null,h=e;;){if(5===h.tag){if(null===d){d=h;try{i=h.stateNode,u?"function"===typeof(a=i.style).setProperty?a.setProperty("display","none","important"):a.display="none":(l=h.stateNode,o=void 0!==(c=h.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=me("display",o))}catch(g){Nc(e,e.return,g)}}}else if(6===h.tag){if(null===d)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(g){Nc(e,e.return,g)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:ml(t,e),vl(e),4&r&&fl(e);case 21:}}function vl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(al(n)){var r=n;break e}n=n.return}throw Error(s(160))}switch(r.tag){case 5:var i=r.stateNode;32&r.flags&&(he(i,""),r.flags&=-33),cl(e,ol(e),i);break;case 3:case 4:var a=r.stateNode.containerInfo;ll(e,ol(e),a);break;default:throw Error(s(161))}}catch(o){Nc(e,e.return,o)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function yl(e,t,n){Xo=e,xl(e,t,n)}function xl(e,t,n){for(var r=0!==(1&e.mode);null!==Xo;){var i=Xo,s=i.child;if(22===i.tag&&r){var a=null!==i.memoizedState||Qo;if(!a){var o=i.alternate,l=null!==o&&null!==o.memoizedState||Jo;o=Qo;var c=Jo;if(Qo=a,(Jo=l)&&!c)for(Xo=i;null!==Xo;)l=(a=Xo).child,22===a.tag&&null!==a.memoizedState?_l(i):null!==l?(l.return=a,Xo=l):_l(i);for(;null!==s;)Xo=s,xl(s,t,n),s=s.sibling;Xo=i,Qo=o,Jo=c}bl(e)}else 0!==(8772&i.subtreeFlags)&&null!==s?(s.return=i,Xo=s):bl(e)}}function bl(e){for(;null!==Xo;){var t=Xo;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Jo||rl(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Jo)if(null===n)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:to(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&qs(t,a,r);break;case 3:var o=t.updateQueue;if(null!==o){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}qs(t,o,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var d=u.memoizedState;if(null!==d){var h=d.dehydrated;null!==h&&Vt(h)}}}break;default:throw Error(s(163))}Jo||512&t.flags&&il(t)}catch(p){Nc(t,t.return,p)}}if(t===e){Xo=null;break}if(null!==(n=t.sibling)){n.return=t.return,Xo=n;break}Xo=t.return}}function wl(e){for(;null!==Xo;){var t=Xo;if(t===e){Xo=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Xo=n;break}Xo=t.return}}function _l(e){for(;null!==Xo;){var t=Xo;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{rl(4,t)}catch(l){Nc(t,n,l)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var i=t.return;try{r.componentDidMount()}catch(l){Nc(t,i,l)}}var s=t.return;try{il(t)}catch(l){Nc(t,s,l)}break;case 5:var a=t.return;try{il(t)}catch(l){Nc(t,a,l)}}}catch(l){Nc(t,t.return,l)}if(t===e){Xo=null;break}var o=t.sibling;if(null!==o){o.return=t.return,Xo=o;break}Xo=t.return}}var kl,Nl=Math.ceil,Sl=b.ReactCurrentDispatcher,jl=b.ReactCurrentOwner,El=b.ReactCurrentBatchConfig,Cl=0,Tl=null,Al=null,Il=0,Pl=0,Ll=Ni(0),Rl=0,Ol=null,Ml=0,Dl=0,Fl=0,zl=null,Ul=null,Bl=0,Vl=1/0,ql=null,Kl=!1,Hl=null,Wl=null,Gl=!1,Zl=null,Ql=0,Jl=0,Yl=null,Xl=-1,$l=0;function ec(){return 0!==(6&Cl)?Ye():-1!==Xl?Xl:Xl=Ye()}function tc(e){return 0===(1&e.mode)?1:0!==(2&Cl)&&0!==Il?Il&-Il:null!==ms.transition?(0===$l&&($l=mt()),$l):0!==(e=xt)?e:e=void 0===(e=window.event)?16:Jt(e.type)}function nc(e,t,n,r){if(50<Jl)throw Jl=0,Yl=null,Error(s(185));vt(e,n,r),0!==(2&Cl)&&e===Tl||(e===Tl&&(0===(2&Cl)&&(Dl|=n),4===Rl&&oc(e,Il)),rc(e,r),1===n&&0===Cl&&0===(1&t.mode)&&(Vl=Ye()+500,zi&&Vi()))}function rc(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,s=e.pendingLanes;0<s;){var a=31-at(s),o=1<<a,l=i[a];-1===l?0!==(o&n)&&0===(o&r)||(i[a]=pt(o,t)):l<=t&&(e.expiredLanes|=o),s&=~o}}(e,t);var r=ht(e,e===Tl?Il:0);if(0===r)null!==n&&Ze(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Ze(n),1===t)0===e.tag?function(e){zi=!0,Bi(e)}(lc.bind(null,e)):Bi(lc.bind(null,e)),ai(function(){0===(6&Cl)&&Vi()}),n=null;else{switch(bt(r)){case 1:n=$e;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Tc(n,ic.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function ic(e,t){if(Xl=-1,$l=0,0!==(6&Cl))throw Error(s(327));var n=e.callbackNode;if(_c()&&e.callbackNode!==n)return null;var r=ht(e,e===Tl?Il:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=gc(e,r);else{t=r;var i=Cl;Cl|=2;var a=fc();for(Tl===e&&Il===t||(ql=null,Vl=Ye()+500,hc(e,t));;)try{yc();break}catch(l){pc(e,l)}js(),Sl.current=a,Cl=i,null!==Al?t=0:(Tl=null,Il=0,t=Rl)}if(0!==t){if(2===t&&(0!==(i=ft(e))&&(r=i,t=sc(e,i))),1===t)throw n=Ol,hc(e,0),oc(e,r),rc(e,Ye()),n;if(6===t)oc(e,r);else{if(i=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],s=i.getSnapshot;i=i.value;try{if(!or(s(),i))return!1}catch(o){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(i)&&(2===(t=gc(e,r))&&(0!==(a=ft(e))&&(r=a,t=sc(e,a))),1===t))throw n=Ol,hc(e,0),oc(e,r),rc(e,Ye()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(s(345));case 2:case 5:wc(e,Ul,ql);break;case 3:if(oc(e,r),(130023424&r)===r&&10<(t=Bl+500-Ye())){if(0!==ht(e,0))break;if(((i=e.suspendedLanes)&r)!==r){ec(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=ri(wc.bind(null,e,Ul,ql),t);break}wc(e,Ul,ql);break;case 4:if(oc(e,r),(4194240&r)===r)break;for(t=e.eventTimes,i=-1;0<r;){var o=31-at(r);a=1<<o,(o=t[o])>i&&(i=o),r&=~a}if(r=i,10<(r=(120>(r=Ye()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Nl(r/1960))-r)){e.timeoutHandle=ri(wc.bind(null,e,Ul,ql),r);break}wc(e,Ul,ql);break;default:throw Error(s(329))}}}return rc(e,Ye()),e.callbackNode===n?ic.bind(null,e):null}function sc(e,t){var n=zl;return e.current.memoizedState.isDehydrated&&(hc(e,t).flags|=256),2!==(e=gc(e,t))&&(t=Ul,Ul=n,null!==t&&ac(t)),e}function ac(e){null===Ul?Ul=e:Ul.push.apply(Ul,e)}function oc(e,t){for(t&=~Fl,t&=~Dl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-at(t),r=1<<n;e[n]=-1,t&=~r}}function lc(e){if(0!==(6&Cl))throw Error(s(327));_c();var t=ht(e,0);if(0===(1&t))return rc(e,Ye()),null;var n=gc(e,t);if(0!==e.tag&&2===n){var r=ft(e);0!==r&&(t=r,n=sc(e,r))}if(1===n)throw n=Ol,hc(e,0),oc(e,t),rc(e,Ye()),n;if(6===n)throw Error(s(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,wc(e,Ul,ql),rc(e,Ye()),null}function cc(e,t){var n=Cl;Cl|=1;try{return e(t)}finally{0===(Cl=n)&&(Vl=Ye()+500,zi&&Vi())}}function uc(e){null!==Zl&&0===Zl.tag&&0===(6&Cl)&&_c();var t=Cl;Cl|=1;var n=El.transition,r=xt;try{if(El.transition=null,xt=1,e)return e()}finally{xt=r,El.transition=n,0===(6&(Cl=t))&&Vi()}}function dc(){Pl=Ll.current,Si(Ll)}function hc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,ii(n)),null!==Al)for(n=Al.return;null!==n;){var r=n;switch(ts(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Li();break;case 3:Js(),Si(Ti),Si(Ci),na();break;case 5:Xs(r);break;case 4:Js();break;case 13:case 19:Si($s);break;case 10:Es(r.type._context);break;case 22:case 23:dc()}n=n.return}if(Tl=e,Al=e=Lc(e.current,null),Il=Pl=t,Rl=0,Ol=null,Fl=Dl=Ml=0,Ul=zl=null,null!==Is){for(t=0;t<Is.length;t++)if(null!==(r=(n=Is[t]).interleaved)){n.interleaved=null;var i=r.next,s=n.pending;if(null!==s){var a=s.next;s.next=i,r.next=a}n.pending=r}Is=null}return e}function pc(e,t){for(;;){var n=Al;try{if(js(),ra.current=Ya,ca){for(var r=aa.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}ca=!1}if(sa=0,la=oa=aa=null,ua=!1,da=0,jl.current=null,null===n||null===n.return){Rl=1,Ol=t,Al=null;break}e:{var a=e,o=n.return,l=n,c=t;if(t=Il,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c,d=l,h=d.tag;if(0===(1&d.mode)&&(0===h||11===h||15===h)){var p=d.alternate;p?(d.updateQueue=p.updateQueue,d.memoizedState=p.memoizedState,d.lanes=p.lanes):(d.updateQueue=null,d.memoizedState=null)}var f=go(o);if(null!==f){f.flags&=-257,vo(f,o,l,0,t),1&f.mode&&mo(a,u,t),c=u;var m=(t=f).updateQueue;if(null===m){var g=new Set;g.add(c),t.updateQueue=g}else m.add(c);break e}if(0===(1&t)){mo(a,u,t),mc();break e}c=Error(s(426))}else if(is&&1&l.mode){var v=go(o);if(null!==v){0===(65536&v.flags)&&(v.flags|=256),vo(v,o,l,0,t),fs(lo(c,l));break e}}a=c=lo(c,l),4!==Rl&&(Rl=2),null===zl?zl=[a]:zl.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t,Bs(a,po(0,c,t));break e;case 1:l=c;var y=a.type,x=a.stateNode;if(0===(128&a.flags)&&("function"===typeof y.getDerivedStateFromError||null!==x&&"function"===typeof x.componentDidCatch&&(null===Wl||!Wl.has(x)))){a.flags|=65536,t&=-t,a.lanes|=t,Bs(a,fo(a,l,t));break e}}a=a.return}while(null!==a)}bc(n)}catch(b){t=b,Al===n&&null!==n&&(Al=n=n.return);continue}break}}function fc(){var e=Sl.current;return Sl.current=Ya,null===e?Ya:e}function mc(){0!==Rl&&3!==Rl&&2!==Rl||(Rl=4),null===Tl||0===(268435455&Ml)&&0===(268435455&Dl)||oc(Tl,Il)}function gc(e,t){var n=Cl;Cl|=2;var r=fc();for(Tl===e&&Il===t||(ql=null,hc(e,t));;)try{vc();break}catch(i){pc(e,i)}if(js(),Cl=n,Sl.current=r,null!==Al)throw Error(s(261));return Tl=null,Il=0,Rl}function vc(){for(;null!==Al;)xc(Al)}function yc(){for(;null!==Al&&!Qe();)xc(Al)}function xc(e){var t=kl(e.alternate,e,Pl);e.memoizedProps=e.pendingProps,null===t?bc(e):Al=t,jl.current=null}function bc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Go(n,t,Pl)))return void(Al=n)}else{if(null!==(n=Zo(n,t)))return n.flags&=32767,void(Al=n);if(null===e)return Rl=6,void(Al=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Al=t);Al=t=e}while(null!==t);0===Rl&&(Rl=5)}function wc(e,t,n){var r=xt,i=El.transition;try{El.transition=null,xt=1,function(e,t,n,r){do{_c()}while(null!==Zl);if(0!==(6&Cl))throw Error(s(327));n=e.finishedWork;var i=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(s(177));e.callbackNode=null,e.callbackPriority=0;var a=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-at(n),s=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~s}}(e,a),e===Tl&&(Al=Tl=null,Il=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Gl||(Gl=!0,Tc(tt,function(){return _c(),null})),a=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||a){a=El.transition,El.transition=null;var o=xt;xt=1;var l=Cl;Cl|=4,jl.current=null,function(e,t){if(ei=Kt,pr(e=hr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var i=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{n.nodeType,a.nodeType}catch(w){n=null;break e}var o=0,l=-1,c=-1,u=0,d=0,h=e,p=null;t:for(;;){for(var f;h!==n||0!==i&&3!==h.nodeType||(l=o+i),h!==a||0!==r&&3!==h.nodeType||(c=o+r),3===h.nodeType&&(o+=h.nodeValue.length),null!==(f=h.firstChild);)p=h,h=f;for(;;){if(h===e)break t;if(p===n&&++u===i&&(l=o),p===a&&++d===r&&(c=o),null!==(f=h.nextSibling))break;p=(h=p).parentNode}h=f}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(ti={focusedElem:e,selectionRange:n},Kt=!1,Xo=t;null!==Xo;)if(e=(t=Xo).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Xo=e;else for(;null!==Xo;){t=Xo;try{var m=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,v=m.memoizedState,y=t.stateNode,x=y.getSnapshotBeforeUpdate(t.elementType===t.type?g:to(t.type,g),v);y.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var b=t.stateNode.containerInfo;1===b.nodeType?b.textContent="":9===b.nodeType&&b.documentElement&&b.removeChild(b.documentElement);break;default:throw Error(s(163))}}catch(w){Nc(t,t.return,w)}if(null!==(e=t.sibling)){e.return=t.return,Xo=e;break}Xo=t.return}m=tl,tl=!1}(e,n),gl(n,e),fr(ti),Kt=!!ei,ti=ei=null,e.current=n,yl(n,e,i),Je(),Cl=l,xt=o,El.transition=a}else e.current=n;if(Gl&&(Gl=!1,Zl=e,Ql=i),a=e.pendingLanes,0===a&&(Wl=null),function(e){if(st&&"function"===typeof st.onCommitFiberRoot)try{st.onCommitFiberRoot(it,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),rc(e,Ye()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)i=t[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(Kl)throw Kl=!1,e=Hl,Hl=null,e;0!==(1&Ql)&&0!==e.tag&&_c(),a=e.pendingLanes,0!==(1&a)?e===Yl?Jl++:(Jl=0,Yl=e):Jl=0,Vi()}(e,t,n,r)}finally{El.transition=i,xt=r}return null}function _c(){if(null!==Zl){var e=bt(Ql),t=El.transition,n=xt;try{if(El.transition=null,xt=16>e?16:e,null===Zl)var r=!1;else{if(e=Zl,Zl=null,Ql=0,0!==(6&Cl))throw Error(s(331));var i=Cl;for(Cl|=4,Xo=e.current;null!==Xo;){var a=Xo,o=a.child;if(0!==(16&Xo.flags)){var l=a.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Xo=u;null!==Xo;){var d=Xo;switch(d.tag){case 0:case 11:case 15:nl(8,d,a)}var h=d.child;if(null!==h)h.return=d,Xo=h;else for(;null!==Xo;){var p=(d=Xo).sibling,f=d.return;if(sl(d),d===u){Xo=null;break}if(null!==p){p.return=f,Xo=p;break}Xo=f}}}var m=a.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(null!==g)}}Xo=a}}if(0!==(2064&a.subtreeFlags)&&null!==o)o.return=a,Xo=o;else e:for(;null!==Xo;){if(0!==(2048&(a=Xo).flags))switch(a.tag){case 0:case 11:case 15:nl(9,a,a.return)}var y=a.sibling;if(null!==y){y.return=a.return,Xo=y;break e}Xo=a.return}}var x=e.current;for(Xo=x;null!==Xo;){var b=(o=Xo).child;if(0!==(2064&o.subtreeFlags)&&null!==b)b.return=o,Xo=b;else e:for(o=x;null!==Xo;){if(0!==(2048&(l=Xo).flags))try{switch(l.tag){case 0:case 11:case 15:rl(9,l)}}catch(_){Nc(l,l.return,_)}if(l===o){Xo=null;break e}var w=l.sibling;if(null!==w){w.return=l.return,Xo=w;break e}Xo=l.return}}if(Cl=i,Vi(),st&&"function"===typeof st.onPostCommitFiberRoot)try{st.onPostCommitFiberRoot(it,e)}catch(_){}r=!0}return r}finally{xt=n,El.transition=t}}return!1}function kc(e,t,n){e=zs(e,t=po(0,t=lo(n,t),1),1),t=ec(),null!==e&&(vt(e,1,t),rc(e,t))}function Nc(e,t,n){if(3===e.tag)kc(e,e,n);else for(;null!==t;){if(3===t.tag){kc(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Wl||!Wl.has(r))){t=zs(t,e=fo(t,e=lo(n,e),1),1),e=ec(),null!==t&&(vt(t,1,e),rc(t,e));break}}t=t.return}}function Sc(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=ec(),e.pingedLanes|=e.suspendedLanes&n,Tl===e&&(Il&n)===n&&(4===Rl||3===Rl&&(130023424&Il)===Il&&500>Ye()-Bl?hc(e,0):Fl|=n),rc(e,t)}function jc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ut,0===(130023424&(ut<<=1))&&(ut=4194304)));var n=ec();null!==(e=Rs(e,t))&&(vt(e,t,n),rc(e,n))}function Ec(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),jc(e,n)}function Cc(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(s(314))}null!==r&&r.delete(t),jc(e,n)}function Tc(e,t){return Ge(e,t)}function Ac(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ic(e,t,n,r){return new Ac(e,t,n,r)}function Pc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Lc(e,t){var n=e.alternate;return null===n?((n=Ic(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Rc(e,t,n,r,i,a){var o=2;if(r=e,"function"===typeof e)Pc(e)&&(o=1);else if("string"===typeof e)o=5;else e:switch(e){case k:return Oc(n.children,i,a,t);case N:o=8,i|=8;break;case S:return(e=Ic(12,n,t,2|i)).elementType=S,e.lanes=a,e;case T:return(e=Ic(13,n,t,i)).elementType=T,e.lanes=a,e;case A:return(e=Ic(19,n,t,i)).elementType=A,e.lanes=a,e;case L:return Mc(n,i,a,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case j:o=10;break e;case E:o=9;break e;case C:o=11;break e;case I:o=14;break e;case P:o=16,r=null;break e}throw Error(s(130,null==e?e:typeof e,""))}return(t=Ic(o,n,t,i)).elementType=e,t.type=r,t.lanes=a,t}function Oc(e,t,n,r){return(e=Ic(7,e,r,t)).lanes=n,e}function Mc(e,t,n,r){return(e=Ic(22,e,r,t)).elementType=L,e.lanes=n,e.stateNode={isHidden:!1},e}function Dc(e,t,n){return(e=Ic(6,e,null,t)).lanes=n,e}function Fc(e,t,n){return(t=Ic(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function zc(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Uc(e,t,n,r,i,s,a,o,l){return e=new zc(e,t,n,o,l),1===t?(t=1,!0===s&&(t|=8)):t=0,s=Ic(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ms(s),e}function Bc(e){if(!e)return Ei;e:{if(Ve(e=e._reactInternals)!==e||1!==e.tag)throw Error(s(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Pi(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(s(171))}if(1===e.tag){var n=e.type;if(Pi(n))return Oi(e,n,t)}return t}function Vc(e,t,n,r,i,s,a,o,l){return(e=Uc(n,r,!0,e,0,s,0,o,l)).context=Bc(null),n=e.current,(s=Fs(r=ec(),i=tc(n))).callback=void 0!==t&&null!==t?t:null,zs(n,s,i),e.current.lanes=i,vt(e,i,r),rc(e,r),e}function qc(e,t,n,r){var i=t.current,s=ec(),a=tc(i);return n=Bc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Fs(s,a)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=zs(i,t,a))&&(nc(e,i,a,s),Us(e,i,a)),a}function Kc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Hc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Wc(e,t){Hc(e,t),(e=e.alternate)&&Hc(e,t)}kl=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ti.current)xo=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return xo=!1,function(e,t,n){switch(t.tag){case 3:To(t),ps();break;case 5:Ys(t);break;case 1:Pi(t.type)&&Mi(t);break;case 4:Qs(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;ji(_s,r._currentValue),r._currentValue=i;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(ji($s,1&$s.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Do(e,t,n):(ji($s,1&$s.current),null!==(e=Ko(e,t,n))?e.sibling:null);ji($s,1&$s.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return Vo(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),ji($s,$s.current),r)break;return null;case 22:case 23:return t.lanes=0,No(e,t,n)}return Ko(e,t,n)}(e,t,n);xo=0!==(131072&e.flags)}else xo=!1,is&&0!==(1048576&t.flags)&&$i(t,Wi,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;qo(e,t),e=t.pendingProps;var i=Ii(t,Ci.current);Ts(t,n),i=ma(null,t,r,e,i,n);var a=ga();return t.flags|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Pi(r)?(a=!0,Mi(t)):a=!1,t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,Ms(t),i.updater=ro,t.stateNode=i,i._reactInternals=t,oo(t,r,e,n),t=Co(null,t,r,!0,a,n)):(t.tag=0,is&&a&&es(t),bo(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(qo(e,t),e=t.pendingProps,r=(i=r._init)(r._payload),t.type=r,i=t.tag=function(e){if("function"===typeof e)return Pc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===C)return 11;if(e===I)return 14}return 2}(r),e=to(r,e),i){case 0:t=jo(null,t,r,e,n);break e;case 1:t=Eo(null,t,r,e,n);break e;case 11:t=wo(null,t,r,e,n);break e;case 14:t=_o(null,t,r,to(r.type,e),n);break e}throw Error(s(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,jo(e,t,r,i=t.elementType===r?i:to(r,i),n);case 1:return r=t.type,i=t.pendingProps,Eo(e,t,r,i=t.elementType===r?i:to(r,i),n);case 3:e:{if(To(t),null===e)throw Error(s(387));r=t.pendingProps,i=(a=t.memoizedState).element,Ds(e,t),Vs(t,r,null,n);var o=t.memoizedState;if(r=o.element,a.isDehydrated){if(a={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=Ao(e,t,r,n,i=lo(Error(s(423)),t));break e}if(r!==i){t=Ao(e,t,r,n,i=lo(Error(s(424)),t));break e}for(rs=ci(t.stateNode.containerInfo.firstChild),ns=t,is=!0,ss=null,n=ws(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(ps(),r===i){t=Ko(e,t,n);break e}bo(e,t,r,n)}t=t.child}return t;case 5:return Ys(t),null===e&&cs(t),r=t.type,i=t.pendingProps,a=null!==e?e.memoizedProps:null,o=i.children,ni(r,i)?o=null:null!==a&&ni(r,a)&&(t.flags|=32),So(e,t),bo(e,t,o,n),t.child;case 6:return null===e&&cs(t),null;case 13:return Do(e,t,n);case 4:return Qs(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=bs(t,null,r,n):bo(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,wo(e,t,r,i=t.elementType===r?i:to(r,i),n);case 7:return bo(e,t,t.pendingProps,n),t.child;case 8:case 12:return bo(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,a=t.memoizedProps,o=i.value,ji(_s,r._currentValue),r._currentValue=o,null!==a)if(or(a.value,o)){if(a.children===i.children&&!Ti.current){t=Ko(e,t,n);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var l=a.dependencies;if(null!==l){o=a.child;for(var c=l.firstContext;null!==c;){if(c.context===r){if(1===a.tag){(c=Fs(-1,n&-n)).tag=2;var u=a.updateQueue;if(null!==u){var d=(u=u.shared).pending;null===d?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}a.lanes|=n,null!==(c=a.alternate)&&(c.lanes|=n),Cs(a.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===a.tag)o=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(o=a.return))throw Error(s(341));o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),Cs(o,n,t),o=a.sibling}else o=a.child;if(null!==o)o.return=a;else for(o=a;null!==o;){if(o===t){o=null;break}if(null!==(a=o.sibling)){a.return=o.return,o=a;break}o=o.return}a=o}bo(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,Ts(t,n),r=r(i=As(i)),t.flags|=1,bo(e,t,r,n),t.child;case 14:return i=to(r=t.type,t.pendingProps),_o(e,t,r,i=to(r.type,i),n);case 15:return ko(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:to(r,i),qo(e,t),t.tag=1,Pi(r)?(e=!0,Mi(t)):e=!1,Ts(t,n),so(t,r,i),oo(t,r,i,n),Co(null,t,r,!0,e,n);case 19:return Vo(e,t,n);case 22:return No(e,t,n)}throw Error(s(156,t.tag))};var Gc="function"===typeof reportError?reportError:function(e){console.error(e)};function Zc(e){this._internalRoot=e}function Qc(e){this._internalRoot=e}function Jc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Yc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Xc(){}function $c(e,t,n,r,i){var s=n._reactRootContainer;if(s){var a=s;if("function"===typeof i){var o=i;i=function(){var e=Kc(a);o.call(e)}}qc(t,a,e,i)}else a=function(e,t,n,r,i){if(i){if("function"===typeof r){var s=r;r=function(){var e=Kc(a);s.call(e)}}var a=Vc(t,r,e,0,null,!1,0,"",Xc);return e._reactRootContainer=a,e[fi]=a.current,Vr(8===e.nodeType?e.parentNode:e),uc(),a}for(;i=e.lastChild;)e.removeChild(i);if("function"===typeof r){var o=r;r=function(){var e=Kc(l);o.call(e)}}var l=Uc(e,0,!1,null,0,!1,0,"",Xc);return e._reactRootContainer=l,e[fi]=l.current,Vr(8===e.nodeType?e.parentNode:e),uc(function(){qc(t,l,n,r)}),l}(n,t,e,i,r);return Kc(a)}Qc.prototype.render=Zc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(s(409));qc(e,t,null,null)},Qc.prototype.unmount=Zc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;uc(function(){qc(null,e,null,null)}),t[fi]=null}},Qc.prototype.unstable_scheduleHydration=function(e){if(e){var t=Nt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Lt.length&&0!==t&&t<Lt[n].priority;n++);Lt.splice(n,0,e),0===n&&Dt(e)}},wt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=dt(t.pendingLanes);0!==n&&(yt(t,1|n),rc(t,Ye()),0===(6&Cl)&&(Vl=Ye()+500,Vi()))}break;case 13:uc(function(){var t=Rs(e,1);if(null!==t){var n=ec();nc(t,e,1,n)}}),Wc(e,1)}},_t=function(e){if(13===e.tag){var t=Rs(e,134217728);if(null!==t)nc(t,e,134217728,ec());Wc(e,134217728)}},kt=function(e){if(13===e.tag){var t=tc(e),n=Rs(e,t);if(null!==n)nc(n,e,t,ec());Wc(e,t)}},Nt=function(){return xt},St=function(e,t){var n=xt;try{return xt=e,t()}finally{xt=n}},_e=function(e,t,n){switch(t){case"input":if(X(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=wi(r);if(!i)throw Error(s(90));G(r),X(r,i)}}}break;case"textarea":se(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ce=cc,Te=uc;var eu={usingClientEntryPoint:!1,Events:[xi,bi,wi,je,Ee,cc]},tu={findFiberByHostInstance:yi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nu={bundleType:tu.bundleType,version:tu.version,rendererPackageName:tu.rendererPackageName,rendererConfig:tu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:b.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=He(e))?null:e.stateNode},findFiberByHostInstance:tu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ru=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ru.isDisabled&&ru.supportsFiber)try{it=ru.inject(nu),st=ru}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eu,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Jc(t))throw Error(s(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:_,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Jc(e))throw Error(s(299));var n=!1,r="",i=Gc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(i=t.onRecoverableError)),t=Uc(e,1,!1,null,0,n,0,r,i),e[fi]=t.current,Vr(8===e.nodeType?e.parentNode:e),new Zc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(s(188));throw e=Object.keys(e).join(","),Error(s(268,e))}return e=null===(e=He(t))?null:e.stateNode},t.flushSync=function(e){return uc(e)},t.hydrate=function(e,t,n){if(!Yc(t))throw Error(s(200));return $c(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Jc(e))throw Error(s(405));var r=null!=n&&n.hydratedSources||null,i=!1,a="",o=Gc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(a=n.identifierPrefix),void 0!==n.onRecoverableError&&(o=n.onRecoverableError)),t=Vc(t,null,e,1,null!=n?n:null,i,0,a,o),e[fi]=t.current,Vr(e),r)for(e=0;e<r.length;e++)i=(i=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new Qc(t)},t.render=function(e,t,n){if(!Yc(t))throw Error(s(200));return $c(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Yc(e))throw Error(s(40));return!!e._reactRootContainer&&(uc(function(){$c(null,null,e,!1,function(){e._reactRootContainer=null,e[fi]=null})}),!0)},t.unstable_batchedUpdates=cc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Yc(n))throw Error(s(200));if(null==e||void 0===e._reactInternals)throw Error(s(38));return $c(e,t,n,!1,r)},t.version="18.3.1-next-f1338f8080-20240426"},3218:e=>{"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},3257:(e,t)=>{t.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40}},4004:(e,t,n)=>{const r=n(7421),i=n(900),s=n(9642),a=n(8697),o=n(5200),l=n(8511),c=n(7969),u=n(7347);function d(e){return unescape(encodeURIComponent(e)).length}function h(e,t,n){const r=[];let i;for(;null!==(i=e.exec(n));)r.push({data:i[0],index:i.index,mode:t,length:i[0].length});return r}function p(e){const t=h(l.NUMERIC,r.NUMERIC,e),n=h(l.ALPHANUMERIC,r.ALPHANUMERIC,e);let i,s;c.isKanjiModeEnabled()?(i=h(l.BYTE,r.BYTE,e),s=h(l.KANJI,r.KANJI,e)):(i=h(l.BYTE_KANJI,r.BYTE,e),s=[]);return t.concat(n,i,s).sort(function(e,t){return e.index-t.index}).map(function(e){return{data:e.data,mode:e.mode,length:e.length}})}function f(e,t){switch(t){case r.NUMERIC:return i.getBitsLength(e);case r.ALPHANUMERIC:return s.getBitsLength(e);case r.KANJI:return o.getBitsLength(e);case r.BYTE:return a.getBitsLength(e)}}function m(e,t){let n;const l=r.getBestModeForData(e);if(n=r.from(t,l),n!==r.BYTE&&n.bit<l.bit)throw new Error('"'+e+'" cannot be encoded with mode '+r.toString(n)+".\n Suggested mode is: "+r.toString(l));switch(n!==r.KANJI||c.isKanjiModeEnabled()||(n=r.BYTE),n){case r.NUMERIC:return new i(e);case r.ALPHANUMERIC:return new s(e);case r.KANJI:return new o(e);case r.BYTE:return new a(e)}}t.fromArray=function(e){return e.reduce(function(e,t){return"string"===typeof t?e.push(m(t,null)):t.data&&e.push(m(t.data,t.mode)),e},[])},t.fromString=function(e,n){const i=function(e){const t=[];for(let n=0;n<e.length;n++){const i=e[n];switch(i.mode){case r.NUMERIC:t.push([i,{data:i.data,mode:r.ALPHANUMERIC,length:i.length},{data:i.data,mode:r.BYTE,length:i.length}]);break;case r.ALPHANUMERIC:t.push([i,{data:i.data,mode:r.BYTE,length:i.length}]);break;case r.KANJI:t.push([i,{data:i.data,mode:r.BYTE,length:d(i.data)}]);break;case r.BYTE:t.push([{data:i.data,mode:r.BYTE,length:d(i.data)}])}}return t}(p(e,c.isKanjiModeEnabled())),s=function(e,t){const n={},i={start:{}};let s=["start"];for(let a=0;a<e.length;a++){const o=e[a],l=[];for(let e=0;e<o.length;e++){const c=o[e],u=""+a+e;l.push(u),n[u]={node:c,lastCount:0},i[u]={};for(let e=0;e<s.length;e++){const a=s[e];n[a]&&n[a].node.mode===c.mode?(i[a][u]=f(n[a].lastCount+c.length,c.mode)-f(n[a].lastCount,c.mode),n[a].lastCount+=c.length):(n[a]&&(n[a].lastCount=c.length),i[a][u]=f(c.length,c.mode)+4+r.getCharCountIndicator(c.mode,t))}}s=l}for(let r=0;r<s.length;r++)i[s[r]].end=0;return{map:i,table:n}}(i,n),a=u.find_path(s.map,"start","end"),o=[];for(let t=1;t<a.length-1;t++)o.push(s.table[a[t]].node);return t.fromArray(function(e){return e.reduce(function(e,t){const n=e.length-1>=0?e[e.length-1]:null;return n&&n.mode===t.mode?(e[e.length-1].data+=t.data,e):(e.push(t),e)},[])}(o))},t.rawSplit=function(e){return t.fromArray(p(e,c.isKanjiModeEnabled()))}},4202:(e,t)=>{"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}function y(){}function x(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||f}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=v.prototype;var b=x.prototype=new y;b.constructor=x,m(b,v.prototype),b.isPureReactComponent=!0;var w=Array.isArray,_=Object.prototype.hasOwnProperty,k={current:null},N={key:!0,ref:!0,__self:!0,__source:!0};function S(e,t,r){var i,s={},a=null,o=null;if(null!=t)for(i in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(a=""+t.key),t)_.call(t,i)&&!N.hasOwnProperty(i)&&(s[i]=t[i]);var l=arguments.length-2;if(1===l)s.children=r;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];s.children=c}if(e&&e.defaultProps)for(i in l=e.defaultProps)void 0===s[i]&&(s[i]=l[i]);return{$$typeof:n,type:e,key:a,ref:o,props:s,_owner:k.current}}function j(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var E=/\/+/g;function C(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function T(e,t,i,s,a){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var l=!1;if(null===e)l=!0;else switch(o){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case r:l=!0}}if(l)return a=a(l=e),e=""===s?"."+C(l,0):s,w(a)?(i="",null!=e&&(i=e.replace(E,"$&/")+"/"),T(a,t,i,"",function(e){return e})):null!=a&&(j(a)&&(a=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,i+(!a.key||l&&l.key===a.key?"":(""+a.key).replace(E,"$&/")+"/")+e)),t.push(a)),1;if(l=0,s=""===s?".":s+":",w(e))for(var c=0;c<e.length;c++){var u=s+C(o=e[c],c);l+=T(o,t,i,u,a)}else if(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"===typeof u)for(e=u.call(e),c=0;!(o=e.next()).done;)l+=T(o=o.value,t,i,u=s+C(o,c++),a);else if("object"===o)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function A(e,t,n){if(null==e)return e;var r=[],i=0;return T(e,r,"","",function(e){return t.call(n,e,i++)}),r}function I(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var P={current:null},L={transition:null},R={ReactCurrentDispatcher:P,ReactCurrentBatchConfig:L,ReactCurrentOwner:k};function O(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:A,forEach:function(e,t,n){A(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return A(e,function(){t++}),t},toArray:function(e){return A(e,function(e){return e})||[]},only:function(e){if(!j(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=i,t.Profiler=a,t.PureComponent=x,t.StrictMode=s,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=R,t.act=O,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=m({},e.props),s=e.key,a=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,o=k.current),void 0!==t.key&&(s=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)_.call(t,c)&&!N.hasOwnProperty(c)&&(i[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)i.children=r;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];i.children=l}return{$$typeof:n,type:e.type,key:s,ref:a,props:i,_owner:o}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=S,t.createFactory=function(e){var t=S.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=j,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:I}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=L.transition;L.transition={};try{e()}finally{L.transition=t}},t.unstable_act=O,t.useCallback=function(e,t){return P.current.useCallback(e,t)},t.useContext=function(e){return P.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return P.current.useDeferredValue(e)},t.useEffect=function(e,t){return P.current.useEffect(e,t)},t.useId=function(){return P.current.useId()},t.useImperativeHandle=function(e,t,n){return P.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return P.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return P.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return P.current.useMemo(e,t)},t.useReducer=function(e,t,n){return P.current.useReducer(e,t,n)},t.useRef=function(e){return P.current.useRef(e)},t.useState=function(e){return P.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return P.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return P.current.useTransition()},t.version="18.3.1"},4377:(e,t,n)=>{"use strict";n.d(t,{generateWalkingRoute:()=>l});var r=n(2555),i=n(4737);const s="eyJvcmciOiI1YjNjZTM1OTc4NTExMTAwMDFjZjYyNDgiLCJpZCI6ImEzN2RiYzM2MjdlZDRjMzVhNjE4MTI3ZTU2MTcwMjVjIiwiaCI6Im11cm11cjY0In0=",a="routequest_route_cache_",o=864e5;const l=async e=>{let{origin:t,lengthMeters:n,checkpointCount:r,seed:i,preferGreenAreas:s}=e;Math.random()<.1&&(()=>{try{const t=Date.now();let n=0;for(let r=0;r<localStorage.length;r++){const i=localStorage.key(r);if(i&&i.startsWith(a))try{const{timestamp:e}=JSON.parse(localStorage.getItem(i));t-e>o&&(localStorage.removeItem(i),n++)}catch(e){localStorage.removeItem(i),n++}}}catch(t){console.warn("[RouteService] Cache cleanup error:",t)}})();const l=((e,t,n,r,i)=>{const s=e.lat.toFixed(4),o=e.lng.toFixed(4);return"".concat(a).concat(s,"_").concat(o,"_").concat(t,"_").concat(n,"_").concat(r,"_").concat(i)})(t,n,r,i,s),d=(e=>{try{const t=localStorage.getItem(e);if(!t)return null;const{data:n,timestamp:r}=JSON.parse(t);return Date.now()-r>o?(localStorage.removeItem(e),null):n}catch(t){return console.warn("[RouteService] Cache read error:",t),null}})(l);if(d){return h(d,r)}try{const e=u({origin:t,lengthMeters:n,checkpointCount:r}),a=[...e,e[0]];0;const o=await c(a,n,i,s);((e,t)=>{try{const n={data:t,timestamp:Date.now()};localStorage.setItem(e,JSON.stringify(n))}catch(n){console.warn("[RouteService] Cache write error:",n)}})(l,o);return h(o,r)}catch(f){console.warn("[RouteService] Kunde inte h\xe4mta ruttdata fr\xe5n OpenRouteService:",f);return p({origin:t,lengthMeters:n,checkpointCount:r})}},c=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;const a=r?"foot-hiking":"foot-walking",o="".concat("https://api.openrouteservice.org/v2","/directions/").concat(a),l=e.map(e=>[e.lng,e.lat]),c={avoid_features:["ferries"],round_trip:{length:t,points:Math.min(4,Math.max(2,Math.floor(t/1e3))),seed:n||Math.floor(90*Math.random())}};r&&(c.profile_params={weightings:{green:1,quiet:1}},c.avoid_features.push("steps"));const u={coordinates:[l[0]],format:"json",instructions:!1,geometry:!0,options:c};const d=await fetch(o,{method:"POST",headers:{Authorization:s,"Content-Type":"application/json"},body:JSON.stringify(u)});if(!d.ok){const e=await d.text(),t="OpenRouteService API fel: ".concat(d.status," - ").concat(e);throw i.D.reportError("OpenRouteService",t),new Error(t)}const h=(await d.json()).routes[0];if(h.geometry){var p;const e=(e=>{const t=[];let n=0,r=0,i=0;for(;n<e.length;){let s,a=0,o=0;do{s=e.charCodeAt(n++)-63,o|=(31&s)<<a,a+=5}while(s>=32);r+=1&o?~(o>>1):o>>1,a=0,o=0;do{s=e.charCodeAt(n++)-63,o|=(31&s)<<a,a+=5}while(s>=32);i+=1&o?~(o>>1):o>>1,t.push({lat:r/1e5,lng:i/1e5})}return t})(h.geometry);return{coordinates:e,totalDistance:(null===(p=h.summary)||void 0===p?void 0:p.distance)||0,route:e}}throw new Error("Ingen geometri returnerad fr\xe5n API")},u=e=>{let{origin:t,lengthMeters:n,checkpointCount:r}=e;const i=n/(2*Math.PI*111e3),s=Math.min(.6*i,.005),a=Math.max(4,Math.min(8,Math.ceil(n/600)));const o=[];for(let l=0;l<a;l++){const e=l/a*Math.PI*2,n=s*(.8+.4*Math.random());o.push({lat:t.lat+Math.sin(e)*n,lng:t.lng+Math.cos(e)*n})}return o},d=e=>({lat:e.lat,lng:e.lng}),h=(e,t)=>{if(!e.coordinates||0===e.coordinates.length)throw new Error("Ingen giltig rutt att placera checkpoints p\xe5");const n=[],r=e.coordinates.length;for(let i=0;i<t;i++){const s=Math.floor(i/t*r),a=Math.min(s,r-1),o=e.coordinates[a],l=d(o);n.push({location:l,routeIndex:a,order:i+1,originalRouteLocation:o})}return{checkpoints:n,route:e.coordinates,totalDistance:e.totalDistance}},p=e=>{let{origin:t,lengthMeters:n,checkpointCount:i}=e;const s=[],a=[],o=Math.sqrt(n)/111e3,l=Math.min(o,.004);const c=[{lat:-l/2,lng:-l/2},{lat:-l/2,lng:l/2},{lat:l/2,lng:l/2},{lat:l/2,lng:-l/2},{lat:-l/2,lng:-l/2}],u=Math.max(15,Math.ceil(n/150));for(let r=0;r<c.length-1;r++){const e=c[r],n=c[r+1];for(let r=0;r<u;r++){const i=r/u,s=t.lat+e.lat+(n.lat-e.lat)*i,o=t.lng+e.lng+(n.lng-e.lng)*i,l=2e-4;a.push({lat:s+(Math.random()-.5)*l,lng:o+(Math.random()-.5)*l})}}a.length>0&&a.push((0,r.A)({},a[0]));for(let r=0;r<i;r++){const e=Math.floor(r/i*(a.length-1)),t=Math.min(e,a.length-1),n=a[t],o=d(n);s.push({location:o,routeIndex:t,order:r+1,originalRouteLocation:n})}return{checkpoints:s,route:a,totalDistance:n}}},4391:(e,t,n)=>{"use strict";var r=n(7950);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},4566:e=>{function t(){this.buffer=[],this.length=0}t.prototype={get:function(e){const t=Math.floor(e/8);return 1===(this.buffer[t]>>>7-e%8&1)},put:function(e,t){for(let n=0;n<t;n++)this.putBit(1===(e>>>t-n-1&1))},getLengthInBits:function(){return this.length},putBit:function(e){const t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}},e.exports=t},4661:e=>{function t(e){if(!e||e<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=e,this.data=new Uint8Array(e*e),this.reservedBit=new Uint8Array(e*e)}t.prototype.set=function(e,t,n,r){const i=e*this.size+t;this.data[i]=n,r&&(this.reservedBit[i]=!0)},t.prototype.get=function(e,t){return this.data[e*this.size+t]},t.prototype.xor=function(e,t,n){this.data[e*this.size+t]^=n},t.prototype.isReserved=function(e,t){return this.reservedBit[e*this.size+t]},e.exports=t},4737:(e,t,n)=>{"use strict";n.d(t,{D:()=>i});var r=n(2555);const i=new class{constructor(){this.statusCache={lastCheck:null,services:{}},this.cacheTimeout=3e5,this.recentErrors=this.loadRecentErrors()}loadRecentErrors(){try{const e=localStorage.getItem("serviceErrors");if(e){const t=JSON.parse(e),n=Date.now()-18e5;return t.filter(e=>e.timestamp>n)}}catch(e){console.error("Kunde inte ladda servicefel:",e)}return[]}reportError(e,t){const n={service:e,message:t,timestamp:Date.now()};this.recentErrors.push(n),this.recentErrors.length>10&&(this.recentErrors=this.recentErrors.slice(-10));try{localStorage.setItem("serviceErrors",JSON.stringify(this.recentErrors))}catch(n){console.error("Kunde inte spara servicefel:",n)}}async checkAllServices(){if(this.statusCache.lastCheck&&Date.now()-this.statusCache.lastCheck<this.cacheTimeout)return this.statusCache.services;const e={stripe:await this.checkStripe(),openrouteservice:await this.checkOpenRouteService(),anthropic:await this.checkAnthropic()};return this.statusCache={lastCheck:Date.now(),services:e},e}async checkStripe(){try{const e=new Promise((e,t)=>setTimeout(()=>t(new Error("Timeout")),5e3)),t=fetch("https://europe-west1-geoquest2-7e45c.cloudfunctions.net/getStripeStatus"),n=await Promise.race([t,e]),r=await n.json();return r.success&&r.payoutsEnabled?{status:"operational",message:"Stripe fungerar"}:r.success?{status:"degraded",message:"Stripe fungerar men utbetalningar \xe4r avst\xe4ngda"}:{status:"down",message:"Stripe har problem"}}catch(e){return{status:"down",message:"Kunde inte kontrollera Stripe",error:e.message}}}async checkOpenRouteService(){try{return"eyJvcmciOiI1YjNjZTM1OTc4NTExMTAwMDFjZjYyNDgiLCJpZCI6ImEzN2RiYzM2MjdlZDRjMzVhNjE4MTI3ZTU2MTcwMjVjIiwiaCI6Im11cm11cjY0In0="?{status:"operational",message:"OpenRouteService konfigurerad"}:{status:"error",message:"OpenRouteService API-nyckel saknas"}}catch(e){return{status:"error",message:"Kunde inte kontrollera OpenRouteService",error:e.message}}}async checkAnthropic(){try{const e=new Promise((e,t)=>setTimeout(()=>t(new Error("Timeout")),5e3)),t=fetch("https://europe-west1-geoquest2-7e45c.cloudfunctions.net/getAIStatus"),n=await Promise.race([t,e]),r=await n.json();if(r.available){const e=r.providers||{};if(Object.entries(e).some(e=>{let[t,n]=e;return n.configured&&!n.available})){const t=Object.entries(e).filter(e=>{let[t,n]=e;return n.configured&&!n.available}).map(e=>{let[t]=e;return t});return{status:"degraded",message:"AI fungerar (".concat(r.primaryProvider,") men ").concat(t.join(", ")," \xe4r nere")}}return{status:"operational",message:"AI-tj\xe4nster fungerar (".concat(r.primaryProvider,")")}}return{status:"down",message:r.message||"AI-tj\xe4nster \xe4r nere"}}catch(e){return{status:"down",message:"Kunde inte kontrollera AI-tj\xe4nster",error:e.message}}}async getProblematicServices(){const e=await this.checkAllServices(),t=[];Object.entries(e).forEach(e=>{let[n,i]=e;"down"!==i.status&&"degraded"!==i.status&&"error"!==i.status||t.push((0,r.A)({name:this.getServiceDisplayName(n)},i))});const n=Date.now()-6e5,i=this.loadRecentErrors().filter(e=>e.timestamp>n),s={};return i.forEach(e=>{s[e.service]||(s[e.service]=[]),s[e.service].push(e)}),Object.entries(s).forEach(e=>{let[n,r]=e;r.length>=2&&!t.find(e=>e.name.includes(n))&&t.push({name:this.getServiceDisplayName(n),status:"degraded",message:"".concat(r.length," fel senaste 10 minuterna")})}),t}getServiceDisplayName(e){return{firebase:"Firebase (databas)",stripe:"Stripe (betalningar)",openrouteservice:"OpenRouteService (kartor)",anthropic:"AI-tj\xe4nster (fr\xe5gegenerering)",OpenRouteService:"OpenRouteService (kartor)"}[e]||e}async forceCheck(){return this.statusCache.lastCheck=null,this.checkAllServices()}}},4772:(e,t,n)=>{const r=n(7969),i=n(6272),s=n(4566),a=n(4661),o=n(9382),l=n(9021),c=n(4833),u=n(1805),d=n(8177),h=n(4980),p=n(350),f=n(7421),m=n(4004);function g(e,t,n){const r=e.size,i=p.getEncodedBits(t,n);let s,a;for(s=0;s<15;s++)a=1===(i>>s&1),s<6?e.set(s,8,a,!0):s<8?e.set(s+1,8,a,!0):e.set(r-15+s,8,a,!0),s<8?e.set(8,r-s-1,a,!0):s<9?e.set(8,15-s-1+1,a,!0):e.set(8,15-s-1,a,!0);e.set(r-8,8,1,!0)}function v(e,t,n){const i=new s;n.forEach(function(t){i.put(t.mode.bit,4),i.put(t.getLength(),f.getCharCountIndicator(t.mode,e)),t.write(i)});const a=8*(r.getSymbolTotalCodewords(e)-u.getTotalCodewordsCount(e,t));for(i.getLengthInBits()+4<=a&&i.put(0,4);i.getLengthInBits()%8!==0;)i.putBit(0);const o=(a-i.getLengthInBits())/8;for(let r=0;r<o;r++)i.put(r%2?17:236,8);return function(e,t,n){const i=r.getSymbolTotalCodewords(t),s=u.getTotalCodewordsCount(t,n),a=i-s,o=u.getBlocksCount(t,n),l=i%o,c=o-l,h=Math.floor(i/o),p=Math.floor(a/o),f=p+1,m=h-p,g=new d(m);let v=0;const y=new Array(o),x=new Array(o);let b=0;const w=new Uint8Array(e.buffer);for(let r=0;r<o;r++){const e=r<c?p:f;y[r]=w.slice(v,v+e),x[r]=g.encode(y[r]),v+=e,b=Math.max(b,e)}const _=new Uint8Array(i);let k,N,S=0;for(k=0;k<b;k++)for(N=0;N<o;N++)k<y[N].length&&(_[S++]=y[N][k]);for(k=0;k<m;k++)for(N=0;N<o;N++)_[S++]=x[N][k];return _}(i,e,t)}function y(e,t,n,i){let s;if(Array.isArray(e))s=m.fromArray(e);else{if("string"!==typeof e)throw new Error("Invalid data");{let r=t;if(!r){const t=m.rawSplit(e);r=h.getBestVersionForData(t,n)}s=m.fromString(e,r||40)}}const u=h.getBestVersionForData(s,n);if(!u)throw new Error("The amount of data is too big to be stored in a QR Code");if(t){if(t<u)throw new Error("\nThe chosen QR Code version cannot contain this amount of data.\nMinimum version required to store current data is: "+u+".\n")}else t=u;const d=v(t,n,s),p=r.getSymbolSize(t),f=new a(p);return function(e,t){const n=e.size,r=l.getPositions(t);for(let i=0;i<r.length;i++){const t=r[i][0],s=r[i][1];for(let r=-1;r<=7;r++)if(!(t+r<=-1||n<=t+r))for(let i=-1;i<=7;i++)s+i<=-1||n<=s+i||(r>=0&&r<=6&&(0===i||6===i)||i>=0&&i<=6&&(0===r||6===r)||r>=2&&r<=4&&i>=2&&i<=4?e.set(t+r,s+i,!0,!0):e.set(t+r,s+i,!1,!0))}}(f,t),function(e){const t=e.size;for(let n=8;n<t-8;n++){const t=n%2===0;e.set(n,6,t,!0),e.set(6,n,t,!0)}}(f),function(e,t){const n=o.getPositions(t);for(let r=0;r<n.length;r++){const t=n[r][0],i=n[r][1];for(let n=-2;n<=2;n++)for(let r=-2;r<=2;r++)-2===n||2===n||-2===r||2===r||0===n&&0===r?e.set(t+n,i+r,!0,!0):e.set(t+n,i+r,!1,!0)}}(f,t),g(f,n,0),t>=7&&function(e,t){const n=e.size,r=h.getEncodedBits(t);let i,s,a;for(let o=0;o<18;o++)i=Math.floor(o/3),s=o%3+n-8-3,a=1===(r>>o&1),e.set(i,s,a,!0),e.set(s,i,a,!0)}(f,t),function(e,t){const n=e.size;let r=-1,i=n-1,s=7,a=0;for(let o=n-1;o>0;o-=2)for(6===o&&o--;;){for(let n=0;n<2;n++)if(!e.isReserved(i,o-n)){let r=!1;a<t.length&&(r=1===(t[a]>>>s&1)),e.set(i,o-n,r),s--,-1===s&&(a++,s=7)}if(i+=r,i<0||n<=i){i-=r,r=-r;break}}}(f,d),isNaN(i)&&(i=c.getBestMask(f,g.bind(null,f,n))),c.applyMask(i,f),g(f,n,i),{modules:f,version:t,errorCorrectionLevel:n,maskPattern:i,segments:s}}t.create=function(e,t){if("undefined"===typeof e||""===e)throw new Error("No input text");let n,s,a=i.M;return"undefined"!==typeof t&&(a=i.from(t.errorCorrectionLevel,i.M),n=h.from(t.version),s=c.from(t.maskPattern),t.toSJISFunc&&r.setToSJISFunction(t.toSJISFunc)),y(e,n,a,s)}},4833:(e,t)=>{t.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const n=3,r=3,i=40,s=10;function a(e,n,r){switch(e){case t.Patterns.PATTERN000:return(n+r)%2===0;case t.Patterns.PATTERN001:return n%2===0;case t.Patterns.PATTERN010:return r%3===0;case t.Patterns.PATTERN011:return(n+r)%3===0;case t.Patterns.PATTERN100:return(Math.floor(n/2)+Math.floor(r/3))%2===0;case t.Patterns.PATTERN101:return n*r%2+n*r%3===0;case t.Patterns.PATTERN110:return(n*r%2+n*r%3)%2===0;case t.Patterns.PATTERN111:return(n*r%3+(n+r)%2)%2===0;default:throw new Error("bad maskPattern:"+e)}}t.isValid=function(e){return null!=e&&""!==e&&!isNaN(e)&&e>=0&&e<=7},t.from=function(e){return t.isValid(e)?parseInt(e,10):void 0},t.getPenaltyN1=function(e){const t=e.size;let r=0,i=0,s=0,a=null,o=null;for(let l=0;l<t;l++){i=s=0,a=o=null;for(let c=0;c<t;c++){let t=e.get(l,c);t===a?i++:(i>=5&&(r+=n+(i-5)),a=t,i=1),t=e.get(c,l),t===o?s++:(s>=5&&(r+=n+(s-5)),o=t,s=1)}i>=5&&(r+=n+(i-5)),s>=5&&(r+=n+(s-5))}return r},t.getPenaltyN2=function(e){const t=e.size;let n=0;for(let r=0;r<t-1;r++)for(let i=0;i<t-1;i++){const t=e.get(r,i)+e.get(r,i+1)+e.get(r+1,i)+e.get(r+1,i+1);4!==t&&0!==t||n++}return n*r},t.getPenaltyN3=function(e){const t=e.size;let n=0,r=0,s=0;for(let i=0;i<t;i++){r=s=0;for(let a=0;a<t;a++)r=r<<1&2047|e.get(i,a),a>=10&&(1488===r||93===r)&&n++,s=s<<1&2047|e.get(a,i),a>=10&&(1488===s||93===s)&&n++}return n*i},t.getPenaltyN4=function(e){let t=0;const n=e.data.length;for(let r=0;r<n;r++)t+=e.data[r];return Math.abs(Math.ceil(100*t/n/5)-10)*s},t.applyMask=function(e,t){const n=t.size;for(let r=0;r<n;r++)for(let i=0;i<n;i++)t.isReserved(i,r)||t.xor(i,r,a(e,i,r))},t.getBestMask=function(e,n){const r=Object.keys(t.Patterns).length;let i=0,s=1/0;for(let a=0;a<r;a++){n(a),t.applyMask(a,e);const r=t.getPenaltyN1(e)+t.getPenaltyN2(e)+t.getPenaltyN3(e)+t.getPenaltyN4(e);t.applyMask(a,e),r<s&&(s=r,i=a)}return i}},4980:(e,t,n)=>{const r=n(7969),i=n(1805),s=n(6272),a=n(7421),o=n(3257),l=r.getBCHDigit(7973);function c(e,t){return a.getCharCountIndicator(e,t)+4}function u(e,t){let n=0;return e.forEach(function(e){const r=c(e.mode,t);n+=r+e.getBitsLength()}),n}t.from=function(e,t){return o.isValid(e)?parseInt(e,10):t},t.getCapacity=function(e,t,n){if(!o.isValid(e))throw new Error("Invalid QR Code version");"undefined"===typeof n&&(n=a.BYTE);const s=8*(r.getSymbolTotalCodewords(e)-i.getTotalCodewordsCount(e,t));if(n===a.MIXED)return s;const l=s-c(n,e);switch(n){case a.NUMERIC:return Math.floor(l/10*3);case a.ALPHANUMERIC:return Math.floor(l/11*2);case a.KANJI:return Math.floor(l/13);case a.BYTE:default:return Math.floor(l/8)}},t.getBestVersionForData=function(e,n){let r;const i=s.from(n,s.M);if(Array.isArray(e)){if(e.length>1)return function(e,n){for(let r=1;r<=40;r++)if(u(e,r)<=t.getCapacity(r,n,a.MIXED))return r}(e,i);if(0===e.length)return 1;r=e[0]}else r=e;return function(e,n,r){for(let i=1;i<=40;i++)if(n<=t.getCapacity(i,r,e))return i}(r.mode,r.getLength(),i)},t.getEncodedBits=function(e){if(!o.isValid(e)||e<7)throw new Error("Invalid QR Code version");let t=e<<12;for(;r.getBCHDigit(t)-l>=0;)t^=7973<<r.getBCHDigit(t)-l;return e<<12|t}},5043:(e,t,n)=>{"use strict";e.exports=n(4202)},5173:(e,t,n)=>{e.exports=n(1497)()},5200:(e,t,n)=>{const r=n(7421),i=n(7969);function s(e){this.mode=r.KANJI,this.data=e}s.getBitsLength=function(e){return 13*e},s.prototype.getLength=function(){return this.data.length},s.prototype.getBitsLength=function(){return s.getBitsLength(this.data.length)},s.prototype.write=function(e){let t;for(t=0;t<this.data.length;t++){let n=i.toSJIS(this.data[t]);if(n>=33088&&n<=40956)n-=33088;else{if(!(n>=57408&&n<=60351))throw new Error("Invalid SJIS character: "+this.data[t]+"\nMake sure your charset is UTF-8");n-=49472}n=192*(n>>>8&255)+(255&n),e.put(n,13)}},e.exports=s},5472:(e,t,n)=>{"use strict";n.d(t,{gS:()=>Yo,rJ:()=>Fa,deleteDoc:()=>Jo,H9:()=>za,Fs:()=>Za,x7:()=>Ho,getDocs:()=>Go,aU:()=>qa,AB:()=>Ro,aQ:()=>Xo,My:()=>Po,P:()=>Eo,O5:()=>rl,BN:()=>Zo,mZ:()=>Qo,_M:()=>To,wP:()=>il});var r,i,s=n(7150),a=n(8812),o=n(443),l=n(7700),c="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},u={};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(e,t,n){n||(n=0);var r=Array(16);if("string"===typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],a=t+(s^n&(i^s))+r[0]+3614090360&4294967295;a=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=n+(a<<7&4294967295|a>>>25))+((a=s+(i^t&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|a>>>20))+((a=i+(n^s&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^i&(s^t))+r[3]+3250441966&4294967295)<<22&4294967295|a>>>10))+((a=t+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|a>>>20))+((a=i+(n^s&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^i&(s^t))+r[7]+4249261313&4294967295)<<22&4294967295|a>>>10))+((a=t+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|a>>>20))+((a=i+(n^s&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^i&(s^t))+r[11]+2304563134&4294967295)<<22&4294967295|a>>>10))+((a=t+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|a>>>25))+((a=s+(i^t&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|a>>>20))+((a=i+(n^s&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|a>>>15))+((a=n+(t^i&(s^t))+r[15]+1236535329&4294967295)<<22&4294967295|a>>>10))+((a=t+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|a>>>27))+((a=s+(n^i&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^n&(s^t))+r[11]+643717713&4294967295)<<14&4294967295|a>>>18))+((a=n+(s^t&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|a>>>12))+((a=t+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|a>>>27))+((a=s+(n^i&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^n&(s^t))+r[15]+3634488961&4294967295)<<14&4294967295|a>>>18))+((a=n+(s^t&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|a>>>12))+((a=t+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|a>>>27))+((a=s+(n^i&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^n&(s^t))+r[3]+4107603335&4294967295)<<14&4294967295|a>>>18))+((a=n+(s^t&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|a>>>12))+((a=t+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|a>>>27))+((a=s+(n^i&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|a>>>23))+((a=i+(t^n&(s^t))+r[7]+1735328473&4294967295)<<14&4294967295|a>>>18))+((a=n+(s^t&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|a>>>12))+((a=t+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|a>>>16))+((a=n+(i^s^t)+r[14]+4259657740&4294967295)<<23&4294967295|a>>>9))+((a=t+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|a>>>16))+((a=n+(i^s^t)+r[10]+3200236656&4294967295)<<23&4294967295|a>>>9))+((a=t+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|a>>>16))+((a=n+(i^s^t)+r[6]+76029189&4294967295)<<23&4294967295|a>>>9))+((a=t+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|a>>>28))+((a=s+(t^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|a>>>21))+((a=i+(s^t^n)+r[15]+530742520&4294967295)<<16&4294967295|a>>>16))+((a=n+(i^s^t)+r[2]+3299628645&4294967295)<<23&4294967295|a>>>9))+((a=t+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|a>>>26))+((a=s+(n^(t|~i))+r[7]+1126891415&4294967295)<<10&4294967295|a>>>22))+((a=i+(t^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|a>>>17))+((a=n+(s^(i|~t))+r[5]+4237533241&4294967295)<<21&4294967295|a>>>11))+((a=t+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|a>>>26))+((a=s+(n^(t|~i))+r[3]+2399980690&4294967295)<<10&4294967295|a>>>22))+((a=i+(t^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|a>>>17))+((a=n+(s^(i|~t))+r[1]+2240044497&4294967295)<<21&4294967295|a>>>11))+((a=t+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|a>>>26))+((a=s+(n^(t|~i))+r[15]+4264355552&4294967295)<<10&4294967295|a>>>22))+((a=i+(t^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|a>>>17))+((a=n+(s^(i|~t))+r[13]+1309151649&4294967295)<<21&4294967295|a>>>11))+((s=(t=n+((a=t+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|a>>>26))+((a=s+(n^(t|~i))+r[11]+3174756917&4294967295)<<10&4294967295|a>>>22))^((i=s+((a=i+(t^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|a>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(a<<21&4294967295|a>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+s&4294967295}function s(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}(t,function(){this.blockSize=-1}),t.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var r=t-this.blockSize,i=this.B,s=this.h,a=0;a<t;){if(0==s)for(;a<=r;)n(this,e,a),a+=this.blockSize;if("string"===typeof e){for(;a<t;)if(i[s++]=e.charCodeAt(a++),s==this.blockSize){n(this,i),s=0;break}}else for(;a<t;)if(i[s++]=e[a++],s==this.blockSize){n(this,i),s=0;break}}this.h=s,this.o+=t},t.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var a={};function o(e){return-128<=e&&128>e?function(e,t){var n=a;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}(e,function(e){return new s([0|e],0>e?-1:0)}):new s([0|e],0>e?-1:0)}function l(e){if(isNaN(e)||!isFinite(e))return c;if(0>e)return m(l(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=4294967296;return new s(t,0)}var c=o(0),d=o(1),h=o(16777216);function p(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function f(e){return-1==e.h}function m(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new s(n,~e.h).add(d)}function g(e,t){return e.add(m(t))}function v(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function y(e,t){this.g=e,this.h=t}function x(e,t){if(p(t))throw Error("division by zero");if(p(e))return new y(c,c);if(f(e))return t=x(m(e),t),new y(m(t.g),m(t.h));if(f(t))return t=x(e,m(t)),new y(m(t.g),t.h);if(30<e.g.length){if(f(e)||f(t))throw Error("slowDivide_ only works with positive integers.");for(var n=d,r=t;0>=r.l(e);)n=b(n),r=b(r);var i=w(n,1),s=w(r,1);for(r=w(r,2),n=w(n,2);!p(r);){var a=s.add(r);0>=a.l(e)&&(i=i.add(n),s=a),r=w(r,1),n=w(n,1)}return t=g(e,i.j(t)),new y(i,t)}for(i=c;0<=e.l(t);){for(n=Math.max(1,Math.floor(e.m()/t.m())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),a=(s=l(n)).j(t);f(a)||0<a.l(e);)a=(s=l(n-=r)).j(t);p(s)&&(s=d),i=i.add(s),e=g(e,a)}return new y(i,e)}function b(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new s(n,e.h)}function w(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],a=0;a<r;a++)i[a]=0<t?e.i(a+n)>>>t|e.i(a+n+1)<<32-t:e.i(a+n);return new s(i,e.h)}(e=s.prototype).m=function(){if(f(this))return-m(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.i(n);e+=(0<=r?r:4294967296+r)*t,t*=4294967296}return e},e.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(p(this))return"0";if(f(this))return"-"+m(this).toString(e);for(var t=l(Math.pow(e,6)),n=this,r="";;){var i=x(n,t).g,s=((0<(n=g(n,i.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(p(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},e.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return f(e=g(this,e))?-1:p(e)?0:1},e.abs=function(){return f(this)?m(this):this},e.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var a=r+(65535&this.i(i))+(65535&e.i(i)),o=(a>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);r=o>>>16,a&=65535,o&=65535,n[i]=o<<16|a}return new s(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(p(this)||p(e))return c;if(f(this))return f(e)?m(this).j(m(e)):m(m(this).j(e));if(f(e))return m(this.j(m(e)));if(0>this.l(h)&&0>e.l(h))return l(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var a=this.i(r)>>>16,o=65535&this.i(r),u=e.i(i)>>>16,d=65535&e.i(i);n[2*r+2*i]+=o*d,v(n,2*r+2*i),n[2*r+2*i+1]+=a*d,v(n,2*r+2*i+1),n[2*r+2*i+1]+=o*u,v(n,2*r+2*i+1),n[2*r+2*i+2]+=a*u,v(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new s(n,0)},e.A=function(e){return x(this,e).h},e.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new s(n,this.h&e.h)},e.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new s(n,this.h|e.h)},e.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new s(n,this.h^e.h)},t.prototype.digest=t.prototype.v,t.prototype.reset=t.prototype.s,t.prototype.update=t.prototype.u,i=u.Md5=t,s.prototype.add=s.prototype.add,s.prototype.multiply=s.prototype.j,s.prototype.modulo=s.prototype.A,s.prototype.compare=s.prototype.l,s.prototype.toNumber=s.prototype.m,s.prototype.toString=s.prototype.toString,s.prototype.getBits=s.prototype.i,s.fromNumber=l,s.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return m(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=l(Math.pow(n,8)),i=c,s=0;s<t.length;s+=8){var a=Math.min(8,t.length-s),o=parseInt(t.substring(s,s+a),n);8>a?(a=l(Math.pow(n,a)),i=i.j(a).add(l(o))):i=(i=i.j(r)).add(l(o))}return i},r=u.Integer=s}).apply("undefined"!==typeof c?c:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});var d,h,p,f,m,g,v,y,x="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},b={};(function(){var e,t="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e};var n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof x&&x];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,r){if(r)e:{var i=n;e=e.split(".");for(var s=0;s<e.length-1;s++){var a=e[s];if(!(a in i))break e;i=i[a]}(r=r(s=i[e=e[e.length-1]]))!=s&&null!=r&&t(i,e,{configurable:!0,writable:!0,value:r})}}("Array.prototype.values",function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,function(e,t){return t})}});var r=r||{},i=this||self;function s(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function a(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function o(e,t,n){return e.call.apply(e.bind,arguments)}function l(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function c(e,t,n){return(c=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?o:l).apply(null,arguments)}function u(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function _(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function k(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function S(e,t){for(let n=1;n<arguments.length;n++){const t=arguments[n];if(s(t)){const n=e.length||0,r=t.length||0;e.length=n+r;for(let i=0;i<r;i++)e[n+i]=t[i]}else e.push(t)}}function j(e){return/^[\s\xa0]*$/.test(e)}function E(){var e=i.navigator;return e&&(e=e.userAgent)?e:""}function C(e){return C[" "](e),e}C[" "]=function(){};var T=-1!=E().indexOf("Gecko")&&!(-1!=E().toLowerCase().indexOf("webkit")&&-1==E().indexOf("Edge"))&&!(-1!=E().indexOf("Trident")||-1!=E().indexOf("MSIE"))&&-1==E().indexOf("Edge");function A(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function I(e){const t={};for(const n in e)t[n]=e[n];return t}const P="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function L(e,t){let n,r;for(let i=1;i<arguments.length;i++){for(n in r=arguments[i],r)e[n]=r[n];for(let t=0;t<P.length;t++)n=P[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function R(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function O(e){i.setTimeout(()=>{throw e},0)}function M(){var e=B;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var D=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new F,e=>e.reset());class F{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let z,U=!1,B=new class{constructor(){this.h=this.g=null}add(e,t){const n=D.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},V=()=>{const e=i.Promise.resolve(void 0);z=()=>{e.then(q)}};var q=()=>{for(var e;e=M();){try{e.h.call(e.g)}catch(n){O(n)}var t=D;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}U=!1};function K(){this.s=this.s,this.C=this.C}function H(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}K.prototype.s=!1,K.prototype.ma=function(){this.s||(this.s=!0,this.N())},K.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},H.prototype.h=function(){this.defaultPrevented=!0};var W=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};i.addEventListener("test",e,t),i.removeEventListener("test",e,t)}catch(n){}return e}();function G(e,t){if(H.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(T){e:{try{C(t.nodeName);var i=!0;break e}catch(s){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"===typeof e.pointerType?e.pointerType:Z[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&G.aa.h.call(this)}}_(G,H);var Z={2:"touch",3:"pen",4:"mouse"};G.prototype.h=function(){G.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var Q="closure_listenable_"+(1e6*Math.random()|0),J=0;function Y(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++J,this.da=this.fa=!1}function X(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function $(e){this.src=e,this.g={},this.h=0}function ee(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=Array.prototype.indexOf.call(i,t,void 0);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(X(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function te(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.da&&s.listener==t&&s.capture==!!n&&s.ha==r)return i}return-1}$.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var a=te(e,t,r,i);return-1<a?(t=e[a],n||(t.fa=!1)):((t=new Y(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var ne="closure_lm_"+(1e6*Math.random()|0),re={};function ie(e,t,n,r,i){if(r&&r.once)return ae(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)ie(e,t[s],n,r,i);return null}return n=pe(n),e&&e[Q]?e.K(t,n,a(r)?!!r.capture:!!r,i):se(e,t,n,!1,r,i)}function se(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=a(i)?!!i.capture:!!i,l=de(e);if(l||(e[ne]=l=new $(e)),(n=l.add(t,n,r,o,s)).proxy)return n;if(r=function(){function e(n){return t.call(e.src,e.listener,n)}const t=ue;return e}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)W||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(ce(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function ae(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)ae(e,t[s],n,r,i);return null}return n=pe(n),e&&e[Q]?e.L(t,n,a(r)?!!r.capture:!!r,i):se(e,t,n,!0,r,i)}function oe(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)oe(e,t[s],n,r,i);else r=a(r)?!!r.capture:!!r,n=pe(n),e&&e[Q]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(n=te(s=e.g[t],n,r,i))&&(X(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--)))):e&&(e=de(e))&&(t=e.g[t.toString()],e=-1,t&&(e=te(t,n,r,i)),(n=-1<e?t[e]:null)&&le(n))}function le(e){if("number"!==typeof e&&e&&!e.da){var t=e.src;if(t&&t[Q])ee(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(ce(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=de(t))?(ee(n,e),0==n.h&&(n.src=null,t[ne]=null)):X(e)}}}function ce(e){return e in re?re[e]:re[e]="on"+e}function ue(e,t){if(e.da)e=!0;else{t=new G(t,this);var n=e.listener,r=e.ha||e.src;e.fa&&le(e),e=n.call(r,t)}return e}function de(e){return(e=e[ne])instanceof $?e:null}var he="__closure_events_fn_"+(1e9*Math.random()>>>0);function pe(e){return"function"===typeof e?e:(e[he]||(e[he]=function(t){return e.handleEvent(t)}),e[he])}function fe(){K.call(this),this.i=new $(this),this.M=this,this.F=null}function me(e,t){var n,r=e.F;if(r)for(n=[];r;r=r.F)n.push(r);if(e=e.M,r=t.type||t,"string"===typeof t)t=new H(t,e);else if(t instanceof H)t.target=t.target||e;else{var i=t;L(t=new H(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var a=t.g=n[s];i=ge(a,r,!0,t)&&i}if(i=ge(a=t.g=e,r,!0,t)&&i,i=ge(a,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=ge(a=t.g=n[s],r,!1,t)&&i}function ge(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var a=t[s];if(a&&!a.da&&a.capture==n){var o=a.listener,l=a.ha||a.src;a.fa&&ee(e.i,a),i=!1!==o.call(l,r)&&i}}return i&&!r.defaultPrevented}function ve(e,t,n){if("function"===typeof e)n&&(e=c(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=c(e.handleEvent,e)}return 2147483647<Number(t)?-1:i.setTimeout(e,t||0)}function ye(e){e.g=ve(()=>{e.g=null,e.i&&(e.i=!1,ye(e))},e.l);const t=e.h;e.h=null,e.m.apply(null,t)}_(fe,K),fe.prototype[Q]=!0,fe.prototype.removeEventListener=function(e,t,n,r){oe(this,e,t,n,r)},fe.prototype.N=function(){if(fe.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)X(n[r]);delete t.g[e],t.h--}}this.F=null},fe.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},fe.prototype.L=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class xe extends K{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:ye(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function be(e){K.call(this),this.h=e,this.g={}}_(be,K);var we=[];function _e(e){A(e.g,function(e,t){this.g.hasOwnProperty(t)&&le(e)},e),e.g={}}be.prototype.N=function(){be.aa.N.call(this),_e(this)},be.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ke=i.JSON.stringify,Ne=i.JSON.parse,Se=class{stringify(e){return i.JSON.stringify(e,void 0)}parse(e){return i.JSON.parse(e,void 0)}};function je(){}function Ee(e){return e.h||(e.h=e.i())}function Ce(){}je.prototype.h=null;var Te={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ae(){H.call(this,"d")}function Ie(){H.call(this,"c")}_(Ae,H),_(Ie,H);var Pe={},Le=null;function Re(){return Le=Le||new fe}function Oe(e){H.call(this,Pe.La,e)}function Me(e){const t=Re();me(t,new Oe(t))}function De(e,t){H.call(this,Pe.STAT_EVENT,e),this.stat=t}function Fe(e){const t=Re();me(t,new De(t,e))}function ze(e,t){H.call(this,Pe.Ma,e),this.size=t}function Ue(e,t){if("function"!==typeof e)throw Error("Fn must not be null and must be a function");return i.setTimeout(function(){e()},t)}function Be(){this.g=!0}function Ve(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<i.length;a++)i[a]=""}}}return ke(n)}catch(o){return t}}(e,n)+(r?" "+r:"")})}Pe.La="serverreachability",_(Oe,H),Pe.STAT_EVENT="statevent",_(De,H),Pe.Ma="timingevent",_(ze,H),Be.prototype.xa=function(){this.g=!1},Be.prototype.info=function(){};var qe,Ke={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},He={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function We(){}function Ge(e,t,n,r){this.j=e,this.i=t,this.l=n,this.R=r||1,this.U=new be(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ze}function Ze(){this.i=null,this.g="",this.h=!1}_(We,je),We.prototype.g=function(){return new XMLHttpRequest},We.prototype.i=function(){return{}},qe=new We;var Qe={},Je={};function Ye(e,t,n){e.L=1,e.v=kt(yt(t)),e.m=n,e.P=!0,Xe(e,null)}function Xe(e,t){e.F=Date.now(),tt(e),e.A=yt(e.v);var n=e.A,r=e.R;Array.isArray(r)||(r=[String(r)]),Dt(n.i,"t",r),e.C=0,n=e.j.J,e.h=new Ze,e.g=Sn(e.j,n?t:null,!e.m),0<e.O&&(e.M=new xe(c(e.Y,e,e.g),e.O)),t=e.U,n=e.g,r=e.ca;var i="readystatechange";Array.isArray(i)||(i&&(we[0]=i.toString()),i=we);for(var s=0;s<i.length;s++){var a=ie(n,i[s],r||t.handleEvent,!1,t.h||t);if(!a)break;t.g[a.key]=a}t=e.H?I(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Me(),function(e,t,n,r,i,s){e.info(function(){if(e.g)if(s)for(var a="",o=s.split("&"),l=0;l<o.length;l++){var c=o[l].split("=");if(1<c.length){var u=c[0];c=c[1];var d=u.split("_");a=2<=d.length&&"type"==d[1]?a+(u+"=")+c+"&":a+(u+"=redacted&")}}else a=null;else a=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+a})}(e.i,e.u,e.A,e.l,e.R,e.m)}function $e(e){return!!e.g&&("GET"==e.u&&2!=e.L&&e.j.Ca)}function et(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?Je:(n=Number(t.substring(n,r)),isNaN(n)?Qe:(r+=1)+n>t.length?Je:(t=t.slice(r,r+n),e.C=r+n,t))}function tt(e){e.S=Date.now()+e.I,nt(e,e.I)}function nt(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Ue(c(e.ba,e),t)}function rt(e){e.B&&(i.clearTimeout(e.B),e.B=null)}function it(e){0==e.j.G||e.J||bn(e.j,e)}function st(e){rt(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,_e(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function at(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||dt(n.h,e)))if(!e.K&&dt(n.h,e)&&3==n.G){try{var r=n.Da.g.parse(t)}catch(u){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;xn(n),cn(n)}gn(n),Fe(18)}}else n.za=i[1],0<n.za-n.T&&37500>i[2]&&n.F&&0==n.v&&!n.C&&(n.C=Ue(c(n.Za,n),6e3));if(1>=ut(n.h)&&n.ca){try{n.ca()}catch(u){}n.ca=void 0}}else _n(n,11)}else if((e.K||n.g==e)&&xn(n),!j(t))for(i=n.Da.g.parse(t),t=0;t<i.length;t++){let c=i[t];if(n.T=c[0],c=c[1],2==n.G)if("c"==c[0]){n.K=c[1],n.ia=c[2];const t=c[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));const i=c[4];null!=i&&(n.Aa=i,n.j.info("SVER="+n.Aa));const u=c[5];null!=u&&"number"===typeof u&&0<u&&(r=1.5*u,n.L=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const d=e.g;if(d){const e=d.g?d.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(ht(s,s.h),s.h=null))}if(r.D){const e=d.g?d.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.ya=e,_t(r.I,r.D,e))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms"));var a=e;if((r=n).qa=Nn(r,r.J?r.ia:null,r.W),a.K){pt(r.h,a);var o=a,l=r.L;l&&(o.I=l),o.B&&(rt(o),tt(o)),r.g=a}else mn(r);0<n.i.length&&dn(n)}else"stop"!=c[0]&&"close"!=c[0]||_n(n,7);else 3==n.G&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?_n(n,7):ln(n):"noop"!=c[0]&&n.l&&n.l.ta(c),n.v=0)}Me()}catch(u){}}Ge.prototype.ca=function(e){e=e.target;const t=this.M;t&&3==rn(e)?t.j():this.Y(e)},Ge.prototype.Y=function(e){try{if(e==this.g)e:{const h=rn(this.g);var t=this.g.Ba();this.g.Z();if(!(3>h)&&(3!=h||this.g&&(this.h.h||this.g.oa()||sn(this.g)))){this.J||4!=h||7==t||Me(),rt(this);var n=this.g.Z();this.X=n;t:if($e(this)){var r=sn(this.g);e="";var s=r.length,a=4==rn(this.g);if(!this.h.i){if("undefined"===typeof TextDecoder){st(this),it(this);var o="";break t}this.h.i=new i.TextDecoder}for(t=0;t<s;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:!(a&&t==s-1)});r.length=0,this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.oa();if(this.o=200==n,function(e,t,n,r,i,s,a){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+a})}(this.i,this.u,this.A,this.l,this.R,h,n),this.o){if(this.T&&!this.K){t:{if(this.g){var l,c=this.g;if((l=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!j(l)){var u=l;break t}}u=null}if(!(n=u)){this.o=!1,this.s=3,Fe(12),st(this),it(this);break e}Ve(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,at(this,n)}if(this.P){let e;for(n=!0;!this.J&&this.C<o.length;){if(e=et(this,o),e==Je){4==h&&(this.s=4,Fe(14),n=!1),Ve(this.i,this.l,null,"[Incomplete Response]");break}if(e==Qe){this.s=4,Fe(15),Ve(this.i,this.l,o,"[Invalid Chunk]"),n=!1;break}Ve(this.i,this.l,e,null),at(this,e)}if($e(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=h||0!=o.length||this.h.h||(this.s=1,Fe(16),n=!1),this.o=this.o&&n,n){if(0<o.length&&!this.W){this.W=!0;var d=this.j;d.g==this&&d.ba&&!d.M&&(d.j.info("Great, no buffering proxy detected. Bytes received: "+o.length),vn(d),d.M=!0,Fe(11))}}else Ve(this.i,this.l,o,"[Invalid Chunked Response]"),st(this),it(this)}else Ve(this.i,this.l,o,null),at(this,o);4==h&&st(this),this.o&&!this.J&&(4==h?bn(this.j,this):(this.o=!1,tt(this)))}else(function(e){const t={};e=(e.g&&2<=rn(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(j(e[r]))continue;var n=R(e[r]);const i=n[0];if("string"!==typeof(n=n[1]))continue;n=n.trim();const s=t[i]||[];t[i]=s,s.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,function(e){return e.join(", ")})})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.s=3,Fe(12)):(this.s=0,Fe(13)),st(this),it(this)}}}catch(w){}},Ge.prototype.cancel=function(){this.J=!0,st(this)},Ge.prototype.ba=function(){this.B=null;const e=Date.now();0<=e-this.S?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.i,this.A),2!=this.L&&(Me(),Fe(17)),st(this),this.s=2,it(this)):nt(this,this.S-e)};var ot=class{constructor(e,t){this.g=e,this.map=t}};function lt(e){this.l=e||10,i.PerformanceNavigationTiming?e=0<(e=i.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ct(e){return!!e.h||!!e.g&&e.g.size>=e.j}function ut(e){return e.h?1:e.g?e.g.size:0}function dt(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function ht(e,t){e.g?e.g.add(t):e.h=t}function pt(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function ft(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return k(e.i)}function mt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(s(e)||"string"===typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!==typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!==typeof Set&&e instanceof Set)){if(s(e)||"string"===typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!==typeof Map&&e instanceof Map||"undefined"!==typeof Set&&e instanceof Set)return Array.from(e.values());if("string"===typeof e)return e.split("");if(s(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,a=0;a<i;a++)t.call(void 0,r[a],n&&n[a],e)}lt.prototype.cancel=function(){if(this.i=ft(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var gt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function vt(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof vt){this.h=e.h,xt(this,e.j),this.o=e.o,this.g=e.g,bt(this,e.s),this.l=e.l;var t=e.i,n=new Lt;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),wt(this,n),this.m=e.m}else e&&(t=String(e).match(gt))?(this.h=!1,xt(this,t[1]||"",!0),this.o=Nt(t[2]||""),this.g=Nt(t[3]||"",!0),bt(this,t[4]),this.l=Nt(t[5]||"",!0),wt(this,t[6]||"",!0),this.m=Nt(t[7]||"")):(this.h=!1,this.i=new Lt(null,this.h))}function yt(e){return new vt(e)}function xt(e,t,n){e.j=n?Nt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function bt(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function wt(e,t,n){t instanceof Lt?(e.i=t,function(e,t){t&&!e.j&&(Rt(e),e.i=null,e.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(Ot(this,t),Dt(this,n,e))},e)),e.j=t}(e.i,e.h)):(n||(t=St(t,It)),e.i=new Lt(t,e.h))}function _t(e,t,n){e.i.set(t,n)}function kt(e){return _t(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Nt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function St(e,t,n){return"string"===typeof e?(e=encodeURI(e).replace(t,jt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function jt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}vt.prototype.toString=function(){var e=[],t=this.j;t&&e.push(St(t,Ct,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(St(t,Ct,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(St(n,"/"==n.charAt(0)?At:Tt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",St(n,Pt)),e.join("")};var Et,Ct=/[#\/\?@]/g,Tt=/[#\?:]/g,At=/[#\?]/g,It=/[#\?@]/g,Pt=/#/g;function Lt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Rt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function Ot(e,t){Rt(e),t=Ft(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Mt(e,t){return Rt(e),t=Ft(e,t),e.g.has(t)}function Dt(e,t,n){Ot(e,t),0<n.length&&(e.i=null,e.g.set(Ft(e,t),k(n)),e.h+=n.length)}function Ft(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function zt(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(s){}}function Ut(){this.g=new Se}function Bt(e,t,n){const r=n||"";try{mt(e,function(e,n){let i=e;a(e)&&(i=ke(e)),t.push(r+n+"="+encodeURIComponent(i))})}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function Vt(e){this.l=e.Ub||null,this.j=e.eb||!1}function qt(e,t){fe.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function Kt(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function Ht(e){e.readyState=4,e.l=null,e.j=null,e.v=null,Wt(e)}function Wt(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Gt(e){let t="";return A(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function Zt(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Gt(n),"string"===typeof e?null!=n&&encodeURIComponent(String(n)):_t(e,t,n))}function Qt(e){fe.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(e=Lt.prototype).add=function(e,t){Rt(this),this.i=null,e=Ft(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){Rt(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},e.na=function(){Rt(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},e.V=function(e){Rt(this);let t=[];if("string"===typeof e)Mt(this,e)&&(t=t.concat(this.g.get(Ft(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},e.set=function(e,t){return Rt(this),this.i=null,Mt(this,e=Ft(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const s=encodeURIComponent(String(r)),a=this.V(r);for(r=0;r<a.length;r++){var i=s;""!==a[r]&&(i+="="+encodeURIComponent(String(a[r]))),e.push(i)}}return this.i=e.join("&")},_(Vt,je),Vt.prototype.g=function(){return new qt(this.l,this.j)},Vt.prototype.i=(Et={},function(){return Et}),_(qt,fe),(e=qt.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,Wt(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||i).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Ht(this)),this.readyState=0},e.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Wt(this)),this.g&&(this.readyState=3,Wt(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if("undefined"!==typeof i.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Kt(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},e.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Ht(this):Wt(this),3==this.readyState&&Kt(this)}},e.Ra=function(e){this.g&&(this.response=this.responseText=e,Ht(this))},e.Qa=function(e){this.g&&(this.response=e,Ht(this))},e.ga=function(){this.g&&Ht(this)},e.setRequestHeader=function(e,t){this.u.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(qt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),_(Qt,fe);var Jt=/^https?$/i,Yt=["POST","PUT"];function Xt(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,$t(e),tn(e)}function $t(e){e.A||(e.A=!0,me(e,"complete"),me(e,"error"))}function en(e){if(e.h&&"undefined"!=typeof r&&(!e.v[1]||4!=rn(e)||2!=e.Z()))if(e.u&&4==rn(e))ve(e.Ea,0,e);else if(me(e,"readystatechange"),4==rn(e)){e.h=!1;try{const r=e.Z();e:switch(r){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var s;if(s=0===r){var a=String(e.D).match(gt)[1]||null;!a&&i.self&&i.self.location&&(a=i.self.location.protocol.slice(0,-1)),s=!Jt.test(a?a.toLowerCase():"")}n=s}if(n)me(e,"complete"),me(e,"success");else{e.m=6;try{var o=2<rn(e)?e.g.statusText:""}catch(l){o=""}e.l=o+" ["+e.Z()+"]",$t(e)}}finally{tn(e)}}}function tn(e,t){if(e.g){nn(e);const r=e.g,i=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||me(e,"ready");try{r.onreadystatechange=i}catch(n){}}}function nn(e){e.I&&(i.clearTimeout(e.I),e.I=null)}function rn(e){return e.g?e.g.readyState:0}function sn(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(N){return null}}function an(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function on(e){this.Aa=0,this.i=[],this.j=new Be,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=an("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=an("baseRetryDelayMs",5e3,e),this.cb=an("retryDelaySeedMs",1e4,e),this.Wa=an("forwardChannelMaxRetries",2,e),this.wa=an("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new lt(e&&e.concurrentRequestLimit),this.Da=new Ut,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function ln(e){if(un(e),3==e.G){var t=e.U++,n=yt(e.I);if(_t(n,"SID",e.K),_t(n,"RID",t),_t(n,"TYPE","terminate"),pn(e,n),(t=new Ge(e,e.j,t)).L=2,t.v=kt(yt(n)),n=!1,i.navigator&&i.navigator.sendBeacon)try{n=i.navigator.sendBeacon(t.v.toString(),"")}catch(r){}!n&&i.Image&&((new Image).src=t.v,n=!0),n||(t.g=Sn(t.j,null),t.g.ea(t.v)),t.F=Date.now(),tt(t)}kn(e)}function cn(e){e.g&&(vn(e),e.g.cancel(),e.g=null)}function un(e){cn(e),e.u&&(i.clearTimeout(e.u),e.u=null),xn(e),e.h.cancel(),e.s&&("number"===typeof e.s&&i.clearTimeout(e.s),e.s=null)}function dn(e){if(!ct(e.h)&&!e.s){e.s=!0;var t=e.Ga;z||V(),U||(z(),U=!0),B.add(t,e),e.B=0}}function hn(e,t){var n;n=t?t.l:e.U++;const r=yt(e.I);_t(r,"SID",e.K),_t(r,"RID",n),_t(r,"AID",e.T),pn(e,r),e.m&&e.o&&Zt(r,e.m,e.o),n=new Ge(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=fn(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),ht(e.h,n),Ye(n,r,t)}function pn(e,t){e.H&&A(e.H,function(e,n){_t(t,n,e)}),e.l&&mt({},function(e,n){_t(t,n,e)})}function fn(e,t,n){n=Math.min(e.i.length,n);var r=e.l?c(e.l.Na,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let a=0;a<n;a++){let n=i[a].g;const o=i[a].map;if(n-=t,0>n)t=Math.max(0,i[a].g-100),s=!1;else try{Bt(o,e,"req"+n+"_")}catch(w){r&&r(o)}}if(s){r=e.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,r}function mn(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;z||V(),U||(z(),U=!0),B.add(t,e),e.v=0}}function gn(e){return!(e.g||e.u||3<=e.v)&&(e.Y++,e.u=Ue(c(e.Fa,e),wn(e,e.v)),e.v++,!0)}function vn(e){null!=e.A&&(i.clearTimeout(e.A),e.A=null)}function yn(e){e.g=new Ge(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=yt(e.qa);_t(t,"RID","rpc"),_t(t,"SID",e.K),_t(t,"AID",e.T),_t(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&_t(t,"TO",e.ja),_t(t,"TYPE","xmlhttp"),pn(e,t),e.m&&e.o&&Zt(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=kt(yt(t)),n.m=null,n.P=!0,Xe(n,e)}function xn(e){null!=e.C&&(i.clearTimeout(e.C),e.C=null)}function bn(e,t){var n=null;if(e.g==t){xn(e),vn(e),e.g=null;var r=2}else{if(!dt(e.h,t))return;n=t.D,pt(e.h,t),r=1}if(0!=e.G)if(t.o)if(1==r){n=t.m?t.m.length:0,t=Date.now()-t.F;var i=e.B;me(r=Re(),new ze(r,n)),dn(e)}else mn(e);else if(3==(i=t.s)||0==i&&0<t.X||!(1==r&&function(e,t){return!(ut(e.h)>=e.h.j-(e.s?1:0))&&(e.s?(e.i=t.D.concat(e.i),!0):!(1==e.G||2==e.G||e.B>=(e.Va?0:e.Wa))&&(e.s=Ue(c(e.Ga,e,t),wn(e,e.B)),e.B++,!0))}(e,t)||2==r&&gn(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),i){case 1:_n(e,5);break;case 4:_n(e,10);break;case 3:_n(e,6);break;default:_n(e,2)}}function wn(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function _n(e,t){if(e.j.info("Error code "+t),2==t){var n=c(e.fb,e),r=e.Xa;const t=!r;r=new vt(r||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||xt(r,"https"),kt(r),t?function(e,t){const n=new Be;if(i.Image){const r=new Image;r.onload=u(zt,n,"TestLoadImage: loaded",!0,t,r),r.onerror=u(zt,n,"TestLoadImage: error",!1,t,r),r.onabort=u(zt,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=u(zt,n,"TestLoadImage: timeout",!1,t,r),i.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(r.toString(),n):function(e,t){new Be;const n=new AbortController,r=setTimeout(()=>{n.abort(),zt(0,0,!1,t)},1e4);fetch(e,{signal:n.signal}).then(e=>{clearTimeout(r),e.ok?zt(0,0,!0,t):zt(0,0,!1,t)}).catch(()=>{clearTimeout(r),zt(0,0,!1,t)})}(r.toString(),n)}else Fe(2);e.G=0,e.l&&e.l.sa(t),kn(e),un(e)}function kn(e){if(e.G=0,e.ka=[],e.l){const t=ft(e.h);0==t.length&&0==e.i.length||(S(e.ka,t),S(e.ka,e.i),e.h.i.length=0,k(e.i),e.i.length=0),e.l.ra()}}function Nn(e,t,n){var r=n instanceof vt?yt(n):new vt(n);if(""!=r.g)t&&(r.g=t+"."+r.g),bt(r,r.s);else{var s=i.location;r=s.protocol,t=t?t+"."+s.hostname:s.hostname,s=+s.port;var a=new vt(null);r&&xt(a,r),t&&(a.g=t),s&&bt(a,s),n&&(a.l=n),r=a}return n=e.D,t=e.ya,n&&t&&_t(r,n,t),_t(r,"VER",e.la),pn(e,r),r}function Sn(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new Qt(new Vt({eb:n})):new Qt(e.pa)).Ha(e.J),t}function jn(){}function En(){}function Cn(e,t){fe.call(this),this.g=new on(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!j(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!j(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new In(this)}function Tn(e){Ae.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function An(){Ie.call(this),this.status=1}function In(e){this.g=e}(e=Qt.prototype).Ha=function(e){this.J=e},e.ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():qe.g(),this.v=this.o?Ee(this.o):Ee(qe),this.g.onreadystatechange=c(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(a){return void Xt(this,a)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else{if("function"!==typeof r.keys||"function"!==typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find(e=>"content-type"==e.toLowerCase()),s=i.FormData&&e instanceof i.FormData,!(0<=Array.prototype.indexOf.call(Yt,t,void 0))||r||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[i,o]of n)this.g.setRequestHeader(i,o);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{nn(this),this.u=!0,this.g.send(e),this.u=!1}catch(a){Xt(this,a)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,me(this,"complete"),me(this,"abort"),tn(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tn(this,!0)),Qt.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?en(this):this.bb())},e.bb=function(){en(this)},e.isActive=function(){return!!this.g},e.Z=function(){try{return 2<rn(this)?this.g.status:-1}catch(Et){return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch(Et){return""}},e.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Ne(t)}},e.Ba=function(){return this.m},e.Ka=function(){return"string"===typeof this.l?this.l:String(this.l)},(e=on.prototype).la=8,e.G=1,e.connect=function(e,t,n,r){Fe(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=Nn(this,null,this.W),dn(this)},e.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const i=new Ge(this,this.j,e);let s=this.o;if(this.S&&(s?(s=I(s),L(s,this.S)):s=this.S),null!==this.m||this.O||(i.H=s,s=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"===typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=fn(this,i,t),_t(n=yt(this.I),"RID",e),_t(n,"CVER",22),this.D&&_t(n,"X-HTTP-Session-Id",this.D),pn(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(Gt(s)))+"&"+t:this.m&&Zt(n,this.m,s)),ht(this.h,i),this.Ua&&_t(n,"TYPE","init"),this.P?(_t(n,"$req",t),_t(n,"SID","null"),i.T=!0,Ye(i,n,null)):Ye(i,n,t),this.G=2}}else 3==this.G&&(e?hn(this,e):0==this.i.length||ct(this.h)||hn(this))},e.Fa=function(){if(this.u=null,yn(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=Ue(c(this.ab,this),e)}},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Fe(10),cn(this),yn(this))},e.Za=function(){null!=this.C&&(this.C=null,cn(this),gn(this),Fe(19))},e.fb=function(e){e?(this.j.info("Successfully pinged google.com"),Fe(2)):(this.j.info("Failed to ping google.com"),Fe(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=jn.prototype).ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){},En.prototype.g=function(e,t){return new Cn(e,t)},_(Cn,fe),Cn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Cn.prototype.close=function(){ln(this.g)},Cn.prototype.o=function(e){var t=this.g;if("string"===typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=ke(e),e=n);t.i.push(new ot(t.Ya++,e)),3==t.G&&dn(t)},Cn.prototype.N=function(){this.g.l=null,delete this.j,ln(this.g),delete this.g,Cn.aa.N.call(this)},_(Tn,Ae),_(An,Ie),_(In,jn),In.prototype.ua=function(){me(this.g,"a")},In.prototype.ta=function(e){me(this.g,new Tn(e))},In.prototype.sa=function(e){me(this.g,new An)},In.prototype.ra=function(){me(this.g,"b")},En.prototype.createWebChannel=En.prototype.g,Cn.prototype.send=Cn.prototype.o,Cn.prototype.open=Cn.prototype.m,Cn.prototype.close=Cn.prototype.close,y=b.createWebChannelTransport=function(){return new En},v=b.getStatEventTarget=function(){return Re()},g=b.Event=Pe,m=b.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ke.NO_ERROR=0,Ke.TIMEOUT=8,Ke.HTTP_ERROR=6,f=b.ErrorCode=Ke,He.COMPLETE="complete",p=b.EventType=He,Ce.EventType=Te,Te.OPEN="a",Te.CLOSE="b",Te.ERROR="c",Te.MESSAGE="d",fe.prototype.listen=fe.prototype.K,h=b.WebChannel=Ce,b.FetchXmlHttpFactory=Vt,Qt.prototype.listenOnce=Qt.prototype.L,Qt.prototype.getLastError=Qt.prototype.Ka,Qt.prototype.getLastErrorCode=Qt.prototype.Ba,Qt.prototype.getStatus=Qt.prototype.Z,Qt.prototype.getResponseJson=Qt.prototype.Oa,Qt.prototype.getResponseText=Qt.prototype.oa,Qt.prototype.send=Qt.prototype.ea,Qt.prototype.setWithCredentials=Qt.prototype.Ha,d=b.XhrIo=Qt}).apply("undefined"!==typeof x?x:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});const w="@firebase/firestore";class _{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}_.UNAUTHENTICATED=new _(null),_.GOOGLE_CREDENTIALS=new _("google-credentials-uid"),_.FIRST_PARTY=new _("first-party-uid"),_.MOCK_USER=new _("mock-user");let k="10.14.0";const N=new o.Vy("@firebase/firestore");function S(){return N.logLevel}function j(e){if(N.logLevel<=o.$b.DEBUG){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=n.map(T);N.debug("Firestore (".concat(k,"): ").concat(e),...i)}}function E(e){if(N.logLevel<=o.$b.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=n.map(T);N.error("Firestore (".concat(k,"): ").concat(e),...i)}}function C(e){if(N.logLevel<=o.$b.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=n.map(T);N.warn("Firestore (".concat(k,"): ").concat(e),...i)}}function T(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function A(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected state";const t="FIRESTORE (".concat(k,") INTERNAL ASSERTION FAILED: ")+e;throw E(t),new Error(t)}function I(e,t){e||A()}function P(e,t){return e}const L={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class R extends l.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>"".concat(this.name,": [code=").concat(this.code,"]: ").concat(this.message)}}class O{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class M{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(e))}}class D{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(_.UNAUTHENTICATED))}shutdown(){}}class F{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class z{constructor(e){this.t=e,this.currentUser=_.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){I(void 0===this.o);let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new O;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new O,e.enqueueRetryable(()=>r(this.currentUser))};const s=()=>{const t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},a=e=>{j("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?a(e):(j("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new O)}},0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(j("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(I("string"==typeof t.accessToken),new M(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return I(null===e||"string"==typeof e),new _(e)}}class U{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=_.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class B{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new U(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(_.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class V{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class q{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){I(void 0===this.o);const n=e=>{null!=e.error&&j("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(e.error.message));const n=e.token!==this.R;return this.R=e.token,j("FirebaseAppCheckTokenProvider","Received ".concat(n?"new":"existing"," token.")),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};const r=e=>{j("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){const e=this.A.getImmediate({optional:!0});e?r(e):j("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(I("string"==typeof e.token),this.R=e.token,new V(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function K(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}class H{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(256/62);let n="";for(;n.length<20;){const r=K(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%62))}return n}}function W(e,t){return e<t?-1:e>t?1:0}function G(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}class Z{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new R(L.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new R(L.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new R(L.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new R(L.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Z.fromMillis(Date.now())}static fromDate(e){return Z.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Z(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?W(this.nanoseconds,e.nanoseconds):W(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Q{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Q(e)}static min(){return new Q(new Z(0,0))}static max(){return new Q(new Z(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class J{constructor(e,t,n){void 0===t?t=0:t>e.length&&A(),void 0===n?n=e.length-t:n>e.length-t&&A(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===J.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof J?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Y extends J{construct(e,t,n){return new Y(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(){const e=[];for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const i of n){if(i.indexOf("//")>=0)throw new R(L.INVALID_ARGUMENT,"Invalid segment (".concat(i,"). Paths must not contain // in them."));e.push(...i.split("/").filter(e=>e.length>0))}return new Y(e)}static emptyPath(){return new Y([])}}const X=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class $ extends J{construct(e,t,n){return new $(e,t,n)}static isValidIdentifier(e){return X.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),$.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new $(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new R(L.INVALID_ARGUMENT,"Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new R(L.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new R(L.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new R(L.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new $(t)}static emptyPath(){return new $([])}}class ee{constructor(e){this.path=e}static fromPath(e){return new ee(Y.fromString(e))}static fromName(e){return new ee(Y.fromString(e).popFirst(5))}static empty(){return new ee(Y.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Y.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Y.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ee(new Y(e.slice()))}}class te{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}te.UNKNOWN_ID=-1;function ne(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=Q.fromTimestamp(1e9===r?new Z(n+1,0):new Z(n,r));return new ie(i,ee.empty(),t)}function re(e){return new ie(e.readTime,e.key,-1)}class ie{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new ie(Q.min(),ee.empty(),-1)}static max(){return new ie(Q.max(),ee.empty(),-1)}}function se(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=ee.comparator(e.documentKey,t.documentKey),0!==n?n:W(e.largestBatchId,t.largestBatchId))}const ae="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class oe{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function le(e){if(e.code!==L.FAILED_PRECONDITION||e.message!==ae)throw e;j("LocalStore","Unexpectedly lost primary lease")}class ce{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&A(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new ce((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof ce?t:ce.resolve(t)}catch(e){return ce.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):ce.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):ce.reject(t)}static resolve(e){return new ce((t,n)=>{t(e)})}static reject(e){return new ce((t,n)=>{n(e)})}static waitFor(e){return new ce((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=ce.resolve(!1);for(const n of e)t=t.next(e=>e?ce.resolve(e):n());return t}static forEach(e,t){const n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new ce((n,r)=>{const i=e.length,s=new Array(i);let a=0;for(let o=0;o<i;o++){const l=o;t(e[l]).next(e=>{s[l]=e,++a,a===i&&n(s)},e=>r(e))}})}static doWhile(e,t){return new ce((n,r)=>{const i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}function ue(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function de(e){return"IndexedDbTransactionError"===e.name}class he{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ie(e),this.se=e=>t.writeSequenceNumber(e))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}function pe(e){return null==e}function fe(e){return 0===e&&1/e==-1/0}function me(e){return"number"==typeof e&&Number.isInteger(e)&&!fe(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}he.oe=-1;const ge=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],ve=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],ye=ve,xe=[...ye,"indexConfiguration","indexState","indexEntries"];function be(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function we(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function _e(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class ke{constructor(e,t){this.comparator=e,this.root=t||Se.EMPTY}insert(e,t){return new ke(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Se.BLACK,null,null))}remove(e){return new ke(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Se.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push("".concat(t,":").concat(n)),!1)),"{".concat(e.join(", "),"}")}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ne(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ne(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ne(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ne(this.root,e,this.comparator,!0)}}class Ne{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Se{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:Se.RED,this.left=null!=r?r:Se.EMPTY,this.right=null!=i?i:Se.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new Se(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Se.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return Se.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Se.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Se.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw A();if(this.right.isRed())throw A();const e=this.left.check();if(e!==this.right.check())throw A();return e+(this.isRed()?0:1)}}Se.EMPTY=null,Se.RED=!0,Se.BLACK=!1,Se.EMPTY=new class{constructor(){this.size=0}get key(){throw A()}get value(){throw A()}get color(){throw A()}get left(){throw A()}get right(){throw A()}copy(e,t,n,r,i){return this}insert(e,t,n){return new Se(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class je{constructor(e){this.comparator=e,this.data=new ke(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ee(this.data.getIterator())}getIteratorFrom(e){return new Ee(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof je))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new je(this.comparator);return t.data=e,t}}class Ee{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Ce{constructor(e){this.fields=e,e.sort($.comparator)}static empty(){return new Ce([])}unionWith(e){let t=new je($.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new Ce(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return G(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class Te extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Ae{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new Te("Invalid base64 string: "+e):e}}(e);return new Ae(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Ae(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return W(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ae.EMPTY_BYTE_STRING=new Ae("");const Ie=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Pe(e){if(I(!!e),"string"==typeof e){let t=0;const n=Ie.exec(e);if(I(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:Le(e.seconds),nanos:Le(e.nanos)}}function Le(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Re(e){return"string"==typeof e?Ae.fromBase64String(e):Ae.fromUint8Array(e)}function Oe(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Me(e){const t=e.mapValue.fields.__previous_value__;return Oe(t)?Me(t):t}function De(e){const t=Pe(e.mapValue.fields.__local_write_time__.timestampValue);return new Z(t.seconds,t.nanos)}class Fe{constructor(e,t,n,r,i,s,a,o,l){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l}}class ze{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new ze("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof ze&&e.projectId===this.projectId&&e.database===this.database}}const Ue={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Be(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Oe(e)?4:rt(e)?9007199254740991:tt(e)?10:11:A()}function Ve(e,t){if(e===t)return!0;const n=Be(e);if(n!==Be(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return De(e).isEqual(De(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=Pe(e.timestampValue),r=Pe(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Re(e.bytesValue).isEqual(Re(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Le(e.geoPointValue.latitude)===Le(t.geoPointValue.latitude)&&Le(e.geoPointValue.longitude)===Le(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Le(e.integerValue)===Le(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=Le(e.doubleValue),r=Le(t.doubleValue);return n===r?fe(n)===fe(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return G(e.arrayValue.values||[],t.arrayValue.values||[],Ve);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(be(n)!==be(r))return!1;for(const i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Ve(n[i],r[i])))return!1;return!0}(e,t);default:return A()}}function qe(e,t){return void 0!==(e.values||[]).find(e=>Ve(e,t))}function Ke(e,t){if(e===t)return 0;const n=Be(e),r=Be(t);if(n!==r)return W(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return W(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=Le(e.integerValue||e.doubleValue),r=Le(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return He(e.timestampValue,t.timestampValue);case 4:return He(De(e),De(t));case 5:return W(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Re(e),r=Re(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let i=0;i<n.length&&i<r.length;i++){const e=W(n[i],r[i]);if(0!==e)return e}return W(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=W(Le(e.latitude),Le(t.latitude));return 0!==n?n:W(Le(e.longitude),Le(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return We(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n,r,i,s;const a=e.fields||{},o=t.fields||{},l=null===(n=a.value)||void 0===n?void 0:n.arrayValue,c=null===(r=o.value)||void 0===r?void 0:r.arrayValue,u=W((null===(i=null==l?void 0:l.values)||void 0===i?void 0:i.length)||0,(null===(s=null==c?void 0:c.values)||void 0===s?void 0:s.length)||0);return 0!==u?u:We(l,c)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===Ue.mapValue&&t===Ue.mapValue)return 0;if(e===Ue.mapValue)return 1;if(t===Ue.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let a=0;a<r.length&&a<s.length;++a){const e=W(r[a],s[a]);if(0!==e)return e;const t=Ke(n[r[a]],i[s[a]]);if(0!==t)return t}return W(r.length,s.length)}(e.mapValue,t.mapValue);default:throw A()}}function He(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return W(e,t);const n=Pe(e),r=Pe(t),i=W(n.seconds,r.seconds);return 0!==i?i:W(n.nanos,r.nanos)}function We(e,t){const n=e.values||[],r=t.values||[];for(let i=0;i<n.length&&i<r.length;++i){const e=Ke(n[i],r[i]);if(e)return e}return W(n.length,r.length)}function Ge(e){return Ze(e)}function Ze(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Pe(e);return"time(".concat(t.seconds,",").concat(t.nanos,")")}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return Re(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return ee.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return"geo(".concat(e.latitude,",").concat(e.longitude,")")}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=Ze(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+="".concat(i,":").concat(Ze(e.fields[i]));return n+"}"}(e.mapValue):A()}function Qe(e,t){return{referenceValue:"projects/".concat(e.projectId,"/databases/").concat(e.database,"/documents/").concat(t.path.canonicalString())}}function Je(e){return!!e&&"integerValue"in e}function Ye(e){return!!e&&"arrayValue"in e}function Xe(e){return!!e&&"nullValue"in e}function $e(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function et(e){return!!e&&"mapValue"in e}function tt(e){var t,n;return"__vector__"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function nt(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return we(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=nt(n)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=nt(e.arrayValue.values[n]);return t}return Object.assign({},e)}function rt(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}class it{constructor(e){this.value=e}static empty(){return new it({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!et(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=nt(t)}setAll(e){let t=$.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=nt(e):r.push(i.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());et(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ve(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];et(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){we(t,(t,n)=>e[t]=n);for(const r of n)delete e[r]}clone(){return new it(nt(this.value))}}function st(e){const t=[];return we(e.fields,(e,n)=>{const r=new $([e]);if(et(n)){const e=st(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)}),new Ce(t)}class at{constructor(e,t,n,r,i,s,a){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new at(e,0,Q.min(),Q.min(),Q.min(),it.empty(),0)}static newFoundDocument(e,t,n,r){return new at(e,1,t,Q.min(),n,r,0)}static newNoDocument(e,t){return new at(e,2,t,Q.min(),Q.min(),it.empty(),0)}static newUnknownDocument(e,t){return new at(e,3,t,Q.min(),Q.min(),it.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Q.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=it.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=it.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Q.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof at&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new at(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {createTime: ").concat(this.createTime,"}), {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}class ot{constructor(e,t){this.position=e,this.inclusive=t}}function lt(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],a=e.position[i];if(r=s.field.isKeyField()?ee.comparator(ee.fromName(a.referenceValue),n.key):Ke(a,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function ct(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!Ve(e.position[n],t.position[n]))return!1;return!0}class ut{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";this.field=e,this.dir=t}}function dt(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class ht{}class pt extends ht{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new wt(e,t,n):"array-contains"===t?new St(e,n):"in"===t?new jt(e,n):"not-in"===t?new Et(e,n):"array-contains-any"===t?new Ct(e,n):new pt(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new _t(e,n):new kt(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Ke(t,this.value)):null!==t&&Be(this.value)===Be(t)&&this.matchesComparison(Ke(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return A()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ft extends ht{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new ft(e,t)}matches(e){return mt(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function mt(e){return"and"===e.op}function gt(e){return vt(e)&&mt(e)}function vt(e){for(const t of e.filters)if(t instanceof ft)return!1;return!0}function yt(e){if(e instanceof pt)return e.field.canonicalString()+e.op.toString()+Ge(e.value);if(gt(e))return e.filters.map(e=>yt(e)).join(",");{const t=e.filters.map(e=>yt(e)).join(",");return"".concat(e.op,"(").concat(t,")")}}function xt(e,t){return e instanceof pt?function(e,t){return t instanceof pt&&e.op===t.op&&e.field.isEqual(t.field)&&Ve(e.value,t.value)}(e,t):e instanceof ft?function(e,t){return t instanceof ft&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,n,r)=>e&&xt(n,t.filters[r]),!0)}(e,t):void A()}function bt(e){return e instanceof pt?function(e){return"".concat(e.field.canonicalString()," ").concat(e.op," ").concat(Ge(e.value))}(e):e instanceof ft?function(e){return e.op.toString()+" {"+e.getFilters().map(bt).join(" ,")+"}"}(e):"Filter"}class wt extends pt{constructor(e,t,n){super(e,t,n),this.key=ee.fromName(n.referenceValue)}matches(e){const t=ee.comparator(e.key,this.key);return this.matchesComparison(t)}}class _t extends pt{constructor(e,t){super(e,"in",t),this.keys=Nt("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class kt extends pt{constructor(e,t){super(e,"not-in",t),this.keys=Nt("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Nt(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>ee.fromName(e.referenceValue))}class St extends pt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Ye(t)&&qe(t.arrayValue,this.value)}}class jt extends pt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&qe(this.value.arrayValue,t)}}class Et extends pt{constructor(e,t){super(e,"not-in",t)}matches(e){if(qe(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!qe(this.value.arrayValue,t)}}class Ct extends pt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Ye(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>qe(this.value.arrayValue,e))}}class Tt{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=a,this.ue=null}}function At(e){return new Tt(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null)}function It(e){const t=P(e);if(null===t.ue){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>yt(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),pe(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>Ge(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>Ge(e)).join(",")),t.ue=e}return t.ue}function Pt(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!dt(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!xt(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!ct(e.startAt,t.startAt)&&ct(e.endAt,t.endAt)}function Lt(e){return ee.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class Rt{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function Ot(e,t,n,r,i,s,a,o){return new Rt(e,t,n,r,i,s,a,o)}function Mt(e){return new Rt(e)}function Dt(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Ft(e){return null!==e.collectionGroup}function zt(e){const t=P(e);if(null===t.ce){t.ce=[];const e=new Set;for(const i of t.explicitOrderBy)t.ce.push(i),e.add(i.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",r=function(e){let t=new je($.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t}(t);r.forEach(r=>{e.has(r.canonicalString())||r.isKeyField()||t.ce.push(new ut(r,n))}),e.has($.keyField().canonicalString())||t.ce.push(new ut($.keyField(),n))}return t.ce}function Ut(e){const t=P(e);return t.le||(t.le=Bt(t,zt(e))),t.le}function Bt(e,t){if("F"===e.limitType)return At(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{const t="desc"===e.dir?"asc":"desc";return new ut(e.field,t)});const n=e.endAt?new ot(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new ot(e.startAt.position,e.startAt.inclusive):null;return At(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function Vt(e,t){const n=e.filters.concat([t]);return new Rt(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function qt(e,t,n){return new Rt(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Kt(e,t){return Pt(Ut(e),Ut(t))&&e.limitType===t.limitType}function Ht(e){return"".concat(It(Ut(e)),"|lt:").concat(e.limitType)}function Wt(e){return"Query(target=".concat(function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=", filters: [".concat(e.filters.map(e=>bt(e)).join(", "),"]")),pe(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=", orderBy: [".concat(e.orderBy.map(e=>function(e){return"".concat(e.field.canonicalString()," (").concat(e.dir,")")}(e)).join(", "),"]")),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>Ge(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>Ge(e)).join(",")),"Target(".concat(t,")")}(Ut(e)),"; limitType=").concat(e.limitType,")")}function Gt(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):ee.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of zt(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=lt(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,zt(e),t))&&!(e.endAt&&!function(e,t,n){const r=lt(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,zt(e),t))}(e,t)}function Zt(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function Qt(e){return(t,n)=>{let r=!1;for(const i of zt(e)){const e=Jt(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function Jt(e,t,n){const r=e.field.isKeyField()?ee.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?Ke(r,i):A()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return A()}}class Yt{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[r,i]of n)if(this.equalsFn(r,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){we(this.inner,(t,n)=>{for(const[r,i]of n)e(r,i)})}isEmpty(){return _e(this.inner)}size(){return this.innerSize}}const Xt=new ke(ee.comparator);function $t(){return Xt}const en=new ke(ee.comparator);function tn(){let e=en;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const i of n)e=e.insert(i.key,i);return e}function nn(e){let t=en;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function rn(){return an()}function sn(){return an()}function an(){return new Yt(e=>e.toString(),(e,t)=>e.isEqual(t))}const on=new ke(ee.comparator),ln=new je(ee.comparator);function cn(){let e=ln;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const i of n)e=e.add(i);return e}const un=new je(W);function dn(){return un}function hn(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:fe(t)?"-0":t}}function pn(e){return{integerValue:""+e}}function fn(e,t){return me(t)?pn(t):hn(e,t)}class mn{constructor(){this._=void 0}}function gn(e,t,n){return e instanceof xn?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&Oe(t)&&(t=Me(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof bn?wn(e,t):e instanceof _n?kn(e,t):function(e,t){const n=yn(e,t),r=Sn(n)+Sn(e.Pe);return Je(n)&&Je(e.Pe)?pn(r):hn(e.serializer,r)}(e,t)}function vn(e,t,n){return e instanceof bn?wn(e,t):e instanceof _n?kn(e,t):n}function yn(e,t){return e instanceof Nn?function(e){return Je(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class xn extends mn{}class bn extends mn{constructor(e){super(),this.elements=e}}function wn(e,t){const n=jn(t);for(const r of e.elements)n.some(e=>Ve(e,r))||n.push(r);return{arrayValue:{values:n}}}class _n extends mn{constructor(e){super(),this.elements=e}}function kn(e,t){let n=jn(t);for(const r of e.elements)n=n.filter(e=>!Ve(e,r));return{arrayValue:{values:n}}}class Nn extends mn{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function Sn(e){return Le(e.integerValue||e.doubleValue)}function jn(e){return Ye(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class En{constructor(e,t){this.field=e,this.transform=t}}class Cn{constructor(e,t){this.version=e,this.transformResults=t}}class Tn{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Tn}static exists(e){return new Tn(void 0,e)}static updateTime(e){return new Tn(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function An(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class In{}function Pn(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Vn(e.key,Tn.none()):new Dn(e.key,e.data,Tn.none());{const n=e.data,r=it.empty();let i=new je($.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new Fn(e.key,r,new Ce(i.toArray()),Tn.none())}}function Ln(e,t,n){e instanceof Dn?function(e,t,n){const r=e.value.clone(),i=Un(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Fn?function(e,t,n){if(!An(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=Un(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(zn(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Rn(e,t,n,r){return e instanceof Dn?function(e,t,n,r){if(!An(e.precondition,t))return n;const i=e.value.clone(),s=Bn(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof Fn?function(e,t,n,r){if(!An(e.precondition,t))return n;const i=Bn(e.fieldTransforms,r,t),s=t.data;return s.setAll(zn(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):function(e,t,n){return An(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function On(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=yn(r.transform,e||null);null!=i&&(null===n&&(n=it.empty()),n.set(r.field,i))}return n||null}function Mn(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&G(e,t,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof bn&&t instanceof bn||e instanceof _n&&t instanceof _n?G(e.elements,t.elements,Ve):e instanceof Nn&&t instanceof Nn?Ve(e.Pe,t.Pe):e instanceof xn&&t instanceof xn}(e.transform,t.transform)}(e,t))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class Dn extends In{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Fn extends In{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function zn(e){const t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}}),t}function Un(e,t,n){const r=new Map;I(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],a=s.transform,o=t.data.field(s.field);r.set(s.field,vn(a,o,n[i]))}return r}function Bn(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,gn(e,s,t))}return r}class Vn extends In{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class qn extends In{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Kn{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const t=this.mutations[r];t.key.isEqual(e.key)&&Ln(t,e,n[r])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Rn(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Rn(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=sn();return this.mutations.forEach(r=>{const i=e.get(r.key),s=i.overlayedDocument;let a=this.applyToLocalView(s,i.mutatedFields);a=t.has(r.key)?null:a;const o=Pn(s,a);null!==o&&n.set(r.key,o),s.isValidDocument()||s.convertToNoDocument(Q.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),cn())}isEqual(e){return this.batchId===e.batchId&&G(this.mutations,e.mutations,(e,t)=>Mn(e,t))&&G(this.baseMutations,e.baseMutations,(e,t)=>Mn(e,t))}}class Hn{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){I(e.mutations.length===n.length);let r=on;const i=e.mutations;for(let s=0;s<i.length;s++)r=r.insert(i[s].key,n[s].version);return new Hn(e,t,n,r)}}class Wn{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return"Overlay{\n      largestBatchId: ".concat(this.largestBatchId,",\n      mutation: ").concat(this.mutation.toString(),"\n    }")}}class Gn{constructor(e,t){this.count=e,this.unchangedNames=t}}var Zn,Qn;function Jn(e){switch(e){default:return A();case L.CANCELLED:case L.UNKNOWN:case L.DEADLINE_EXCEEDED:case L.RESOURCE_EXHAUSTED:case L.INTERNAL:case L.UNAVAILABLE:case L.UNAUTHENTICATED:return!1;case L.INVALID_ARGUMENT:case L.NOT_FOUND:case L.ALREADY_EXISTS:case L.PERMISSION_DENIED:case L.FAILED_PRECONDITION:case L.ABORTED:case L.OUT_OF_RANGE:case L.UNIMPLEMENTED:case L.DATA_LOSS:return!0}}function Yn(e){if(void 0===e)return E("GRPC error has no .code"),L.UNKNOWN;switch(e){case Zn.OK:return L.OK;case Zn.CANCELLED:return L.CANCELLED;case Zn.UNKNOWN:return L.UNKNOWN;case Zn.DEADLINE_EXCEEDED:return L.DEADLINE_EXCEEDED;case Zn.RESOURCE_EXHAUSTED:return L.RESOURCE_EXHAUSTED;case Zn.INTERNAL:return L.INTERNAL;case Zn.UNAVAILABLE:return L.UNAVAILABLE;case Zn.UNAUTHENTICATED:return L.UNAUTHENTICATED;case Zn.INVALID_ARGUMENT:return L.INVALID_ARGUMENT;case Zn.NOT_FOUND:return L.NOT_FOUND;case Zn.ALREADY_EXISTS:return L.ALREADY_EXISTS;case Zn.PERMISSION_DENIED:return L.PERMISSION_DENIED;case Zn.FAILED_PRECONDITION:return L.FAILED_PRECONDITION;case Zn.ABORTED:return L.ABORTED;case Zn.OUT_OF_RANGE:return L.OUT_OF_RANGE;case Zn.UNIMPLEMENTED:return L.UNIMPLEMENTED;case Zn.DATA_LOSS:return L.DATA_LOSS;default:return A()}}(Qn=Zn||(Zn={}))[Qn.OK=0]="OK",Qn[Qn.CANCELLED=1]="CANCELLED",Qn[Qn.UNKNOWN=2]="UNKNOWN",Qn[Qn.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Qn[Qn.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Qn[Qn.NOT_FOUND=5]="NOT_FOUND",Qn[Qn.ALREADY_EXISTS=6]="ALREADY_EXISTS",Qn[Qn.PERMISSION_DENIED=7]="PERMISSION_DENIED",Qn[Qn.UNAUTHENTICATED=16]="UNAUTHENTICATED",Qn[Qn.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Qn[Qn.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Qn[Qn.ABORTED=10]="ABORTED",Qn[Qn.OUT_OF_RANGE=11]="OUT_OF_RANGE",Qn[Qn.UNIMPLEMENTED=12]="UNIMPLEMENTED",Qn[Qn.INTERNAL=13]="INTERNAL",Qn[Qn.UNAVAILABLE=14]="UNAVAILABLE",Qn[Qn.DATA_LOSS=15]="DATA_LOSS";let Xn=null;function $n(){return new TextEncoder}const er=new r([4294967295,4294967295],0);function tr(e){const t=$n().encode(e),n=new i;return n.update(t),new Uint8Array(n.digest())}function nr(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),i=t.getUint32(4,!0),s=t.getUint32(8,!0),a=t.getUint32(12,!0);return[new r([n,i],0),new r([s,a],0)]}class rr{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new ir("Invalid padding: ".concat(t));if(n<0)throw new ir("Invalid hash count: ".concat(n));if(e.length>0&&0===this.hashCount)throw new ir("Invalid hash count: ".concat(n));if(0===e.length&&0!==t)throw new ir("Invalid padding when bitmap length is 0: ".concat(t));this.Ie=8*e.length-t,this.Te=r.fromNumber(this.Ie)}Ee(e,t,n){let i=e.add(t.multiply(r.fromNumber(n)));return 1===i.compare(er)&&(i=new r([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;const t=tr(e),[n,r]=nr(t);for(let i=0;i<this.hashCount;i++){const e=this.Ee(n,r,i);if(!this.de(e))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new rr(i,r,t);return n.forEach(e=>s.insert(e)),s}insert(e){if(0===this.Ie)return;const t=tr(e),[n,r]=nr(t);for(let i=0;i<this.hashCount;i++){const e=this.Ee(n,r,i);this.Ae(e)}}Ae(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class ir extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class sr{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,ar.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new sr(Q.min(),r,new ke(W),$t(),cn())}}class ar{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new ar(n,t,cn(),cn(),cn())}}class or{constructor(e,t,n,r){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=r}}class lr{constructor(e,t){this.targetId=e,this.me=t}}class cr{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ae.EMPTY_BYTE_STRING,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class ur{constructor(){this.fe=0,this.ge=pr(),this.pe=Ae.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=cn(),t=cn(),n=cn();return this.ge.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:A()}}),new ar(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=pr()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,I(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class dr{constructor(e){this.Le=e,this.Be=new Map,this.ke=$t(),this.qe=hr(),this.Qe=new ke(W)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:A()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((e,n)=>{this.ze(n)&&t(n)})}He(e){const t=e.targetId,n=e.me.count,r=this.Je(t);if(r){const i=r.target;if(Lt(i))if(0===n){const e=new ee(i.path);this.Ue(t,e,at.newNoDocument(e,Q.min()))}else I(1===n);else{const r=this.Ye(t);if(r!==n){const n=this.Ze(e),i=n?this.Xe(n,e,r):1;if(0!==i){this.je(t);const e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,e)}null==Xn||Xn.et(function(e,t,n,r,i){var s,a,o,l,c,u;const d={localCacheCount:e,existenceFilterCount:t.count,databaseId:n.database,projectId:n.projectId},h=t.unchangedNames;return h&&(d.bloomFilter={applied:0===i,hashCount:null!==(s=null==h?void 0:h.hashCount)&&void 0!==s?s:0,bitmapLength:null!==(l=null===(o=null===(a=null==h?void 0:h.bits)||void 0===a?void 0:a.bitmap)||void 0===o?void 0:o.length)&&void 0!==l?l:0,padding:null!==(u=null===(c=null==h?void 0:h.bits)||void 0===c?void 0:c.padding)&&void 0!==u?u:0,mightContain:e=>{var t;return null!==(t=null==r?void 0:r.mightContain(e))&&void 0!==t&&t}}),d}(r,e.me,this.Le.tt(),n,i))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=t;let s,a;try{s=Re(n).toUint8Array()}catch(e){if(e instanceof Te)return C("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{a=new rr(s,r,i)}catch(e){return C(e instanceof ir?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===a.Ie?null:a}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let r=0;return n.forEach(n=>{const i=this.Le.tt(),s="projects/".concat(i.projectId,"/databases/").concat(i.database,"/documents/").concat(n.path.canonicalString());e.mightContain(s)||(this.Ue(t,n,null),r++)}),r}rt(e){const t=new Map;this.Be.forEach((n,r)=>{const i=this.Je(r);if(i){if(n.current&&Lt(i.target)){const t=new ee(i.target.path);null!==this.ke.get(t)||this.it(r,t)||this.Ue(r,t,at.newNoDocument(t,e))}n.be&&(t.set(r,n.ve()),n.Ce())}});let n=cn();this.qe.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{const t=this.Je(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.ke.forEach((t,n)=>n.setReadTime(e));const r=new sr(e,t,this.Qe,this.ke,n);return this.ke=$t(),this.qe=hr(),this.Qe=new ke(W),r}$e(e,t){if(!this.ze(e))return;const n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;const r=this.Ge(e);this.it(e,t)?r.Fe(t,1):r.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new ur,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new je(W),this.qe=this.qe.insert(e,t)),t}ze(e){const t=null!==this.Je(e);return t||j("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new ur),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function hr(){return new ke(ee.comparator)}function pr(){return new ke(ee.comparator)}const fr={asc:"ASCENDING",desc:"DESCENDING"},mr={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},gr={and:"AND",or:"OR"};class vr{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function yr(e,t){return e.useProto3Json||pe(t)?t:{value:t}}function xr(e,t){return e.useProto3Json?"".concat(new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+t.nanoseconds).slice(-9),"Z"):{seconds:""+t.seconds,nanos:t.nanoseconds}}function br(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function wr(e,t){return xr(e,t.toTimestamp())}function _r(e){return I(!!e),Q.fromTimestamp(function(e){const t=Pe(e);return new Z(t.seconds,t.nanos)}(e))}function kr(e,t){return Nr(e,t).canonicalString()}function Nr(e,t){const n=function(e){return new Y(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function Sr(e){const t=Y.fromString(e);return I(Hr(t)),t}function jr(e,t){return kr(e.databaseId,t.path)}function Er(e,t){const n=Sr(t);if(n.get(1)!==e.databaseId.projectId)throw new R(L.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new R(L.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new ee(Ir(n))}function Cr(e,t){return kr(e.databaseId,t)}function Tr(e){const t=Sr(e);return 4===t.length?Y.emptyPath():Ir(t)}function Ar(e){return new Y(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Ir(e){return I(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Pr(e,t,n){return{name:jr(e,t),fields:n.value.mapValue.fields}}function Lr(e,t){let n;if(t instanceof Dn)n={update:Pr(e,t.key,t.value)};else if(t instanceof Vn)n={delete:jr(e,t.key)};else if(t instanceof Fn)n={update:Pr(e,t.key,t.data),updateMask:Kr(t.fieldMask)};else{if(!(t instanceof qn))return A();n={verify:jr(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const n=t.transform;if(n instanceof xn)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof bn)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof _n)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Nn)return{fieldPath:t.field.canonicalString(),increment:n.Pe};throw A()}(0,e))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:wr(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:A()}(e,t.precondition)),n}function Rr(e,t){return{documents:[Cr(e,t.path)]}}function Or(e,t){const n={structuredQuery:{}},r=t.path;let i;null!==t.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=Cr(e,i);const s=function(e){if(0!==e.length)return qr(ft.create(e,"and"))}(t.filters);s&&(n.structuredQuery.where=s);const a=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:Br(e.field),direction:Fr(e.dir)}}(e))}(t.orderBy);a&&(n.structuredQuery.orderBy=a);const o=yr(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{_t:n,parent:i}}function Mr(e){let t=Tr(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){I(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function(e){const t=Dr(e);return t instanceof ft&&gt(t)?t.getFilters():[t]}(n.where));let a=[];n.orderBy&&(a=function(e){return e.map(e=>function(e){return new ut(Vr(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))}(n.orderBy));let o=null;n.limit&&(o=function(e){let t;return t="object"==typeof e?e.value:e,pe(t)?null:t}(n.limit));let l=null;n.startAt&&(l=function(e){const t=!!e.before,n=e.values||[];return new ot(n,t)}(n.startAt));let c=null;return n.endAt&&(c=function(e){const t=!e.before,n=e.values||[];return new ot(n,t)}(n.endAt)),Ot(t,i,a,s,o,"F",l,c)}function Dr(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Vr(e.unaryFilter.field);return pt.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Vr(e.unaryFilter.field);return pt.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Vr(e.unaryFilter.field);return pt.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Vr(e.unaryFilter.field);return pt.create(i,"!=",{nullValue:"NULL_VALUE"});default:return A()}}(e):void 0!==e.fieldFilter?function(e){return pt.create(Vr(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return A()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return ft.create(e.compositeFilter.filters.map(e=>Dr(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return A()}}(e.compositeFilter.op))}(e):A()}function Fr(e){return fr[e]}function zr(e){return mr[e]}function Ur(e){return gr[e]}function Br(e){return{fieldPath:e.canonicalString()}}function Vr(e){return $.fromServerFormat(e.fieldPath)}function qr(e){return e instanceof pt?function(e){if("=="===e.op){if($e(e.value))return{unaryFilter:{field:Br(e.field),op:"IS_NAN"}};if(Xe(e.value))return{unaryFilter:{field:Br(e.field),op:"IS_NULL"}}}else if("!="===e.op){if($e(e.value))return{unaryFilter:{field:Br(e.field),op:"IS_NOT_NAN"}};if(Xe(e.value))return{unaryFilter:{field:Br(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Br(e.field),op:zr(e.op),value:e.value}}}(e):e instanceof ft?function(e){const t=e.getFilters().map(e=>qr(e));return 1===t.length?t[0]:{compositeFilter:{op:Ur(e.op),filters:t}}}(e):A()}function Kr(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Hr(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class Wr{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Q.min(),s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Q.min(),a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Ae.EMPTY_BYTE_STRING,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new Wr(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Wr(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Wr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Wr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Gr{constructor(e){this.ct=e}}function Zr(e){const t=Mr({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?qt(t,t.limit,"L"):t}class Qr{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(Le(e.integerValue));else if("doubleValue"in e){const n=Le(e.doubleValue);isNaN(n)?this.dt(t,13):(this.dt(t,15),fe(n)?t.At(0):t.At(n))}else if("timestampValue"in e){let n=e.timestampValue;this.dt(t,20),"string"==typeof n&&(n=Pe(n)),t.Rt("".concat(n.seconds||"")),t.At(n.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(Re(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.dt(t,45),t.At(n.latitude||0),t.At(n.longitude||0)}else"mapValue"in e?rt(e)?this.dt(t,Number.MAX_SAFE_INTEGER):tt(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):A()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const n=e.fields||{};this.dt(t,55);for(const r of Object.keys(n))this.Vt(r,t),this.Tt(n[r],t)}wt(e,t){var n,r;const i=e.fields||{};this.dt(t,53);const s="value",a=(null===(r=null===(n=i[s].arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.length)||0;this.dt(t,15),t.At(Le(a)),this.Vt(s,t),this.Tt(i[s],t)}bt(e,t){const n=e.values||[];this.dt(t,50);for(const r of n)this.Tt(r,t)}yt(e,t){this.dt(t,37),ee.fromName(e).path.forEach(e=>{this.dt(t,60),this.Dt(e,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}Qr.vt=new Qr;class Jr{constructor(){this.un=new Yr}addToCollectionParentIndex(e,t){return this.un.add(t),ce.resolve()}getCollectionParents(e,t){return ce.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return ce.resolve()}deleteFieldIndex(e,t){return ce.resolve()}deleteAllFieldIndexes(e){return ce.resolve()}createTargetIndexes(e,t){return ce.resolve()}getDocumentsMatchingTarget(e,t){return ce.resolve(null)}getIndexType(e,t){return ce.resolve(0)}getFieldIndexes(e,t){return ce.resolve([])}getNextCollectionGroupToUpdate(e){return ce.resolve(null)}getMinOffset(e,t){return ce.resolve(ie.min())}getMinOffsetFromCollectionGroup(e,t){return ce.resolve(ie.min())}updateCollectionGroup(e,t,n){return ce.resolve()}updateIndexEntries(e,t){return ce.resolve()}}class Yr{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new je(Y.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new je(Y.comparator)).toArray()}}new Uint8Array(0);class Xr{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new Xr(e,Xr.DEFAULT_COLLECTION_PERCENTILE,Xr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}Xr.DEFAULT_COLLECTION_PERCENTILE=10,Xr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Xr.DEFAULT=new Xr(41943040,Xr.DEFAULT_COLLECTION_PERCENTILE,Xr.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Xr.DISABLED=new Xr(-1,0,0);class $r{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new $r(0)}static kn(){return new $r(-1)}}class ei{constructor(){this.changes=new Yt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,at.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?ce.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class ti{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class ni{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&Rn(n.mutation,e,Ce.empty(),Z.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,cn()).next(()=>t))}getLocalViewOfDocuments(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:cn();const r=rn();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=tn();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){const n=rn();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,cn()))}populateOverlays(e,t,n){const r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=$t();const s=an(),a=an();return t.forEach((e,t)=>{const a=n.get(t.key);r.has(t.key)&&(void 0===a||a.mutation instanceof Fn)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),Rn(a.mutation,t,a.mutation.getFieldMask(),Z.now())):s.set(t.key,Ce.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var n;return a.set(e,new ti(t,null!==(n=s.get(e))&&void 0!==n?n:null))}),a))}recalculateAndSaveOverlays(e,t){const n=an();let r=new ke((e,t)=>e-t),i=cn();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(const i of e)i.keys().forEach(e=>{const s=t.get(e);if(null===s)return;let a=n.get(e)||Ce.empty();a=i.applyToLocalView(s,a),n.set(e,a);const o=(r.get(i.batchId)||cn()).add(e);r=r.insert(i.batchId,o)})}).next(()=>{const s=[],a=r.getReverseIterator();for(;a.hasNext();){const r=a.getNext(),o=r.key,l=r.value,c=sn();l.forEach(e=>{if(!i.has(e)){const r=Pn(t.get(e),n.get(e));null!==r&&c.set(e,r),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,c))}return ce.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return function(e){return ee.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Ft(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):ce.resolve(rn());let a=-1,o=i;return s.next(t=>ce.forEach(t,(t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),i.get(t)?ce.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,cn())).next(e=>({batchId:a,changes:nn(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ee(t)).next(e=>{let t=tn();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const i=t.collectionGroup;let s=tn();return this.indexManager.getCollectionParents(e,i).next(a=>ce.forEach(a,a=>{const o=function(e,t){return new Rt(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,a.child(i));return this.getDocumentsMatchingCollectionQuery(e,o,n,r).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r))).next(e=>{i.forEach((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,at.newInvalidDocument(r)))});let n=tn();return e.forEach((e,r)=>{const s=i.get(e);void 0!==s&&Rn(s.mutation,r,Ce.empty(),Z.now()),Gt(t,r)&&(n=n.insert(e,r))}),n})}}class ri{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return ce.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:_r(e.createTime)}}(t)),ce.resolve()}getNamedQuery(e,t){return ce.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(e){return{name:e.name,query:Zr(e.bundledQuery),readTime:_r(e.readTime)}}(t)),ce.resolve()}}class ii{constructor(){this.overlays=new ke(ee.comparator),this.Ir=new Map}getOverlay(e,t){return ce.resolve(this.overlays.get(t))}getOverlays(e,t){const n=rn();return ce.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.ht(e,t,r)}),ce.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.Ir.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.Ir.delete(n)),ce.resolve()}getOverlaysForCollection(e,t,n){const r=rn(),i=t.length+1,s=new ee(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){const e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return ce.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new ke((e,t)=>e-t);const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=rn(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const a=rn(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return ce.resolve(a)}ht(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.Ir.get(r.largestBatchId).delete(n.key);this.Ir.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Wn(t,n));let i=this.Ir.get(t);void 0===i&&(i=cn(),this.Ir.set(t,i)),this.Ir.set(t,i.add(n.key))}}class si{constructor(){this.sessionToken=Ae.EMPTY_BYTE_STRING}getSessionToken(e){return ce.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,ce.resolve()}}class ai{constructor(){this.Tr=new je(oi.Er),this.dr=new je(oi.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const n=new oi(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Vr(new oi(e,t))}mr(e,t){e.forEach(e=>this.removeReference(e,t))}gr(e){const t=new ee(new Y([])),n=new oi(t,e),r=new oi(t,e+1),i=[];return this.dr.forEachInRange([n,r],e=>{this.Vr(e),i.push(e.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new ee(new Y([])),n=new oi(t,e),r=new oi(t,e+1);let i=cn();return this.dr.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){const t=new oi(e,0),n=this.Tr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class oi{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return ee.comparator(e.key,t.key)||W(e.wr,t.wr)}static Ar(e,t){return W(e.wr,t.wr)||ee.comparator(e.key,t.key)}}class li{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new je(oi.Er)}checkEmpty(e){return ce.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Kn(i,t,n,r);this.mutationQueue.push(s);for(const a of r)this.br=this.br.add(new oi(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return ce.resolve(s)}lookupMutationBatch(e,t){return ce.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.vr(n),i=r<0?0:r;return ce.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return ce.resolve(0===this.mutationQueue.length?-1:this.Sr-1)}getAllMutationBatches(e){return ce.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new oi(t,0),r=new oi(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([n,r],e=>{const t=this.Dr(e.wr);i.push(t)}),ce.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new je(W);return t.forEach(e=>{const t=new oi(e,0),r=new oi(e,Number.POSITIVE_INFINITY);this.br.forEachInRange([t,r],e=>{n=n.add(e.wr)})}),ce.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;ee.isDocumentKey(i)||(i=i.child(""));const s=new oi(new ee(i),0);let a=new je(W);return this.br.forEachWhile(e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(a=a.add(e.wr)),!0)},s),ce.resolve(this.Cr(a))}Cr(e){const t=[];return e.forEach(e=>{const n=this.Dr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){I(0===this.Fr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.br;return ce.forEach(t.mutations,r=>{const i=new oi(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.br=n})}On(e){}containsKey(e,t){const n=new oi(t,0),r=this.br.firstAfterOrEqual(n);return ce.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,ce.resolve()}Fr(e,t){return this.vr(e)}vr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class ci{constructor(e){this.Mr=e,this.docs=new ke(ee.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return ce.resolve(n?n.document.mutableCopy():at.newInvalidDocument(t))}getEntries(e,t){let n=$t();return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():at.newInvalidDocument(e))}),ce.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=$t();const s=t.path,a=new ee(s.child("")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){const{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||se(re(a),n)<=0||(r.has(a.key)||Gt(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return ce.resolve(i)}getAllFromCollectionGroup(e,t,n,r){A()}Or(e,t){return ce.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new ui(this)}getSize(e){return ce.resolve(this.size)}}class ui extends ei{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.cr.addEntry(e,r)):this.cr.removeEntry(n)}),ce.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}class di{constructor(e){this.persistence=e,this.Nr=new Yt(e=>It(e),Pt),this.lastRemoteSnapshotVersion=Q.min(),this.highestTargetId=0,this.Lr=0,this.Br=new ai,this.targetCount=0,this.kr=$r.Bn()}forEachTarget(e,t){return this.Nr.forEach((e,n)=>t(n)),ce.resolve()}getLastRemoteSnapshotVersion(e){return ce.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ce.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),ce.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),ce.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new $r(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,ce.resolve()}updateTargetData(e,t){return this.Kn(t),ce.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,ce.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Nr.forEach((s,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.Nr.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),ce.waitFor(i).next(()=>r)}getTargetCount(e){return ce.resolve(this.targetCount)}getTargetData(e,t){const n=this.Nr.get(t)||null;return ce.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),ce.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),ce.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),ce.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Br.yr(t);return ce.resolve(n)}containsKey(e,t){return ce.resolve(this.Br.containsKey(t))}}class hi{constructor(e,t){this.qr={},this.overlays={},this.Qr=new he(0),this.Kr=!1,this.Kr=!0,this.$r=new si,this.referenceDelegate=e(this),this.Ur=new di(this),this.indexManager=new Jr,this.remoteDocumentCache=function(e){return new ci(e)}(e=>this.referenceDelegate.Wr(e)),this.serializer=new Gr(t),this.Gr=new ri(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new ii,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new li(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){j("MemoryPersistence","Starting transaction:",e);const r=new pi(this.Qr.next());return this.referenceDelegate.zr(),n(r).next(e=>this.referenceDelegate.jr(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Hr(e,t){return ce.or(Object.values(this.qr).map(n=>()=>n.containsKey(e,t)))}}class pi extends oe{constructor(e){super(),this.currentSequenceNumber=e}}class fi{constructor(e){this.persistence=e,this.Jr=new ai,this.Yr=null}static Zr(e){return new fi(e)}get Xr(){if(this.Yr)return this.Yr;throw A()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),ce.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),ce.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),ce.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(e=>this.Xr.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.Xr.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ce.forEach(this.Xr,n=>{const r=ee.fromPath(n);return this.ei(e,r).next(e=>{e||t.removeEntry(r,Q.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(e=>{e?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return ce.or([()=>ce.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class mi{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=r}static Wi(e,t){let n=cn(),r=cn();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new mi(e,t.fromCache,n,r)}}class gi{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class vi{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=(0,l.nr)()?8:ue((0,l.ZQ)())>0?6:4}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,r){const i={result:null};return this.Yi(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.Zi(e,t,r,n).next(e=>{i.result=e})}).next(()=>{if(i.result)return;const n=new gi;return this.Xi(e,t,n).next(r=>{if(i.result=r,this.zi)return this.es(e,t,n,r.size)})}).next(()=>i.result)}es(e,t,n,r){return n.documentReadCount<this.ji?(S()<=o.$b.DEBUG&&j("QueryEngine","SDK will not create cache indexes for query:",Wt(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),ce.resolve()):(S()<=o.$b.DEBUG&&j("QueryEngine","Query:",Wt(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Hi*r?(S()<=o.$b.DEBUG&&j("QueryEngine","The SDK decides to create cache indexes for query:",Wt(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ut(t))):ce.resolve())}Yi(e,t){if(Dt(t))return ce.resolve(null);let n=Ut(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(t=qt(t,null,"F"),n=Ut(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{const i=cn(...r);return this.Ji.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{const s=this.ts(t,r);return this.ns(t,s,i,n.readTime)?this.Yi(e,qt(t,null,"F")):this.rs(e,s,t,n)}))})))}Zi(e,t,n,r){return Dt(t)||r.isEqual(Q.min())?ce.resolve(null):this.Ji.getDocuments(e,n).next(i=>{const s=this.ts(t,i);return this.ns(t,s,n,r)?ce.resolve(null):(S()<=o.$b.DEBUG&&j("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Wt(t)),this.rs(e,s,t,ne(r,-1)).next(e=>e))})}ts(e,t){let n=new je(Qt(e));return t.forEach((t,r)=>{Gt(e,r)&&(n=n.add(r))}),n}ns(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Xi(e,t,n){return S()<=o.$b.DEBUG&&j("QueryEngine","Using full collection scan to execute query:",Wt(t)),this.Ji.getDocumentsMatchingQuery(e,t,ie.min(),n)}rs(e,t,n,r){return this.Ji.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}class yi{constructor(e,t,n,r){this.persistence=e,this.ss=t,this.serializer=r,this.os=new ke(W),this._s=new Yt(e=>It(e),Pt),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ni(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function xi(e,t,n,r){return new yi(e,t,n,r)}async function bi(e,t){const n=P(e);return await n.persistence.runTransaction("Handle user change","readonly",e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next(i=>(r=i,n.ls(t),n.mutationQueue.getAllMutationBatches(e))).next(t=>{const i=[],s=[];let a=cn();for(const e of r){i.push(e.batchId);for(const t of e.mutations)a=a.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)a=a.add(t.key)}return n.localDocuments.getDocuments(e,a).next(e=>({hs:e,removedBatchIds:i,addedBatchIds:s}))})})}function wi(e){const t=P(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Ur.getLastRemoteSnapshotVersion(e))}function _i(e,t,n){let r=cn(),i=cn();return n.forEach(e=>r=r.add(e)),t.getEntries(e,r).next(e=>{let r=$t();return n.forEach((n,s)=>{const a=e.get(n);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(Q.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):j("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),{Ps:r,Is:i}})}function ki(e,t){const n=P(e);return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}function Ni(e,t){const n=P(e);return n.persistence.runTransaction("Allocate target","readwrite",e=>{let r;return n.Ur.getTargetData(e,t).next(i=>i?(r=i,ce.resolve(r)):n.Ur.allocateTargetId(e).next(i=>(r=new Wr(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Ur.addTargetData(e,r).next(()=>r))))}).then(e=>{const r=n.os.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.os=n.os.insert(e.targetId,e),n._s.set(t,e.targetId)),e})}async function Si(e,t,n){const r=P(e),i=r.os.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,e=>r.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(!de(e))throw e;j("LocalStore","Failed to update sequence numbers for target ".concat(t,": ").concat(e))}r.os=r.os.remove(t),r._s.delete(i.target)}function ji(e,t,n){const r=P(e);let i=Q.min(),s=cn();return r.persistence.runTransaction("Execute query","readwrite",e=>function(e,t,n){const r=P(e),i=r._s.get(n);return void 0!==i?ce.resolve(r.os.get(i)):r.Ur.getTargetData(t,n)}(r,e,Ut(t)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(e,t.targetId).next(e=>{s=e})}).next(()=>r.ss.getDocumentsMatchingQuery(e,t,n?i:Q.min(),n?s:cn())).next(e=>(Ei(r,Zt(t),e),{documents:e,Ts:s})))}function Ei(e,t,n){let r=e.us.get(t)||Q.min();n.forEach((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.us.set(t,r)}class Ci{constructor(){this.activeTargetIds=dn()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Ti{constructor(){this.so=new Ci,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Ci,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Ai{_o(e){}shutdown(){}}class Ii{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){j("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){j("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Pi=null;function Li(){return null===Pi?Pi=268435456+Math.round(2147483648*Math.random()):Pi++,"0x"+Pi.toString(16)}const Ri={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Oi{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}const Mi="WebChannelConnection";class Di extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Do=t+"://"+e.host,this.vo="projects/".concat(n,"/databases/").concat(r),this.Co="(default)"===this.databaseId.database?"project_id=".concat(n):"project_id=".concat(n,"&database_id=").concat(r)}get Fo(){return!1}Mo(e,t,n,r,i){const s=Li(),a=this.xo(e,t.toUriEncodedString());j("RestConnection","Sending RPC '".concat(e,"' ").concat(s,":"),a,n);const o={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(o,r,i),this.No(e,a,o,n).then(t=>(j("RestConnection","Received RPC '".concat(e,"' ").concat(s,": "),t),t),t=>{throw C("RestConnection","RPC '".concat(e,"' ").concat(s," failed with error: "),t,"url: ",a,"request:",n),t})}Lo(e,t,n,r,i,s){return this.Mo(e,t,n,r,i)}Oo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+k,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}xo(e,t){const n=Ri[e];return"".concat(this.Do,"/v1/").concat(t,":").concat(n)}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,r){const i=Li();return new Promise((s,a)=>{const o=new d;o.setWithCredentials(!0),o.listenOnce(p.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case f.NO_ERROR:const t=o.getResponseJson();j(Mi,"XHR for RPC '".concat(e,"' ").concat(i," received:"),JSON.stringify(t)),s(t);break;case f.TIMEOUT:j(Mi,"RPC '".concat(e,"' ").concat(i," timed out")),a(new R(L.DEADLINE_EXCEEDED,"Request time out"));break;case f.HTTP_ERROR:const n=o.getStatus();if(j(Mi,"RPC '".concat(e,"' ").concat(i," failed with status:"),n,"response text:",o.getResponseText()),n>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(L).indexOf(t)>=0?t:L.UNKNOWN}(t.status);a(new R(e,t.message))}else a(new R(L.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new R(L.UNAVAILABLE,"Connection failed."));break;default:A()}}finally{j(Mi,"RPC '".concat(e,"' ").concat(i," completed."))}});const l=JSON.stringify(r);j(Mi,"RPC '".concat(e,"' ").concat(i," sending request:"),r),o.send(t,"POST",l,n,15)})}Bo(e,t,n){const r=Li(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=y(),a=v(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(o.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(o.useFetchStreams=!0),this.Oo(o.initMessageHeaders,t,n),o.encodeInitMessageHeaders=!0;const c=i.join("");j(Mi,"Creating RPC '".concat(e,"' stream ").concat(r,": ").concat(c),o);const u=s.createWebChannel(c,o);let d=!1,p=!1;const f=new Oi({Io:t=>{p?j(Mi,"Not sending because RPC '".concat(e,"' stream ").concat(r," is closed:"),t):(d||(j(Mi,"Opening RPC '".concat(e,"' stream ").concat(r," transport.")),u.open(),d=!0),j(Mi,"RPC '".concat(e,"' stream ").concat(r," sending:"),t),u.send(t))},To:()=>u.close()}),x=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return x(u,h.EventType.OPEN,()=>{p||(j(Mi,"RPC '".concat(e,"' stream ").concat(r," transport opened.")),f.yo())}),x(u,h.EventType.CLOSE,()=>{p||(p=!0,j(Mi,"RPC '".concat(e,"' stream ").concat(r," transport closed")),f.So())}),x(u,h.EventType.ERROR,t=>{p||(p=!0,C(Mi,"RPC '".concat(e,"' stream ").concat(r," transport errored:"),t),f.So(new R(L.UNAVAILABLE,"The operation could not be completed")))}),x(u,h.EventType.MESSAGE,t=>{var n;if(!p){const i=t.data[0];I(!!i);const s=i,a=s.error||(null===(n=s[0])||void 0===n?void 0:n.error);if(a){j(Mi,"RPC '".concat(e,"' stream ").concat(r," received error:"),a);const t=a.status;let n=function(e){const t=Zn[e];if(void 0!==t)return Yn(t)}(t),i=a.message;void 0===n&&(n=L.INTERNAL,i="Unknown error status: "+t+" with message "+a.message),p=!0,f.So(new R(n,i)),u.close()}else j(Mi,"RPC '".concat(e,"' stream ").concat(r," received:"),i),f.bo(i)}}),x(a,g.STAT_EVENT,t=>{t.stat===m.PROXY?j(Mi,"RPC '".concat(e,"' stream ").concat(r," detected buffering proxy")):t.stat===m.NOPROXY&&j(Mi,"RPC '".concat(e,"' stream ").concat(r," detected no buffering proxy"))}),setTimeout(()=>{f.wo()},0),f}}function Fi(){return"undefined"!=typeof document?document:null}function zi(e){return new vr(e,!0)}class Ui{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;this.ui=e,this.timerId=t,this.ko=n,this.qo=r,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),r=Math.max(0,t-n);r>0&&j("ExponentialBackoff","Backing off for ".concat(r," ms (base delay: ").concat(this.Ko," ms, delay with jitter: ").concat(t," ms, last attempt: ").concat(n," ms ago)")),this.$o=this.ui.enqueueAfterDelay(this.timerId,r,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){null!==this.$o&&(this.$o.skipDelay(),this.$o=null)}cancel(){null!==this.$o&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}class Bi{constructor(e,t,n,r,i,s,a,o){this.ui=e,this.Ho=n,this.Jo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Ui(e,t)}n_(){return 1===this.state||5===this.state||this.r_()}r_(){return 2===this.state||3===this.state}start(){this.e_=0,4!==this.state?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&null===this.Zo&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,4!==e?this.t_.reset():t&&t.code===L.RESOURCE_EXHAUSTED?(E(t.toString()),E("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===L.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(e=>{let[n,r]=e;this.Yo===t&&this.P_(n,r)},t=>{e(()=>{const e=new R(L.UNKNOWN,"Fetching auth token failed: "+t.message);return this.I_(e)})})}P_(e,t){const n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(e=>{n(()=>this.I_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.e_?this.E_(e):this.onNext(e))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return j("PersistentStream","close with error: ".concat(e)),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(j("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Vi extends Bi{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:A()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.useProto3Json?(I(void 0===t||"string"==typeof t),Ae.fromBase64String(t||"")):(I(void 0===t||t instanceof Buffer||t instanceof Uint8Array),Ae.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),a=t.targetChange.cause,o=a&&function(e){const t=void 0===e.code?L.UNKNOWN:Yn(e.code);return new R(t,e.message||"")}(a);n=new cr(r,i,s,o||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=Er(e,r.document.name),s=_r(r.document.updateTime),a=r.document.createTime?_r(r.document.createTime):Q.min(),o=new it({mapValue:{fields:r.document.fields}}),l=at.newFoundDocument(i,s,a,o),c=r.targetIds||[],u=r.removedTargetIds||[];n=new or(c,u,l.key,l)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=Er(e,r.document),s=r.readTime?_r(r.readTime):Q.min(),a=at.newNoDocument(i,s),o=r.removedTargetIds||[];n=new or([],o,a.key,a)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=Er(e,r.document),s=r.removedTargetIds||[];n=new or([],s,i,null)}else{if(!("filter"in t))return A();{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:i}=e,s=new Gn(r,i),a=e.targetId;n=new lr(a,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return Q.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?Q.min():t.readTime?_r(t.readTime):Q.min()}(e);return this.listener.d_(t,n)}A_(e){const t={};t.database=Ar(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=Lt(r)?{documents:Rr(e,r)}:{query:Or(e,r)._t},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=br(e,t.resumeToken);const r=yr(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(Q.min())>0){n.readTime=xr(e,t.snapshotVersion.toTimestamp());const r=yr(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return A()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.a_(t)}R_(e){const t={};t.database=Ar(this.serializer),t.removeTarget=e,this.a_(t)}}class qi extends Bi{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return I(!!e.streamToken),this.lastStreamToken=e.streamToken,I(!e.writeResults||0===e.writeResults.length),this.listener.f_()}onNext(e){I(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=function(e,t){return e&&e.length>0?(I(void 0!==t),e.map(e=>function(e,t){let n=e.updateTime?_r(e.updateTime):_r(t);return n.isEqual(Q.min())&&(n=_r(t)),new Cn(n,e.transformResults||[])}(e,t))):[]}(e.writeResults,e.commitTime),n=_r(e.commitTime);return this.listener.g_(n,t)}p_(){const e={};e.database=Ar(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>Lr(this.serializer,e))};this.a_(t)}}class Ki extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.y_=!1}w_(){if(this.y_)throw new R(L.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,r){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(i=>{let[s,a]=i;return this.connection.Mo(e,Nr(t,n),r,s,a)}).catch(e=>{throw"FirebaseError"===e.name?(e.code===L.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new R(L.UNKNOWN,e.toString())})}Lo(e,t,n,r,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(s=>{let[a,o]=s;return this.connection.Lo(e,Nr(t,n),r,a,o,i)}).catch(e=>{throw"FirebaseError"===e.name?(e.code===L.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new R(L.UNKNOWN,e.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class Hi{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){0===this.S_&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){"Online"===this.state?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_("Connection failed 1 times. Most recent error: ".concat(e.toString())),this.C_("Offline")))}set(e){this.x_(),this.S_=0,"Online"===e&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t="Could not reach Cloud Firestore backend. ".concat(e,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.D_?(E(t),this.D_=!1):j("OnlineStateTracker",t)}x_(){null!==this.b_&&(this.b_.cancel(),this.b_=null)}}class Wi{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(e=>{n.enqueueAndForget(async()=>{ts(this)&&(j("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=P(e);t.L_.add(4),await Zi(t),t.q_.set("Unknown"),t.L_.delete(4),await Gi(t)}(this))})}),this.q_=new Hi(n,r)}}async function Gi(e){if(ts(e))for(const t of e.B_)await t(!0)}async function Zi(e){for(const t of e.B_)await t(!1)}function Qi(e,t){const n=P(e);n.N_.has(t.targetId)||(n.N_.set(t.targetId,t),es(n)?$i(n):bs(n).r_()&&Yi(n,t))}function Ji(e,t){const n=P(e),r=bs(n);n.N_.delete(t),r.r_()&&Xi(n,t),0===n.N_.size&&(r.r_()?r.o_():ts(n)&&n.q_.set("Unknown"))}function Yi(e,t){if(e.Q_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Q.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}bs(e).A_(t)}function Xi(e,t){e.Q_.xe(t),bs(e).R_(t)}function $i(e){e.Q_=new dr({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),ot:t=>e.N_.get(t)||null,tt:()=>e.datastore.serializer.databaseId}),bs(e).start(),e.q_.v_()}function es(e){return ts(e)&&!bs(e).n_()&&e.N_.size>0}function ts(e){return 0===P(e).L_.size}function ns(e){e.Q_=void 0}async function rs(e){e.q_.set("Online")}async function is(e){e.N_.forEach((t,n)=>{Yi(e,t)})}async function ss(e,t){ns(e),es(e)?(e.q_.M_(t),$i(e)):e.q_.set("Unknown")}async function as(e,t,n){if(e.q_.set("Online"),t instanceof cr&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.N_.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.N_.delete(r),e.Q_.removeTarget(r))}(e,t)}catch(n){j("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await os(e,n)}else if(t instanceof or?e.Q_.Ke(t):t instanceof lr?e.Q_.He(t):e.Q_.We(t),!n.isEqual(Q.min()))try{const t=await wi(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.Q_.rt(t);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.N_.get(r);i&&e.N_.set(r,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{const r=e.N_.get(t);if(!r)return;e.N_.set(t,r.withResumeToken(Ae.EMPTY_BYTE_STRING,r.snapshotVersion)),Xi(e,t);const i=new Wr(r.target,t,n,r.sequenceNumber);Yi(e,i)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){j("RemoteStore","Failed to raise snapshot:",t),await os(e,t)}}async function os(e,t,n){if(!de(t))throw t;e.L_.add(1),await Zi(e),e.q_.set("Offline"),n||(n=()=>wi(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{j("RemoteStore","Retrying IndexedDB access"),await n(),e.L_.delete(1),await Gi(e)})}function ls(e,t){return t().catch(n=>os(e,n,t))}async function cs(e){const t=P(e),n=ws(t);let r=t.O_.length>0?t.O_[t.O_.length-1].batchId:-1;for(;us(t);)try{const e=await ki(t.localStore,r);if(null===e){0===t.O_.length&&n.o_();break}r=e.batchId,ds(t,e)}catch(e){await os(t,e)}hs(t)&&ps(t)}function us(e){return ts(e)&&e.O_.length<10}function ds(e,t){e.O_.push(t);const n=ws(e);n.r_()&&n.V_&&n.m_(t.mutations)}function hs(e){return ts(e)&&!ws(e).n_()&&e.O_.length>0}function ps(e){ws(e).start()}async function fs(e){ws(e).p_()}async function ms(e){const t=ws(e);for(const n of e.O_)t.m_(n.mutations)}async function gs(e,t,n){const r=e.O_.shift(),i=Hn.from(r,t,n);await ls(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await cs(e)}async function vs(e,t){t&&ws(e).V_&&await async function(e,t){if(function(e){return Jn(e)&&e!==L.ABORTED}(t.code)){const n=e.O_.shift();ws(e).s_(),await ls(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await cs(e)}}(e,t),hs(e)&&ps(e)}async function ys(e,t){const n=P(e);n.asyncQueue.verifyOperationInProgress(),j("RemoteStore","RemoteStore received new credentials");const r=ts(n);n.L_.add(3),await Zi(n),r&&n.q_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.L_.delete(3),await Gi(n)}async function xs(e,t){const n=P(e);t?(n.L_.delete(2),await Gi(n)):t||(n.L_.add(2),await Zi(n),n.q_.set("Unknown"))}function bs(e){return e.K_||(e.K_=function(e,t,n){const r=P(e);return r.w_(),new Vi(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Eo:rs.bind(null,e),Ro:is.bind(null,e),mo:ss.bind(null,e),d_:as.bind(null,e)}),e.B_.push(async t=>{t?(e.K_.s_(),es(e)?$i(e):e.q_.set("Unknown")):(await e.K_.stop(),ns(e))})),e.K_}function ws(e){return e.U_||(e.U_=function(e,t,n){const r=P(e);return r.w_(),new qi(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Eo:()=>Promise.resolve(),Ro:fs.bind(null,e),mo:vs.bind(null,e),f_:ms.bind(null,e),g_:gs.bind(null,e)}),e.B_.push(async t=>{t?(e.U_.s_(),await cs(e)):(await e.U_.stop(),e.O_.length>0&&(j("RemoteStore","Stopping write stream with ".concat(e.O_.length," pending writes")),e.O_=[]))})),e.U_}class _s{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new O,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,a=new _s(e,t,s,r,i);return a.start(n),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new R(L.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ks(e,t){if(E("AsyncQueue","".concat(t,": ").concat(e)),de(e))return new R(L.UNAVAILABLE,"".concat(t,": ").concat(e));throw e}class Ns{constructor(e){this.comparator=e?(t,n)=>e(t,n)||ee.comparator(t.key,n.key):(e,t)=>ee.comparator(e.key,t.key),this.keyedMap=tn(),this.sortedSet=new ke(this.comparator)}static emptySet(e){return new Ns(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Ns))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Ns;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Ss{constructor(){this.W_=new ke(ee.comparator)}track(e){const t=e.doc.key,n=this.W_.get(t);n?0!==e.type&&3===n.type?this.W_=this.W_.insert(t,e):3===e.type&&1!==n.type?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.W_=this.W_.remove(t):1===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):A():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,n)=>{e.push(n)}),e}}class js{constructor(e,t,n,r,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new js(e,t,Ns.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Kt(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}class Es{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class Cs{constructor(){this.queries=Ts(),this.onlineState="Unknown",this.Y_=new Set}terminate(){!function(e,t){const n=P(e),r=n.queries;n.queries=Ts(),r.forEach((e,n)=>{for(const r of n.j_)r.onError(t)})}(this,new R(L.ABORTED,"Firestore shutting down"))}}function Ts(){return new Yt(e=>Ht(e),Kt)}async function As(e,t){const n=P(e);let r=3;const i=t.query;let s=n.queries.get(i);s?!s.H_()&&t.J_()&&(r=2):(s=new Es,r=t.J_()?0:1);try{switch(r){case 0:s.z_=await n.onListen(i,!0);break;case 1:s.z_=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(e){const n=ks(e,"Initialization of query '".concat(Wt(t.query),"' failed"));return void t.onError(n)}n.queries.set(i,s),s.j_.push(t),t.Z_(n.onlineState),s.z_&&t.X_(s.z_)&&Rs(n)}async function Is(e,t){const n=P(e),r=t.query;let i=3;const s=n.queries.get(r);if(s){const e=s.j_.indexOf(t);e>=0&&(s.j_.splice(e,1),0===s.j_.length?i=t.J_()?0:1:!s.H_()&&t.J_()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function Ps(e,t){const n=P(e);let r=!1;for(const i of t){const e=i.query,t=n.queries.get(e);if(t){for(const e of t.j_)e.X_(i)&&(r=!0);t.z_=i}}r&&Rs(n)}function Ls(e,t,n){const r=P(e),i=r.queries.get(t);if(i)for(const s of i.j_)s.onError(n);r.queries.delete(t)}function Rs(e){e.Y_.forEach(e=>{e.next()})}var Os,Ms;(Ms=Os||(Os={})).ea="default",Ms.Cache="cache";class Ds{constructor(e,t,n){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new js(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache)return!0;if(!this.J_())return!0;const n="Offline"!==t;return(!this.options._a||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}oa(e){e=js.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Os.Cache}}class Fs{constructor(e){this.key=e}}class zs{constructor(e){this.key=e}}class Us{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=cn(),this.mutatedKeys=cn(),this.Aa=Qt(e),this.Ra=new Ns(this.Aa)}get Va(){return this.Ta}ma(e,t){const n=t?t.fa:new Ss,r=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,a=!1;const o="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,l="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{const c=r.get(e),u=Gt(this.query,t)?t:null,d=!!c&&this.mutatedKeys.has(c.key),h=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let p=!1;c&&u?c.data.isEqual(u.data)?d!==h&&(n.track({type:3,doc:u}),p=!0):this.ga(c,u)||(n.track({type:2,doc:u}),p=!0,(o&&this.Aa(u,o)>0||l&&this.Aa(u,l)<0)&&(a=!0)):!c&&u?(n.track({type:0,doc:u}),p=!0):c&&!u&&(n.track({type:1,doc:c}),p=!0,(o||l)&&(a=!0)),p&&(u?(s=s.add(u),i=h?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{Ra:s,fa:n,ns:a,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const s=e.fa.G_();s.sort((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return A()}};return n(e)-n(t)}(e.type,t.type)||this.Aa(e.doc,t.doc)),this.pa(n),r=null!=r&&r;const a=t&&!r?this.ya():[],o=0===this.da.size&&this.current&&!r?1:0,l=o!==this.Ea;return this.Ea=o,0!==s.length||l?{snapshot:new js(this.query,e.Ra,i,s,e.mutatedKeys,0===o,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:a}:{wa:a}}Z_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Ss,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(e=>this.Ta=this.Ta.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ta=this.Ta.delete(e)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=cn(),this.Ra.forEach(e=>{this.Sa(e.key)&&(this.da=this.da.add(e.key))});const t=[];return e.forEach(e=>{this.da.has(e)||t.push(new zs(e))}),this.da.forEach(n=>{e.has(n)||t.push(new Fs(n))}),t}ba(e){this.Ta=e.Ts,this.da=cn();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return js.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,0===this.Ea,this.hasCachedResults)}}class Bs{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Vs{constructor(e){this.key=e,this.va=!1}}class qs{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Ca={},this.Fa=new Yt(e=>Ht(e),Kt),this.Ma=new Map,this.xa=new Set,this.Oa=new ke(ee.comparator),this.Na=new Map,this.La=new ai,this.Ba={},this.ka=new Map,this.qa=$r.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return!0===this.Qa}}async function Ks(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=da(e);let i;const s=r.Fa.get(t);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Da()):i=await Ws(r,t,n,!0),i}async function Hs(e,t){const n=da(e);await Ws(n,t,!0,!1)}async function Ws(e,t,n,r){const i=await Ni(e.localStore,Ut(t)),s=i.targetId,a=e.sharedClientState.addLocalQueryTarget(s,n);let o;return r&&(o=await Gs(e,t,s,"current"===a,i.resumeToken)),e.isPrimaryClient&&n&&Qi(e.remoteStore,i),o}async function Gs(e,t,n,r,i){e.Ka=(t,n,r)=>async function(e,t,n,r){let i=t.view.ma(n);i.ns&&(i=await ji(e.localStore,t.query,!1).then(e=>{let{documents:n}=e;return t.view.ma(n,i)}));const s=r&&r.targetChanges.get(t.targetId),a=r&&null!=r.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return sa(e,t.targetId,o.wa),o.snapshot}(e,t,n,r);const s=await ji(e.localStore,t,!0),a=new Us(t,s.Ts),o=a.ma(s.documents),l=ar.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),c=a.applyChanges(o,e.isPrimaryClient,l);sa(e,n,c.wa);const u=new Bs(t,n,a);return e.Fa.set(t,u),e.Ma.has(n)?e.Ma.get(n).push(t):e.Ma.set(n,[t]),c.snapshot}async function Zs(e,t,n){const r=P(e),i=r.Fa.get(t),s=r.Ma.get(i.targetId);if(s.length>1)return r.Ma.set(i.targetId,s.filter(e=>!Kt(e,t))),void r.Fa.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await Si(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),n&&Ji(r.remoteStore,i.targetId),ra(r,i.targetId)}).catch(le)):(ra(r,i.targetId),await Si(r.localStore,i.targetId,!0))}async function Qs(e,t){const n=P(e),r=n.Fa.get(t),i=n.Ma.get(r.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),Ji(n.remoteStore,r.targetId))}async function Js(e,t){const n=P(e);try{const e=await function(e,t){const n=P(e),r=t.snapshotVersion;let i=n.os;return n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const s=n.cs.newChangeBuffer({trackRemovals:!0});i=n.os;const a=[];t.targetChanges.forEach((s,o)=>{const l=i.get(o);if(!l)return;a.push(n.Ur.removeMatchingKeys(e,s.removedDocuments,o).next(()=>n.Ur.addMatchingKeys(e,s.addedDocuments,o)));let c=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?c=c.withResumeToken(Ae.EMPTY_BYTE_STRING,Q.min()).withLastLimboFreeSnapshotVersion(Q.min()):s.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(s.resumeToken,r)),i=i.insert(o,c),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(l,c,s)&&a.push(n.Ur.updateTargetData(e,c))});let o=$t(),l=cn();if(t.documentUpdates.forEach(r=>{t.resolvedLimboDocuments.has(r)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),a.push(_i(e,s,t.documentUpdates).next(e=>{o=e.Ps,l=e.Is})),!r.isEqual(Q.min())){const t=n.Ur.getLastRemoteSnapshotVersion(e).next(t=>n.Ur.setTargetsMetadata(e,e.currentSequenceNumber,r));a.push(t)}return ce.waitFor(a).next(()=>s.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(n.os=i,e))}(n.localStore,t);t.targetChanges.forEach((e,t)=>{const r=n.Na.get(t);r&&(I(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.va=!0:e.modifiedDocuments.size>0?I(r.va):e.removedDocuments.size>0&&(I(r.va),r.va=!1))}),await la(n,e,t)}catch(e){await le(e)}}function Ys(e,t,n){const r=P(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.Fa.forEach((n,r)=>{const i=r.view.Z_(t);i.snapshot&&e.push(i.snapshot)}),function(e,t){const n=P(e);n.onlineState=t;let r=!1;n.queries.forEach((e,n)=>{for(const i of n.j_)i.Z_(t)&&(r=!0)}),r&&Rs(n)}(r.eventManager,t),e.length&&r.Ca.d_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Xs(e,t,n){const r=P(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Na.get(t),s=i&&i.key;if(s){let e=new ke(ee.comparator);e=e.insert(s,at.newNoDocument(s,Q.min()));const n=cn().add(s),i=new sr(Q.min(),new Map,new ke(W),e,n);await Js(r,i),r.Oa=r.Oa.remove(s),r.Na.delete(t),oa(r)}else await Si(r.localStore,t,!1).then(()=>ra(r,t,n)).catch(le)}async function $s(e,t){const n=P(e),r=t.batch.batchId;try{const e=await function(e,t){const n=P(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const r=t.batch.keys(),i=n.cs.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let a=ce.resolve();return s.forEach(e=>{a=a.next(()=>r.getEntry(t,e)).next(t=>{const s=n.docVersions.get(e);I(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,i))}(n,e,t,i).next(()=>i.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=cn();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,r))})}(n.localStore,t);na(n,r,null),ta(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await la(n,e)}catch(e){await le(e)}}async function ea(e,t,n){const r=P(e);try{const e=await function(e,t){const n=P(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next(t=>(I(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t))).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>n.localDocuments.getDocuments(e,r))})}(r.localStore,t);na(r,t,n),ta(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await la(r,e)}catch(n){await le(n)}}function ta(e,t){(e.ka.get(t)||[]).forEach(e=>{e.resolve()}),e.ka.delete(t)}function na(e,t,n){const r=P(e);let i=r.Ba[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Ba[r.currentUser.toKey()]=i}}function ra(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Ma.get(t))e.Fa.delete(r),n&&e.Ca.$a(r,n);e.Ma.delete(t),e.isPrimaryClient&&e.La.gr(t).forEach(t=>{e.La.containsKey(t)||ia(e,t)})}function ia(e,t){e.xa.delete(t.path.canonicalString());const n=e.Oa.get(t);null!==n&&(Ji(e.remoteStore,n),e.Oa=e.Oa.remove(t),e.Na.delete(n),oa(e))}function sa(e,t,n){for(const r of n)r instanceof Fs?(e.La.addReference(r.key,t),aa(e,r)):r instanceof zs?(j("SyncEngine","Document no longer in limbo: "+r.key),e.La.removeReference(r.key,t),e.La.containsKey(r.key)||ia(e,r.key)):A()}function aa(e,t){const n=t.key,r=n.path.canonicalString();e.Oa.get(n)||e.xa.has(r)||(j("SyncEngine","New document in limbo: "+n),e.xa.add(r),oa(e))}function oa(e){for(;e.xa.size>0&&e.Oa.size<e.maxConcurrentLimboResolutions;){const t=e.xa.values().next().value;e.xa.delete(t);const n=new ee(Y.fromString(t)),r=e.qa.next();e.Na.set(r,new Vs(n)),e.Oa=e.Oa.insert(n,r),Qi(e.remoteStore,new Wr(Ut(Mt(n.path)),r,"TargetPurposeLimboResolution",he.oe))}}async function la(e,t,n){const r=P(e),i=[],s=[],a=[];r.Fa.isEmpty()||(r.Fa.forEach((e,o)=>{a.push(r.Ka(o,t,n).then(e=>{var t;if((e||n)&&r.isPrimaryClient){const i=e?!e.fromCache:null===(t=null==n?void 0:n.targetChanges.get(o.targetId))||void 0===t?void 0:t.current;r.sharedClientState.updateQueryState(o.targetId,i?"current":"not-current")}if(e){i.push(e);const t=mi.Wi(o.targetId,e);s.push(t)}}))}),await Promise.all(a),r.Ca.d_(i),await async function(e,t){const n=P(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>ce.forEach(t,t=>ce.forEach(t.$i,r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r)).next(()=>ce.forEach(t.Ui,r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))}catch(e){if(!de(e))throw e;j("LocalStore","Failed to update sequence numbers: "+e)}for(const r of t){const e=r.targetId;if(!r.fromCache){const t=n.os.get(e),r=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(r);n.os=n.os.insert(e,i)}}}(r.localStore,s))}async function ca(e,t){const n=P(e);if(!n.currentUser.isEqual(t)){j("SyncEngine","User change. New user:",t.toKey());const e=await bi(n.localStore,t);n.currentUser=t,function(e,t){e.ka.forEach(e=>{e.forEach(e=>{e.reject(new R(L.CANCELLED,t))})}),e.ka.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await la(n,e.hs)}}function ua(e,t){const n=P(e),r=n.Na.get(t);if(r&&r.va)return cn().add(r.key);{let e=cn();const r=n.Ma.get(t);if(!r)return e;for(const t of r){const r=n.Fa.get(t);e=e.unionWith(r.view.Va)}return e}}function da(e){const t=P(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Js.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=ua.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Xs.bind(null,t),t.Ca.d_=Ps.bind(null,t.eventManager),t.Ca.$a=Ls.bind(null,t.eventManager),t}function ha(e){const t=P(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=$s.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=ea.bind(null,t),t}class pa{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=zi(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return xi(this.persistence,new vi,e.initialUser,this.serializer)}Ga(e){return new hi(fi.Zr,this.serializer)}Wa(e){return new Ti}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}pa.provider={build:()=>new pa};class fa{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Ys(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=ca.bind(null,this.syncEngine),await xs(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Cs}createDatastore(e){const t=zi(e.databaseInfo.databaseId),n=function(e){return new Di(e)}(e.databaseInfo);return function(e,t,n,r){return new Ki(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,r,i){return new Wi(e,t,n,r,i)}(this.localStore,this.datastore,e.asyncQueue,e=>Ys(this.syncEngine,e,0),Ii.D()?new Ii:new Ai)}createSyncEngine(e,t){return function(e,t,n,r,i,s,a){const o=new qs(e,t,n,r,i,s);return a&&(o.Qa=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){const t=P(e);j("RemoteStore","RemoteStore shutting down."),t.L_.add(5),await Zi(t),t.k_.shutdown(),t.q_.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()}}fa.provider={build:()=>new fa};class ma{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):E("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class ga{constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=_.UNAUTHENTICATED,this.clientId=H.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async e=>{j("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(j("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new O;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=ks(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function va(e,t){e.asyncQueue.verifyOperationInProgress(),j("FirestoreClient","Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await bi(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function ya(e,t){e.asyncQueue.verifyOperationInProgress();const n=await xa(e);j("FirestoreClient","Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>ys(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>ys(t.remoteStore,n)),e._onlineComponents=t}async function xa(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){j("FirestoreClient","Using user provided OfflineComponentProvider");try{await va(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!function(e){return"FirebaseError"===e.name?e.code===L.FAILED_PRECONDITION||e.code===L.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(n))throw n;C("Error using user provided cache. Falling back to memory cache: "+n),await va(e,new pa)}}else j("FirestoreClient","Using default OfflineComponentProvider"),await va(e,new pa);return e._offlineComponents}async function ba(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(j("FirestoreClient","Using user provided OnlineComponentProvider"),await ya(e,e._uninitializedComponentsProvider._online)):(j("FirestoreClient","Using default OnlineComponentProvider"),await ya(e,new fa))),e._onlineComponents}function wa(e){return ba(e).then(e=>e.syncEngine)}async function _a(e){const t=await ba(e),n=t.eventManager;return n.onListen=Ks.bind(null,t.syncEngine),n.onUnlisten=Zs.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=Hs.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=Qs.bind(null,t.syncEngine),n}function ka(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=new O;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,r,i){const s=new ma({next:o=>{s.Za(),t.enqueueAndForget(()=>Is(e,a));const l=o.docs.has(n);!l&&o.fromCache?i.reject(new R(L.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&o.fromCache&&r&&"server"===r.source?i.reject(new R(L.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:e=>i.reject(e)}),a=new Ds(Mt(n.path),s,{includeMetadataChanges:!0,_a:!0});return As(e,a)}(await _a(e),e.asyncQueue,t,n,r)),r.promise}function Na(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=new O;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,n,r,i){const s=new ma({next:n=>{s.Za(),t.enqueueAndForget(()=>Is(e,a)),n.fromCache&&"server"===r.source?i.reject(new R(L.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),a=new Ds(n,s,{includeMetadataChanges:!0,_a:!0});return As(e,a)}(await _a(e),e.asyncQueue,t,n,r)),r.promise}function Sa(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const ja=new Map;function Ea(e,t,n){if(!n)throw new R(L.INVALID_ARGUMENT,"Function ".concat(e,"() cannot be called with an empty ").concat(t,"."))}function Ca(e){if(!ee.isDocumentKey(e))throw new R(L.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(e," has ").concat(e.length,"."))}function Ta(e){if(ee.isDocumentKey(e))throw new R(L.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but ".concat(e," has ").concat(e.length,"."))}function Aa(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e="".concat(e.substring(0,20),"...")),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?"a custom ".concat(t," object"):"an object"}}return"function"==typeof e?"a function":A()}function Ia(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new R(L.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Aa(e);throw new R(L.INVALID_ARGUMENT,"Expected type '".concat(t.name,"', but it was: ").concat(n))}}return e}function Pa(e,t){if(t<=0)throw new R(L.INVALID_ARGUMENT,"Function ".concat(e,"() requires a positive number, but it was: ").concat(t,"."))}class La{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new R(L.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new R(L.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new R(L.INVALID_ARGUMENT,"".concat(e," and ").concat(n," cannot be used together."))})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Sa(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new R(L.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (must not be NaN)"));if(e.timeoutSeconds<5)throw new R(L.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (minimum allowed value is 5)"));if(e.timeoutSeconds>30)throw new R(L.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (maximum allowed value is 30)"))}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Ra{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new La({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new R(L.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new R(L.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new La(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new D;switch(e.type){case"firstParty":return new B(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new R(L.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=ja.get(e);t&&(j("ComponentProvider","Removing Datastore"),ja.delete(e),t.terminate())}(this),Promise.resolve()}}class Oa{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Oa(this.firestore,e,this._query)}}class Ma{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Da(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ma(this.firestore,e,this._key)}}class Da extends Oa{constructor(e,t,n){super(e,t,Mt(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ma(this.firestore,null,new ee(e))}withConverter(e){return new Da(this.firestore,e,this._path)}}function Fa(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=(0,l.Ku)(e),Ea("collection","path",t),e instanceof Ra){const n=Y.fromString(t,...r);return Ta(n),new Da(e,null,n)}{if(!(e instanceof Ma||e instanceof Da))throw new R(L.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(Y.fromString(t,...r));return Ta(n),new Da(e.firestore,null,n)}}function za(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=(0,l.Ku)(e),1===arguments.length&&(t=H.newId()),Ea("doc","path",t),e instanceof Ra){const n=Y.fromString(t,...r);return Ca(n),new Ma(e,null,new ee(n))}{if(!(e instanceof Ma||e instanceof Da))throw new R(L.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(Y.fromString(t,...r));return Ca(n),new Ma(e.firestore,e instanceof Da?e.converter:null,new ee(n))}}class Ua{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Promise.resolve();this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Ui(this,"async_queue_retry"),this.Vu=()=>{const e=Fi();e&&j("AsyncQueue","Visibility state changed to "+e.visibilityState),this.t_.jo()},this.mu=e;const t=Fi();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=Fi();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new O;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(0!==this.Pu.length){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!de(e))throw e;j("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(e=>{this.Eu=e,this.du=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw E("INTERNAL UNHANDLED ERROR: ",t),e}).then(e=>(this.du=!1,e))));return this.mu=t,t}enqueueAfterDelay(e,t,n){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const r=_s.createAndSchedule(this,e,t,n,e=>this.yu(e));return this.Tu.push(r),r}fu(){this.Eu&&A()}verifyOperationInProgress(){}async wu(){let e;do{e=this.mu,await e}while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function Ba(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const r of t)if(r in n&&"function"==typeof n[r])return!0;return!1}(e,["next","error","complete"])}class Va extends Ra{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new Ua,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Ua(e),this._firestoreClient=void 0,await e}}}function qa(e,t){const n="object"==typeof e?e:(0,s.Sx)(),r="string"==typeof e?e:t||"(default)",i=(0,s.j6)(n,"firestore").getImmediate({identifier:r});if(!i._initialized){const e=(0,l.yU)("firestore");e&&function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};var i;const s=(e=Ia(e,Ra))._getSettings(),a="".concat(t,":").concat(n);if("firestore.googleapis.com"!==s.host&&s.host!==a&&C("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=_.MOCK_USER;else{t=(0,l.Fy)(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new R(L.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new _(s)}e._authCredentials=new F(new M(t,n))}}(i,...e)}return i}function Ka(e){if(e._terminated)throw new R(L.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||Ha(e),e._firestoreClient}function Ha(e){var t,n,r;const i=e._freezeSettings(),s=function(e,t,n,r){return new Fe(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,Sa(r.experimentalLongPollingOptions),r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._componentsProvider||(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),e._firestoreClient=new ga(e._authCredentials,e._appCheckCredentials,e._queue,s,e._componentsProvider&&function(e){const t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}class Wa{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Wa(Ae.fromBase64String(e))}catch(e){throw new R(L.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Wa(Ae.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Ga{constructor(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(let r=0;r<t.length;++r)if(0===t[r].length)throw new R(L.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new $(t)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function Za(){return new Ga("__name__")}class Qa{constructor(e){this._methodName=e}}class Ja{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new R(L.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new R(L.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return W(this._lat,e._lat)||W(this._long,e._long)}}class Ya{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}}const Xa=/^__.*__$/;class $a{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Fn(e,this.data,this.fieldMask,t,this.fieldTransforms):new Dn(e,this.data,t,this.fieldTransforms)}}class eo{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Fn(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function to(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw A()}}class no{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new no(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Fu({path:n,xu:!1});return r.Ou(e),r}Nu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Fu({path:n,xu:!1});return r.vu(),r}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return xo(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(0===e.length)throw this.Bu("Document fields must not be empty");if(to(this.Cu)&&Xa.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class ro{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||zi(e)}Qu(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new no({Cu:e,methodName:t,qu:n,path:$.emptyPath(),xu:!1,ku:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function io(e){const t=e._freezeSettings(),n=zi(e._databaseId);return new ro(e._databaseId,!!t.ignoreUndefinedProperties,n)}function so(e,t,n,r,i){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const a=e.Qu(s.merge||s.mergeFields?2:0,t,n,i);mo("Data must be an object, but it was:",a,r);const o=po(r,a);let l,c;if(s.merge)l=new Ce(a.fieldMask),c=a.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=go(t,r,n);if(!a.contains(i))throw new R(L.INVALID_ARGUMENT,"Field '".concat(i,"' is specified in your field mask but missing from your input data."));bo(e,i)||e.push(i)}l=new Ce(e),c=a.fieldTransforms.filter(e=>l.covers(e.field))}else l=null,c=a.fieldTransforms;return new $a(new it(o),l,c)}class ao extends Qa{_toFieldTransform(e){if(2!==e.Cu)throw 1===e.Cu?e.Bu("".concat(this._methodName,"() can only appear at the top level of your update data")):e.Bu("".concat(this._methodName,"() cannot be used with set() unless you pass {merge:true}"));return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof ao}}class oo extends Qa{_toFieldTransform(e){return new En(e.path,new xn)}isEqual(e){return e instanceof oo}}function lo(e,t,n,r){const i=e.Qu(1,t,n);mo("Data must be an object, but it was:",i,r);const s=[],a=it.empty();we(r,(e,r)=>{const o=yo(t,e,n);r=(0,l.Ku)(r);const c=i.Nu(o);if(r instanceof ao)s.push(o);else{const e=ho(r,c);null!=e&&(s.push(o),a.set(o,e))}});const o=new Ce(s);return new eo(a,o,i.fieldTransforms)}function co(e,t,n,r,i,s){const a=e.Qu(1,t,n),o=[go(t,r,n)],c=[i];if(s.length%2!=0)throw new R(L.INVALID_ARGUMENT,"Function ".concat(t,"() needs to be called with an even number of arguments that alternate between field names and values."));for(let l=0;l<s.length;l+=2)o.push(go(t,s[l])),c.push(s[l+1]);const u=[],d=it.empty();for(let p=o.length-1;p>=0;--p)if(!bo(u,o[p])){const e=o[p];let t=c[p];t=(0,l.Ku)(t);const n=a.Nu(e);if(t instanceof ao)u.push(e);else{const r=ho(t,n);null!=r&&(u.push(e),d.set(e,r))}}const h=new Ce(u);return new eo(d,h,a.fieldTransforms)}function uo(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return ho(n,e.Qu(r?4:3,t))}function ho(e,t){if(fo(e=(0,l.Ku)(e)))return mo("Unsupported field value:",t,e),po(e,t);if(e instanceof Qa)return function(e,t){if(!to(t.Cu))throw t.Bu("".concat(e._methodName,"() can only be used with update() and set()"));if(!t.path)throw t.Bu("".concat(e._methodName,"() is not currently supported inside arrays"));const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.xu&&4!==t.Cu)throw t.Bu("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=ho(i,t.Lu(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=(0,l.Ku)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return fn(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=Z.fromDate(e);return{timestampValue:xr(t.serializer,n)}}if(e instanceof Z){const n=new Z(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:xr(t.serializer,n)}}if(e instanceof Ja)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Wa)return{bytesValue:br(t.serializer,e._byteString)};if(e instanceof Ma){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Bu("Document reference is for database ".concat(r.projectId,"/").concat(r.database," but should be for database ").concat(n.projectId,"/").concat(n.database));return{referenceValue:kr(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof Ya)return function(e,t){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.Bu("VectorValues must only contain numeric values.");return hn(t.serializer,e)})}}}}}}(e,t);throw t.Bu("Unsupported field value: ".concat(Aa(e)))}(e,t)}function po(e,t){const n={};return _e(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):we(e,(e,r)=>{const i=ho(r,t.Mu(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function fo(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Z||e instanceof Ja||e instanceof Wa||e instanceof Ma||e instanceof Qa||e instanceof Ya)}function mo(e,t,n){if(!fo(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=Aa(n);throw"an object"===r?t.Bu(e+" a custom object"):t.Bu(e+" "+r)}}function go(e,t,n){if((t=(0,l.Ku)(t))instanceof Ga)return t._internalPath;if("string"==typeof t)return yo(e,t);throw xo("Field path arguments must be of type string or ",e,!1,void 0,n)}const vo=new RegExp("[~\\*/\\[\\]]");function yo(e,t,n){if(t.search(vo)>=0)throw xo("Invalid field path (".concat(t,"). Paths must not contain '~', '*', '/', '[', or ']'"),e,!1,void 0,n);try{return new Ga(...t.split("."))._internalPath}catch(r){throw xo("Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),e,!1,void 0,n)}}function xo(e,t,n,r,i){const s=r&&!r.isEmpty(),a=void 0!==i;let o="Function ".concat(t,"() called with invalid data");n&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=" in field ".concat(r)),a&&(l+=" in document ".concat(i)),l+=")"),new R(L.INVALID_ARGUMENT,o+e+l)}function bo(e,t){return e.some(e=>e.isEqual(t))}class wo{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Ma(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new _o(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(ko("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class _o extends wo{data(){return super.data()}}function ko(e,t){return"string"==typeof t?yo(e,t):t instanceof Ga?t._internalPath:t._delegate._internalPath}function No(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new R(L.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class So{}class jo extends So{}function Eo(e,t){let n=[];for(var r=arguments.length,i=new Array(r>2?r-2:0),s=2;s<r;s++)i[s-2]=arguments[s];t instanceof So&&n.push(t),n=n.concat(i),function(e){const t=e.filter(e=>e instanceof Ao).length,n=e.filter(e=>e instanceof Co).length;if(t>1||t>0&&n>0)throw new R(L.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const a of n)e=a._apply(e);return e}class Co extends jo{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new Co(e,t,n)}_apply(e){const t=this._parse(e);return Do(e._query,t),new Oa(e.firestore,e.converter,Vt(e._query,t))}_parse(e){const t=io(e.firestore),n=function(e,t,n,r,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new R(L.INVALID_ARGUMENT,"Invalid Query. You can't perform '".concat(s,"' queries on documentId()."));if("in"===s||"not-in"===s){Mo(a,s);const t=[];for(const n of a)t.push(Oo(r,e,n));o={arrayValue:{values:t}}}else o=Oo(r,e,a)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||Mo(a,s),o=uo(n,t,a,"in"===s||"not-in"===s);return pt.create(i,s,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value);return n}}function To(e,t,n){const r=t,i=ko("where",e);return Co._create(i,r,n)}class Ao extends So{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Ao(e,t)}_parse(e){const t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:ft.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const i of r)Do(n,i),n=Vt(n,i)}(e._query,t),new Oa(e.firestore,e.converter,Vt(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Io extends jo{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Io(e,t)}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new R(L.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new R(L.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ut(t,n)}(e._query,this._field,this._direction);return new Oa(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new Rt(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function Po(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",n=ko("orderBy",e);return Io._create(n,t)}class Lo extends jo{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new Lo(e,t,n)}_apply(e){return new Oa(e.firestore,e.converter,qt(e._query,this._limit,this._limitType))}}function Ro(e){return Pa("limit",e),Lo._create("limit",e,"F")}function Oo(e,t,n){if("string"==typeof(n=(0,l.Ku)(n))){if(""===n)throw new R(L.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ft(t)&&-1!==n.indexOf("/"))throw new R(L.INVALID_ARGUMENT,"Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '".concat(n,"' contains a '/' character."));const r=t.path.child(Y.fromString(n));if(!ee.isDocumentKey(r))throw new R(L.INVALID_ARGUMENT,"Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '".concat(r,"' is not because it has an odd number of segments (").concat(r.length,")."));return Qe(e,new ee(r))}if(n instanceof Ma)return Qe(e,n._key);throw new R(L.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ".concat(Aa(n),"."))}function Mo(e,t){if(!Array.isArray(e)||0===e.length)throw new R(L.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '".concat(t.toString(),"' filters."))}function Do(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new R(L.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '".concat(t.op.toString(),"' filter.")):new R(L.INVALID_ARGUMENT,"Invalid query. You cannot use '".concat(t.op.toString(),"' filters with '").concat(n.toString(),"' filters."))}class Fo{convertValue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(Be(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Le(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Re(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw A()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";const n={};return we(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertVectorValue(e){var t,n,r;const i=null===(r=null===(n=null===(t=e.fields)||void 0===t?void 0:t.value.arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.map(e=>Le(e.doubleValue));return new Ya(i)}convertGeoPoint(e){return new Ja(Le(e.latitude),Le(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Me(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(De(e));default:return null}}convertTimestamp(e){const t=Pe(e);return new Z(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=Y.fromString(e);I(Hr(n));const r=new ze(n.get(1),n.get(3)),i=new ee(n.popFirst(5));return r.isEqual(t)||E("Document ".concat(i," contains a document reference within a different database (").concat(r.projectId,"/").concat(r.database,") which is not supported. It will be treated as a reference in the current database (").concat(t.projectId,"/").concat(t.database,") instead.")),i}}function zo(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class Uo{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Bo extends wo{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){const t=new Vo(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){const n=this._document.data.field(ko("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Vo extends Bo{data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return super.data(e)}}class qo{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Uo(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new Vo(this._firestore,this._userDataWriter,n.key,n,new Uo(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(){const e=!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new R(L.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{const r=new Vo(e._firestore,e._userDataWriter,n.doc.key,n.doc,new Uo(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const r=new Vo(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Uo(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:Ko(t.type),doc:r,oldIndex:i,newIndex:s}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function Ko(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return A()}}function Ho(e){e=Ia(e,Ma);const t=Ia(e.firestore,Va);return ka(Ka(t),e._key).then(n=>el(t,e,n))}class Wo extends Fo{constructor(e){super(),this.firestore=e}convertBytes(e){return new Wa(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ma(this.firestore,null,t)}}function Go(e){e=Ia(e,Oa);const t=Ia(e.firestore,Va),n=Ka(t),r=new Wo(t);return No(e._query),Na(n,e._query).then(n=>new qo(t,r,e,n))}function Zo(e,t,n){e=Ia(e,Ma);const r=Ia(e.firestore,Va),i=zo(e.converter,t,n);return $o(r,[so(io(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Tn.none())])}function Qo(e,t,n){e=Ia(e,Ma);const r=Ia(e.firestore,Va),i=io(r);let s;for(var a=arguments.length,o=new Array(a>3?a-3:0),c=3;c<a;c++)o[c-3]=arguments[c];return s="string"==typeof(t=(0,l.Ku)(t))||t instanceof Ga?co(i,"updateDoc",e._key,t,n,o):lo(i,"updateDoc",e._key,t),$o(r,[s.toMutation(e._key,Tn.exists(!0))])}function Jo(e){return $o(Ia(e.firestore,Va),[new Vn(e._key,Tn.none())])}function Yo(e,t){const n=Ia(e.firestore,Va),r=za(e),i=zo(e.converter,t);return $o(n,[so(io(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,Tn.exists(!1))]).then(()=>r)}function Xo(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i,s,a;e=(0,l.Ku)(e);let o={includeMetadataChanges:!1,source:"default"},c=0;"object"!=typeof n[c]||Ba(n[c])||(o=n[c],c++);const u={includeMetadataChanges:o.includeMetadataChanges,source:o.source};if(Ba(n[c])){const e=n[c];n[c]=null===(i=e.next)||void 0===i?void 0:i.bind(e),n[c+1]=null===(s=e.error)||void 0===s?void 0:s.bind(e),n[c+2]=null===(a=e.complete)||void 0===a?void 0:a.bind(e)}let d,h,p;if(e instanceof Ma)h=Ia(e.firestore,Va),p=Mt(e._key.path),d={next:t=>{n[c]&&n[c](el(h,e,t))},error:n[c+1],complete:n[c+2]};else{const t=Ia(e,Oa);h=Ia(t.firestore,Va),p=t._query;const r=new Wo(h);d={next:e=>{n[c]&&n[c](new qo(h,r,t,e))},error:n[c+1],complete:n[c+2]},No(e._query)}return function(e,t,n,r){const i=new ma(r),s=new Ds(t,i,n);return e.asyncQueue.enqueueAndForget(async()=>As(await _a(e),s)),()=>{i.Za(),e.asyncQueue.enqueueAndForget(async()=>Is(await _a(e),s))}}(Ka(h),p,u,d)}function $o(e,t){return function(e,t){const n=new O;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){const r=ha(e);try{const e=await function(e,t){const n=P(e),r=Z.now(),i=t.reduce((e,t)=>e.add(t.key),cn());let s,a;return n.persistence.runTransaction("Locally write mutations","readwrite",e=>{let o=$t(),l=cn();return n.cs.getEntries(e,i).next(e=>{o=e,o.forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>n.localDocuments.getOverlayedDocuments(e,o)).next(i=>{s=i;const a=[];for(const e of t){const t=On(e,s.get(e.key).overlayedDocument);null!=t&&a.push(new Fn(e.key,t,st(t.value.mapValue),Tn.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,a,t)}).next(t=>{a=t;const r=t.applyToLocalDocumentSet(s,l);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)})}).then(()=>({batchId:a.batchId,changes:nn(s)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Ba[e.currentUser.toKey()];r||(r=new ke(W)),r=r.insert(t,n),e.Ba[e.currentUser.toKey()]=r}(r,e.batchId,n),await la(r,e.changes),await cs(r.remoteStore)}catch(e){const t=ks(e,"Failed to persist write");n.reject(t)}}(await wa(e),t,n)),n.promise}(Ka(e),t)}function el(e,t,n){const r=n.docs.get(t._key),i=new Wo(e);return new Bo(e,i,t._key,r,new Uo(n.hasPendingWrites,n.fromCache),t.converter)}class tl{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=io(e)}set(e,t,n){this._verifyNotCommitted();const r=nl(e,this._firestore),i=zo(r.converter,t,n),s=so(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,Tn.none())),this}update(e,t,n){this._verifyNotCommitted();const r=nl(e,this._firestore);let i;for(var s=arguments.length,a=new Array(s>3?s-3:0),o=3;o<s;o++)a[o-3]=arguments[o];return i="string"==typeof(t=(0,l.Ku)(t))||t instanceof Ga?co(this._dataReader,"WriteBatch.update",r._key,t,n,a):lo(this._dataReader,"WriteBatch.update",r._key,t),this._mutations.push(i.toMutation(r._key,Tn.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=nl(e,this._firestore);return this._mutations=this._mutations.concat(new Vn(t._key,Tn.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new R(L.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function nl(e,t){if((e=(0,l.Ku)(e)).firestore!==t)throw new R(L.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}function rl(){return new oo("serverTimestamp")}function il(e){return Ka(e=Ia(e,Va)),new tl(e,t=>$o(e,t))}new WeakMap;!function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(e){k=e}(s.MF),(0,s.om)(new a.uA("firestore",(e,n)=>{let{instanceIdentifier:r,options:i}=n;const s=e.getProvider("app").getImmediate(),a=new Va(new z(e.getProvider("auth-internal")),new q(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new R(L.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ze(e.options.projectId,t)}(s,r),s);return i=Object.assign({useFetchStreams:t},i),a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),(0,s.KO)(w,"4.7.3",e),(0,s.KO)(w,"4.7.3","esm2017")}()},5487:(e,t,n)=>{const r=n(8293);function i(e,t){const n=e.a/255,r=t+'="'+e.hex+'"';return n<1?r+" "+t+'-opacity="'+n.toFixed(2).slice(1)+'"':r}function s(e,t,n){let r=e+t;return"undefined"!==typeof n&&(r+=" "+n),r}t.render=function(e,t,n){const a=r.getOptions(t),o=e.modules.size,l=e.modules.data,c=o+2*a.margin,u=a.color.light.a?"<path "+i(a.color.light,"fill")+' d="M0 0h'+c+"v"+c+'H0z"/>':"",d="<path "+i(a.color.dark,"stroke")+' d="'+function(e,t,n){let r="",i=0,a=!1,o=0;for(let l=0;l<e.length;l++){const c=Math.floor(l%t),u=Math.floor(l/t);c||a||(a=!0),e[l]?(o++,l>0&&c>0&&e[l-1]||(r+=a?s("M",c+n,.5+u+n):s("m",i,0),i=0,a=!1),c+1<t&&e[l+1]||(r+=s("h",o),o=0)):i++}return r}(l,o,a.margin)+'"/>',h='viewBox="0 0 '+c+" "+c+'"',p='<svg xmlns="http://www.w3.org/2000/svg" '+(a.width?'width="'+a.width+'" height="'+a.width+'" ':"")+h+' shape-rendering="crispEdges">'+u+d+"</svg>\n";return"function"===typeof n&&n(null,p),p}},6116:e=>{e.exports=function(){return"function"===typeof Promise&&Promise.prototype&&Promise.prototype.then}},6272:(e,t)=>{t.L={bit:1},t.M={bit:0},t.Q={bit:3},t.H={bit:2},t.isValid=function(e){return e&&"undefined"!==typeof e.bit&&e.bit>=0&&e.bit<4},t.from=function(e,n){if(t.isValid(e))return e;try{return function(e){if("string"!==typeof e)throw new Error("Param is not a string");switch(e.toLowerCase()){case"l":case"low":return t.L;case"m":case"medium":return t.M;case"q":case"quartile":return t.Q;case"h":case"high":return t.H;default:throw new Error("Unknown EC Level: "+e)}}(e)}catch(r){return n}}},7150:(e,t,n)=>{"use strict";n.d(t,{MF:()=>de,j6:()=>ae,xZ:()=>oe,om:()=>se,Sx:()=>pe,Dk:()=>fe,Wp:()=>he,KO:()=>me});var r=n(8812),i=n(443),s=n(7700),a=n(2555);let o,l;const c=new WeakMap,u=new WeakMap,d=new WeakMap,h=new WeakMap,p=new WeakMap;let f={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return u.get(e);if("objectStoreNames"===t)return e.objectStoreNames||d.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return v(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function m(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(l||(l=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(y(this),n),v(c.get(this))}:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return v(e.apply(y(this),n))}:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];const s=e.call(y(this),t,...r);return d.set(s,t.sort?t.sort():[t]),v(s)}}function g(e){return"function"===typeof e?m(e):(e instanceof IDBTransaction&&function(e){if(u.has(e))return;const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});u.set(e,t)}(e),t=e,(o||(o=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>t instanceof e)?new Proxy(e,f):e);var t}function v(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(v(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&c.set(t,e)}).catch(()=>{}),p.set(t,e),t}(e);if(h.has(e))return h.get(e);const t=g(e);return t!==e&&(h.set(e,t),p.set(t,e)),t}const y=e=>p.get(e);const x=["get","getKey","getAll","getAllKeys","count"],b=["put","add","delete","clear"],w=new Map;function _(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!==typeof t)return;if(w.get(t))return w.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=b.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!x.includes(n))return;const s=async function(e){const t=this.transaction(e,i?"readwrite":"readonly");let s=t.store;for(var a=arguments.length,o=new Array(a>1?a-1:0),l=1;l<a;l++)o[l-1]=arguments[l];return r&&(s=s.index(o.shift())),(await Promise.all([s[n](...o),i&&t.done]))[0]};return w.set(t,s),s}f=(e=>(0,a.A)((0,a.A)({},e),{},{get:(t,n,r)=>_(t,n)||e.get(t,n,r),has:(t,n)=>!!_(t,n)||e.has(t,n)}))(f);class k{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){const t=e.getImmediate();return"".concat(t.library,"/").concat(t.version)}return null}).filter(e=>e).join(" ")}}const N="@firebase/app",S="0.10.13",j=new i.Vy("@firebase/app"),E="@firebase/app-compat",C="@firebase/analytics-compat",T="@firebase/analytics",A="@firebase/app-check-compat",I="@firebase/app-check",P="@firebase/auth",L="@firebase/auth-compat",R="@firebase/database",O="@firebase/data-connect",M="@firebase/database-compat",D="@firebase/functions",F="@firebase/functions-compat",z="@firebase/installations",U="@firebase/installations-compat",B="@firebase/messaging",V="@firebase/messaging-compat",q="@firebase/performance",K="@firebase/performance-compat",H="@firebase/remote-config",W="@firebase/remote-config-compat",G="@firebase/storage",Z="@firebase/storage-compat",Q="@firebase/firestore",J="@firebase/vertexai-preview",Y="@firebase/firestore-compat",X="firebase",$="[DEFAULT]",ee={[N]:"fire-core",[E]:"fire-core-compat",[T]:"fire-analytics",[C]:"fire-analytics-compat",[I]:"fire-app-check",[A]:"fire-app-check-compat",[P]:"fire-auth",[L]:"fire-auth-compat",[R]:"fire-rtdb",[O]:"fire-data-connect",[M]:"fire-rtdb-compat",[D]:"fire-fn",[F]:"fire-fn-compat",[z]:"fire-iid",[U]:"fire-iid-compat",[B]:"fire-fcm",[V]:"fire-fcm-compat",[q]:"fire-perf",[K]:"fire-perf-compat",[H]:"fire-rc",[W]:"fire-rc-compat",[G]:"fire-gcs",[Z]:"fire-gcs-compat",[Q]:"fire-fst",[Y]:"fire-fst-compat",[J]:"fire-vertex","fire-js":"fire-js",[X]:"fire-js-all"},te=new Map,ne=new Map,re=new Map;function ie(e,t){try{e.container.addComponent(t)}catch(n){j.debug("Component ".concat(t.name," failed to register with FirebaseApp ").concat(e.name),n)}}function se(e){const t=e.name;if(re.has(t))return j.debug("There were multiple attempts to register component ".concat(t,".")),!1;re.set(t,e);for(const n of te.values())ie(n,e);for(const n of ne.values())ie(n,e);return!0}function ae(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function oe(e){return void 0!==e.settings}const le={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ce=new s.FA("app","Firebase",le);class ue{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new r.uA("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ce.create("app-deleted",{appName:this._name})}}const de="10.14.1";function he(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;if("object"!==typeof t){t={name:t}}const i=Object.assign({name:$,automaticDataCollectionEnabled:!1},t),a=i.name;if("string"!==typeof a||!a)throw ce.create("bad-app-name",{appName:String(a)});if(n||(n=(0,s.T9)()),!n)throw ce.create("no-options");const o=te.get(a);if(o){if((0,s.bD)(n,o.options)&&(0,s.bD)(i,o.config))return o;throw ce.create("duplicate-app",{appName:a})}const l=new r.h1(a);for(const r of re.values())l.addComponent(r);const c=new ue(n,i,l);return te.set(a,c),c}function pe(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$;const t=te.get(e);if(!t&&e===$&&(0,s.T9)())return he();if(!t)throw ce.create("no-app",{appName:e});return t}function fe(){return Array.from(te.values())}function me(e,t,n){var i;let s=null!==(i=ee[e])&&void 0!==i?i:e;n&&(s+="-".concat(n));const a=s.match(/\s|\//),o=t.match(/\s|\//);if(a||o){const e=['Unable to register library "'.concat(s,'" with version "').concat(t,'":')];return a&&e.push('library name "'.concat(s,'" contains illegal characters (whitespace or "/")')),a&&o&&e.push("and"),o&&e.push('version name "'.concat(t,'" contains illegal characters (whitespace or "/")')),void j.warn(e.join(" "))}se(new r.uA("".concat(s,"-version"),()=>({library:s,version:t}),"VERSION"))}const ge="firebase-heartbeat-store";let ve=null;function ye(){return ve||(ve=function(e,t){let{blocked:n,upgrade:r,blocking:i,terminated:s}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=indexedDB.open(e,t),o=v(a);return r&&a.addEventListener("upgradeneeded",e=>{r(v(a.result),e.oldVersion,e.newVersion,v(a.transaction),e)}),n&&a.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(ge)}catch(n){console.warn(n)}}}).catch(e=>{throw ce.create("idb-open",{originalErrorMessage:e.message})})),ve}async function xe(e,t){try{const n=(await ye()).transaction(ge,"readwrite"),r=n.objectStore(ge);await r.put(t,be(e)),await n.done}catch(n){if(n instanceof s.g)j.warn(n.message);else{const e=ce.create("idb-set",{originalErrorMessage:null===n||void 0===n?void 0:n.message});j.warn(e.message)}}}function be(e){return"".concat(e.name,"!").concat(e.options.appId)}class we{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new ke(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=_e();if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(e=>e.date===r))return;return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6}),this._storage.overwrite(this._heartbeatsCache)}catch(n){j.warn(n)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=_e(),{heartbeatsToSend:n,unsentEntries:r}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;const n=[];let r=e.slice();for(const i of e){const e=n.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),Ne(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),Ne(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=(0,s.Uj)(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return j.warn(t),""}}}function _e(){return(new Date).toISOString().substring(0,10)}class ke{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,s.zW)()&&(0,s.eX)().then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await ye()).transaction(ge),n=await t.objectStore(ge).get(be(e));return await t.done,n}catch(t){if(t instanceof s.g)j.warn(t.message);else{const e=ce.create("idb-get",{originalErrorMessage:null===t||void 0===t?void 0:t.message});j.warn(e.message)}}}(this.app);return(null===e||void 0===e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return xe(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return xe(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function Ne(e){return(0,s.Uj)(JSON.stringify({version:2,heartbeats:e})).length}var Se;Se="",se(new r.uA("platform-logger",e=>new k(e),"PRIVATE")),se(new r.uA("heartbeat",e=>new we(e),"PRIVATE")),me(N,S,Se),me(N,S,"esm2017"),me("fire-js","")},7234:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,i=e[r];if(!(0<s(i,t)))break e;e[r]=t,e[n]=i,n=r}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length,a=i>>>1;r<a;){var o=2*(r+1)-1,l=e[o],c=o+1,u=e[c];if(0>s(l,n))c<i&&0>s(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[o]=n,r=o);else{if(!(c<i&&0>s(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function s(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],u=[],d=1,h=null,p=3,f=!1,m=!1,g=!1,v="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,x="undefined"!==typeof setImmediate?setImmediate:null;function b(e){for(var t=r(u);null!==t;){if(null===t.callback)i(u);else{if(!(t.startTime<=e))break;i(u),t.sortIndex=t.expirationTime,n(c,t)}t=r(u)}}function w(e){if(g=!1,b(e),!m)if(null!==r(c))m=!0,L(_);else{var t=r(u);null!==t&&R(w,t.startTime-e)}}function _(e,n){m=!1,g&&(g=!1,y(j),j=-1),f=!0;var s=p;try{for(b(n),h=r(c);null!==h&&(!(h.expirationTime>n)||e&&!T());){var a=h.callback;if("function"===typeof a){h.callback=null,p=h.priorityLevel;var o=a(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof o?h.callback=o:h===r(c)&&i(c),b(n)}else i(c);h=r(c)}if(null!==h)var l=!0;else{var d=r(u);null!==d&&R(w,d.startTime-n),l=!1}return l}finally{h=null,p=s,f=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var k,N=!1,S=null,j=-1,E=5,C=-1;function T(){return!(t.unstable_now()-C<E)}function A(){if(null!==S){var e=t.unstable_now();C=e;var n=!0;try{n=S(!0,e)}finally{n?k():(N=!1,S=null)}}else N=!1}if("function"===typeof x)k=function(){x(A)};else if("undefined"!==typeof MessageChannel){var I=new MessageChannel,P=I.port2;I.port1.onmessage=A,k=function(){P.postMessage(null)}}else k=function(){v(A,0)};function L(e){S=e,N||(N=!0,k())}function R(e,n){j=v(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||f||(m=!0,L(_))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,i,s){var a=t.unstable_now();switch("object"===typeof s&&null!==s?s="number"===typeof(s=s.delay)&&0<s?a+s:a:s=a,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:d++,callback:i,priorityLevel:e,startTime:s,expirationTime:o=s+o,sortIndex:-1},s>a?(e.sortIndex=s,n(u,e),null===r(c)&&e===r(u)&&(g?(y(j),j=-1):g=!0,R(w,s-a))):(e.sortIndex=o,n(c,e),m||f||(m=!0,L(_))),e},t.unstable_shouldYield=T,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},7347:e=>{"use strict";var t={single_source_shortest_paths:function(e,n,r){var i={},s={};s[n]=0;var a,o,l,c,u,d,h,p=t.PriorityQueue.make();for(p.push(n,0);!p.empty();)for(l in o=(a=p.pop()).value,c=a.cost,u=e[o]||{})u.hasOwnProperty(l)&&(d=c+u[l],h=s[l],("undefined"===typeof s[l]||h>d)&&(s[l]=d,p.push(l,d),i[l]=o));if("undefined"!==typeof r&&"undefined"===typeof s[r]){var f=["Could not find a path from ",n," to ",r,"."].join("");throw new Error(f)}return i},extract_shortest_path_from_predecessor_list:function(e,t){for(var n=[],r=t;r;)n.push(r),e[r],r=e[r];return n.reverse(),n},find_path:function(e,n,r){var i=t.single_source_shortest_paths(e,n,r);return t.extract_shortest_path_from_predecessor_list(i,r)},PriorityQueue:{make:function(e){var n,r=t.PriorityQueue,i={};for(n in e=e||{},r)r.hasOwnProperty(n)&&(i[n]=r[n]);return i.queue=[],i.sorter=e.sorter||r.default_sorter,i},default_sorter:function(e,t){return e.cost-t.cost},push:function(e,t){var n={value:e,cost:t};this.queue.push(n),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return 0===this.queue.length}}};e.exports=t},7421:(e,t,n)=>{const r=n(3257),i=n(8511);t.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},t.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},t.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},t.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},t.MIXED={bit:-1},t.getCharCountIndicator=function(e,t){if(!e.ccBits)throw new Error("Invalid mode: "+e);if(!r.isValid(t))throw new Error("Invalid version: "+t);return t>=1&&t<10?e.ccBits[0]:t<27?e.ccBits[1]:e.ccBits[2]},t.getBestModeForData=function(e){return i.testNumeric(e)?t.NUMERIC:i.testAlphanumeric(e)?t.ALPHANUMERIC:i.testKanji(e)?t.KANJI:t.BYTE},t.toString=function(e){if(e&&e.id)return e.id;throw new Error("Invalid mode")},t.isValid=function(e){return e&&e.bit&&e.ccBits},t.from=function(e,n){if(t.isValid(e))return e;try{return function(e){if("string"!==typeof e)throw new Error("Param is not a string");switch(e.toLowerCase()){case"numeric":return t.NUMERIC;case"alphanumeric":return t.ALPHANUMERIC;case"kanji":return t.KANJI;case"byte":return t.BYTE;default:throw new Error("Unknown mode: "+e)}}(e)}catch(r){return n}}},7700:(e,t,n)=>{"use strict";n.d(t,{Am:()=>I,FA:()=>j,Fy:()=>m,I9:()=>P,Im:()=>C,Ku:()=>D,T9:()=>h,Tj:()=>u,Uj:()=>a,XA:()=>p,ZQ:()=>g,bD:()=>T,c1:()=>y,cY:()=>f,eX:()=>N,g:()=>S,hp:()=>L,jZ:()=>v,lT:()=>w,lV:()=>b,nr:()=>_,sr:()=>x,tD:()=>R,u:()=>o,yU:()=>d,zW:()=>k});const r=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296===(64512&i)&&r+1<e.length&&56320===(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},i={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<e.length;i+=3){const t=e[i],s=i+1<e.length,a=s?e[i+1]:0,o=i+2<e.length,l=o?e[i+2]:0,c=t>>2,u=(3&t)<<4|a>>4;let d=(15&a)<<2|l>>6,h=63&l;o||(h=64,s||(d=64)),r.push(n[c],n[u],n[d],n[h])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(r(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],a=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<e.length;){const t=n[e.charAt(i++)],a=i<e.length?n[e.charAt(i)]:0;++i;const o=i<e.length?n[e.charAt(i)]:64;++i;const l=i<e.length?n[e.charAt(i)]:64;if(++i,null==t||null==a||null==o||null==l)throw new s;const c=t<<2|a>>4;if(r.push(c),64!==o){const e=a<<4&240|o>>2;if(r.push(e),64!==l){const e=o<<6&192|l;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class s extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const a=function(e){return function(e){const t=r(e);return i.encodeByteArray(t,!0)}(e).replace(/\./g,"")},o=function(e){try{return i.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};const l=()=>function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,c=()=>{try{return l()||(()=>{if("undefined"===typeof process)return;const e={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_FIREBASE_API_KEY:"AIzaSyArvQzOJTrtsekOK9Wpgi3PezPcM9KmXyY",REACT_APP_FIREBASE_APP_ID:"1:614868886377:web:3c020075969956ef1813f8",REACT_APP_FIREBASE_AUTH_DOMAIN:"geoquest2-7e45c.firebaseapp.com",REACT_APP_FIREBASE_MEASUREMENT_ID:"G-L45RHX7MCN",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"614868886377",REACT_APP_FIREBASE_PROJECT_ID:"geoquest2-7e45c",REACT_APP_FIREBASE_STORAGE_BUCKET:"geoquest2-7e45c.firebasestorage.app",REACT_APP_OPENROUTE_API_KEY:"eyJvcmciOiI1YjNjZTM1OTc4NTExMTAwMDFjZjYyNDgiLCJpZCI6ImEzN2RiYzM2MjdlZDRjMzVhNjE4MTI3ZTU2MTcwMjVjIiwiaCI6Im11cm11cjY0In0=",REACT_APP_STRIPE_PUBLISHABLE_KEY:"pk_live_51SCkJSCO02VZleLGS20eWjUQl0cAhGoZaQA5wfxS9ShhQJZmTm8Os02jPlP9c2fehToeLz369r0pjAixP98N6FAy00DFPn5jNh"}.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"===typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(n){return}const t=e&&o(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info("Unable to get __FIREBASE_DEFAULTS__ due to: ".concat(e))}},u=e=>{var t,n;return null===(n=null===(t=c())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},d=e=>{const t=u(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error("Invalid host ".concat(t," with no separate hostname and port!"));const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},h=()=>{var e;return null===(e=c())||void 0===e?void 0:e.config},p=e=>{var t;return null===(t=c())||void 0===t?void 0:t["_".concat(e)]};class f{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"===typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function m(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:"https://securetoken.google.com/".concat(n),aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[a(JSON.stringify({alg:"none",type:"JWT"})),a(JSON.stringify(s)),""].join(".")}function g(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function v(){return"undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(g())}function y(){return"undefined"!==typeof navigator&&"Cloudflare-Workers"===navigator.userAgent}function x(){const e="object"===typeof chrome?chrome.runtime:"object"===typeof browser?browser.runtime:void 0;return"object"===typeof e&&void 0!==e.id}function b(){return"object"===typeof navigator&&"ReactNative"===navigator.product}function w(){const e=g();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function _(){return!function(){var e;const t=null===(e=c())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(r){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function k(){try{return"object"===typeof indexedDB}catch(e){return!1}}function N(){return new Promise((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(n){t(n)}})}class S extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,S.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,j.prototype.create)}}class j{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e){const t=(arguments.length<=1?void 0:arguments[1])||{},n="".concat(this.service,"/").concat(e),r=this.errors[e],i=r?function(e,t){return e.replace(E,(e,n)=>{const r=t[n];return null!=r?String(r):"<".concat(n,"?>")})}(r,t):"Error",s="".concat(this.serviceName,": ").concat(i," (").concat(n,").");return new S(n,s,t)}}const E=/\{\$([^}]+)}/g;function C(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function T(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(A(n)&&A(s)){if(!T(n,s))return!1}else if(n!==s)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function A(e){return null!==e&&"object"===typeof e}function I(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function P(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}}),t}function L(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function R(e,t){const n=new O(e,t);return n.subscribe.bind(n)}class O{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!==typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"===typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=M),void 0===r.error&&(r.error=M),void 0===r.complete&&(r.complete=M);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(n){"undefined"!==typeof console&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function M(){}function D(e){return e&&e._delegate?e._delegate:e}},7950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(2730)},7969:(e,t)=>{let n;const r=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];t.getSymbolSize=function(e){if(!e)throw new Error('"version" cannot be null or undefined');if(e<1||e>40)throw new Error('"version" should be in range from 1 to 40');return 4*e+17},t.getSymbolTotalCodewords=function(e){return r[e]},t.getBCHDigit=function(e){let t=0;for(;0!==e;)t++,e>>>=1;return t},t.setToSJISFunction=function(e){if("function"!==typeof e)throw new Error('"toSJISFunc" is not a valid function.');n=e},t.isKanjiModeEnabled=function(){return"undefined"!==typeof n},t.toSJIS=function(e){return n(e)}},8177:(e,t,n)=>{const r=n(1312);function i(e){this.genPoly=void 0,this.degree=e,this.degree&&this.initialize(this.degree)}i.prototype.initialize=function(e){this.degree=e,this.genPoly=r.generateECPolynomial(this.degree)},i.prototype.encode=function(e){if(!this.genPoly)throw new Error("Encoder not initialized");const t=new Uint8Array(e.length+this.degree);t.set(e);const n=r.mod(t,this.genPoly),i=this.degree-n.length;if(i>0){const e=new Uint8Array(this.degree);return e.set(n,i),e}return n},e.exports=i},8293:(e,t)=>{function n(e){if("number"===typeof e&&(e=e.toString()),"string"!==typeof e)throw new Error("Color should be defined as hex string");let t=e.slice().replace("#","").split("");if(t.length<3||5===t.length||t.length>8)throw new Error("Invalid hex color: "+e);3!==t.length&&4!==t.length||(t=Array.prototype.concat.apply([],t.map(function(e){return[e,e]}))),6===t.length&&t.push("F","F");const n=parseInt(t.join(""),16);return{r:n>>24&255,g:n>>16&255,b:n>>8&255,a:255&n,hex:"#"+t.slice(0,6).join("")}}t.getOptions=function(e){e||(e={}),e.color||(e.color={});const t="undefined"===typeof e.margin||null===e.margin||e.margin<0?4:e.margin,r=e.width&&e.width>=21?e.width:void 0,i=e.scale||4;return{width:r,scale:r?4:i,margin:t,color:{dark:n(e.color.dark||"#000000ff"),light:n(e.color.light||"#ffffffff")},type:e.type,rendererOpts:e.rendererOpts||{}}},t.getScale=function(e,t){return t.width&&t.width>=e+2*t.margin?t.width/(e+2*t.margin):t.scale},t.getImageWidth=function(e,n){const r=t.getScale(e,n);return Math.floor((e+2*n.margin)*r)},t.qrToImageData=function(e,n,r){const i=n.modules.size,s=n.modules.data,a=t.getScale(i,r),o=Math.floor((i+2*r.margin)*a),l=r.margin*a,c=[r.color.light,r.color.dark];for(let t=0;t<o;t++)for(let n=0;n<o;n++){let u=4*(t*o+n),d=r.color.light;if(t>=l&&n>=l&&t<o-l&&n<o-l){d=c[s[Math.floor((t-l)/a)*i+Math.floor((n-l)/a)]?1:0]}e[u++]=d.r,e[u++]=d.g,e[u++]=d.b,e[u]=d.a}}},8330:e=>{"use strict";e.exports={rE:"0.8.1"}},8511:(e,t)=>{const n="[0-9]+";let r="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";r=r.replace(/u/g,"\\u");const i="(?:(?![A-Z0-9 $%*+\\-./:]|"+r+")(?:.|[\r\n]))+";t.KANJI=new RegExp(r,"g"),t.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),t.BYTE=new RegExp(i,"g"),t.NUMERIC=new RegExp(n,"g"),t.ALPHANUMERIC=new RegExp("[A-Z $%*+\\-./:]+","g");const s=new RegExp("^"+r+"$"),a=new RegExp("^"+n+"$"),o=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");t.testKanji=function(e){return s.test(e)},t.testNumeric=function(e){return a.test(e)},t.testAlphanumeric=function(e){return o.test(e)}},8697:(e,t,n)=>{const r=n(7421);function i(e){this.mode=r.BYTE,this.data="string"===typeof e?(new TextEncoder).encode(e):new Uint8Array(e)}i.getBitsLength=function(e){return 8*e},i.prototype.getLength=function(){return this.data.length},i.prototype.getBitsLength=function(){return i.getBitsLength(this.data.length)},i.prototype.write=function(e){for(let t=0,n=this.data.length;t<n;t++)e.put(this.data[t],8)},e.exports=i},8812:(e,t,n)=>{"use strict";n.d(t,{h1:()=>o,uA:()=>i});var r=n(7700);class i{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const s="[DEFAULT]";class a{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new r.cY;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(n){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null===e||void 0===e?void 0:e.identifier),r=null!==(t=null===e||void 0===e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error("Service ".concat(this.name," is not available"))}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error("Mismatching Component ".concat(e.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:s})}catch(t){}for(const[e,n]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:r});n.resolve(e)}catch(t){}}}}clearInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s;return this.instances.has(e)}getOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s;return this.instancesOptions.get(e)||{}}initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error("".concat(this.name,"(").concat(n,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[i,s]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(i)&&s.resolve(r)}return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch(r){}}getOrInitializeService(e){let{instanceIdentifier:t,options:n={}}=e,r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(i=t,i===s?void 0:i),options:n}),this.instances.set(t,r),this.instancesOptions.set(t,n),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch(a){}var i;return r||null}normalizeInstanceIdentifier(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s;return this.component?this.component.multipleInstances?e:s:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class o{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component ".concat(e.name," has already been registered with ").concat(this.name));t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new a(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},8853:(e,t,n)=>{"use strict";e.exports=n(7234)},8856:function(e,t,n){!function(e){"use strict";function t(e,t){var n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)}e=e&&e.hasOwnProperty("default")?e.default:e;var n=function(e,t){return(180*Math.atan2(t.y-e.y,t.x-e.x)/Math.PI+90+360)%360},r=function(e,t){var n=e.value;return e.isInPixels?n/t:n};function i(e){if("string"===typeof e&&-1!==e.indexOf("%"))return{value:parseFloat(e)/100,isInPixels:!1};var t=e?parseFloat(e):0;return{value:t,isInPixels:t>0}}var s=function(e,t){return e.x===t.x&&e.y===t.y};function a(e){return e.reduce(function(e,r,i,a){if(i>0&&!s(r,a[i-1])){var o=a[i-1],l=e.length>0?e[e.length-1].distB:0,c=t(o,r);e.push({a:o,b:r,distA:l,distB:l+c,heading:n(o,r)})}return e},[])}function o(e,t){var n=a(e),i=n.length;if(0===i)return[];var s=n[i-1].distB,o=r(t.offset,s),c=r(t.endOffset,s),u=s*r(t.repeat,s),d=c>0?s*c:0,h=[],p=o>0?s*o:0;do{h.push(p),p+=u}while(u>0&&p<s-d);var f=0,m=n[0];return h.map(function(e){for(;e>m.distB&&f<i-1;)f++,m=n[f];var t=(e-m.distA)/(m.distB-m.distA);return{pt:l(m.a,m.b,t),heading:m.heading}})}function l(e,t,n){return t.x!==e.x?{x:e.x+n*(t.x-e.x),y:e.y+n*(t.y-e.y)}:{x:e.x,y:e.y+(t.y-e.y)*n}}(function(){var e=L.Marker.prototype._initIcon,t=L.Marker.prototype._setPos,n="msTransform"===L.DomUtil.TRANSFORM;L.Marker.addInitHook(function(){var e=this.options.icon&&this.options.icon.options&&this.options.icon.options.iconAnchor;e&&(e=e[0]+"px "+e[1]+"px"),this.options.rotationOrigin=this.options.rotationOrigin||e||"center bottom",this.options.rotationAngle=this.options.rotationAngle||0,this.on("drag",function(e){e.target._applyRotation()})}),L.Marker.include({_initIcon:function(){e.call(this)},_setPos:function(e){t.call(this,e),this._applyRotation()},_applyRotation:function(){this.options.rotationAngle&&(this._icon.style[L.DomUtil.TRANSFORM+"Origin"]=this.options.rotationOrigin,n?this._icon.style[L.DomUtil.TRANSFORM]="rotate("+this.options.rotationAngle+"deg)":this._icon.style[L.DomUtil.TRANSFORM]+=" rotateZ("+this.options.rotationAngle+"deg)")},setRotationAngle:function(e){return this.options.rotationAngle=e,this.update(),this},setRotationOrigin:function(e){return this.options.rotationOrigin=e,this.update(),this}})})(),e.Symbol=e.Symbol||{},e.Symbol.Dash=e.Class.extend({options:{pixelSize:10,pathOptions:{}},initialize:function(t){e.Util.setOptions(this,t),this.options.pathOptions.clickable=!1},buildSymbol:function(t,n,r,i,s){var a=this.options,o=Math.PI/180;if(a.pixelSize<=1)return e.polyline([t.latLng,t.latLng],a.pathOptions);var l=r.project(t.latLng),c=-(t.heading-90)*o,u=e.point(l.x+a.pixelSize*Math.cos(c+Math.PI)/2,l.y+a.pixelSize*Math.sin(c)/2),d=l.add(l.subtract(u));return e.polyline([r.unproject(u),r.unproject(d)],a.pathOptions)}}),e.Symbol.dash=function(t){return new e.Symbol.Dash(t)},e.Symbol.ArrowHead=e.Class.extend({options:{polygon:!0,pixelSize:10,headAngle:60,pathOptions:{stroke:!1,weight:2}},initialize:function(t){e.Util.setOptions(this,t),this.options.pathOptions.clickable=!1},buildSymbol:function(t,n,r,i,s){return this.options.polygon?e.polygon(this._buildArrowPath(t,r),this.options.pathOptions):e.polyline(this._buildArrowPath(t,r),this.options.pathOptions)},_buildArrowPath:function(t,n){var r=Math.PI/180,i=n.project(t.latLng),s=-(t.heading-90)*r,a=this.options.headAngle/2*r,o=s+a,l=s-a,c=e.point(i.x-this.options.pixelSize*Math.cos(o),i.y+this.options.pixelSize*Math.sin(o)),u=e.point(i.x-this.options.pixelSize*Math.cos(l),i.y+this.options.pixelSize*Math.sin(l));return[n.unproject(c),t.latLng,n.unproject(u)]}}),e.Symbol.arrowHead=function(t){return new e.Symbol.ArrowHead(t)},e.Symbol.Marker=e.Class.extend({options:{markerOptions:{},rotate:!1},initialize:function(t){e.Util.setOptions(this,t),this.options.markerOptions.clickable=!1,this.options.markerOptions.draggable=!1},buildSymbol:function(t,n,r,i,s){return this.options.rotate&&(this.options.markerOptions.rotationAngle=t.heading+(this.options.angleCorrection||0)),e.marker(t.latLng,this.options.markerOptions)}}),e.Symbol.marker=function(t){return new e.Symbol.Marker(t)};var c=function(t){return t instanceof e.LatLng||Array.isArray(t)&&2===t.length&&"number"===typeof t[0]},u=function(e){return Array.isArray(e)&&c(e[0])};e.PolylineDecorator=e.FeatureGroup.extend({options:{patterns:[]},initialize:function(t,n){e.FeatureGroup.prototype.initialize.call(this),e.Util.setOptions(this,n),this._map=null,this._paths=this._initPaths(t),this._bounds=this._initBounds(),this._patterns=this._initPatterns(this.options.patterns)},_initPaths:function(t,n){var r=this;return u(t)?[n?t.concat([t[0]]):t]:t instanceof e.Polyline?this._initPaths(t.getLatLngs(),t instanceof e.Polygon):Array.isArray(t)?t.reduce(function(e,t){return e.concat(r._initPaths(t,n))},[]):[]},_initPatterns:function(e){return e.map(this._parsePatternDef)},setPatterns:function(e){this.options.patterns=e,this._patterns=this._initPatterns(this.options.patterns),this.redraw()},setPaths:function(e){this._paths=this._initPaths(e),this._bounds=this._initBounds(),this.redraw()},_parsePatternDef:function(e,t){return{symbolFactory:e.symbol,offset:i(e.offset),endOffset:i(e.endOffset),repeat:i(e.repeat)}},onAdd:function(e){this._map=e,this._draw(),this._map.on("moveend",this.redraw,this)},onRemove:function(t){this._map.off("moveend",this.redraw,this),this._map=null,e.FeatureGroup.prototype.onRemove.call(this,t)},_initBounds:function(){var t=this._paths.reduce(function(e,t){return e.concat(t)},[]);return e.latLngBounds(t)},getBounds:function(){return this._bounds},_buildSymbols:function(e,t,n){var r=this;return n.map(function(i,s){return t.buildSymbol(i,e,r._map,s,n.length)})},_getDirectionPoints:function(t,n){var r=this;return t.length<2?[]:o(t.map(function(e){return r._map.project(e)}),n).map(function(t){return{latLng:r._map.unproject(e.point(t.pt)),heading:t.heading}})},redraw:function(){this._map&&(this.clearLayers(),this._draw())},_getPatternLayers:function(t){var n=this,r=this._map.getBounds().pad(.1);return this._paths.map(function(i){var s=n._getDirectionPoints(i,t).filter(function(e){return r.contains(e.latLng)});return e.featureGroup(n._buildSymbols(i,t.symbolFactory,s))})},_draw:function(){var t=this;this._patterns.map(function(e){return t._getPatternLayers(e)}).forEach(function(n){t.addLayer(e.featureGroup(n))})}}),e.polylineDecorator=function(t,n){return new e.PolylineDecorator(t,n)}}(n(228))},8970:(e,t,n)=>{const r=n(6116),i=n(4772),s=n(2182),a=n(5487);function o(e,t,n,s,a){const o=[].slice.call(arguments,1),l=o.length,c="function"===typeof o[l-1];if(!c&&!r())throw new Error("Callback required as last argument");if(!c){if(l<1)throw new Error("Too few arguments provided");return 1===l?(n=t,t=s=void 0):2!==l||t.getContext||(s=n,n=t,t=void 0),new Promise(function(r,a){try{const a=i.create(n,s);r(e(a,t,s))}catch(o){a(o)}})}if(l<2)throw new Error("Too few arguments provided");2===l?(a=n,n=t,t=s=void 0):3===l&&(t.getContext&&"undefined"===typeof a?(a=s,s=void 0):(a=s,s=n,n=t,t=void 0));try{const r=i.create(n,s);a(null,e(r,t,s))}catch(u){a(u)}}t.create=i.create,t.toCanvas=o.bind(null,s.render),t.toDataURL=o.bind(null,s.renderToDataURL),t.toString=o.bind(null,function(e,t,n){return a.render(e,n)})},9021:(e,t,n)=>{const r=n(7969).getSymbolSize;t.getPositions=function(e){const t=r(e);return[[0,0],[t-7,0],[0,t-7]]}},9382:(e,t,n)=>{const r=n(7969).getSymbolSize;t.getRowColCoords=function(e){if(1===e)return[];const t=Math.floor(e/7)+2,n=r(e),i=145===n?26:2*Math.ceil((n-13)/(2*t-2)),s=[n-7];for(let r=1;r<t-1;r++)s[r]=s[r-1]-i;return s.push(6),s.reverse()},t.getPositions=function(e){const n=[],r=t.getRowColCoords(e),i=r.length;for(let t=0;t<i;t++)for(let e=0;e<i;e++)0===t&&0===e||0===t&&e===i-1||t===i-1&&0===e||n.push([r[t],r[e]]);return n}},9642:(e,t,n)=>{const r=n(7421),i=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function s(e){this.mode=r.ALPHANUMERIC,this.data=e}s.getBitsLength=function(e){return 11*Math.floor(e/2)+e%2*6},s.prototype.getLength=function(){return this.data.length},s.prototype.getBitsLength=function(){return s.getBitsLength(this.data.length)},s.prototype.write=function(e){let t;for(t=0;t+2<=this.data.length;t+=2){let n=45*i.indexOf(this.data[t]);n+=i.indexOf(this.data[t+1]),e.put(n,11)}this.data.length%2&&e.put(i.indexOf(this.data[t]),6)},e.exports=s}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,n),s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(r,i){if(1&i&&(r=this(r)),8&i)return r;if("object"===typeof r&&r){if(4&i&&r.__esModule)return r;if(16&i&&"function"===typeof r.then)return r}var s=Object.create(null);n.r(s);var a={};e=e||[null,t({}),t([]),t(t)];for(var o=2&i&&r;("object"==typeof o||"function"==typeof o)&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach(e=>a[e]=()=>r[e]);return a.default=()=>r,n.d(s,a),s}})(),n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e,t=n(5043),r=n.t(t,2),i=n(4391);function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(e||(e={}));const a="popstate";function o(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function l(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(n){}}}function c(e,t){return{usr:e.state,key:e.key,idx:t}}function u(e,t,n,r){return void 0===n&&(n=null),s({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?h(t):t,{state:n,key:t&&t.key||r||Math.random().toString(36).substr(2,8)})}function d(e){let{pathname:t="/",search:n="",hash:r=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),r&&"#"!==r&&(t+="#"===r.charAt(0)?r:"#"+r),t}function h(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function p(t,n,r,i){void 0===i&&(i={});let{window:l=document.defaultView,v5Compat:h=!1}=i,p=l.history,f=e.Pop,m=null,g=v();function v(){return(p.state||{idx:null}).idx}function y(){f=e.Pop;let t=v(),n=null==t?null:t-g;g=t,m&&m({action:f,location:b.location,delta:n})}function x(e){let t="null"!==l.location.origin?l.location.origin:l.location.href,n="string"===typeof e?e:d(e);return n=n.replace(/ $/,"%20"),o(t,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,t)}null==g&&(g=0,p.replaceState(s({},p.state,{idx:g}),""));let b={get action(){return f},get location(){return t(l,p)},listen(e){if(m)throw new Error("A history only accepts one active listener");return l.addEventListener(a,y),m=e,()=>{l.removeEventListener(a,y),m=null}},createHref:e=>n(l,e),createURL:x,encodeLocation(e){let t=x(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(t,n){f=e.Push;let i=u(b.location,t,n);r&&r(i,t),g=v()+1;let s=c(i,g),a=b.createHref(i);try{p.pushState(s,"",a)}catch(o){if(o instanceof DOMException&&"DataCloneError"===o.name)throw o;l.location.assign(a)}h&&m&&m({action:f,location:b.location,delta:1})},replace:function(t,n){f=e.Replace;let i=u(b.location,t,n);r&&r(i,t),g=v();let s=c(i,g),a=b.createHref(i);p.replaceState(s,"",a),h&&m&&m({action:f,location:b.location,delta:0})},go:e=>p.go(e)};return b}var f;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(f||(f={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function m(e,t,n){return void 0===n&&(n="/"),g(e,t,n,!1)}function g(e,t,n,r){let i=A(("string"===typeof t?h(t):t).pathname||"/",n);if(null==i)return null;let s=v(e);!function(e){e.sort((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every((e,n)=>e===t[n]);return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map(e=>e.childrenIndex),t.routesMeta.map(e=>e.childrenIndex)))}(s);let a=null;for(let o=0;null==a&&o<s.length;++o){let e=T(i);a=E(s[o],e,r)}return a}function v(e,t,n,r){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===r&&(r="");let i=(e,i,s)=>{let a={relativePath:void 0===s?e.path||"":s,caseSensitive:!0===e.caseSensitive,childrenIndex:i,route:e};a.relativePath.startsWith("/")&&(o(a.relativePath.startsWith(r),'Absolute route path "'+a.relativePath+'" nested under path "'+r+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),a.relativePath=a.relativePath.slice(r.length));let l=O([r,a.relativePath]),c=n.concat(a);e.children&&e.children.length>0&&(o(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+l+'".'),v(e.children,t,c,l)),(null!=e.path||e.index)&&t.push({path:l,score:j(l,e.index),routesMeta:c})};return e.forEach((e,t)=>{var n;if(""!==e.path&&null!=(n=e.path)&&n.includes("?"))for(let r of y(e.path))i(e,t,r);else i(e,t)}),t}function y(e){let t=e.split("/");if(0===t.length)return[];let[n,...r]=t,i=n.endsWith("?"),s=n.replace(/\?$/,"");if(0===r.length)return i?[s,""]:[s];let a=y(r.join("/")),o=[];return o.push(...a.map(e=>""===e?s:[s,e].join("/"))),i&&o.push(...a),o.map(t=>e.startsWith("/")&&""===t?"/":t)}const x=/^:[\w-]+$/,b=3,w=2,_=1,k=10,N=-2,S=e=>"*"===e;function j(e,t){let n=e.split("/"),r=n.length;return n.some(S)&&(r+=N),t&&(r+=w),n.filter(e=>!S(e)).reduce((e,t)=>e+(x.test(t)?b:""===t?_:k),r)}function E(e,t,n){void 0===n&&(n=!1);let{routesMeta:r}=e,i={},s="/",a=[];for(let o=0;o<r.length;++o){let e=r[o],l=o===r.length-1,c="/"===s?t:t.slice(s.length)||"/",u=C({path:e.relativePath,caseSensitive:e.caseSensitive,end:l},c),d=e.route;if(!u&&l&&n&&!r[r.length-1].route.index&&(u=C({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},c)),!u)return null;Object.assign(i,u.params),a.push({params:i,pathname:O([s,u.pathname]),pathnameBase:M(O([s,u.pathnameBase])),route:d}),"/"!==u.pathnameBase&&(s=O([s,u.pathnameBase]))}return a}function C(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);l("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let r=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(e,t,n)=>(r.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)"));e.endsWith("*")?(r.push({paramName:"*"}),i+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":""!==e&&"/"!==e&&(i+="(?:(?=\\/|$))");let s=new RegExp(i,t?void 0:"i");return[s,r]}(e.path,e.caseSensitive,e.end),i=t.match(n);if(!i)return null;let s=i[0],a=s.replace(/(.)\/+$/,"$1"),o=i.slice(1);return{params:r.reduce((e,t,n)=>{let{paramName:r,isOptional:i}=t;if("*"===r){let e=o[n]||"";a=s.slice(0,s.length-e.length).replace(/(.)\/+$/,"$1")}const l=o[n];return e[r]=i&&!l?void 0:(l||"").replace(/%2F/g,"/"),e},{}),pathname:s,pathnameBase:a,pattern:e}}function T(e){try{return e.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(t){return l(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function A(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&"/"!==r?null:e.slice(n)||"/"}function I(e,t,n,r){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function P(e){return e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0)}function L(e,t){let n=P(e);return t?n.map((e,t)=>t===n.length-1?e.pathname:e.pathnameBase):n.map(e=>e.pathnameBase)}function R(e,t,n,r){let i;void 0===r&&(r=!1),"string"===typeof e?i=h(e):(i=s({},e),o(!i.pathname||!i.pathname.includes("?"),I("?","pathname","search",i)),o(!i.pathname||!i.pathname.includes("#"),I("#","pathname","hash",i)),o(!i.search||!i.search.includes("#"),I("#","search","hash",i)));let a,l=""===e||""===i.pathname,c=l?"/":i.pathname;if(null==c)a=n;else{let e=t.length-1;if(!r&&c.startsWith("..")){let t=c.split("/");for(;".."===t[0];)t.shift(),e-=1;i.pathname=t.join("/")}a=e>=0?t[e]:"/"}let u=function(e,t){void 0===t&&(t="/");let{pathname:n,search:r="",hash:i=""}="string"===typeof e?h(e):e,s=n?n.startsWith("/")?n:function(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)}),n.length>1?n.join("/"):"/"}(n,t):t;return{pathname:s,search:D(r),hash:F(i)}}(i,a),d=c&&"/"!==c&&c.endsWith("/"),p=(l||"."===c)&&n.endsWith("/");return u.pathname.endsWith("/")||!d&&!p||(u.pathname+="/"),u}const O=e=>e.join("/").replace(/\/\/+/g,"/"),M=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),D=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",F=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;function z(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}const U=["post","put","patch","delete"],B=(new Set(U),["get",...U]);new Set(B),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function V(){return V=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},V.apply(this,arguments)}const q=t.createContext(null);const K=t.createContext(null);const H=t.createContext(null);const W=t.createContext(null);const G=t.createContext({outlet:null,matches:[],isDataRoute:!1});const Z=t.createContext(null);function Q(){return null!=t.useContext(W)}function J(){return Q()||o(!1),t.useContext(W).location}function Y(e){t.useContext(H).static||t.useLayoutEffect(e)}function X(){let{isDataRoute:e}=t.useContext(G);return e?function(){let{router:e}=ce(oe.UseNavigateStable),n=de(le.UseNavigateStable),r=t.useRef(!1);return Y(()=>{r.current=!0}),t.useCallback(function(t,i){void 0===i&&(i={}),r.current&&("number"===typeof t?e.navigate(t):e.navigate(t,V({fromRouteId:n},i)))},[e,n])}():function(){Q()||o(!1);let e=t.useContext(q),{basename:n,future:r,navigator:i}=t.useContext(H),{matches:s}=t.useContext(G),{pathname:a}=J(),l=JSON.stringify(L(s,r.v7_relativeSplatPath)),c=t.useRef(!1);return Y(()=>{c.current=!0}),t.useCallback(function(t,r){if(void 0===r&&(r={}),!c.current)return;if("number"===typeof t)return void i.go(t);let s=R(t,JSON.parse(l),a,"path"===r.relative);null==e&&"/"!==n&&(s.pathname="/"===s.pathname?n:O([n,s.pathname])),(r.replace?i.replace:i.push)(s,r.state,r)},[n,i,l,a,e])}()}function $(){let{matches:e}=t.useContext(G),n=e[e.length-1];return n?n.params:{}}function ee(e,n){let{relative:r}=void 0===n?{}:n,{future:i}=t.useContext(H),{matches:s}=t.useContext(G),{pathname:a}=J(),o=JSON.stringify(L(s,i.v7_relativeSplatPath));return t.useMemo(()=>R(e,JSON.parse(o),a,"path"===r),[e,o,a,r])}function te(n,r,i,s){Q()||o(!1);let{navigator:a}=t.useContext(H),{matches:l}=t.useContext(G),c=l[l.length-1],u=c?c.params:{},d=(c&&c.pathname,c?c.pathnameBase:"/");c&&c.route;let p,f=J();if(r){var g;let e="string"===typeof r?h(r):r;"/"===d||(null==(g=e.pathname)?void 0:g.startsWith(d))||o(!1),p=e}else p=f;let v=p.pathname||"/",y=v;if("/"!==d){let e=d.replace(/^\//,"").split("/");y="/"+v.replace(/^\//,"").split("/").slice(e.length).join("/")}let x=m(n,{pathname:y});let b=ae(x&&x.map(e=>Object.assign({},e,{params:Object.assign({},u,e.params),pathname:O([d,a.encodeLocation?a.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?d:O([d,a.encodeLocation?a.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])})),l,i,s);return r&&b?t.createElement(W.Provider,{value:{location:V({pathname:"/",search:"",hash:"",state:null,key:"default"},p),navigationType:e.Pop}},b):b}function ne(){let e=function(){var e;let n=t.useContext(Z),r=ue(le.UseRouteError),i=de(le.UseRouteError);if(void 0!==n)return n;return null==(e=r.errors)?void 0:e[i]}(),n=z(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,i="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:i};return t.createElement(t.Fragment,null,t.createElement("h2",null,"Unexpected Application Error!"),t.createElement("h3",{style:{fontStyle:"italic"}},n),r?t.createElement("pre",{style:s},r):null,null)}const re=t.createElement(ne,null);class ie extends t.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?t.createElement(G.Provider,{value:this.props.routeContext},t.createElement(Z.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function se(e){let{routeContext:n,match:r,children:i}=e,s=t.useContext(q);return s&&s.static&&s.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=r.route.id),t.createElement(G.Provider,{value:n},i)}function ae(e,n,r,i){var s;if(void 0===n&&(n=[]),void 0===r&&(r=null),void 0===i&&(i=null),null==e){var a;if(!r)return null;if(r.errors)e=r.matches;else{if(!(null!=(a=i)&&a.v7_partialHydration&&0===n.length&&!r.initialized&&r.matches.length>0))return null;e=r.matches}}let l=e,c=null==(s=r)?void 0:s.errors;if(null!=c){let e=l.findIndex(e=>e.route.id&&void 0!==(null==c?void 0:c[e.route.id]));e>=0||o(!1),l=l.slice(0,Math.min(l.length,e+1))}let u=!1,d=-1;if(r&&i&&i.v7_partialHydration)for(let t=0;t<l.length;t++){let e=l[t];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(d=t),e.route.id){let{loaderData:t,errors:n}=r,i=e.route.loader&&void 0===t[e.route.id]&&(!n||void 0===n[e.route.id]);if(e.route.lazy||i){u=!0,l=d>=0?l.slice(0,d+1):[l[0]];break}}}return l.reduceRight((e,i,s)=>{let a,o=!1,h=null,p=null;var f;r&&(a=c&&i.route.id?c[i.route.id]:void 0,h=i.route.errorElement||re,u&&(d<0&&0===s?(f="route-fallback",!1||he[f]||(he[f]=!0),o=!0,p=null):d===s&&(o=!0,p=i.route.hydrateFallbackElement||null)));let m=n.concat(l.slice(0,s+1)),g=()=>{let n;return n=a?h:o?p:i.route.Component?t.createElement(i.route.Component,null):i.route.element?i.route.element:e,t.createElement(se,{match:i,routeContext:{outlet:e,matches:m,isDataRoute:null!=r},children:n})};return r&&(i.route.ErrorBoundary||i.route.errorElement||0===s)?t.createElement(ie,{location:r.location,revalidation:r.revalidation,component:h,error:a,children:g(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):g()},null)}var oe=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(oe||{}),le=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(le||{});function ce(e){let n=t.useContext(q);return n||o(!1),n}function ue(e){let n=t.useContext(K);return n||o(!1),n}function de(e){let n=function(){let e=t.useContext(G);return e||o(!1),e}(),r=n.matches[n.matches.length-1];return r.route.id||o(!1),r.route.id}const he={};function pe(e,t){null==e||e.v7_startTransition,void 0===(null==e?void 0:e.v7_relativeSplatPath)&&(!t||t.v7_relativeSplatPath),t&&(t.v7_fetcherPersist,t.v7_normalizeFormMethod,t.v7_partialHydration,t.v7_skipActionErrorRevalidation)}r.startTransition;function fe(e){let{to:n,replace:r,state:i,relative:s}=e;Q()||o(!1);let{future:a,static:l}=t.useContext(H),{matches:c}=t.useContext(G),{pathname:u}=J(),d=X(),h=R(n,L(c,a.v7_relativeSplatPath),u,"path"===s),p=JSON.stringify(h);return t.useEffect(()=>d(JSON.parse(p),{replace:r,state:i,relative:s}),[d,p,s,r,i]),null}function me(e){o(!1)}function ge(n){let{basename:r="/",children:i=null,location:s,navigationType:a=e.Pop,navigator:l,static:c=!1,future:u}=n;Q()&&o(!1);let d=r.replace(/^\/*/,"/"),p=t.useMemo(()=>({basename:d,navigator:l,static:c,future:V({v7_relativeSplatPath:!1},u)}),[d,u,l,c]);"string"===typeof s&&(s=h(s));let{pathname:f="/",search:m="",hash:g="",state:v=null,key:y="default"}=s,x=t.useMemo(()=>{let e=A(f,d);return null==e?null:{location:{pathname:e,search:m,hash:g,state:v,key:y},navigationType:a}},[d,f,m,g,v,y,a]);return null==x?null:t.createElement(H.Provider,{value:p},t.createElement(W.Provider,{children:i,value:x}))}function ve(e){let{children:t,location:n}=e;return te(ye(t),n)}new Promise(()=>{});t.Component;function ye(e,n){void 0===n&&(n=[]);let r=[];return t.Children.forEach(e,(e,i)=>{if(!t.isValidElement(e))return;let s=[...n,i];if(e.type===t.Fragment)return void r.push.apply(r,ye(e.props.children,s));e.type!==me&&o(!1),e.props.index&&e.props.children&&o(!1);let a={id:e.props.id||s.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(a.children=ye(e.props.children,s)),r.push(a)}),r}var xe=n(7950),be=n.t(xe,2);function we(){return we=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},we.apply(this,arguments)}function _e(e,t){if(null==e)return{};var n,r,i={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}function ke(e){return void 0===e&&(e=""),new URLSearchParams("string"===typeof e||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,n)=>{let r=e[n];return t.concat(Array.isArray(r)?r.map(e=>[n,e]):[[n,r]])},[]))}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);const Ne=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"];try{window.__reactRouterVersion="6"}catch(pu){}new Map;const Se=r.startTransition;be.flushSync,r.useId;function je(e){let{basename:n,children:r,future:i,window:s}=e,a=t.useRef();var o;null==a.current&&(a.current=(void 0===(o={window:s,v5Compat:!0})&&(o={}),p(function(e,t){let{pathname:n,search:r,hash:i}=e.location;return u("",{pathname:n,search:r,hash:i},t.state&&t.state.usr||null,t.state&&t.state.key||"default")},function(e,t){return"string"===typeof t?t:d(t)},null,o)));let l=a.current,[c,h]=t.useState({action:l.action,location:l.location}),{v7_startTransition:f}=i||{},m=t.useCallback(e=>{f&&Se?Se(()=>h(e)):h(e)},[h,f]);return t.useLayoutEffect(()=>l.listen(m),[l,m]),t.useEffect(()=>pe(i),[i]),t.createElement(ge,{basename:n,children:r,location:c.location,navigationType:c.action,navigator:l,future:i})}const Ee="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,Ce=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Te=t.forwardRef(function(e,n){let r,{onClick:i,relative:s,reloadDocument:a,replace:l,state:c,target:u,to:h,preventScrollReset:p,viewTransition:f}=e,m=_e(e,Ne),{basename:g}=t.useContext(H),v=!1;if("string"===typeof h&&Ce.test(h)&&(r=h,Ee))try{let e=new URL(window.location.href),t=h.startsWith("//")?new URL(e.protocol+h):new URL(h),n=A(t.pathname,g);t.origin===e.origin&&null!=n?h=n+t.search+t.hash:v=!0}catch(pu){}let y=function(e,n){let{relative:r}=void 0===n?{}:n;Q()||o(!1);let{basename:i,navigator:s}=t.useContext(H),{hash:a,pathname:l,search:c}=ee(e,{relative:r}),u=l;return"/"!==i&&(u="/"===l?i:O([i,l])),s.createHref({pathname:u,search:c,hash:a})}(h,{relative:s}),x=function(e,n){let{target:r,replace:i,state:s,preventScrollReset:a,relative:o,viewTransition:l}=void 0===n?{}:n,c=X(),u=J(),h=ee(e,{relative:o});return t.useCallback(t=>{if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(t,r)){t.preventDefault();let n=void 0!==i?i:d(u)===d(h);c(e,{replace:n,state:s,preventScrollReset:a,relative:o,viewTransition:l})}},[u,c,h,i,s,r,e,a,o,l])}(h,{replace:l,state:c,target:u,preventScrollReset:p,relative:s,viewTransition:f});return t.createElement("a",we({},m,{href:r||y,onClick:v||a?i:function(e){i&&i(e),e.defaultPrevented||x(e)},ref:n,target:u}))});var Ae,Ie;function Pe(e){let n=t.useRef(ke(e)),r=t.useRef(!1),i=J(),s=t.useMemo(()=>function(e,t){let n=ke(e);return t&&t.forEach((e,r)=>{n.has(r)||t.getAll(r).forEach(e=>{n.append(r,e)})}),n}(i.search,r.current?null:n.current),[i.search]),a=X(),o=t.useCallback((e,t)=>{const n=ke("function"===typeof e?e(s):e);r.current=!0,a("?"+n,t)},[a,s]);return[s,o]}(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(Ae||(Ae={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(Ie||(Ie={}));const Le={randomUUID:"undefined"!==typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};var Re,Oe=new Uint8Array(16);function Me(){if(!Re&&!(Re="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Re(Oe)}for(var De=[],Fe=0;Fe<256;++Fe)De.push((Fe+256).toString(16).slice(1));function ze(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(De[e[t+0]]+De[e[t+1]]+De[e[t+2]]+De[e[t+3]]+"-"+De[e[t+4]]+De[e[t+5]]+"-"+De[e[t+6]]+De[e[t+7]]+"-"+De[e[t+8]]+De[e[t+9]]+"-"+De[e[t+10]]+De[e[t+11]]+De[e[t+12]]+De[e[t+13]]+De[e[t+14]]+De[e[t+15]]).toLowerCase()}const Ue=function(e,t,n){if(Le.randomUUID&&!t&&!e)return Le.randomUUID();var r=(e=e||{}).random||(e.rng||Me)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=r[i];return t}return ze(r)};var Be=n(7150),Ve=n(7700),qe=n(443);function Ke(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}Object.create;Object.create;"function"===typeof SuppressedError&&SuppressedError;var He=n(8812);function We(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Ge=We,Ze=new Ve.FA("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Qe=new qe.Vy("@firebase/auth");function Je(e){if(Qe.logLevel<=qe.$b.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Qe.error("Auth (".concat(Be.MF,"): ").concat(e),...n)}}function Ye(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];throw tt(e,...n)}function Xe(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return tt(e,...n)}function $e(e,t,n){const r=Object.assign(Object.assign({},Ge()),{[t]:n});return new Ve.FA("auth","Firebase",r).create(t,{appName:e.name})}function et(e){return $e(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function tt(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if("string"!==typeof e){const t=n[0],r=[...n.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(t,...r)}return Ze.create(e,...n)}function nt(e,t){if(!e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];throw tt(t,...r)}}function rt(e){const t="INTERNAL ASSERTION FAILED: "+e;throw Je(t),new Error(t)}function it(e,t){e||rt(t)}function st(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function at(){return"http:"===ot()||"https:"===ot()}function ot(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class lt{constructor(e,t){this.shortDelay=e,this.longDelay=t,it(t>e,"Short delay should be less than long delay!"),this.isMobile=(0,Ve.jZ)()||(0,Ve.lV)()}get(){return"undefined"!==typeof navigator&&navigator&&"onLine"in navigator&&"boolean"===typeof navigator.onLine&&(at()||(0,Ve.sr)()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function ct(e,t){it(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?"".concat(n).concat(t.startsWith("/")?t.slice(1):t):n}class ut{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!==typeof self&&"fetch"in self?self.fetch:"undefined"!==typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!==typeof fetch?fetch:void rt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!==typeof self&&"Headers"in self?self.Headers:"undefined"!==typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!==typeof Headers?Headers:void rt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!==typeof self&&"Response"in self?self.Response:"undefined"!==typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!==typeof Response?Response:void rt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const dt={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},ht=new lt(3e4,6e4);function pt(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function ft(e,t,n,r){return mt(e,arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},async()=>{let i={},s={};r&&("GET"===t?s=r:i={body:JSON.stringify(r)});const a=(0,Ve.Am)(Object.assign({key:e.config.apiKey},s)).slice(1),o=await e._getAdditionalHeaders();o["Content-Type"]="application/json",e.languageCode&&(o["X-Firebase-Locale"]=e.languageCode);const l=Object.assign({method:t,headers:o},i);return(0,Ve.c1)()||(l.referrerPolicy="no-referrer"),ut.fetch()(vt(e,e.config.apiHost,n,a),l)})}async function mt(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},dt),t);try{const t=new xt(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw bt(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,a]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw bt(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw bt(e,"email-already-in-use",s);if("USER_DISABLED"===n)throw bt(e,"user-disabled",s);const o=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(a)throw $e(e,o,a);Ye(e,o)}}catch(pu){if(pu instanceof Ve.g)throw pu;Ye(e,"network-request-failed",{message:String(pu)})}}async function gt(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const s=await ft(e,t,n,r,i);return"mfaPendingCredential"in s&&Ye(e,"multi-factor-auth-required",{_serverResponse:s}),s}function vt(e,t,n,r){const i="".concat(t).concat(n,"?").concat(r);return e.config.emulator?ct(e.config,i):"".concat(e.config.apiScheme,"://").concat(i)}function yt(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class xt{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(Xe(this.auth,"network-request-failed")),ht.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function bt(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=Xe(e,t,r);return i.customData._tokenResponse=n,i}function wt(e){return void 0!==e&&void 0!==e.enterprise}class _t{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return yt(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}}async function kt(e,t){return ft(e,"GET","/v2/recaptchaConfig",pt(e,t))}async function Nt(e,t){return ft(e,"POST","/v1/accounts:lookup",t)}function St(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(pu){}}function jt(e){return 1e3*Number(e)}function Et(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return Je("JWT malformed, contained fewer than 3 sections"),null;try{const e=(0,Ve.u)(n);return e?JSON.parse(e):(Je("Failed to decode base64 JWT payload"),null)}catch(pu){return Je("Caught error parsing JWT payload as JSON",null===pu||void 0===pu?void 0:pu.toString()),null}}function Ct(e){const t=Et(e);return nt(t,"internal-error"),nt("undefined"!==typeof t.exp,"internal-error"),nt("undefined"!==typeof t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function Tt(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2])return t;try{return await t}catch(pu){throw pu instanceof Ve.g&&function(e){let{code:t}=e;return t==="auth/".concat("user-disabled")||t==="auth/".concat("user-token-expired")}(pu)&&e.auth.currentUser===e&&await e.auth.signOut(),pu}}class At{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(pu){return void((null===pu||void 0===pu?void 0:pu.code)==="auth/".concat("network-request-failed")&&this.schedule(!0))}this.schedule()}}class It{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=St(this.lastLoginAt),this.creationTime=St(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Pt(e){var t;const n=e.auth,r=await e.getIdToken(),i=await Tt(e,Nt(n,{idToken:r}));nt(null===i||void 0===i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const a=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?Lt(s.providerUserInfo):[],o=(l=e.providerData,c=a,[...l.filter(e=>!c.some(t=>t.providerId===e.providerId)),...c]);var l,c;const u=e.isAnonymous,d=!(e.email&&s.passwordHash)&&!(null===o||void 0===o?void 0:o.length),h=!!u&&d,p={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new It(s.createdAt,s.lastLoginAt),isAnonymous:h};Object.assign(e,p)}function Lt(e){return e.map(e=>{var{providerId:t}=e,n=Ke(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}class Rt{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){nt(e.idToken,"internal-error"),nt("undefined"!==typeof e.idToken,"internal-error"),nt("undefined"!==typeof e.refreshToken,"internal-error");const t="expiresIn"in e&&"undefined"!==typeof e.expiresIn?Number(e.expiresIn):Ct(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){nt(0!==e.length,"internal-error");const t=Ct(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]||!this.accessToken||this.isExpired?(nt(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:i}=await async function(e,t){const n=await mt(e,{},async()=>{const n=(0,Ve.Am)({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,s=vt(e,r,"/v1/token","key=".concat(i)),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",ut.fetch()(s,{method:"POST",headers:a,body:n})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new Rt;return n&&(nt("string"===typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(nt("string"===typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(nt("number"===typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Rt,this.toJSON())}_performRefresh(){return rt("not implemented")}}function Ot(e,t){nt("string"===typeof e||"undefined"===typeof e,"internal-error",{appName:t})}class Mt{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=Ke(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new At(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new It(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await Tt(this,this.stsTokenManager.getToken(this.auth,e));return nt(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=(0,Ve.Ku)(e),r=await n.getIdToken(t),i=Et(r);nt(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s="object"===typeof i.firebase?i.firebase:void 0,a=null===s||void 0===s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:St(jt(i.auth_time)),issuedAtTime:St(jt(i.iat)),expirationTime:St(jt(i.exp)),signInProvider:a||null,signInSecondFactor:(null===s||void 0===s?void 0:s.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=(0,Ve.Ku)(e);await Pt(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(nt(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Mt(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){nt(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await Pt(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if((0,Be.xZ)(this.auth.app))return Promise.reject(et(this.auth));const e=await this.getIdToken();return await Tt(this,async function(e,t){return ft(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,a,o,l,c;const u=null!==(n=t.displayName)&&void 0!==n?n:void 0,d=null!==(r=t.email)&&void 0!==r?r:void 0,h=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,p=null!==(s=t.photoURL)&&void 0!==s?s:void 0,f=null!==(a=t.tenantId)&&void 0!==a?a:void 0,m=null!==(o=t._redirectEventId)&&void 0!==o?o:void 0,g=null!==(l=t.createdAt)&&void 0!==l?l:void 0,v=null!==(c=t.lastLoginAt)&&void 0!==c?c:void 0,{uid:y,emailVerified:x,isAnonymous:b,providerData:w,stsTokenManager:_}=t;nt(y&&_,e,"internal-error");const k=Rt.fromJSON(this.name,_);nt("string"===typeof y,e,"internal-error"),Ot(u,e.name),Ot(d,e.name),nt("boolean"===typeof x,e,"internal-error"),nt("boolean"===typeof b,e,"internal-error"),Ot(h,e.name),Ot(p,e.name),Ot(f,e.name),Ot(m,e.name),Ot(g,e.name),Ot(v,e.name);const N=new Mt({uid:y,auth:e,email:d,emailVerified:x,displayName:u,isAnonymous:b,photoURL:p,phoneNumber:h,tenantId:f,stsTokenManager:k,createdAt:g,lastLoginAt:v});return w&&Array.isArray(w)&&(N.providerData=w.map(e=>Object.assign({},e))),m&&(N._redirectEventId=m),N}static async _fromIdTokenResponse(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=new Rt;r.updateFromServerResponse(t);const i=new Mt({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await Pt(i),i}static async _fromGetAccountInfoResponse(e,t,n){const r=t.users[0];nt(void 0!==r.localId,"internal-error");const i=void 0!==r.providerUserInfo?Lt(r.providerUserInfo):[],s=!(r.email&&r.passwordHash)&&!(null===i||void 0===i?void 0:i.length),a=new Rt;a.updateFromIdToken(n);const o=new Mt({uid:r.localId,auth:e,stsTokenManager:a,isAnonymous:s}),l={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new It(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!(null===i||void 0===i?void 0:i.length)};return Object.assign(o,l),o}}const Dt=new Map;function Ft(e){it(e instanceof Function,"Expected a class definition");let t=Dt.get(e);return t?(it(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Dt.set(e,t),t)}class zt{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}zt.type="NONE";const Ut=zt;function Bt(e,t,n){return"firebase".concat(":",e,":").concat(t,":").concat(n)}class Vt{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=Bt(this.userKey,r.apiKey,i),this.fullPersistenceKey=Bt("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Mt._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"authUser";if(!t.length)return new Vt(Ft(Ut),e,n);const r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e);let i=r[0]||Ft(Ut);const s=Bt(n,e.config.apiKey,e.name);let a=null;for(const c of t)try{const t=await c._get(s);if(t){const n=Mt._fromJSON(e,t);c!==i&&(a=n),i=c;break}}catch(l){}const o=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&o.length?(i=o[0],a&&await i._set(s,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch(l){}})),new Vt(i,e,n)):new Vt(i,e,n)}}function qt(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Gt(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Kt(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Qt(t))return"Blackberry";if(Jt(t))return"Webos";if(Ht(t))return"Safari";if((t.includes("chrome/")||Wt(t))&&!t.includes("edge/"))return"Chrome";if(Zt(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null===n||void 0===n?void 0:n.length))return n[1]}return"Other"}function Kt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,Ve.ZQ)();return/firefox\//i.test(e)}function Ht(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,Ve.ZQ)()).toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Wt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,Ve.ZQ)();return/crios\//i.test(e)}function Gt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,Ve.ZQ)();return/iemobile/i.test(e)}function Zt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,Ve.ZQ)();return/android/i.test(e)}function Qt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,Ve.ZQ)();return/blackberry/i.test(e)}function Jt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,Ve.ZQ)();return/webos/i.test(e)}function Yt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,Ve.ZQ)();return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Xt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,Ve.ZQ)();return Yt(e)||Zt(e)||Jt(e)||Qt(e)||/windows phone/i.test(e)||Gt(e)}function $t(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];switch(e){case"Browser":t=qt((0,Ve.ZQ)());break;case"Worker":t="".concat(qt((0,Ve.ZQ)()),"-").concat(e);break;default:t=e}const r=n.length?n.join(","):"FirebaseCore-web";return"".concat(t,"/","JsCore","/").concat(Be.MF,"/").concat(r)}class en{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise((n,r)=>{try{n(e(t))}catch(pu){r(pu)}});n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(pu){t.reverse();for(const r of t)try{r()}catch(n){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null===pu||void 0===pu?void 0:pu.message})}}}class tn{constructor(e){var t,n,r,i;const s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=s.minPasswordLength)&&void 0!==t?t:6,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),void 0!==s.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),void 0!==s.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),void 0!==s.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),void 0!==s.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(r=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==r?r:"",this.forceUpgradeOnSignin=null!==(i=e.forceUpgradeOnSignin)&&void 0!==i&&i,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,r,i,s,a;const o={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,o),this.validatePasswordCharacterOptions(e,o),o.isValid&&(o.isValid=null===(t=o.meetsMinPasswordLength)||void 0===t||t),o.isValid&&(o.isValid=null===(n=o.meetsMaxPasswordLength)||void 0===n||n),o.isValid&&(o.isValid=null===(r=o.containsLowercaseLetter)||void 0===r||r),o.isValid&&(o.isValid=null===(i=o.containsUppercaseLetter)||void 0===i||i),o.isValid&&(o.isValid=null===(s=o.containsNumericCharacter)||void 0===s||s),o.isValid&&(o.isValid=null===(a=o.containsNonAlphanumericCharacter)||void 0===a||a),o}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class nn{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new sn(this),this.idTokenSubscription=new sn(this),this.beforeStateQueue=new en(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Ze,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Ft(t)),this._initializationPromise=this.queue(async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await Vt.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(pu){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await Nt(this,{idToken:e}),n=await Mt._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if((0,Be.xZ)(this.app)){const e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,s=null===r||void 0===r?void 0:r._redirectEventId,a=await this.tryRedirectSignIn(e);n&&n!==s||!(null===a||void 0===a?void 0:a.user)||(r=a.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(pu){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(pu))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return nt(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(pu){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Pt(e)}catch(pu){if((null===pu||void 0===pu?void 0:pu.code)!=="auth/".concat("network-request-failed"))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"===typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if((0,Be.xZ)(this.app))return Promise.reject(et(this));const t=e?(0,Ve.Ku)(e):null;return t&&nt(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._deleted)return e&&nt(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return(0,Be.xZ)(this.app)?Promise.reject(et(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return(0,Be.xZ)(this.app)?Promise.reject(et(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Ft(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e){return ft(e,"GET","/v2/passwordPolicy",pt(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}(this),t=new tn(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Ve.FA("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return ft(e,"POST","/v2/accounts:revokeToken",pt(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Ft(e)||this._popupRedirectResolver;nt(t,this,"argument-error"),this.redirectPersistenceManager=await Vt.create(this,[Ft(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return"".concat(this.config.authDomain,":").concat(this.config.apiKey,":").concat(this.name)}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"===typeof t?t:t.next.bind(t);let s=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(nt(a,this,"internal-error"),a.then(()=>{s||i(this.currentUser)}),"function"===typeof t){const i=e.addObserver(t,n,r);return()=>{s=!0,i()}}{const n=e.addObserver(t);return()=>{s=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return nt(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=$t(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null===t||void 0===t?void 0:t.error)&&function(e){if(Qe.logLevel<=qe.$b.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Qe.warn("Auth (".concat(Be.MF,"): ").concat(e),...n)}}("Error while retrieving App Check token: ".concat(t.error)),null===t||void 0===t?void 0:t.token}}function rn(e){return(0,Ve.Ku)(e)}class sn{constructor(e){this.auth=e,this.observer=null,this.addObserver=(0,Ve.tD)(e=>this.observer=e)}get next(){return nt(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let an={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function on(e){return an.loadJS(e)}function ln(e){return"__".concat(e).concat(Math.floor(1e6*Math.random()))}class cn{constructor(e){this.type="recaptcha-enterprise",this.auth=rn(e)}async verify(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"verify",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];function n(t,n,r){const i=window.grecaptcha;wt(i)?i.enterprise.ready(()=>{i.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n("NO_RECAPTCHA")})}):r(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{kt(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(r=>{if(void 0!==r.recaptchaKey){const n=new _t(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{n(e)})})})(this.auth).then(i=>{if(!t&&wt(window.grecaptcha))n(i,e,r);else{if("undefined"===typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));let t=an.recaptchaEnterpriseScript;0!==t.length&&(t+=i),on(t).then(()=>{n(i,e,r)}).catch(e=>{r(e)})}}).catch(e=>{r(e)})})}}async function un(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=new cn(e);let s;try{s=await i.verify(n)}catch(o){s=await i.verify(n,!0)}const a=Object.assign({},t);return r?Object.assign(a,{captchaResp:s}):Object.assign(a,{captchaResponse:s}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function dn(e,t,n,r){var i;if(null===(i=e._getRecaptchaConfig())||void 0===i?void 0:i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await un(e,t,n,"getOobCode"===n);return r(e,i)}return r(e,t).catch(async i=>{if(i.code==="auth/".concat("missing-recaptcha-token")){console.log("".concat(n," is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow."));const i=await un(e,t,n,"getOobCode"===n);return r(e,i)}return Promise.reject(i)})}function hn(e,t,n){const r=rn(e);nt(r._canInitEmulator,r,"emulator-config-failed"),nt(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null===n||void 0===n?void 0:n.disableWarnings),s=pn(t),{host:a,port:o}=function(e){const t=pn(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:fn(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:fn(t)}}}(t),l=null===o?"":":".concat(o);r.config.emulator={url:"".concat(s,"//").concat(a).concat(l,"/")},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:a,port:o,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!==typeof console&&"function"===typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!==typeof window&&"undefined"!==typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function pn(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function fn(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class mn{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return rt("not implemented")}_getIdTokenResponse(e){return rt("not implemented")}_linkToIdToken(e,t){return rt("not implemented")}_getReauthenticationResolver(e){return rt("not implemented")}}async function gn(e,t){return ft(e,"POST","/v1/accounts:signUp",t)}async function vn(e,t){return gt(e,"POST","/v1/accounts:signInWithPassword",pt(e,t))}class yn extends mn{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new yn(e,t,"password")}static _fromEmailAndCode(e,t){return new yn(e,t,"emailLink",arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e;if((null===t||void 0===t?void 0:t.email)&&(null===t||void 0===t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return dn(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",vn);case"emailLink":return async function(e,t){return gt(e,"POST","/v1/accounts:signInWithEmailLink",pt(e,t))}(e,{email:this._email,oobCode:this._password});default:Ye(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return dn(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",gn);case"emailLink":return async function(e,t){return gt(e,"POST","/v1/accounts:signInWithEmailLink",pt(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:Ye(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function xn(e,t){return gt(e,"POST","/v1/accounts:signInWithIdp",pt(e,t))}class bn extends mn{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new bn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Ye("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=Ke(t,["providerId","signInMethod"]);if(!n||!r)return null;const s=new bn(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return xn(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,xn(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,xn(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=(0,Ve.Am)(t)}return e}}const wn={USER_NOT_FOUND:"user-not-found"};class _n extends mn{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new _n({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new _n({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return gt(e,"POST","/v1/accounts:signInWithPhoneNumber",pt(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await gt(e,"POST","/v1/accounts:signInWithPhoneNumber",pt(e,t));if(n.temporaryProof)throw bt(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return gt(e,"POST","/v1/accounts:signInWithPhoneNumber",pt(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),wn)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"===typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new _n({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class kn{constructor(e){var t,n,r,i,s,a;const o=(0,Ve.I9)((0,Ve.hp)(e)),l=null!==(t=o.apiKey)&&void 0!==t?t:null,c=null!==(n=o.oobCode)&&void 0!==n?n:null,u=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=o.mode)&&void 0!==r?r:null);nt(l&&c&&u,"argument-error"),this.apiKey=l,this.operation=u,this.code=c,this.continueUrl=null!==(i=o.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(s=o.languageCode)&&void 0!==s?s:null,this.tenantId=null!==(a=o.tenantId)&&void 0!==a?a:null}static parseLink(e){const t=function(e){const t=(0,Ve.I9)((0,Ve.hp)(e)).link,n=t?(0,Ve.I9)((0,Ve.hp)(t)).deep_link_id:null,r=(0,Ve.I9)((0,Ve.hp)(e)).deep_link_id;return(r?(0,Ve.I9)((0,Ve.hp)(r)).link:null)||r||n||t||e}(e);try{return new kn(t)}catch(n){return null}}}class Nn{constructor(){this.providerId=Nn.PROVIDER_ID}static credential(e,t){return yn._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=kn.parseLink(t);return nt(n,"argument-error"),yn._fromEmailAndCode(e,n.code,n.tenantId)}}Nn.PROVIDER_ID="password",Nn.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Nn.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Sn{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class jn extends Sn{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class En extends jn{constructor(){super("facebook.com")}static credential(e){return bn._fromParams({providerId:En.PROVIDER_ID,signInMethod:En.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return En.credentialFromTaggedObject(e)}static credentialFromError(e){return En.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return En.credential(t.oauthAccessToken)}catch(n){return null}}}En.FACEBOOK_SIGN_IN_METHOD="facebook.com",En.PROVIDER_ID="facebook.com";class Cn extends jn{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return bn._fromParams({providerId:Cn.PROVIDER_ID,signInMethod:Cn.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Cn.credentialFromTaggedObject(e)}static credentialFromError(e){return Cn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthIdToken:n,oauthAccessToken:r}=t;if(!n&&!r)return null;try{return Cn.credential(n,r)}catch(i){return null}}}Cn.GOOGLE_SIGN_IN_METHOD="google.com",Cn.PROVIDER_ID="google.com";class Tn extends jn{constructor(){super("github.com")}static credential(e){return bn._fromParams({providerId:Tn.PROVIDER_ID,signInMethod:Tn.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Tn.credentialFromTaggedObject(e)}static credentialFromError(e){return Tn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return Tn.credential(t.oauthAccessToken)}catch(n){return null}}}Tn.GITHUB_SIGN_IN_METHOD="github.com",Tn.PROVIDER_ID="github.com";class An extends jn{constructor(){super("twitter.com")}static credential(e,t){return bn._fromParams({providerId:An.PROVIDER_ID,signInMethod:An.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return An.credentialFromTaggedObject(e)}static credentialFromError(e){return An.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=t;if(!n||!r)return null;try{return An.credential(n,r)}catch(i){return null}}}async function In(e,t){return gt(e,"POST","/v1/accounts:signUp",pt(e,t))}An.TWITTER_SIGN_IN_METHOD="twitter.com",An.PROVIDER_ID="twitter.com";class Pn{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=await Mt._fromIdTokenResponse(e,n,r),s=Ln(n);return new Pn({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=Ln(n);return new Pn({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function Ln(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}async function Rn(e){var t;if((0,Be.xZ)(e.app))return Promise.reject(et(e));const n=rn(e);if(await n._initializationPromise,null===(t=n.currentUser)||void 0===t?void 0:t.isAnonymous)return new Pn({user:n.currentUser,providerId:null,operationType:"signIn"});const r=await In(n,{returnSecureToken:!0}),i=await Pn._fromIdTokenResponse(n,"signIn",r,!0);return await n._updateCurrentUser(i.user),i}class On extends Ve.g{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,On.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new On(e,t,n,r)}}function Mn(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if(n.code==="auth/".concat("multi-factor-auth-required"))throw On._fromErrorAndOperation(e,n,t,r);throw n})}async function Dn(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=await Tt(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return Pn._forOperation(e,"link",r)}async function Fn(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{auth:r}=e;if((0,Be.xZ)(r.app))return Promise.reject(et(r));const i="reauthenticate";try{const s=await Tt(e,Mn(r,i,t,e),n);nt(s.idToken,r,"internal-error");const a=Et(s.idToken);nt(a,r,"internal-error");const{sub:o}=a;return nt(e.uid===o,r,"user-mismatch"),Pn._forOperation(e,i,s)}catch(pu){throw(null===pu||void 0===pu?void 0:pu.code)==="auth/".concat("user-not-found")&&Ye(r,"user-mismatch"),pu}}async function zn(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if((0,Be.xZ)(e.app))return Promise.reject(et(e));const r="signIn",i=await Mn(e,r,t),s=await Pn._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(s.user),s}async function Un(e,t){return zn(rn(e),t)}async function Bn(e){const t=rn(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function Vn(e,t){let{displayName:n,photoURL:r}=t;if(void 0===n&&void 0===r)return;const i=(0,Ve.Ku)(e),s={idToken:await i.getIdToken(),displayName:n,photoUrl:r,returnSecureToken:!0},a=await Tt(i,async function(e,t){return ft(e,"POST","/v1/accounts:update",t)}(i.auth,s));i.displayName=a.displayName||null,i.photoURL=a.photoUrl||null;const o=i.providerData.find(e=>{let{providerId:t}=e;return"password"===t});o&&(o.displayName=i.displayName,o.photoURL=i.photoURL),await i._updateTokensIfNecessary(a)}new WeakMap;const qn="__sak";class Kn{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(qn,"1"),this.storage.removeItem(qn),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Hn extends Kn{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Xt(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});const n=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);(0,Ve.lT)()&&10===document.documentMode&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Hn.type="LOCAL";const Wn=Hn;class Gn extends Kn{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Gn.type="SESSION";const Zn=Gn;class Qn{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const n=new Qn(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,s=this.handlersMap[r];if(!(null===s||void 0===s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const a=Array.from(s).map(async e=>e(t.origin,i)),o=await function(e){return Promise.all(e.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}(a);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:o})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Jn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n="";for(let r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}Qn.receivers=[];class Yn{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;const r="undefined"!==typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,s;return new Promise((a,o)=>{const l=Jn("",20);r.port1.start();const c=setTimeout(()=>{o(new Error("unsupported_event"))},n);s={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===l)switch(t.data.status){case"ack":clearTimeout(c),i=setTimeout(()=>{o(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(t.data.response);break;default:clearTimeout(c),clearTimeout(i),o(new Error("invalid_response"))}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[r.port2])}).finally(()=>{s&&this.removeMessageHandler(s)})}}function Xn(){return window}function $n(){return"undefined"!==typeof Xn().WorkerGlobalScope&&"function"===typeof Xn().importScripts}const er="firebaseLocalStorageDb",tr="firebaseLocalStorage",nr="fbase_key";class rr{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function ir(e,t){return e.transaction([tr],t?"readwrite":"readonly").objectStore(tr)}function sr(){const e=indexedDB.open(er,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(tr,{keyPath:nr})}catch(pu){n(pu)}}),e.addEventListener("success",async()=>{const n=e.result;n.objectStoreNames.contains(tr)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(er);return new rr(e).toPromise()}(),t(await sr()))})})}async function ar(e,t,n){const r=ir(e,!0).put({[nr]:t,value:n});return new rr(r).toPromise()}function or(e,t){const n=ir(e,!0).delete(t);return new rr(n).toPromise()}class lr{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await sr()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(pu){if(t++>3)throw pu;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return $n()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Qn._getInstance($n()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new Yn(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&function(){var e;return(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await sr();return await ar(e,qn,"1"),await or(e,qn),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>ar(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(t=>async function(e,t){const n=ir(e,!1).get(t),r=await new rr(n).toPromise();return void 0===r?null:r.value}(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>or(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(e=>{const t=ir(e,!1).getAll();return new rr(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!n.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}lr.type="LOCAL";const cr=lr;ln("rcb"),new lt(3e4,6e4);const ur="recaptcha";async function dr(e,t,n){var r;const i=await n.verify();try{let s;if(nt("string"===typeof i,e,"argument-error"),nt(n.type===ur,e,"argument-error"),s="string"===typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s){nt("enroll"===t.type,e,"internal-error");const n=await function(e,t){return ft(e,"POST","/v2/accounts/mfaEnrollment:start",pt(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:i}});return n.phoneSessionInfo.sessionInfo}{nt("signin"===t.type,e,"internal-error");const n=(null===(r=s.multiFactorHint)||void 0===r?void 0:r.uid)||s.multiFactorUid;nt(n,e,"missing-multi-factor-info");const a=await function(e,t){return ft(e,"POST","/v2/accounts/mfaSignIn:start",pt(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:i}});return a.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return ft(e,"POST","/v1/accounts:sendVerificationCode",pt(e,t))}(e,{phoneNumber:s.phoneNumber,recaptchaToken:i});return t}}finally{n._reset()}}class hr{constructor(e){this.providerId=hr.PROVIDER_ID,this.auth=rn(e)}verifyPhoneNumber(e,t){return dr(this.auth,e,(0,Ve.Ku)(t))}static credential(e,t){return _n._fromVerification(e,t)}static credentialFromResult(e){const t=e;return hr.credentialFromTaggedObject(t)}static credentialFromError(e){return hr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{phoneNumber:n,temporaryProof:r}=t;return n&&r?_n._fromTokenResponse(n,r):null}}function pr(e,t){return t?Ft(t):(nt(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}hr.PROVIDER_ID="phone",hr.PHONE_SIGN_IN_METHOD="phone";class fr extends mn{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return xn(e,this._buildIdpRequest())}_linkToIdToken(e,t){return xn(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return xn(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function mr(e){return zn(e.auth,new fr(e),e.bypassAuthState)}function gr(e){const{auth:t,user:n}=e;return nt(n,t,"internal-error"),Fn(n,new fr(e),e.bypassAuthState)}async function vr(e){const{auth:t,user:n}=e;return nt(n,t,"internal-error"),Dn(n,new fr(e),e.bypassAuthState)}class yr{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(pu){this.reject(pu)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:a}=e;if(s)return void this.reject(s);const o={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(o))}catch(pu){this.reject(pu)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return mr;case"linkViaPopup":case"linkViaRedirect":return vr;case"reauthViaPopup":case"reauthViaRedirect":return gr;default:Ye(this.auth,"internal-error")}}resolve(e){it(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){it(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const xr=new lt(2e3,1e4);class br extends yr{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,br.currentPopupAction&&br.currentPopupAction.cancel(),br.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return nt(e,this.auth,"internal-error"),e}async onExecution(){it(1===this.filter.length,"Popup operations only handle one event");const e=Jn();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(Xe(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(Xe(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,br.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Xe(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(e,xr.get())};e()}}br.currentPopupAction=null;const wr=new Map;class _r extends yr{constructor(e,t){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.eventId=null}async execute(){let e=wr.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=Sr(t),r=Nr(e);if(!await r._isAvailable())return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth),n=t?await super.execute():null;e=()=>Promise.resolve(n)}catch(pu){e=()=>Promise.reject(pu)}wr.set(this.auth._key(),e)}return this.bypassAuthState||wr.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function kr(e,t){wr.set(e._key(),t)}function Nr(e){return Ft(e._redirectPersistence)}function Sr(e){return Bt("pendingRedirect",e.config.apiKey,e.name)}async function jr(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if((0,Be.xZ)(e.app))return Promise.reject(et(e));const r=rn(e),i=pr(r,t),s=new _r(r,i,n),a=await s.execute();return a&&!n&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,t)),a}class Er{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Tr(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!Tr(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(Xe(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Cr(e))}saveEventToCache(e){this.cachedEventUids.add(Cr(e)),this.lastProcessedEventTime=Date.now()}}function Cr(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function Tr(e){let{type:t,error:n}=e;return"unknown"===t&&(null===n||void 0===n?void 0:n.code)==="auth/".concat("no-auth-event")}const Ar=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Ir=/^https?/;async function Pr(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e){return ft(e,"GET","/v1/projects",arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}(e);for(const r of t)try{if(Lr(r))return}catch(n){}Ye(e,"unauthorized-domain")}function Lr(e){const t=st(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!Ir.test(n))return!1;if(Ar.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const Rr=new lt(3e4,6e4);function Or(){const e=Xn().___jsl;if(null===e||void 0===e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}function Mr(e){return new Promise((t,n)=>{var r,i,s;function a(){Or(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Or(),n(Xe(e,"network-request-failed"))},timeout:Rr.get()})}if(null===(i=null===(r=Xn().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=Xn().gapi)||void 0===s?void 0:s.load)){const t=ln("iframefcb");return Xn()[t]=()=>{gapi.load?a():n(Xe(e,"network-request-failed"))},on("".concat(an.gapiScript,"?onload=").concat(t)).catch(e=>n(e))}a()}}).catch(e=>{throw Dr=null,e})}let Dr=null;const Fr=new lt(5e3,15e3),zr={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Ur=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Br(e){const t=e.config;nt(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?ct(t,"emulator/auth/iframe"):"https://".concat(e.config.authDomain,"/").concat("__/auth/iframe"),r={apiKey:t.apiKey,appName:e.name,v:Be.MF},i=Ur.get(e.config.apiHost);i&&(r.eid=i);const s=e._getFrameworks();return s.length&&(r.fw=s.join(",")),"".concat(n,"?").concat((0,Ve.Am)(r).slice(1))}async function Vr(e){const t=await function(e){return Dr=Dr||Mr(e),Dr}(e),n=Xn().gapi;return nt(n,e,"internal-error"),t.open({where:document.body,url:Br(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:zr,dontclear:!0},t=>new Promise(async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=Xe(e,"network-request-failed"),s=Xn().setTimeout(()=>{r(i)},Fr.get());function a(){Xn().clearTimeout(s),n(t)}t.ping(a).then(a,()=>{r(i)})}))}const qr={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Kr{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(pu){}}}function Hr(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:600;const s=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let o="";const l=Object.assign(Object.assign({},qr),{width:r.toString(),height:i.toString(),top:s,left:a}),c=(0,Ve.ZQ)().toLowerCase();n&&(o=Wt(c)?"_blank":n),Kt(c)&&(t=t||"http://localhost",l.scrollbars="yes");const u=Object.entries(l).reduce((e,t)=>{let[n,r]=t;return"".concat(e).concat(n,"=").concat(r,",")},"");if(function(){var e;return Yt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,Ve.ZQ)())&&!!(null===(e=window.navigator)||void 0===e?void 0:e.standalone)}(c)&&"_self"!==o)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",o),new Kr(null);const d=window.open(t||"",o,u);nt(d,e,"popup-blocked");try{d.focus()}catch(pu){}return new Kr(d)}const Wr="__/auth/handler",Gr="emulator/auth/handler",Zr=encodeURIComponent("fac");async function Qr(e,t,n,r,i,s){nt(e.config.authDomain,e,"auth-domain-config-required"),nt(e.config.apiKey,e,"invalid-api-key");const a={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:Be.MF,eventId:i};if(t instanceof Sn){t.setDefaultLanguage(e.languageCode),a.providerId=t.providerId||"",(0,Ve.Im)(t.getCustomParameters())||(a.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(s||{}))a[e]=t}if(t instanceof jn){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(a.scopes=e.join(","))}e.tenantId&&(a.tid=e.tenantId);const o=a;for(const u of Object.keys(o))void 0===o[u]&&delete o[u];const l=await e._getAppCheckToken(),c=l?"#".concat(Zr,"=").concat(encodeURIComponent(l)):"";return"".concat(function(e){let{config:t}=e;if(!t.emulator)return"https://".concat(t.authDomain,"/").concat(Wr);return ct(t,Gr)}(e),"?").concat((0,Ve.Am)(o).slice(1)).concat(c)}const Jr="webStorageSupport";const Yr=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Zn,this._completeRedirectFn=jr,this._overrideRedirectResult=kr}async _openPopup(e,t,n,r){var i;it(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()");return Hr(e,await Qr(e,t,n,st(),r),Jn())}async _openRedirect(e,t,n,r){await this._originValidation(e);return function(e){Xn().location.href=e}(await Qr(e,t,n,st(),r)),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(it(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await Vr(e),n=new Er(e);return t.register("authEvent",t=>{nt(null===t||void 0===t?void 0:t.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Jr,{type:Jr},n=>{var r;const i=null===(r=null===n||void 0===n?void 0:n[0])||void 0===r?void 0:r[Jr];void 0!==i&&t(!!i),Ye(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Pr(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Xt()||Ht()||Yt()}};var Xr="@firebase/auth",$r="1.7.9";class ei{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e((null===t||void 0===t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){nt(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const ti=(0,Ve.XA)("authIdTokenMaxAge")||300;let ni=null;function ri(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,Be.Sx)();const t=(0,Be.j6)(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=(0,Be.j6)(e,"auth");if(n.isInitialized()){const e=n.getImmediate(),r=n.getOptions();if((0,Ve.bD)(r,null!==t&&void 0!==t?t:{}))return e;Ye(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:Yr,persistence:[cr,Wn,Zn]}),r=(0,Ve.XA)("authTokenSyncURL");if(r&&"boolean"===typeof isSecureContext&&isSecureContext){const e=new URL(r,location.origin);if(location.origin===e.origin){const t=(i=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>ti)return;const r=null===t||void 0===t?void 0:t.token;ni!==r&&(ni=r,await fetch(i,{method:r?"POST":"DELETE",headers:r?{Authorization:"Bearer ".concat(r)}:{}}))});!function(e,t,n){(0,Ve.Ku)(e).beforeAuthStateChanged(t,n)}(n,t,()=>t(n.currentUser)),function(e,t,n,r){(0,Ve.Ku)(e).onIdTokenChanged(t,n,r)}(n,e=>t(e))}}var i;const s=(0,Ve.Tj)("auth");return s&&hn(n,"http://".concat(s)),n}var ii;an={loadJS:e=>new Promise((t,n)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=Xe("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(r)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},ii="Browser",(0,Be.om)(new He.uA("auth",(e,t)=>{let{options:n}=t;const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=r.options;nt(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:a,authDomain:o,clientPlatform:ii,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:$t(ii)},c=new nn(r,i,s,l);return function(e,t){const n=(null===t||void 0===t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(Ft);(null===t||void 0===t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null===t||void 0===t?void 0:t.popupRedirectResolver)}(c,n),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),(0,Be.om)(new He.uA("auth-internal",e=>(e=>new ei(e))(rn(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),(0,Be.KO)(Xr,$r,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(ii)),(0,Be.KO)(Xr,$r,"esm2017");var si=n(5472);(0,Be.KO)("firebase","10.14.1","app");const ai={apiKey:"AIzaSyArvQzOJTrtsekOK9Wpgi3PezPcM9KmXyY",authDomain:"geoquest2-7e45c.firebaseapp.com",projectId:"geoquest2-7e45c",storageBucket:"geoquest2-7e45c.firebasestorage.app",messagingSenderId:"614868886377",appId:"1:614868886377:web:3c020075969956ef1813f8",measurementId:"G-L45RHX7MCN"},oi=["apiKey","authDomain","projectId","appId"],li=oi.every(e=>{const t=ai[e];return"string"===typeof t&&t.trim().length>0});let ci=null,ui=null,di=null;const hi=()=>{if(!li)throw new Error("Firebase \xe4r inte konfigurerat. Kontrollera att f\xf6ljande milj\xf6variabler \xe4r satta i .env:\n"+oi.map(e=>"REACT_APP_FIREBASE_".concat(e.toUpperCase())).join("\n"));if(ci)return ci;const e=(0,Be.Dk)();if(e.length>0)return ci=e[0],ci;try{return ci=(0,Be.Wp)(ai),ci}catch(t){throw new Error("Kunde inte initialisera Firebase: ".concat(t.message))}},pi=()=>{if(!ui){const e=hi();ui=(0,si.aU)(e)}return ui},fi=()=>{if(!di){const e=hi();di=ri(e)}return di},mi=()=>li,gi=pi(),vi=fi(),yi="geoquest:preferences";const xi=new class{getPreferences(){try{const e=localStorage.getItem(yi);return e?JSON.parse(e):{}}catch(e){return console.error("[UserPreferences] Kunde inte l\xe4sa preferenser:",e),{}}}savePreferences(e){try{localStorage.setItem(yi,JSON.stringify(e)),"undefined"!==typeof window&&window.dispatchEvent(new Event("userPreferences:changed"))}catch(t){console.error("[UserPreferences] Kunde inte spara preferenser:",t)}}getAlias(){return this.getPreferences().alias||""}saveAlias(e){const t=this.getPreferences();t.alias=e,this.savePreferences(t)}removeAlias(){const e=this.getPreferences();"alias"in e&&(delete e.alias,this.savePreferences(e))}getContact(){return this.getPreferences().contact||""}saveContact(e){const t=this.getPreferences();t.contact=e,this.savePreferences(t)}removeContact(){const e=this.getPreferences();"contact"in e&&(delete e.contact,this.savePreferences(e))}clearPreferences(){try{localStorage.removeItem(yi),"undefined"!==typeof window&&window.dispatchEvent(new Event("userPreferences:changed"))}catch(e){console.error("[UserPreferences] Kunde inte rensa preferenser:",e)}}};var bi=n(579);const wi="tipspromenad:auth",_i=(0,t.createContext)(),ki=mi(),Ni=ki?fi():null,Si=ki?pi():null,ji=async function(e){var t,n,r;let{profileOverride:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!Si||!e)return;const s=(0,si.H9)(Si,"users",e.uid);let a=null;try{a=await(0,si.x7)(s)}catch(c){0}const o=null!==(t=a)&&void 0!==t&&t.exists()?a.data():null,l={profile:{displayName:(null===i||void 0===i?void 0:i.displayName)||e.displayName||e.email||"Anv\xe4ndare",contact:null!==(n=null!==(r=null===i||void 0===i?void 0:i.contact)&&void 0!==r?r:e.email)&&void 0!==n?n:null},email:e.email||null};null!==o&&void 0!==o&&o.createdAt||(l.createdAt=(0,si.O5)()),await(0,si.BN)(s,l,{merge:!0})},Ei=e=>{let{children:n}=e;const[r,i]=(0,t.useState)(()=>ki?null:(()=>{if("undefined"===typeof window)return null;try{const e=window.localStorage.getItem(wi);return e?JSON.parse(e):null}catch(e){return console.warn("Kunde inte l\xe4sa auth fr\xe5n storage",e),null}})()),[s,a]=(0,t.useState)(!ki);(0,t.useEffect)(()=>{ki||((e=>{if("undefined"!==typeof window)try{e?window.localStorage.setItem(wi,JSON.stringify(e)):window.localStorage.removeItem(wi)}catch(t){console.warn("Kunde inte skriva auth till storage",t)}})(r),a(!0))},[r]);const o=(0,t.useCallback)(async e=>{if(!ki)return null;if(!e)return i(null),a(!0),null;try{0;const t=await(async e=>{if(!Si||!e)return null;const t=(0,si.H9)(Si,"users",e.uid),n=await(0,si.x7)(t),r=n.exists()?n.data():{},i=r.profile||{},s=!0===r.isSuperUser;return{id:e.uid,name:i.displayName||e.displayName||e.email||"Anv\xe4ndare",email:e.email||null,contact:i.contact||e.email||null,isAnonymous:e.isAnonymous,isSuperUser:s,profile:i}})(e);return t?(i(t),a(!0),t):(i(null),a(!0),null)}catch(t){return console.warn("Kunde inte tolka Firebase-anv\xe4ndare",t),i(null),a(!0),null}},[]);(0,t.useEffect)(()=>{if(!ki||!Ni)return;const e=function(e,t,n,r){return(0,Ve.Ku)(e).onAuthStateChanged(t,n,r)}(Ni,async e=>{if(!e)try{const e=await Rn(Ni),t=xi.getAlias(),n=xi.getContact();return void((t||n)&&await ji(e.user,{profileOverride:{displayName:t||"G\xe4st",contact:n||null}}))}catch(t){console.error("[Auth] Kunde inte skapa anonym anv\xe4ndare:",t)}o(e)});return e},[o]);const l=(0,t.useCallback)(async e=>{let{email:t,password:n,name:r}=e;if(!ki){const e={id:Ue(),name:r||"Anv\xe4ndare",email:t,contact:t,isAnonymous:!1,isSuperUser:!1};return i(e),a(!0),e}if(!t||!n)throw new Error("Ange e-post och l\xf6senord.");const s=await function(e,t,n){return(0,Be.xZ)(e.app)?Promise.reject(et(e)):Un((0,Ve.Ku)(e),Nn.credential(t,n)).catch(async t=>{throw t.code==="auth/".concat("password-does-not-meet-requirements")&&Bn(e),t})}(Ni,t,n);return r&&s.user.displayName!==r&&await Vn(s.user,{displayName:r}),await ji(s.user,{profileOverride:{displayName:r||s.user.displayName}}),await o(s.user),s.user},[o]),c=(0,t.useCallback)(async e=>{let{name:t,email:n,password:r,contact:s}=e;if(!ki){if(null===t||void 0===t||!t.trim())throw new Error("Ange ett namn.");const e={id:Ue(),name:t.trim(),email:n||null,contact:s||n||null,isAnonymous:!1,isSuperUser:!1};return i(e),a(!0),e}if(null===t||void 0===t||!t.trim()||null===n||void 0===n||!n.trim()||!r)throw new Error("Fyll i namn, e-post och l\xf6senord f\xf6r att registrera.");const l=await async function(e,t,n){if((0,Be.xZ)(e.app))return Promise.reject(et(e));const r=rn(e),i=dn(r,{returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",In),s=await i.catch(t=>{throw t.code==="auth/".concat("password-does-not-meet-requirements")&&Bn(e),t}),a=await Pn._fromIdTokenResponse(r,"signIn",s);return await r._updateCurrentUser(a.user),a}(Ni,n.trim(),r);return l.user.displayName!==t.trim()&&await Vn(l.user,{displayName:t.trim()}),await ji(l.user,{profileOverride:{displayName:t.trim(),contact:s||n.trim()}}),await o(l.user),l.user},[o]),u=(0,t.useCallback)(async e=>{let{alias:t,contact:n}=e;if(!ki){const e={id:Ue(),name:t||"G\xe4st",contact:n||null,isAnonymous:!0,isSuperUser:!1};return i(e),a(!0),e}try{t&&xi.saveAlias(t),n&&xi.saveContact(n);const e=Ni.currentUser;if(e&&e.isAnonymous)return await ji(e,{profileOverride:{displayName:t||e.displayName||"G\xe4st",contact:n||null}}),await o(e),e;const r=await Rn(Ni);return await ji(r.user,{profileOverride:{displayName:t||r.user.displayName||"G\xe4st",contact:n||null}}),await o(r.user),r.user}catch(r){if("auth/admin-restricted-operation"===r.code){console.warn("[Auth] Anonymous login disabled in Firebase, using offline mode");const e={id:Ue(),name:t||"G\xe4st",contact:n||null,isAnonymous:!0,isSuperUser:!1};return i(e),a(!0),e}throw r}},[o]),d=(0,t.useCallback)(async()=>{ki?await function(e){return(0,Ve.Ku)(e).signOut()}(Ni):(i(null),a(!0))},[]),h=(0,t.useMemo)(()=>({currentUser:r,isAuthenticated:Boolean(r),isSuperUser:!0===(null===r||void 0===r?void 0:r.isSuperUser),isAuthInitialized:s,login:l,register:c,loginAsGuest:u,logout:d,usesFirebaseAuth:ki}),[r,s,l,c,u,d]);return(0,bi.jsx)(_i.Provider,{value:h,children:n})},Ci=()=>{const e=(0,t.useContext)(_i);if(!e)throw new Error("useAuth m\xe5ste anv\xe4ndas inom AuthProvider");return e};var Ti=n(2555);const Ai=[{id:"q-geography-1",difficulty:"adult",audience:"adult",category:"Geografi",languages:{sv:{text:"Vilken \xe4r Sveriges h\xf6gsta fj\xe4lltopp?",options:["Kebnekaise","Helags","Sarektj\xe5kk\xe5","\xc5reskutan"],explanation:"Kebnekaise \xe4r Sveriges h\xf6gsta berg med sydtoppen 2 095,6 meter \xf6ver havet."},en:{text:"What is Sweden's highest mountain peak?",options:["Kebnekaise","Helags","Sarektj\xe5kk\xe5","\xc5reskutan"],explanation:"Kebnekaise is Sweden's highest mountain with the southern peak at 2,095.6 meters above sea level."}},correctOption:0},{id:"q-geography-2",difficulty:"family",audience:"family",category:"Geografi",languages:{sv:{text:"Vilken svensk stad kallas f\xf6r Lilla London?",options:["G\xf6teborg","Malm\xf6","Stockholm","Uppsala"],explanation:"Smeknamnet kom under 1800-talet d\xe5 m\xe5nga britter flyttade till G\xf6teborg."},en:{text:"Which Swedish city is called Little London?",options:["Gothenburg","Malm\xf6","Stockholm","Uppsala"],explanation:"The nickname came in the 19th century when many Britons moved to Gothenburg."}},correctOption:0},{id:"q-animals-1",difficulty:"kid",audience:"kid",category:"Djur",languages:{sv:{text:'Vilket djur s\xe4ger "kuckeliku"?',options:["Hund","Katt","Tupp","Ko"],explanation:"Tuppen \xe4r den som gal kuckeliku p\xe5 morgonen."},en:{text:'Which animal says "cock-a-doodle-doo"?',options:["Dog","Cat","Rooster","Cow"],explanation:"The rooster is the one that crows cock-a-doodle-doo in the morning."}},correctOption:2},{id:"q-history-1",difficulty:"adult",audience:"adult",category:"Historia",languages:{sv:{text:"N\xe4r blev Sverige medlem i EU?",options:["1993","1995","1998","2001"],explanation:"Sverige gick med i EU den 1 januari 1995."},en:{text:"When did Sweden become a member of the EU?",options:["1993","1995","1998","2001"],explanation:"Sweden joined the EU on January 1, 1995."}},correctOption:1},{id:"q-science-1",difficulty:"family",audience:"family",category:"Naturvetenskap",languages:{sv:{text:"Hur m\xe5nga planeter finns det i v\xe5rt solsystem?",options:["7","8","9","10"],explanation:"Sedan Pluto omklassificerades finns \xe5tta planeter kvar."},en:{text:"How many planets are there in our solar system?",options:["7","8","9","10"],explanation:"Since Pluto was reclassified, eight planets remain."}},correctOption:1},{id:"q-sport-1",difficulty:"adult",audience:"adult",category:"Sport",languages:{sv:{text:"Vilken svensk vann Wimbledon 1990?",options:["Bj\xf6rn Borg","Stefan Edberg","Mats Wilander","Robin S\xf6derling"],explanation:"Stefan Edberg vann Wimbledon b\xe5de 1988 och 1990."},en:{text:"Which Swede won Wimbledon in 1990?",options:["Bj\xf6rn Borg","Stefan Edberg","Mats Wilander","Robin S\xf6derling"],explanation:"Stefan Edberg won Wimbledon in both 1988 and 1990."}},correctOption:1},{id:"q-riddle-1",difficulty:"kid",audience:"kid",category:"G\xe5tor",languages:{sv:{text:"Jag har ett huvud och en fot men ingen kropp, vad \xe4r jag?",options:["En svamp","Ett bord","En s\xe4ng","En stol"],explanation:"En s\xe4ng har b\xe5de huvuds- och fot\xe4nde."},en:{text:"I have a head and a foot but no body, what am I?",options:["A mushroom","A table","A bed","A chair"],explanation:"A bed has both a headboard and a footboard."}},correctOption:2},{id:"q-nature-1",difficulty:"family",audience:"family",category:"Natur",languages:{sv:{text:"Vid vilken temperatur fryser vatten?",options:["0 \xb0C","10 \xb0C","32 \xb0C","100 \xb0C"],explanation:"Vatten fryser vid 0 \xb0C under normala f\xf6rh\xe5llanden."},en:{text:"At what temperature does water freeze?",options:["0 \xb0C","10 \xb0C","32 \xb0C","100 \xb0C"],explanation:"Water freezes at 0 \xb0C under normal conditions."}},correctOption:0}],Ii="questions",Pi={listQuestions:async()=>{const e=pi();return(await(0,si.getDocs)((0,si.rJ)(e,Ii))).docs.map(e=>(0,Ti.A)({id:e.id},e.data()))},getQuestion:async e=>{if(!e)return null;const t=pi(),n=await(0,si.x7)((0,si.H9)(t,Ii,e));return n.exists()?(0,Ti.A)({id:n.id},n.data()):null},getQuestionsByIds:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!Array.isArray(e)||0===e.length)return[];const t=pi(),n=e.map(e=>(0,si.x7)((0,si.H9)(t,Ii,e)));return(await Promise.all(n)).filter(e=>e.exists()).map(e=>(0,Ti.A)({id:e.id},e.data()))},subscribeToQuestions:e=>{const t=pi(),n=(0,si.rJ)(t,Ii);return(0,si.aQ)(n,t=>{const n=t.docs.map(e=>(0,Ti.A)({id:e.id},e.data()));e(n)},t=>{console.error("[Firestore] Error in questions subscription:",t),e([])})},deleteQuestion:async e=>{const t=pi();await(0,si.deleteDoc)((0,si.H9)(t,Ii,e))},deleteQuestions:async e=>{if(!e||0===e.length)return;const t=pi(),n=(0,si.wP)(t);e.forEach(e=>{const r=(0,si.H9)(t,Ii,e);n.delete(r)}),await n.commit()},addManyQuestions:async e=>{if(!e||0===e.length)return;const t=pi(),n=(0,si.wP)(t);e.forEach(e=>{const r=(0,si.H9)(t,Ii,e.id),i=(0,Ti.A)((0,Ti.A)({},e),{},{createdAt:e.createdAt||(0,si.O5)()});n.set(r,i,{merge:!0})}),await n.commit()},updateQuestion:async(e,t)=>{const n=pi(),r=(0,si.H9)(n,Ii,e);await(0,si.mZ)(r,t)},updateManyQuestions:async e=>{if(!e||0===e.length)return;const t=pi();for(let n=0;n<e.length;n+=500){const r=(0,si.wP)(t);e.slice(n,n+500).forEach(e=>{let{questionId:n,updateData:i}=e;const s=(0,si.H9)(t,Ii,n);r.update(s,i)}),await r.commit()}}},Li=Pi,Ri=async e=>{await Li.deleteQuestion(e)},Oi=async e=>{await Li.deleteQuestions(e)},Mi=async()=>Li.listQuestions(),Di=async e=>Li.getQuestionsByIds(e),Fi=async(e,t)=>{await Li.updateQuestion(e,t)},zi=async(e,t)=>{const n=ri().currentUser;if(!n)throw new Error("User must be authenticated to queue tasks.");const r=await fetch((e=>"https://".concat("europe-west1","-").concat("geoquest2-7e45c",".cloudfunctions.net/").concat(e))(e),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(await n.getIdToken())},body:JSON.stringify(t)}),i=await r.json();if(!r.ok)throw new Error(i.error||"Failed to queue task with ".concat(e));return i},Ui=async e=>{let{amount:t,category:n,ageGroup:r,difficulty:i,provider:s}=e;return await zi("generateAIQuestions",{amount:t,category:n,ageGroup:r,difficulty:i,provider:s})},Bi=async e=>{let{question:t,options:n,correctOption:r,explanation:i}=e;return await zi("validateQuestionWithAI",{question:t,options:n,correctOption:r,explanation:i})},Vi=async e=>{let{questions:t}=e;return await zi("batchValidateQuestions",{questions:t})},qi=async e=>{let{questionId:t,provider:n}=e;return await zi("regenerateQuestionEmoji",{questionId:t,provider:n})},Ki=async e=>{let{questionIds:t}=e;return await zi("batchRegenerateEmojis",{questionIds:t})},Hi=["children","youth","adults"],Wi={easy:["children"],medium:["youth"],hard:["adults"],kid:["children"],family:["children","adults"],adult:["adults"]},Gi={barn:["children"],kid:["children"],children:["children"],ungdom:["youth"],youth:["youth"],vuxen:["adults"],adult:["adults"],familj:["children","adults"],family:["children","adults"]},Zi=["swedish","english","international","global","german","norwegian","danish"],Qi=e=>"string"===typeof e?e.toLowerCase().trim():"",Ji=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"sv";const n=[],r=((e,t)=>e.languages?e.languages[t]:{text:e.text,options:e.options,explanation:e.explanation})(e,t);if(!r)return n.push("Fr\xe5gan saknar ".concat("sv"===t?"svensk":"engelsk"," \xf6vers\xe4ttning")),{valid:!1,errors:n};const{text:i,options:s,explanation:a}=r,o=e.correctOption;if((!i||i.trim().length<10)&&n.push("Fr\xe5getexten m\xe5ste vara minst 10 tecken l\xe5ng"),Array.isArray(s))if(4!==s.length)n.push("Fr\xe5gan m\xe5ste ha exakt 4 svarsalternativ (har ".concat(s.length,")"));else{s.forEach((e,t)=>{e&&0!==e.trim().length||n.push("Alternativ ".concat(t+1," \xe4r tomt"))});new Set(s.map(e=>e.trim().toLowerCase())).size!==s.length&&n.push("Flera svarsalternativ \xe4r identiska");const e=Yi(s);e.length>0&&n.push("Varning: Dessa alternativ verkar liknande: ".concat(e.join(", ")))}else n.push("Fr\xe5gan m\xe5ste ha svarsalternativ");"number"!==typeof o?n.push("Fr\xe5gan m\xe5ste ha ett korrekt svar angivet (correctOption)"):(o<0||o>=((null===s||void 0===s?void 0:s.length)||0))&&n.push("Korrekt svar (".concat(o,") \xe4r utanf\xf6r giltigt intervall (0-").concat(((null===s||void 0===s?void 0:s.length)||1)-1,")")),(!a||a.trim().length<10)&&n.push("F\xf6rklaringen m\xe5ste vara minst 10 tecken l\xe5ng");const l=(e=>{const t=new Set;Array.isArray(e.ageGroups)&&e.ageGroups.forEach(e=>{const n=Qi(e);Hi.includes(n)&&t.add(n)});const n=Qi(e.difficulty);Wi[n]&&Wi[n].forEach(e=>t.add(e));const r=Qi(e.audience);return Gi[r]&&Gi[r].forEach(e=>t.add(e)),Array.from(t)})(e);0===l.length&&n.push("Fr\xe5gan m\xe5ste ha minst en ageGroup (children/youth/adults)");const c=(e=>{const t=Qi(e.targetAudience);if(t)return t;const n=Qi(e.audience);return n||""})(e);c?Zi.includes(c)||n.push("Fr\xe5gan m\xe5ste ha en giltig targetAudience (".concat(Zi.join("/"),")")):n.push("Fr\xe5gan m\xe5ste ha en targetAudience (t.ex. swedish/english/international)");const u=(e=>Array.isArray(e.categories)?e.categories.filter(e=>"string"===typeof e).map(e=>e.trim()).filter(e=>e.length>0):"string"===typeof e.category&&e.category.trim().length>0?[e.category.trim()]:[])(e);return 0===u.length&&n.push("Fr\xe5gan m\xe5ste ha minst en kategori"),e.languages&&(e.languages.sv||n.push("Fr\xe5gan saknar svensk \xf6vers\xe4ttning"),e.languages.en||n.push("Fr\xe5gan saknar engelsk \xf6vers\xe4ttning")),{valid:0===n.length,errors:n}},Yi=e=>{const t=[];for(let n=0;n<e.length;n++)for(let r=n+1;r<e.length;r++){Xi(e[n],e[r])>.8&&t.push('"'.concat(e[n],'" \u2248 "').concat(e[r],'"'))}return t},Xi=(e,t)=>{const n=e.toLowerCase().trim(),r=t.toLowerCase().trim();if(n===r)return 1;return 1-$i(n,r)/Math.max(n.length,r.length)},$i=(e,t)=>{const n=e.length,r=t.length,i=Array(n+1).fill(null).map(()=>Array(r+1).fill(0));for(let s=0;s<=n;s++)i[s][0]=s;for(let s=0;s<=r;s++)i[0][s]=s;for(let s=1;s<=n;s++)for(let n=1;n<=r;n++)e[s-1]===t[n-1]?i[s][n]=i[s-1][n-1]:i[s][n]=Math.min(i[s-1][n]+1,i[s][n-1]+1,i[s-1][n-1]+1);return i[n][r]},es=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"sv",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.85;const r=[],i=new Set;for(let c=0;c<e.length;c++)for(let u=c+1;u<e.length;u++){var s,a,o,l;const d=e[c],h=e[u],p=[d.id,h.id].sort().join("-");if(i.has(p))continue;i.add(p);const f=(null===(s=d.languages)||void 0===s||null===(a=s[t])||void 0===a?void 0:a.text)||"",m=(null===(o=h.languages)||void 0===o||null===(l=o[t])||void 0===l?void 0:l.text)||"";if(!f||!m)continue;const g=Xi(f,m);g>=n&&r.push({question1:d,question2:h,similarity:Math.round(100*g),text1:f,text2:m,pairId:p})}return r.sort((e,t)=>t.similarity-e.similarity)};let ts=[],ns=new Map,rs=!1,is=null;const ss=new Set,as=()=>{ss.forEach(e=>e([...ts]))},os=()=>{var e;e=Array.from(ns.values()),ts=e.sort((e,t)=>{var n,r;const i=null!==(n=e.createdAt)&&void 0!==n&&n.toMillis?e.createdAt.toMillis():0;return(null!==(r=t.createdAt)&&void 0!==r&&r.toMillis?t.createdAt.toMillis():0)-i})},ls=async()=>{try{const e=await Mi();return ns=new Map(e.map(e=>[e.id,e])),os(),rs=!0,as(),ts}catch(e){throw console.error("[questionService] Kunde inte ladda fr\xe5gor fr\xe5n Firestore:",e),ns=new Map,ts=[],rs=!0,as(),e}},cs=async()=>rs?ts:(is||(is=ls().finally(()=>{is=null})),is),us=(e,t)=>{const n=ns.get(e);if(!n)return!1;const r="function"===typeof t?t(n):(0,Ti.A)((0,Ti.A)({},n),t);return ns.set(e,r),os(),as(),!0},ds=async(e,t)=>{await cs();try{var n;const r=t?JSON.parse(JSON.stringify(t)):null,i=ns.get(e),s="structure"===(null===i||void 0===i||null===(n=i.aiValidationResult)||void 0===n?void 0:n.validationType),a={structureValidationResult:r,structureValidatedAt:new Date};return s&&(a.aiValidationResult=null),await Fi(e,a),us(e,e=>(0,Ti.A)((0,Ti.A)({},e),a)),!0}catch(r){throw console.error("[questionService] Kunde inte uppdatera strukturvalidering:",r),r}},hs=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=(Array.isArray(e)?e:[e]).filter(e=>e&&!ns.has(e));if(0!==t.length)try{const e=await Di(t);e.length>0&&(e.forEach(e=>{e&&ns.set(e.id,e)}),os(),as())}catch(n){console.error("[questionService] Kunde inte ladda fr\xe5gor efter id:",n)}},ps=e=>{var t,n;const r=e.languages?(0,Ti.A)({},e):(0,Ti.A)((0,Ti.A)({},e),{},{languages:{sv:{text:e.text,options:e.options,explanation:e.explanation||"Ingen f\xf6rklaring tillg\xe4nglig"}}}),i=(null===(t=r.languages)||void 0===t?void 0:t.sv)||{text:"",options:[]},s=(null===(n=r.languages)||void 0===n?void 0:n.en)||{text:i.text,options:i.options,explanation:i.explanation};r.languages={sv:{text:i.text||s.text||"",options:Array.isArray(i.options)&&4===i.options.length?i.options:s.options||[],explanation:i.explanation||s.explanation||""},en:{text:s.text||i.text||"",options:Array.isArray(s.options)&&4===s.options.length?s.options:i.options||[],explanation:s.explanation||i.explanation||""}};let a=[];Array.isArray(r.categories)&&r.categories.length>0?a=r.categories:r.category&&(a=[r.category]),a=a.filter(e=>"string"===typeof e&&e.trim().length>0).map(e=>e.trim()),0===a.length&&(a=["Allm\xe4nt"]);let o=[];if(Array.isArray(r.ageGroups)&&r.ageGroups.length>0)o=r.ageGroups;else{const e=r.audience||r.difficulty;"kid"!==e&&"children"!==e||o.push("children"),"youth"!==e&&"medium"!==e||o.push("youth"),"adult"!==e&&"adults"!==e&&"difficult"!==e||o.push("adults")}0===o.length&&(o=["adults"]),o=Array.from(new Set(o));const l=r.targetAudience||"swedish";let c=r.correctOption;if("string"===typeof c){const e=parseInt(c,10);Number.isNaN(e)||(c=e)}return(0,Ti.A)((0,Ti.A)({},r),{},{categories:a,ageGroups:o,targetAudience:l,correctOption:c})},fs=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"sv";const n=ps(e),r=n.languages[t]||n.languages.sv||n.languages[Object.keys(n.languages)[0]];return r?(0,Ti.A)((0,Ti.A)({},n),{},{text:r.text,options:r.options,explanation:r.explanation}):(0,Ti.A)((0,Ti.A)({},n),{},{text:"Fr\xe5gan kunde inte laddas",options:[],explanation:""})},ms=()=>(rs||is||cs().catch(()=>{}),ts.map(ps)),gs=()=>(async()=>(await cs(),ts.map(ps)))(),vs=e=>{if(!e)return null;const t=ns.get(e);return t?ps(t):(hs([e]),null)},ys=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"sv";const n=ns.get(e);return n?fs(n,t):(hs([e]),null)},xs=e=>{if(!Array.isArray(e)||0===e.length)return[];const t=e.filter(e=>e&&!ns.has(e));return t.length>0&&hs(t),e.map(e=>{const t=ns.get(e);return t?ps(t):null}).filter(Boolean)},bs=e=>hs(e),ws=async e=>{await cs();if(-1===ts.findIndex(t=>t.id===e))throw new Error("Fr\xe5ga hittades inte i cache.");if(Ai.some(t=>t.id===e))throw new Error("Kan inte ta bort inbyggda fr\xe5gor.");return await Ri(e),(e=>{const t=Array.isArray(e)?new Set(e):new Set([e]);let n=!1;t.forEach(e=>{ns.delete(e)&&(n=!0)}),n&&(os(),as())})(e),!0},_s=e=>(ss.add(e),rs?e([...ts]):cs().then(()=>e([...ts])).catch(()=>e([])),()=>ss.delete(e)),ks=function(e){return Ji(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"sv")},Ns=function(){return es(ts,arguments.length>0&&void 0!==arguments[0]?arguments[0]:"sv",arguments.length>1&&void 0!==arguments[1]?arguments[1]:.85)},Ss=async e=>{await cs();try{var t;const n=ns.get(e);if(!n)throw new Error("Question ".concat(e," not found"));const r=(null===(t=n.languages)||void 0===t?void 0:t.sv)||{text:n.text,options:n.options,explanation:n.explanation};return await Bi({question:r.text,options:r.options,correctOption:n.correctOption,explanation:r.explanation||""})}catch(n){throw console.error("Error validating single question:",n),n}},js=async e=>{await cs();try{const t=e.map(e=>ns.get(e)).filter(Boolean).map(e=>{var t;const n=(null===(t=e.languages)||void 0===t?void 0:t.sv)||{text:e.text,options:e.options,explanation:e.explanation};return{id:e.id,question:n.text,options:n.options,correctOption:e.correctOption,explanation:n.explanation}});return await Vi({questions:t})}catch(t){throw console.error("Error batch validating questions:",t),t}},Es=(e,t)=>ds(e,t),Cs=async function(e,t){await cs();try{const n=t?JSON.parse(JSON.stringify(t)):t;return"structure"===(null===n||void 0===n?void 0:n.validationType)?ds(e,n):(await Fi(e,{aiValidated:!1,aiValidationResult:n}),us(e,e=>(0,Ti.A)((0,Ti.A)({},e),{},{aiValidated:!1,aiValidationResult:n})),!0)}catch(n){throw console.error("Kunde inte markera fr\xe5ga som ovaliderad:",n),n}},Ts=async e=>{await cs();try{return await Fi(e,{aiValidated:!0,manuallyApproved:!0,manuallyRejected:!1,manuallyApprovedAt:new Date,aiValidationResult:{valid:!0,validationType:"manual",reasoning:"Manuellt godk\xe4nd efter granskning"},structureValidationResult:{valid:!0,validationType:"manual",reasoning:"Manuellt godk\xe4nd efter granskning",issues:[],checkedAt:new Date}}),us(e,e=>(0,Ti.A)((0,Ti.A)({},e),{},{aiValidated:!0,manuallyApproved:!0,manuallyRejected:!1,manuallyApprovedAt:new Date,aiValidationResult:{valid:!0,validationType:"manual",reasoning:"Manuellt godk\xe4nd efter granskning"},structureValidationResult:{valid:!0,validationType:"manual",reasoning:"Manuellt godk\xe4nd efter granskning",issues:[],checkedAt:new Date}})),!0}catch(t){throw console.error("Kunde inte markera fr\xe5ga som manuellt godk\xe4nd:",t),t}},As=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";await cs();try{return await Fi(e,{aiValidated:!1,manuallyRejected:!0,manuallyApproved:!1,manuallyRejectedAt:new Date,aiValidationResult:{valid:!1,validationType:"manual",issues:[t||"Manuellt underk\xe4nd efter granskning"],reasoning:t||"Manuellt underk\xe4nd efter granskning"}}),us(e,e=>(0,Ti.A)((0,Ti.A)({},e),{},{aiValidated:!1,manuallyRejected:!0,manuallyApproved:!1,manuallyRejectedAt:new Date,aiValidationResult:{valid:!1,validationType:"manual",issues:[t||"Manuellt underk\xe4nd efter granskning"],reasoning:t||"Manuellt underk\xe4nd efter granskning"}})),!0}catch(n){throw console.error("Kunde inte markera fr\xe5ga som manuellt underk\xe4nd:",n),n}},Is=async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"anonymous";await cs();try{const r=ts.find(t=>t.id===e);if(!r)throw new Error("Fr\xe5gan hittades inte");const i={reportedAt:new Date,reportedBy:n,reason:t,resolved:!1},s=[...r.reports||[],i];return await Fi(e,{reported:!0,reportCount:s.length,reports:s}),us(e,e=>(0,Ti.A)((0,Ti.A)({},e),{},{reported:!0,reportCount:s.length,reports:s})),!0}catch(r){throw console.error("Kunde inte rapportera fr\xe5ga:",r),r}},Ps=async e=>{await cs();try{const t=ts.find(t=>t.id===e);if(!t)throw new Error("Fr\xe5gan hittades inte");const n=(t.reports||[]).map(e=>(0,Ti.A)((0,Ti.A)({},e),{},{resolved:!0,resolvedAt:new Date,resolution:"approved"}));return await Fi(e,{reported:!1,reports:n,reportResolvedAt:new Date}),us(e,e=>(0,Ti.A)((0,Ti.A)({},e),{},{reported:!1,reports:n,reportResolvedAt:new Date})),!0}catch(t){throw console.error("Kunde inte godk\xe4nna rapporterad fr\xe5ga:",t),t}},Ls=async(e,t)=>{if(!e)throw new Error("questionId is required");await cs();try{const n=await qi({questionId:e,provider:t}),{svg:r,provider:i}=n||{},s={illustration:r,illustrationProvider:i,illustrationGeneratedAt:new Date};return await Fi(e,s),us(e,e=>e?(0,Ti.A)((0,Ti.A)({},e),s):e),n}catch(n){throw console.error("[questionService] Kunde inte regenerera emoji:",n),n}},Rs=async e=>{await cs();try{const t=ts.find(t=>t.id===e);if(!t)throw new Error("Fr\xe5gan hittades inte");const n=(t.reports||[]).map(e=>e.reason).filter(Boolean).join("; "),r=(t.reports||[]).map(e=>(0,Ti.A)((0,Ti.A)({},e),{},{resolved:!0,resolvedAt:new Date,resolution:"rejected"}));return await Fi(e,{reported:!1,aiValidated:!1,manuallyRejected:!0,manuallyApproved:!1,manuallyRejectedAt:new Date,reports:r,reportResolvedAt:new Date,aiValidationResult:{valid:!1,validationType:"manual",issues:["Rapporterad av anv\xe4ndare: ".concat(n)],reasoning:"Underk\xe4nd baserat p\xe5 anv\xe4ndarrapporter: ".concat(n)}}),us(e,e=>(0,Ti.A)((0,Ti.A)({},e),{},{reported:!1,aiValidated:!1,manuallyRejected:!0,manuallyApproved:!1,manuallyRejectedAt:new Date,reports:r,reportResolvedAt:new Date,aiValidationResult:{valid:!1,validationType:"manual",issues:["Rapporterad av anv\xe4ndare: ".concat(n)],reasoning:"Underk\xe4nd baserat p\xe5 anv\xe4ndarrapporter: ".concat(n)}})),!0}catch(t){throw console.error("Kunde inte underk\xe4nna rapporterad fr\xe5ga:",t),t}};var Os=n(4377);const Ms={lat:56.6657823,lng:16.3453025},Ds=[Ms.lat,Ms.lng],Fs=()=>{const e="ABCDEFGHJKLMNPQRSTUVWXYZ23456789";let t="";for(let n=0;n<6;n+=1)t+=e[Math.floor(32*Math.random())];return t},zs=async()=>{try{const e=await gs();return 0===e.length?(console.warn("[runFactory] No questions in Firestore, using QUESTION_BANK fallback"),Ai):e}catch(e){return console.warn("[runFactory] Error loading questions, using QUESTION_BANK fallback:",e),Ai}},Us=e=>{const t=Math.max(0,e),n=Math.floor(t/3),r=t-3*n,i=["children","youth","adults"],s={children:n,youth:n,adults:n};for(let a=0;a<r;a+=1)s[i[a%i.length]]+=1;return s},Bs=async e=>{let{audience:t,difficulty:n,questionCount:r,categories:i=[]}=e;const s=await zs();if(0===s.length)throw new Error("Fr\xe5gebanken \xe4r tom. Kontrollera att fr\xe5gor har laddats korrekt fr\xe5n databasen.");if(r<1||r>50)throw new Error("Ogiltigt antal fr\xe5gor (".concat(r,"). V\xe4lj mellan 1 och 50 fr\xe5gor."));if("family"===n)return Vs(s,r,i);const a=[...s.filter(e=>{if(!1===e.aiValidated||!0===e.manuallyRejected||!0===e.reported)return!1;let t=!1;t=Array.isArray(e.ageGroups)&&e.ageGroups.length>0?e.ageGroups.includes(n):"children"===n||"kid"===n?"kid"===e.audience||"kid"===e.difficulty:"youth"===n||"medium"===n?"medium"===e.audience||"medium"===e.difficulty:"adults"!==n&&"adult"!==n||("adult"===e.audience||"adult"===e.difficulty);let r=!1;return 0===i.length?r=!0:Array.isArray(e.categories)?r=e.categories.some(e=>i.includes(e)):e.category&&(r=i.includes(e.category)),t&&r})].sort(()=>Math.random()-.5);if(0===a.length){const e=i.length>0?" och kategorier (".concat(i.join(", "),")"):"";throw new Error("Inga godk\xe4nda fr\xe5gor matchar vald \xe5ldersgrupp (".concat(n,")").concat(e,". Prova en annan kombination eller validera fler fr\xe5gor."))}if(a.length<r){const e=i.length>0?" och kategorier (".concat(i.join(", "),")"):"";throw new Error("Det finns endast ".concat(a.length," godk\xe4nda fr\xe5gor som matchar vald \xe5ldersgrupp (").concat(n,")").concat(e,", men du beh\xf6ver ").concat(r," fr\xe5gor.\n\n")+"V\xe4lj ett l\xe4gre antal fr\xe5gor eller validera fler fr\xe5gor i fr\xe5gebanken.")}return a.slice(0,r)},Vs=(e,t,n)=>{const r=t=>e.filter(e=>{if(!1===e.aiValidated||!0===e.manuallyRejected||!0===e.reported)return!1;let r=!1;return Array.isArray(e.ageGroups)?r=e.ageGroups.includes(t):"children"===t?r="kid"===e.difficulty||"kid"===e.audience:"youth"===t?r="medium"===e.difficulty||"medium"===e.audience:"adults"===t&&(r="adult"===e.difficulty||"adult"===e.audience||"expert"===e.difficulty||"hard"===e.difficulty),!!r&&(0===n.length||(Array.isArray(e.categories)?e.categories.some(e=>n.includes(e)):!!e.category&&n.includes(e.category)))}),i=r("children"),s=r("youth"),a=r("adults"),o=Us(t),l=o.children,c=o.youth,u=o.adults;if(i.length<l){const e=n.length>0?" och kategorier (".concat(n.join(", "),")"):"";throw new Error("F\xf6r f\xe5 barnfr\xe5gor tillg\xe4ngliga".concat(e,". Beh\xf6ver ").concat(l," men har bara ").concat(i.length,".\n\n")+"Validera fler barnfr\xe5gor eller v\xe4lj f\xe4rre fr\xe5gor totalt.")}if(s.length<c){const e=n.length>0?" och kategorier (".concat(n.join(", "),")"):"";throw new Error("F\xf6r f\xe5 ungdomsfr\xe5gor tillg\xe4ngliga".concat(e,". Beh\xf6ver ").concat(c," men har bara ").concat(s.length,".\n\n")+"Validera fler ungdomsfr\xe5gor eller v\xe4lj f\xe4rre fr\xe5gor totalt.")}if(a.length<u){const e=n.length>0?" och kategorier (".concat(n.join(", "),")"):"";throw new Error("F\xf6r f\xe5 vuxenfr\xe5gor tillg\xe4ngliga".concat(e,". Beh\xf6ver ").concat(u," men har bara ").concat(a.length,".\n\n")+"Validera fler vuxenfr\xe5gor eller v\xe4lj f\xe4rre fr\xe5gor totalt.")}const d={children:[...i].sort(()=>Math.random()-.5).slice(0,l),youth:[...s].sort(()=>Math.random()-.5).slice(0,c),adults:[...a].sort(()=>Math.random()-.5).slice(0,u)},h=["children","youth","adults"].sort(()=>Math.random()-.5),p=[];let f=0;for(;p.length<t;){let e=!1;for(const n of h){const r=d[n];if(f<r.length&&(p.push(r[f]),e=!0,p.length===t))break}if(!e)break;f+=1}return p},qs=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ms;return e.map((n,r)=>{const i=r/e.length*Math.PI*2,s=.002*Math.sin(i),a=.002*Math.cos(i);return{order:r+1,location:{lat:t.lat+s+.001*(Math.random()-.5),lng:t.lng+a+.001*(Math.random()-.5)},questionId:n.id,title:"Fr\xe5ga ".concat(r+1)}})},Ks=(e,t)=>(0,Ti.A)((0,Ti.A)({},e),{},{createdBy:(null===t||void 0===t?void 0:t.id)||"admin",createdByName:(null===t||void 0===t?void 0:t.name)||"Administrat\xf6r",createdAt:(new Date).toISOString(),status:"active"}),Hs=async(e,t)=>{let{name:n,audience:r="family",difficulty:i="family",lengthMeters:s=2500,questionCount:a=8,categories:o=[],allowAnonymous:l=!0,allowRouteSelection:c=!1,language:u="sv",origin:d,seed:h,preferGreenAreas:p}=e;const f=await Bs({audience:r,difficulty:i,questionCount:a,categories:o}),m=Fs(),g=await(async(e,t)=>{var n,r;let{lengthMeters:i=2500,origin:s,seed:a,preferGreenAreas:o}=t;const l=null!==(n=null===s||void 0===s?void 0:s.lat)&&void 0!==n?n:Ms.lat,c=null!==(r=null===s||void 0===s?void 0:s.lng)&&void 0!==r?r:Ms.lng;try{const t=await(0,Os.generateWalkingRoute)({origin:{lat:l,lng:c},lengthMeters:i,checkpointCount:e.length,seed:a,preferGreenAreas:o});return{checkpoints:t.checkpoints.map((t,n)=>({order:t.order,location:t.location,questionId:e[n].id,title:"Fr\xe5ga ".concat(n+1),routeIndex:t.routeIndex})),route:t.route,totalDistance:t.totalDistance}}catch(p){var u,d,h;return console.warn("[RunFactory] Ruttplanering misslyckades, anv\xe4nder cirkul\xe4r fallback:",p),null!==(u=p.message)&&void 0!==u&&u.includes("API")||null!==(d=p.message)&&void 0!==d&&d.includes("network")||null!==(h=p.message)&&void 0!==h&&h.includes("fetch"),{checkpoints:e.map((t,n)=>{const r=n/e.length*Math.PI*2,s=i/1e3/e.length,a=Math.sin(r)*s*.01,o=Math.cos(r)*s*.01;return{order:n+1,location:{lat:l+a,lng:c+o},questionId:t.id,title:"Fr\xe5ga ".concat(n+1)}}),route:null,totalDistance:i}}})(f,{lengthMeters:s,origin:d,seed:h,preferGreenAreas:p});const v={id:Ue(),name:n||"Ny runda",description:"Genererad utifr\xe5n \xf6nskem\xe5l",audience:r,difficulty:i,questionCount:a,type:"generated",lengthMeters:s,allowAnonymous:l,allowRouteSelection:c,language:u||"sv",joinCode:m,qrSlug:m.toLowerCase(),checkpoints:g.checkpoints,route:g.route,startPoint:d||Ms,questionIds:f.map(e=>e.id)};return Ks(v,t||{id:n||"Auto",name:n||"Auto-generator"})},Ws=()=>pi(),Gs=()=>(0,si.rJ)(Ws(),"runs"),Zs=e=>(0,si.rJ)(Ws(),"runs",e,"participants"),Qs=e=>{try{return JSON.parse(JSON.stringify(e))}catch(t){return console.warn("[FirestoreGateway] Serialisering misslyckades:",t),e}},Js=e=>{if(null===e||void 0===e||!e.exists())return null;const t=e.data();return(0,Ti.A)({id:e.id},t)},Ys=e=>{if(!e)return null;const t=Date.now(),n=e.lastSeen?new Date(e.lastSeen).getTime():0,r=e.completedAt?new Date(e.completedAt).getTime():null,i=Boolean(r),s=!i&&t-n<6e4,a=i?"finished":s?"active":"inactive";return(0,Ti.A)((0,Ti.A)({},e),{},{isActive:s,status:a,lastSeenFormatted:e.lastSeen?new Date(e.lastSeen).toLocaleString("sv-SE"):"Aldrig",completedAtFormatted:e.completedAt?new Date(e.completedAt).toLocaleString("sv-SE"):null})},Xs=e=>{if(null===e||void 0===e||!e.exists())return null;const t=(0,Ti.A)({id:e.id},e.data());return Ys(t)},$s={listRuns:async()=>(await(0,si.getDocs)(Gs())).docs.map(Js).filter(Boolean),async listRunsByIds(e){if(!e||0===e.length)return[];const t=(0,si.P)(Gs(),(0,si._M)((0,si.Fs)(),"in",e));return(await(0,si.getDocs)(t)).docs.map(Js).filter(Boolean)},async getRun(e){var t;const r=await(0,si.x7)((0,si.H9)(Gs(),e));let i=Js(r);if(i&&"generated"===i.type&&!i.route&&(null===(t=i.checkpoints)||void 0===t?void 0:t.length)>0){0;try{var s;const{generateWalkingRoute:e}=await Promise.resolve().then(n.bind(n,4377)),t=(null===(s=i.checkpoints[0])||void 0===s?void 0:s.location)||Ms,r=await e({origin:t,lengthMeters:i.lengthMeters||2500,checkpointCount:i.checkpoints.length});r.route&&r.route.length>0&&(i=(0,Ti.A)((0,Ti.A)({},i),{},{route:r.route}),await(0,si.BN)((0,si.H9)(Gs(),i.id),Qs(i)))}catch(a){console.warn("[FirestoreGateway] Kunde inte generera route-data retroaktivt:",a)}}return i},async getRunByCode(e){try{const t=(0,si.P)(Gs(),(0,si._M)("joinCode","==",e.toUpperCase())),n=await(0,si.getDocs)(t),[r]=n.docs;return r?Js(r):null}catch(t){if(console.error("[getRunByCode] Firestore query failed:",{code:t.code,message:t.message,joinCode:e,error:t}),"permission-denied"===t.code)throw new Error("Kunde inte h\xe4mta runda - beh\xf6righetsproblem. F\xf6rs\xf6k igen om en stund.");throw t}},async createRun(e,t){const n=await(async(e,t)=>{let{name:n,description:r,audience:i="family",difficulty:s="family",questionCount:a=8,categories:o=[],type:l="hosted",lengthMeters:c=2e3,allowAnonymous:u=!0,allowRouteSelection:d=!1,language:h="sv",origin:p=null}=e;const f=await Bs({audience:i,difficulty:s,questionCount:a,categories:o}),m=Fs();let g=null,v=[];try{const e=p||Ms,t=await(0,Os.generateWalkingRoute)({origin:e,lengthMeters:c,checkpointCount:f.length});t.route&&t.route.length>0?(g=t.route,v=f.map((e,t)=>{const n=Math.floor(t/f.length*(g.length-1)),r=Math.min(n,g.length-1);return{order:t+1,location:(0,Ti.A)({},g[r]),questionId:e.id,title:"Fr\xe5ga ".concat(t+1),routeIndex:r}})):v=qs(f,p||Ms)}catch(b){var y;console.warn("[RunFactory] buildHostedRun: kunde inte generera route-data:",b),p&&null!==(y=b.message)&&void 0!==y&&y.includes("API"),v=qs(f,p||Ms)}const x={id:Ue(),name:n,description:r,audience:i,difficulty:s,questionCount:a,type:l,lengthMeters:c,allowAnonymous:u,allowRouteSelection:d,language:h||"sv",joinCode:m,qrSlug:m.toLowerCase(),checkpoints:v,route:g,startPoint:p||Ms,questionIds:f.map(e=>e.id)};return Ks(x,t)})(e,t);return await(0,si.BN)((0,si.H9)(Gs(),n.id),(0,Ti.A)((0,Ti.A)({},Qs(n)),{},{createdAt:(0,si.O5)()})),n},async generateRouteRun(e,t){const n=await Hs(e,t);const r=Qs(n);return await(0,si.BN)((0,si.H9)(Gs(),n.id),(0,Ti.A)((0,Ti.A)({},r),{},{createdAt:(0,si.O5)()})),n},listParticipants:async e=>(await(0,si.getDocs)(Zs(e))).docs.map(Xs).filter(Boolean),async registerParticipant(e,t){let{userId:n,alias:r,contact:i,isAnonymous:s}=t;const a={id:Ue(),runId:e,userId:n||null,alias:r||"G\xe4st",contact:i||null,isAnonymous:Boolean(s),joinedAt:(0,si.O5)(),completedAt:null,currentOrder:1,score:0,answers:[],lastSeen:(0,si.O5)()};try{await(0,si.BN)((0,si.H9)(Zs(e),a.id),a)}catch(o){throw console.error("\u274c Failed to create participant:",o),console.error("Error code:",o.code),console.error("Error message:",o.message),o}return Ys((0,Ti.A)((0,Ti.A)({},a),{},{joinedAt:(new Date).toISOString(),lastSeen:(new Date).toISOString()}))},async recordAnswer(e,t,n){var r;let{questionId:i,answerIndex:s,correct:a}=n;const o=(0,si.H9)(Zs(e),t),l=await(0,si.x7)(o);if(!l.exists())throw new Error("Deltagare hittades inte.");const c=(0,Ti.A)({id:t},l.data()),u=Array.isArray(c.answers)?[...c.answers]:[],d=(new Date).toISOString(),h=u.findIndex(e=>e.questionId===i);h>=0?u[h]=(0,Ti.A)((0,Ti.A)({},u[h]),{},{answerIndex:s,correct:a,answeredAt:d}):u.push({questionId:i,answerIndex:s,correct:a,answeredAt:d});const p=u.filter(e=>e.correct).length,f=await(0,si.x7)((0,si.H9)(Gs(),e)),m=f.exists()&&(null===(r=f.data().questionIds)||void 0===r?void 0:r.length)||0,g=(0,Ti.A)((0,Ti.A)({},c),{},{answers:u,score:p,currentOrder:u.length+1,completedAt:m>0&&u.length===m?d:c.completedAt,lastSeen:d});return await(0,si.BN)(o,Qs(g),{merge:!0}),Ys(g)},async completeRun(e,t){const n=(0,si.H9)(Zs(e),t),r=(new Date).toISOString();await(0,si.mZ)(n,{completedAt:r,lastSeen:r})},async closeRun(e){const t=(new Date).toISOString();await(0,si.mZ)((0,si.H9)(Gs(),e),{status:"closed",closedAt:t})},async deleteRun(e){const{deleteDoc:t,getDocs:r}=await Promise.resolve().then(n.bind(n,5472)),i=(await r(Zs(e))).docs.map(e=>t(e.ref));await Promise.all(i),await t((0,si.H9)(Gs(),e))},subscribeRuns(e){const t=(0,si.P)(Gs(),(0,si._M)("status","==","active"));return(0,si.aQ)(t,t=>{const n=t.docs.map(Js).filter(Boolean);e(n)})},subscribeParticipants:(e,t)=>(0,si.aQ)(Zs(e),e=>{const n=e.docs.map(Xs).filter(Boolean);t(n)}),async heartbeatParticipant(e,t){const n=(0,si.H9)(Zs(e),t),r=(new Date).toISOString();await(0,si.mZ)(n,{lastSeen:r});const i=await(0,si.x7)(n);return Xs(i)},async getParticipant(e,t){const n=await(0,si.x7)((0,si.H9)(Zs(e),t));return Xs(n)},async updateRun(e,t){const n=(0,si.H9)(Gs(),e);await(0,si.mZ)(n,Qs(t));const r=await(0,si.x7)(n);return Js(r)}};if(!mi())throw new Error("Firebase m\xe5ste vara konfigurerat. Kontrollera att alla REACT_APP_FIREBASE_* variabler \xe4r satta i .env");const ea=$s,ta=(0,t.createContext)(null),na="tipspromenad:activeParticipant",ra=e=>{if("undefined"!==typeof window)try{e?window.localStorage.setItem(na,JSON.stringify(e)):window.localStorage.removeItem(na)}catch(t){console.warn("[RunContext] Kunde inte skriva aktiv deltagare till localStorage:",t)}},ia=e=>{var t;return null!==e&&void 0!==e&&null!==(t=e.questionIds)&&void 0!==t&&t.length?xs(e.questionIds):[]},sa=e=>{let{children:n}=e;const[r,i]=(0,t.useState)(!1),[s,a]=(0,t.useState)(null),[o,l]=(0,t.useState)(null),[c,u]=(0,t.useState)([]),[d,h]=(0,t.useState)([]),p=(null===s||void 0===s?void 0:s.id)||null,f=(null===o||void 0===o?void 0:o.id)||null,m=(0,t.useRef)(null);(0,t.useEffect)(()=>{m.current=(null===o||void 0===o?void 0:o.id)||null},[o]);const g=(0,t.useCallback)(async e=>{if(e){a(e),u(ia(e)),bs(e.questionIds).then(()=>{u(ia(e))}).catch(e=>{console.warn("[RunContext] Kunde inte ladda fr\xe5gor f\xf6r run:",e)});try{const t=await ea.listParticipants(e.id);h(t);const n=m.current;if(n){const e=t.find(e=>e.id===n);e&&l(e)}}catch(t){console.warn("[RunContext] Kunde inte ladda deltagare f\xf6r run:",t),h([])}}},[]),v=(0,t.useCallback)(async(e,t)=>{const n=await ea.createRun(e,t);return await g(n),n},[g]),y=(0,t.useCallback)(async(e,t)=>{const n=await ea.generateRouteRun(e,t);return await g(n),n},[g]),x=(0,t.useCallback)(async e=>{const t=await ea.getRun(e);if(!t)throw new Error("Runda med ID ".concat(e," hittades inte"));return await g(t),t},[g]),b=(0,t.useCallback)(async(e,t)=>{const n=await ea.getRunByCode(e);if(!n)throw new Error('Ingen runda hittades med anslutningskod "'.concat(e,'"'));const r=await ea.registerParticipant(n.id,t);return await g(n),l(r),{run:n,participant:r}},[g]),w=(0,t.useCallback)(async(e,t)=>{const n=await ea.getRun(e);if(!n)throw new Error("Runda med ID ".concat(e," hittades inte"));const r=t?await ea.getParticipant(e,t):null;return await g(n),l(r),{run:n,participant:r}},[g]),_=(0,t.useCallback)(async()=>{if(!p)return[];const e=await ea.listParticipants(p);h(e);const t=m.current;if(t){const n=e.find(e=>e.id===t);n?l(n):(m.current=null,l(null),ra(null))}return e},[p]),k=(0,t.useCallback)(async e=>{let{questionId:t,answerIndex:n}=e;if(!s||!o)throw new Error("Ingen aktiv runda eller deltagare. Kontrollera din session.");const r=vs(t);if(!r)throw new Error("Fr\xe5ga med ID ".concat(t," hittades inte."));const i=r.correctOption===n,a=await ea.recordAnswer(s.id,o.id,{questionId:t,answerIndex:n,correct:i});return l(a),await _(),{participant:a,correct:i}},[s,o,_]),N=(0,t.useCallback)(async()=>{p&&f?(await ea.completeRun(p,f),await _()):console.warn("[RunContext] F\xf6rs\xf6kte markera deltagare som klar utan aktiv session")},[p,f,_]),S=(0,t.useCallback)(async()=>{if(!p)return;await ea.closeRun(p);const e=await ea.getRun(p);e&&(a(e),u(ia(e)))},[p]),j=(0,t.useCallback)(async e=>{if(!p)return null;const t=await ea.updateRun(p,e);return t&&(a(t),u(ia(t))),t},[p]),E=(0,t.useCallback)(async function(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||p;e&&(await ea.deleteRun(e),e===p&&(a(null),l(null),u([]),h([]),ra(null)))},[p]);(0,t.useEffect)(()=>{s&&o?ra({runId:s.id,participantId:o.id}):r&&ra(null)},[s,o,r]),(0,t.useEffect)(()=>{if(r)return;const e=(()=>{if("undefined"===typeof window)return null;try{const e=window.localStorage.getItem(na);return e?JSON.parse(e):null}catch(e){return console.warn("[RunContext] Kunde inte l\xe4sa aktiv deltagare fr\xe5n localStorage:",e),null}})();null!==e&&void 0!==e&&e.runId&&null!==e&&void 0!==e&&e.participantId&&w(e.runId,e.participantId).catch(e=>{console.warn("[RunContext] Kunde inte \xe5terst\xe4lla session:",e),ra(null)}),i(!0)},[r,w]),(0,t.useEffect)(()=>{if(!p)return()=>{};return ea.subscribeRuns(e=>{const t=e.find(e=>e.id===p);t&&(a(t),u(ia(t)))})},[p]),(0,t.useEffect)(()=>{if(!p)return()=>{};return ea.subscribeParticipants(p,e=>{h(e);const t=m.current;if(t){const n=e.find(e=>e.id===t);n?l(n):(m.current=null,l(null),ra(null))}})},[p]),(0,t.useEffect)(()=>{if(!p||!f)return;if("undefined"===typeof window)return;const e=()=>{ea.heartbeatParticipant(p,f).catch(e=>{var t;console.warn("[RunContext] Heartbeat misslyckades:",e),("not-found"===(null===e||void 0===e?void 0:e.code)||null!==e&&void 0!==e&&null!==(t=e.message)&&void 0!==t&&t.includes("No document to update"))&&(m.current=null,l(null),ra(null))})};e();const t=window.setInterval(e,15e3),n=()=>{"undefined"!==typeof document&&"visible"===document.visibilityState&&e()},r=()=>e();return"undefined"!==typeof document&&document.addEventListener("visibilitychange",n),window.addEventListener("beforeunload",r),()=>{window.clearInterval(t),"undefined"!==typeof document&&document.removeEventListener("visibilitychange",n),window.removeEventListener("beforeunload",r)}},[p,f]),(0,t.useEffect)(()=>{p&&_().catch(e=>{console.warn("[RunContext] Kunde inte ladda initial deltagarlista:",e),h([])})},[_,p]);const C=(0,t.useMemo)(()=>({currentRun:s,questions:c,participants:d,currentParticipant:o,createHostedRun:v,generateRun:y,loadRunById:x,updateRun:j,closeRun:S,deleteRun:E,joinRunByCode:b,attachToRun:w,submitAnswer:k,completeRunForParticipant:N,refreshParticipants:_}),[s,c,d,o,v,y,x,j,S,E,b,w,k,N,_]);return(0,bi.jsx)(ta.Provider,{value:C,children:n})},aa=()=>{const e=(0,t.useContext)(ta);if(!e)throw new Error("useRun m\xe5ste anv\xe4ndas inom en RunProvider. Kontrollera att komponenten \xe4r wrappnad i <RunProvider>.");return e},oa=e=>{let{isOpen:t,onClose:n,title:r="Meddelande",message:i,type:s="info"}=e;if(!t)return null;const a={success:{bgColor:"bg-green-500/10",borderColor:"border-green-500/50",textColor:"text-green-400",iconColor:"text-green-400",icon:(0,bi.jsx)("svg",{className:"w-12 h-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,bi.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})},error:{bgColor:"bg-red-500/10",borderColor:"border-red-500/50",textColor:"text-red-400",iconColor:"text-red-400",icon:(0,bi.jsx)("svg",{className:"w-12 h-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,bi.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})},warning:{bgColor:"bg-yellow-500/10",borderColor:"border-yellow-500/50",textColor:"text-yellow-400",iconColor:"text-yellow-400",icon:(0,bi.jsx)("svg",{className:"w-12 h-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,bi.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})},info:{bgColor:"bg-cyan-500/10",borderColor:"border-cyan-500/50",textColor:"text-cyan-400",iconColor:"text-cyan-400",icon:(0,bi.jsx)("svg",{className:"w-12 h-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,bi.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}},o=a[s]||a.info;return(0,bi.jsx)("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-[1200]",onClick:e=>{e.target===e.currentTarget&&n()},children:(0,bi.jsx)("div",{className:"bg-slate-900 rounded-xl shadow-2xl border border-slate-700 max-w-md w-full",onClick:e=>e.stopPropagation(),children:(0,bi.jsxs)("div",{className:"p-6",children:[(0,bi.jsx)("div",{className:"flex justify-center mb-4 ".concat(o.iconColor),children:o.icon}),(0,bi.jsx)("h2",{className:"text-xl font-bold text-white mb-3 text-center",children:r}),(0,bi.jsx)("div",{className:"".concat(o.bgColor," ").concat(o.borderColor," border rounded-lg p-4 mb-6"),children:(0,bi.jsx)("p",{className:"".concat(o.textColor," text-center whitespace-pre-line"),children:i})}),(0,bi.jsx)("button",{onClick:n,className:"w-full bg-gradient-to-r from-cyan-600 to-indigo-600 hover:from-cyan-700 hover:to-indigo-700 text-white font-semibold py-3 px-4 rounded-lg transition-all shadow-lg",children:"OK"})]})})})},la=100,ca=(0,si.rJ)(gi,"backgroundTasks"),ua=e=>e?e.toDate?e.toDate():"number"===typeof e||"string"===typeof e?new Date(e):null:null,da=e=>{const t=e.data()||{};return(0,Ti.A)((0,Ti.A)({id:e.id},t),{},{createdAt:ua(t.createdAt),startedAt:ua(t.startedAt),finishedAt:ua(t.finishedAt),updatedAt:ua(t.updatedAt)})},ha=e=>[...e].sort((e,t)=>{const n=e.createdAt instanceof Date?e.createdAt.getTime():0,r=t.createdAt instanceof Date?t.createdAt.getTime():0;return n!==r?r-n:e.id.localeCompare(t.id)}),pa=new Set(["completed","failed","cancelled"]),fa=function(e,t){let{limit:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=new Map;return(0,si.aQ)(e,e=>{const i=ha(e.docs.map(e=>{var t;const n=da(e),{progress:i,status:s,id:a}=n;if(!i||"number"!==typeof i.completed)return pa.has(s)&&r.delete(a),n;const o=r.get(a),l=Number(i.completed)||0,c=Number(i.total)||0;if("queued"===s||"pending"===s||!o)return r.set(a,{completed:l,total:c}),pa.has(s)&&r.delete(a),n;let u=l,d=c;var h;"processing"===s&&l<o.completed&&(u=o.completed,d=Math.max(null!==(h=o.total)&&void 0!==h?h:0,c));return r.set(a,{completed:u,total:Math.max(d,null!==(t=o.total)&&void 0!==t?t:0)}),pa.has(s)&&r.delete(a),u===l&&d===c?n:(0,Ti.A)((0,Ti.A)({},n),{},{progress:(0,Ti.A)((0,Ti.A)({},i),{},{completed:u,total:d})})})),s="number"===typeof n?i.slice(0,n):i;t(s)},e=>{console.error("[backgroundTaskService] Realtime subscription failed:",e),t([],e)})},ma={async fetchUserTasks(e){var t;if(!e)return[];const n=null!==(t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).limit)&&void 0!==t?t:la,r=(0,si.P)(ca,(0,si._M)("userId","==",e)),i=await(0,si.getDocs)(r);return ha(i.docs.map(da)).slice(0,n)},subscribeToUserTasks(e,t){var n;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)return t([]),()=>{};const i=null!==(n=r.limit)&&void 0!==n?n:la,s=(0,si.P)(ca,(0,si._M)("userId","==",e));return fa(s,t,{limit:i})},async fetchAllTasks(){var e;const t=null!==(e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).limit)&&void 0!==e?e:la,n=(0,si.P)(ca,(0,si.My)("createdAt","desc"),(0,si.AB)(t)),r=await(0,si.getDocs)(n);return ha(r.docs.map(da))},subscribeToAllTasks(e){var t;const n=null!==(t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).limit)&&void 0!==t?t:la,r=(0,si.P)(ca,(0,si.My)("createdAt","desc"),(0,si.AB)(n));return fa(r,e)}},ga=(0,t.createContext)({pushToast:()=>{},dismissToast:()=>{},toasts:[]});let va=0;const ya=e=>{let{children:n}=e;const[r,i]=(0,t.useState)([]),s=(0,t.useRef)(new Map),a=(0,t.useCallback)(e=>{i(t=>t.filter(t=>t.id!==e));const t=s.current.get(e);t&&(clearTimeout(t),s.current.delete(e))},[]),o=(0,t.useCallback)(e=>{const t=(e=>{var t;return va+=1,{id:"".concat(Date.now(),"-").concat(va),title:e.title||"Avisering",message:e.message||"",variant:e.variant||"info",duration:null!==(t=e.duration)&&void 0!==t?t:6e3}})(e);if(i(e=>[...e,t]),null!==t.duration){const e=setTimeout(()=>{a(t.id)},t.duration);s.current.set(t.id,e)}return t.id},[a]),l=(0,t.useMemo)(()=>({toasts:r,pushToast:o,dismissToast:a}),[a,o,r]);return(0,bi.jsx)(ga.Provider,{value:l,children:n})},xa=()=>(0,t.useContext)(ga),ba=(0,t.createContext)({myTasks:[],myTrackedTasks:[],unreadTaskIds:new Set,unreadCount:0,hasActiveTrackedTasks:!1,registerTask:()=>{},markTaskAsSeen:()=>{},markAllTasksAsSeen:()=>{},allTasks:[],refreshUserTasks:()=>{},refreshAllTasks:()=>{}}),wa=new Set(["completed","failed","cancelled"]),_a={completed:"success",failed:"error",cancelled:"warning"},ka={random:"slumpad provider",gemini:"Gemini",anthropic:"Claude",openai:"OpenAI"},Na={isOpen:!1,title:"",message:"",type:"info"},Sa=(e,t)=>{if(!e)return t;try{return JSON.parse(e)}catch(n){return console.warn("[BackgroundTaskContext] Failed to parse JSON from storage:",n),t}},ja=e=>{let{children:n}=e;const{currentUser:r,isSuperUser:i}=Ci(),{pushToast:s}=xa(),[a,o]=(0,t.useState)([]),[l,c]=(0,t.useState)([]),[u,d]=(0,t.useState)([]),h=(0,t.useRef)(new Set),[p,f]=(0,t.useState)(new Set),[m,g]=(0,t.useState)(()=>(0,Ti.A)({},Na)),v=(0,t.useRef)({}),y=(0,t.useRef)(new Set),x=(0,t.useRef)(!1),b=(0,t.useRef)(new Map),w=(0,t.useRef)(new Set),_=(0,t.useRef)({tracked:null,acknowledged:null}),k=(0,t.useRef)(!0);(0,t.useEffect)(()=>(k.current=!0,()=>{k.current=!1}),[]);const N=(0,t.useCallback)(()=>{if("undefined"===typeof window)return;const{tracked:e}=_.current;if(!e)return;const t=Array.from(b.current.entries()).reduce((e,t)=>{var n;let[r,i]=t;return e[r]=(0,Ti.A)((0,Ti.A)({},i),{},{createdAt:i.createdAt instanceof Date?i.createdAt.toISOString():null!==(n=i.createdAt)&&void 0!==n?n:null}),e},{});localStorage.setItem(e,JSON.stringify(t))},[]),S=(0,t.useCallback)(()=>{if("undefined"===typeof window)return;const{acknowledged:e}=_.current;if(!e)return;const t=Array.from(w.current);localStorage.setItem(e,JSON.stringify(t))},[]),j=(0,t.useCallback)(e=>{e&&y.current.forEach(t=>{t.startsWith("".concat(e,":"))&&y.current.delete(t)})},[]),E=(0,t.useCallback)(()=>{o([]),c([]),b.current=new Map,w.current=new Set,h.current=new Set,f(new Set),v.current={},y.current=new Set,x.current=!1,_.current={tracked:null,acknowledged:null},d([])},[]),C=(0,t.useCallback)(e=>{if(!k.current)return;o(e);const t={};if(e.forEach(e=>{t[e.id]=e.status}),!x.current)return v.current=t,void(x.current=!0);const n=new Set(h.current);e.forEach(e=>{const t=v.current[e.id],r=e.status!==t,a=b.current.has(e.id),o=wa.has(e.status);if(v.current[e.id]=e.status,a&&o&&r&&(w.current.has(e.id)||n.add(e.id),i)){const t="".concat(e.id,":").concat(e.status);if(!y.current.has(t)){const n=b.current.get(e.id)||{},r=_a[e.status]||"info",i=(()=>n.label?n.label:"generation"===e.taskType?"AI-generering":"validation"===e.taskType?"AI-validering":"regenerateemoji"===e.taskType?"Emoji-regenerering":"batchregenerateemojis"===e.taskType?"Mass-regenerering Emojis":"Bakgrundsjobb")(),a=[];var l;if("completed"===e.status)a.push("Bakgrundsjobbet \xe4r klart."),null!=(null===(l=e.result)||void 0===l?void 0:l.count)&&a.push("Resultat: ".concat(e.result.count,"."));if("failed"===e.status&&(a.push("Bakgrundsjobbet misslyckades."),e.error&&a.push(e.error)),"cancelled"===e.status&&a.push("Bakgrundsjobbet avbr\xf6ts."),s({title:i,message:a.join("\n"),variant:r}),"generation"===e.taskType&&"completed"===e.status){const t=function(){var e,t,n,r;let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s="string"===typeof(null===(e=i.result)||void 0===e?void 0:e.provider)&&i.result.provider||"string"===typeof(null===(t=i.payload)||void 0===t?void 0:t.provider)&&i.payload.provider||"AI",a=s.toLowerCase(),o=ka[a]||s,l=[];return l.push("AI-generering via ".concat(o," klar!")),"number"===typeof(null===(n=i.result)||void 0===n?void 0:n.count)&&l.push("".concat(i.result.count," fr\xe5gor genererades.")),Array.isArray(null===(r=i.result)||void 0===r?void 0:r.questionIds)&&i.result.questionIds.length>0&&l.push("Fr\xe5gorna importeras och visas i listan n\xe4r Firestore-synken \xe4r klar."),l.join("\n\n")}(e);g({isOpen:!0,title:"AI-generering klar",message:t,type:"success"})}y.current.add(t)}}}),Array.from(n).forEach(e=>{b.current.has(e)&&!w.current.has(e)||n.delete(e)}),h.current=n,f(new Set(n)),v.current=t},[i,s]),T=(0,t.useCallback)(async()=>{if(r&&!r.isAnonymous)try{const e=await ma.fetchUserTasks(r.uid);C(e)}catch(e){console.error("[BackgroundTaskContext] Failed to fetch user background tasks:",e)}},[r,C]),A=(0,t.useCallback)(async()=>{if(i)try{const e=await ma.fetchAllTasks();if(!k.current)return;c(e)}catch(e){console.error("[BackgroundTaskContext] Failed to fetch global background tasks:",e)}},[i]);(0,t.useEffect)(()=>{if(!r||r.isAnonymous)return void E();E();const e="geoquest:tasks:tracked:".concat(r.uid),t="geoquest:tasks:ack:".concat(r.uid);_.current={tracked:e,acknowledged:t};const n=Sa("undefined"!==typeof window?localStorage.getItem(e):null,{}),i=new Map;Object.entries(n).forEach(e=>{let[t,n]=e;i.set(t,{taskType:n.taskType,label:n.label,description:n.description,createdAt:n.createdAt?new Date(n.createdAt):new Date})}),b.current=i;const s=Sa("undefined"!==typeof window?localStorage.getItem(t):null,[]);w.current=new Set(s),d(Array.from(i.entries())),v.current={},x.current=!1;const a=ma.subscribeToUserTasks(r.uid,(e,t)=>{k.current&&(t?console.error("[BackgroundTaskContext] Realtime user-task subscription failed:",t):C(e))});return()=>{"function"===typeof a&&a()}},[r,C,E]),(0,t.useEffect)(()=>{if(!i)return void c([]);const e=ma.subscribeToAllTasks((e,t)=>{k.current&&(t?console.error("[BackgroundTaskContext] Realtime all-task subscription failed:",t):c(e))});return()=>{"function"===typeof e&&e()}},[i]);const I=(0,t.useCallback)((e,t)=>{if(!e||!t||!r||r.isAnonymous)return;const n=b.current.get(e),i={taskType:t.taskType||(null===n||void 0===n?void 0:n.taskType)||"task",label:t.label||(null===n||void 0===n?void 0:n.label)||"Bakgrundsjobb",description:t.description||(null===n||void 0===n?void 0:n.description)||null,createdAt:t.createdAt?new Date(t.createdAt):(null===n||void 0===n?void 0:n.createdAt)||new Date};j(e),b.current.set(e,i),w.current.delete(e),N(),S(),d(Array.from(b.current.entries())),T()},[j,r,S,N,T]),P=(0,t.useCallback)(e=>{if(!e||!r||r.isAnonymous)return;w.current.add(e),b.current.delete(e),N(),S();const t=new Set(h.current);t.delete(e),h.current=t,f(new Set(t)),d(Array.from(b.current.entries())),j(e)},[j,r,S,N]),L=(0,t.useCallback)(()=>{r&&!r.isAnonymous&&(a.forEach(e=>{wa.has(e.status)&&(w.current.add(e.id),b.current.delete(e.id),j(e.id))}),N(),S(),h.current=new Set,f(new Set),d(Array.from(b.current.entries())))},[j,r,S,N,a]),R=(0,t.useMemo)(()=>{if(0===u.length&&0===a.length)return[];const e=new Map(u),t=a.reduce((e,t)=>(e.set(t.id,t),e),new Map),n=new Set([...Array.from(t.keys()),...Array.from(e.keys())]),i=Array.from(n).map(n=>{const i=t.get(n),s=e.get(n),a=(null===i||void 0===i?void 0:i.createdAt)||(null===s||void 0===s?void 0:s.createdAt)||null,o=(null===i||void 0===i?void 0:i.status)||"queued";return{id:n,taskType:(null===i||void 0===i?void 0:i.taskType)||(null===s||void 0===s?void 0:s.taskType)||"task",status:o,label:(null===i||void 0===i?void 0:i.label)||(null===s||void 0===s?void 0:s.label)||"Bakgrundsjobb",description:(null===i||void 0===i?void 0:i.description)||(null===s||void 0===s?void 0:s.description)||null,createdAt:a,startedAt:(null===i||void 0===i?void 0:i.startedAt)||null,finishedAt:(null===i||void 0===i?void 0:i.finishedAt)||null,userId:(null===i||void 0===i?void 0:i.userId)||(null===r||void 0===r?void 0:r.uid),payload:null===i||void 0===i?void 0:i.payload,result:null===i||void 0===i?void 0:i.result,error:null===i||void 0===i?void 0:i.error,progress:null===i||void 0===i?void 0:i.progress,statusHistory:null===i||void 0===i?void 0:i.statusHistory,tracked:!0}});return i.sort((e,t)=>{const n=e.createdAt?e.createdAt.getTime():0;return(t.createdAt?t.createdAt.getTime():0)-n}),i},[r,u,a]),O=(0,t.useMemo)(()=>new Set(p),[p]),M=O.size,D=R.some(e=>!wa.has(e.status)),F=(0,t.useMemo)(()=>({myTasks:a,myTrackedTasks:R,unreadTaskIds:O,unreadCount:M,hasActiveTrackedTasks:D,registerTask:I,markTaskAsSeen:P,markAllTasksAsSeen:L,allTasks:l,refreshUserTasks:T,refreshAllTasks:A}),[l,D,L,P,R,I,A,T,M,O,a]);return(0,bi.jsxs)(ba.Provider,{value:F,children:[n,(0,bi.jsx)(oa,{isOpen:m.isOpen,onClose:()=>g((0,Ti.A)({},Na)),title:m.title,message:m.message,type:m.type})]})},Ea=()=>(0,t.useContext)(ba),Ca="geoquest:local:createdRuns",Ta="geoquest:local:joinedRuns",Aa="geoquest:local:migrated",Ia=e=>{if("undefined"===typeof window)return null;try{const t=window.localStorage.getItem(e);return t?JSON.parse(t):null}catch(t){return console.warn("[LocalStorage] Kunde inte l\xe4sa ".concat(e,":"),t),null}},Pa=(e,t)=>{if("undefined"!==typeof window)try{window.localStorage.setItem(e,JSON.stringify(t))}catch(n){console.warn("[LocalStorage] Kunde inte skriva ".concat(e,":"),n)}},La=()=>Ia(Ca)||[],Ra=()=>Ia(Ta)||[],Oa=()=>!0===Ia(Aa),Ma=e=>{const t=Ia(Ca)||[];if(t.some(t=>t.runId===e.id)){const n=t.map(t=>t.runId===e.id?(0,Ti.A)((0,Ti.A)({},t),{},{updatedAt:Date.now()}):t);Pa(Ca,n)}else t.push({runId:e.id,createdAt:Date.now(),updatedAt:Date.now()}),Pa(Ca,t)},Da=(e,t)=>{const n=Ia(Ta)||[];if(n.some(t=>t.runId===e.id)){const t=n.map(t=>t.runId===e.id?(0,Ti.A)((0,Ti.A)({},t),{},{updatedAt:Date.now()}):t);Pa(Ta,t)}else n.push({runId:e.id,participantId:(null===t||void 0===t?void 0:t.id)||null,joinedAt:Date.now(),updatedAt:Date.now()}),Pa(Ta,n)},Fa=La,za=Ra,Ua=()=>{const e=La(),t=Ra();return e.length>0||t.length>0},Ba=Oa,Va=()=>{Pa(Aa,!0)},qa=()=>({createdRuns:La(),joinedRuns:Ra(),hasMigrated:Oa()}),Ka=pi(),Ha=()=>{if("undefined"===typeof window)return"unknown";const e=navigator.userAgent.toLowerCase();return/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(e)?"tablet":/Mobile|Android|iP(hone|od)|IEMobile|BlackBerry|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(e)?"mobile":"desktop"},Wa=()=>{if("undefined"===typeof window)return"unknown";const e=navigator.userAgent;return/Windows/.test(e)?"Windows":/Mac OS X/.test(e)?"macOS":/Linux/.test(e)?"Linux":/Android/.test(e)?"Android":/iOS|iPhone|iPad|iPod/.test(e)?"iOS":"unknown"},Ga=()=>{if("undefined"===typeof window)return"unknown";const e=navigator.userAgent;return/Edg/.test(e)?"Edge":/Chrome/.test(e)&&!/Edg/.test(e)?"Chrome":/Safari/.test(e)&&!/Chrome/.test(e)?"Safari":/Firefox/.test(e)?"Firefox":/MSIE|Trident/.test(e)?"Internet Explorer":"unknown"},Za=()=>{if("undefined"===typeof window)return"unknown";try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){return"unknown"}},Qa=()=>{if("undefined"===typeof window)return null;let e=localStorage.getItem("geoquest:deviceId");return e||(e="device_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),localStorage.setItem("geoquest:deviceId",e)),e},Ja=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{const n=Qa();if(!n)return;const r={deviceId:n,eventType:e,timestamp:(0,si.O5)(),deviceType:Ha(),os:Wa(),browser:Ga(),timezone:Za(),metadata:Object.fromEntries(Object.entries((0,Ti.A)((0,Ti.A)({},t),{},{userAgent:navigator.userAgent,language:navigator.language,screenResolution:"".concat(window.screen.width,"x").concat(window.screen.height),path:window.location.pathname})).filter(e=>{let[t,n]=e;return void 0!==n}))};await(0,si.gS)((0,si.rJ)(Ka,"analytics"),r)}catch(n){console.error("Error logging visit:",n)}},Ya=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let t=(0,si.P)((0,si.rJ)(Ka,"analytics"),(0,si.My)("timestamp","desc"));e.eventType&&(t=(0,si.P)(t,(0,si._M)("eventType","==",e.eventType))),e.limit&&(t=(0,si.P)(t,(0,si.AB)(e.limit)));return(await(0,si.getDocs)(t)).docs.map(e=>(0,Ti.A)({id:e.id},e.data()))}catch(t){return console.error("Error fetching analytics:",t),[]}},Xa=Qa,$a=Ja,eo=Ya,to=async e=>{try{const t=Qa();if(!t)return;const n=(0,si.P)((0,si.rJ)(Ka,"analytics"),(0,si._M)("deviceId","==",t)),r=(await(0,si.getDocs)(n)).docs.map(t=>(0,si.mZ)(t.ref,{userId:e}));await Promise.all(r),await Ja("device_linked",{userId:e})}catch(t){console.error("Error linking device to user:",t)}},no=async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{await Ja("donation",(0,Ti.A)({amount:e,paymentIntentId:t},n)),localStorage.setItem("geoquest:hasDonated","true"),localStorage.setItem("geoquest:donationTimestamp",(new Date).toISOString())}catch(r){console.error("Error logging donation:",r)}},ro=async()=>{try{const e=await Ya({limit:1e4}),t={totalVisits:e.length,uniqueDevices:new Set(e.map(e=>e.deviceId)).size,eventsByType:{},devicesByDate:{},donations:{count:0,total:0}};return e.forEach(e=>{var n,r;(t.eventsByType[e.eventType]=(t.eventsByType[e.eventType]||0)+1,"donation"===e.eventType)&&(t.donations.count++,t.donations.total+=(null===(r=e.metadata)||void 0===r?void 0:r.amount)||0);if(null!==(n=e.timestamp)&&void 0!==n&&n.toDate){const n=e.timestamp.toDate().toISOString().split("T")[0];t.devicesByDate[n]=t.devicesByDate[n]||new Set,t.devicesByDate[n].add(e.deviceId)}}),t}catch(e){return console.error("Error getting aggregated stats:",e),null}},io="0.8.1",so=(new Date).toISOString(),ao=pi(),oo=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{const n=(0,si.rJ)(ao,"messages");let r=[];e&&r.push((0,si.getDocs)((0,si.P)(n,(0,si._M)("userId","==",e),(0,si._M)("deleted","==",!1),(0,si.My)("createdAt","desc"),(0,si.AB)(25)))),t&&r.push((0,si.getDocs)((0,si.P)(n,(0,si._M)("deviceId","==",t),(0,si._M)("deleted","==",!1),(0,si.My)("createdAt","desc"),(0,si.AB)(25))));const i=await Promise.all(r),s=[];i.forEach(e=>{e.docs.forEach(e=>{s.push((0,Ti.A)({id:e.id},e.data()))})}),s.sort((e,t)=>e.createdAt&&t.createdAt?t.createdAt.toDate()-e.createdAt.toDate():0);return Array.from(new Map(s.map(e=>[e.id,e])).values())}catch(n){return console.error("Error fetching messages:",n),[]}},lo=async e=>{try{const t=(0,Ti.A)((0,Ti.A)({},e),{},{createdAt:(0,si.O5)(),read:!1,deleted:!1});return(await(0,si.gS)((0,si.rJ)(ao,"messages"),t)).id}catch(t){throw console.error("Error sending message:",t),t}},co=oo,uo=async e=>{try{const t=(0,si.H9)(ao,"messages",e);await(0,si.mZ)(t,{read:!0,readAt:(0,si.O5)()})}catch(t){console.error("Error marking message as read:",t)}},ho=async e=>{try{const t=(0,si.H9)(ao,"messages",e);await(0,si.mZ)(t,{deleted:!0,deletedAt:(0,si.O5)()})}catch(t){console.error("Error deleting message:",t)}},po=async e=>{try{await(0,si.deleteDoc)((0,si.H9)(ao,"messages",e))}catch(t){console.error("Error permanently deleting message:",t)}},fo=async()=>{try{return(await(0,si.getDocs)((0,si.P)((0,si.rJ)(ao,"messages"),(0,si.My)("createdAt","desc")))).docs.map(e=>(0,Ti.A)({id:e.id},e.data()))}catch(e){return console.error("Error fetching all messages:",e),[]}},mo=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{return(await oo(e,t)).filter(e=>!e.read).length}catch(n){return console.error("Error getting unread count:",n),0}},go="tipspromenad:trackingEnabled",vo=()=>{const[e,n]=(0,t.useState)(()=>(()=>{if("undefined"===typeof window)return!0;try{return"off"!==window.localStorage.getItem(go)}catch(o){return console.warn("Kunde inte l\xe4sa tracking-preferens",o),!0}})()),[r,i]=(0,t.useState)("idle"),[s,a]=(0,t.useState)(null),[o,l]=(0,t.useState)(null),[c,u]=(0,t.useState)(null),d=(0,t.useRef)(null),h=(0,t.useCallback)(()=>{"undefined"!==typeof navigator&&navigator.geolocation&&null!==d.current&&(navigator.geolocation.clearWatch(d.current),d.current=null)},[]);(0,t.useEffect)(()=>{if("undefined"!==typeof window)try{window.localStorage.setItem(go,e?"on":"off")}catch(t){console.warn("Kunde inte spara tracking-preferens",t)}},[e]),(0,t.useEffect)(()=>{if(!e)return h(),void i(e=>"unsupported"===e?"unsupported":"idle");if("undefined"===typeof navigator||!navigator.geolocation)return i("unsupported"),void n(!1);i("pending");let t=null;return d.current=navigator.geolocation.watchPosition(e=>{if(t){if(((e,t,n,r)=>{const i=e*Math.PI/180,s=n*Math.PI/180,a=(n-e)*Math.PI/180,o=(r-t)*Math.PI/180,l=Math.sin(a/2)*Math.sin(a/2)+Math.cos(i)*Math.cos(s)*Math.sin(o/2)*Math.sin(o/2);return 2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*6371e3})(t.coords.latitude,t.coords.longitude,e.coords.latitude,e.coords.longitude)<5)return}t=e,i("active"),l(null),a({lat:e.coords.latitude,lng:e.coords.longitude,accuracy:e.coords.accuracy}),u(new Date(e.timestamp||Date.now()))},e=>{console.warn("Geolocation misslyckades",e),l(e),e.code===e.PERMISSION_DENIED?(i("denied"),n(!1)):e.code===e.POSITION_UNAVAILABLE?i("unavailable"):e.code===e.TIMEOUT?i("timeout"):i("error")},{enableHighAccuracy:!0,maximumAge:1e4,timeout:2e4}),h},[e,h]);const p=(0,t.useCallback)(()=>{n(!0)},[]),f=(0,t.useCallback)(()=>{n(!1)},[]),m=(0,t.useCallback)(()=>s&&"active"===r?s:Ms,[s,r]);return{trackingEnabled:e,status:r,coords:s,error:o,lastUpdated:c,enableTracking:p,disableTracking:f,getCurrentPosition:m}};var yo=n(5173);function xo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function bo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xo(Object(n),!0).forEach(function(t){_o(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xo(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function wo(e){return wo="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wo(e)}function _o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ko(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function No(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=e&&("undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null==n)return;var r,i,s=[],a=!0,o=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(s.push(r.value),!t||s.length!==t);a=!0);}catch(l){o=!0,i=l}finally{try{a||null==n.return||n.return()}finally{if(o)throw i}}return s}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return So(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return So(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function So(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var jo=function(e,n,r){var i=!!r,s=t.useRef(r);t.useEffect(function(){s.current=r},[r]),t.useEffect(function(){if(!i||!e)return function(){};var t=function(){s.current&&s.current.apply(s,arguments)};return e.on(n,t),function(){e.off(n,t)}},[i,n,e,s])},Eo=function(e){var n=t.useRef(e);return t.useEffect(function(){n.current=e},[e]),n.current},Co=function(e){return null!==e&&"object"===wo(e)},To="[object Object]",Ao=function e(t,n){if(!Co(t)||!Co(n))return t===n;var r=Array.isArray(t);if(r!==Array.isArray(n))return!1;var i=Object.prototype.toString.call(t)===To;if(i!==(Object.prototype.toString.call(n)===To))return!1;if(!i&&!r)return t===n;var s=Object.keys(t),a=Object.keys(n);if(s.length!==a.length)return!1;for(var o={},l=0;l<s.length;l+=1)o[s[l]]=!0;for(var c=0;c<a.length;c+=1)o[a[c]]=!0;var u=Object.keys(o);if(u.length!==s.length)return!1;var d=t,h=n;return u.every(function(t){return e(d[t],h[t])})},Io=function(e,t,n){return Co(e)?Object.keys(e).reduce(function(r,i){var s=!Co(t)||!Ao(e[i],t[i]);return n.includes(i)?(s&&console.warn("Unsupported prop change: options.".concat(i," is not a mutable property.")),r):s?bo(bo({},r||{}),{},_o({},i,e[i])):r},null):null},Po="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",Lo=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Po;if(null===e||Co(t=e)&&"function"===typeof t.elements&&"function"===typeof t.createToken&&"function"===typeof t.createPaymentMethod&&"function"===typeof t.confirmCardPayment)return e;throw new Error(n)},Ro=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Po;if(function(e){return Co(e)&&"function"===typeof e.then}(e))return{tag:"async",stripePromise:Promise.resolve(e).then(function(e){return Lo(e,t)})};var n=Lo(e,t);return null===n?{tag:"empty"}:{tag:"sync",stripe:n}},Oo=function(e){e&&e._registerWrapper&&e.registerAppInfo&&(e._registerWrapper({name:"react-stripe-js",version:"4.0.2"}),e.registerAppInfo({name:"react-stripe-js",version:"4.0.2",url:"https://stripe.com/docs/stripe-js/react"}))},Mo=t.createContext(null);Mo.displayName="ElementsContext";var Do=function(e,t){if(!e)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(t," in an <Elements> provider."));return e},Fo=function(e){var n=e.stripe,r=e.options,i=e.children,s=t.useMemo(function(){return Ro(n)},[n]),a=No(t.useState(function(){return{stripe:"sync"===s.tag?s.stripe:null,elements:"sync"===s.tag?s.stripe.elements(r):null}}),2),o=a[0],l=a[1];t.useEffect(function(){var e=!0,t=function(e){l(function(t){return t.stripe?t:{stripe:e,elements:e.elements(r)}})};return"async"!==s.tag||o.stripe?"sync"!==s.tag||o.stripe||t(s.stripe):s.stripePromise.then(function(n){n&&e&&t(n)}),function(){e=!1}},[s,o,r]);var c=Eo(n);t.useEffect(function(){null!==c&&c!==n&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[c,n]);var u=Eo(r);return t.useEffect(function(){if(o.elements){var e=Io(r,u,["clientSecret","fonts"]);e&&o.elements.update(e)}},[r,u,o.elements]),t.useEffect(function(){Oo(o.stripe)},[o.stripe]),t.createElement(Mo.Provider,{value:o},i)};Fo.propTypes={stripe:yo.any,options:yo.object};var zo=function(e){var n=t.useContext(Mo);return Do(n,e)};yo.func.isRequired;var Uo=t.createContext(null);Uo.displayName="CheckoutContext",yo.any,yo.shape({fetchClientSecret:yo.func.isRequired,elementsOptions:yo.object}).isRequired;var Bo=function(e){var n=t.useContext(Uo),r=t.useContext(Mo);if(n){if(r)throw new Error("You cannot wrap the part of your app that ".concat(e," in both <CheckoutProvider> and <Elements> providers."));return n}return Do(r,e)},Vo=["mode"],qo=function(e,n){var r,i="".concat((r=e).charAt(0).toUpperCase()+r.slice(1),"Element"),s=n?function(e){Bo("mounts <".concat(i,">"));var n=e.id,r=e.className;return t.createElement("div",{id:n,className:r})}:function(n){var r,s=n.id,a=n.className,o=n.options,l=void 0===o?{}:o,c=n.onBlur,u=n.onFocus,d=n.onReady,h=n.onChange,p=n.onEscape,f=n.onClick,m=n.onLoadError,g=n.onLoaderStart,v=n.onNetworksChange,y=n.onConfirm,x=n.onCancel,b=n.onShippingAddressChange,w=n.onShippingRateChange,_=n.onSavedPaymentMethodRemove,k=n.onSavedPaymentMethodUpdate,N=Bo("mounts <".concat(i,">")),S="elements"in N?N.elements:null,j="checkoutState"in N?N.checkoutState:null,E="success"===(null===j||void 0===j?void 0:j.type)?j.checkout:null,C=No(t.useState(null),2),T=C[0],A=C[1],I=t.useRef(null),P=t.useRef(null);jo(T,"blur",c),jo(T,"focus",u),jo(T,"escape",p),jo(T,"click",f),jo(T,"loaderror",m),jo(T,"loaderstart",g),jo(T,"networkschange",v),jo(T,"confirm",y),jo(T,"cancel",x),jo(T,"shippingaddresschange",b),jo(T,"shippingratechange",w),jo(T,"savedpaymentmethodremove",_),jo(T,"savedpaymentmethodupdate",k),jo(T,"change",h),d&&(r="expressCheckout"===e?d:function(){d(T)}),jo(T,"ready",r),t.useLayoutEffect(function(){if(null===I.current&&null!==P.current&&(S||E)){var t=null;if(E)switch(e){case"payment":t=E.createPaymentElement(l);break;case"address":if(!("mode"in l))throw new Error("You must supply options.mode. mode must be 'billing' or 'shipping'.");var n=l.mode,r=ko(l,Vo);if("shipping"===n)t=E.createShippingAddressElement(r);else{if("billing"!==n)throw new Error("Invalid options.mode. mode must be 'billing' or 'shipping'.");t=E.createBillingAddressElement(r)}break;case"expressCheckout":t=E.createExpressCheckoutElement(l);break;case"currencySelector":t=E.createCurrencySelectorElement();break;case"taxId":t=E.createTaxIdElement(l);break;default:throw new Error("Invalid Element type ".concat(i,". You must use either the <PaymentElement />, <AddressElement options={{mode: 'shipping'}} />, <AddressElement options={{mode: 'billing'}} />, or <ExpressCheckoutElement />."))}else S&&(t=S.create(e,l));I.current=t,A(t),t&&t.mount(P.current)}},[S,E,l]);var L=Eo(l);return t.useEffect(function(){if(I.current){var e=Io(l,L,["paymentRequest"]);e&&"update"in I.current&&I.current.update(e)}},[l,L]),t.useLayoutEffect(function(){return function(){if(I.current&&"function"===typeof I.current.destroy)try{I.current.destroy(),I.current=null}catch(e){}}},[]),t.createElement("div",{id:s,className:a,ref:P})};return s.propTypes={id:yo.string,className:yo.string,onChange:yo.func,onBlur:yo.func,onFocus:yo.func,onReady:yo.func,onEscape:yo.func,onClick:yo.func,onLoadError:yo.func,onLoaderStart:yo.func,onNetworksChange:yo.func,onConfirm:yo.func,onCancel:yo.func,onShippingAddressChange:yo.func,onShippingRateChange:yo.func,onSavedPaymentMethodRemove:yo.func,onSavedPaymentMethodUpdate:yo.func,options:yo.object},s.displayName=i,s.__elementType=e,s},Ko="undefined"===typeof window,Ho=t.createContext(null);Ho.displayName="EmbeddedCheckoutProviderContext";qo("auBankAccount",Ko);var Wo,Go=qo("card",Ko),Zo=(qo("cardNumber",Ko),qo("cardExpiry",Ko),qo("cardCvc",Ko),qo("fpxBank",Ko),qo("iban",Ko),qo("idealBank",Ko),qo("p24Bank",Ko),qo("epsBank",Ko),qo("payment",Ko),qo("expressCheckout",Ko),qo("paymentRequestButton",Ko),qo("linkAuthentication",Ko),qo("address",Ko),qo("shippingAddress",Ko),qo("paymentMethodMessaging",Ko),qo("affirmMessage",Ko),qo("afterpayClearpayMessage",Ko),qo("taxId",Ko),"basil"),Qo="https://js.stripe.com",Jo="".concat(Qo,"/").concat(Zo,"/stripe.js"),Yo=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,Xo=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/,$o="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",el=function(e){return Yo.test(e)||Xo.test(e)},tl=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",n=document.createElement("script");n.src="".concat(Jo).concat(t);var r=document.head||document.body;if(!r)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return r.appendChild(n),n},nl=null,rl=null,il=null,sl=function(e){return null!==nl?nl:(nl=new Promise(function(t,n){if("undefined"!==typeof window&&"undefined"!==typeof document)if(window.Stripe&&e&&console.warn($o),window.Stripe)t(window.Stripe);else try{var r=function(){for(var e=document.querySelectorAll('script[src^="'.concat(Qo,'"]')),t=0;t<e.length;t++){var n=e[t];if(el(n.src))return n}return null}();if(r&&e)console.warn($o);else if(r){if(r&&null!==il&&null!==rl){var i;r.removeEventListener("load",il),r.removeEventListener("error",rl),null===(i=r.parentNode)||void 0===i||i.removeChild(r),r=tl(e)}}else r=tl(e);il=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}}(t,n),rl=function(e){return function(t){e(new Error("Failed to load Stripe.js",{cause:t}))}}(n),r.addEventListener("load",il),r.addEventListener("error",rl)}catch(s){return void n(s)}else t(null)}),nl.catch(function(e){return nl=null,Promise.reject(e)}))},al=!1,ol=function(){return Wo||(Wo=sl(null).catch(function(e){return Wo=null,Promise.reject(e)}))};Promise.resolve().then(function(){return ol()}).catch(function(e){al||console.warn(e)});var ll=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];al=!0;var r=Date.now();return ol().then(function(e){return function(e,t,n){if(null===e)return null;var r=t[0].match(/^pk_test/),i=function(e){return 3===e?"v3":e}(e.version),s=Zo;r&&i!==s&&console.warn("Stripe.js@".concat(i," was loaded on the page, but @stripe/stripe-js@").concat("7.9.0"," expected Stripe.js@").concat(s,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var a=e.apply(void 0,t);return function(e,t){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"7.9.0",startTime:t})}(a,n),a}(e,t,r)})};const cl=()=>"true"==={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_FIREBASE_API_KEY:"AIzaSyArvQzOJTrtsekOK9Wpgi3PezPcM9KmXyY",REACT_APP_FIREBASE_APP_ID:"1:614868886377:web:3c020075969956ef1813f8",REACT_APP_FIREBASE_AUTH_DOMAIN:"geoquest2-7e45c.firebaseapp.com",REACT_APP_FIREBASE_MEASUREMENT_ID:"G-L45RHX7MCN",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"614868886377",REACT_APP_FIREBASE_PROJECT_ID:"geoquest2-7e45c",REACT_APP_FIREBASE_STORAGE_BUCKET:"geoquest2-7e45c.firebasestorage.app",REACT_APP_OPENROUTE_API_KEY:"eyJvcmciOiI1YjNjZTM1OTc4NTExMTAwMDFjZjYyNDgiLCJpZCI6ImEzN2RiYzM2MjdlZDRjMzVhNjE4MTI3ZTU2MTcwMjVjIiwiaCI6Im11cm11cjY0In0=",REACT_APP_STRIPE_PUBLISHABLE_KEY:"pk_live_51SCkJSCO02VZleLGS20eWjUQl0cAhGoZaQA5wfxS9ShhQJZmTm8Os02jPlP9c2fehToeLz369r0pjAixP98N6FAy00DFPn5jNh"}.REACT_APP_PAYMENT_TEST_MODE||"undefined"!==typeof window&&"true"===localStorage.getItem("geoquest:paymentTestMode");let ul=null;const dl={createPaymentIntent:async e=>{let{runId:t,participantId:n,amount:r=500}=e;if(cl())return{success:!0,paymentIntentId:"test_pi_".concat(t,"_").concat(n,"_").concat(Date.now()),testMode:!0};try{const e="https://europe-west1-".concat("geoquest2-7e45c",".cloudfunctions.net/createPaymentIntent"),i=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({runId:t,participantId:n,amount:r,currency:"sek"})});if(!i.ok){const e=await i.json().catch(()=>({}));throw new Error(e.error||"HTTP error! status: ".concat(i.status))}const{client_secret:s,payment_intent_id:a}=await i.json();return{success:!0,clientSecret:s,paymentIntentId:a,testMode:!1}}catch(i){return console.error("[PaymentService] Fel vid skapande av betalning:",i),{success:!1,error:i.message,testMode:!1}}},confirmPayment:async e=>{let{clientSecret:t,stripe:n,elements:r}=e;if(cl())return{success:!0,paymentIntent:{id:"test_pi_confirmed_".concat(Date.now()),status:"succeeded"},testMode:!0};if(!n||!r)return{success:!1,error:"Stripe har inte laddats korrekt"};try{const{error:e,paymentIntent:i}=await n.confirmCardPayment(t,{payment_method:{card:r.getElement("card")}});return e?{success:!1,error:e.message}:{success:!0,paymentIntent:i,testMode:!1}}catch(i){return console.error("[PaymentService] Fel vid bekr\xe4ftelse av betalning:",i),{success:!1,error:i.message}}},getTestMode:cl,setTestMode:e=>{"undefined"!==typeof window&&(e?localStorage.setItem("geoquest:paymentTestMode","true"):localStorage.removeItem("geoquest:paymentTestMode"))},getStripeInstance:()=>(ul||cl()||(ul=ll("pk_live_51SCkJSCO02VZleLGS20eWjUQl0cAhGoZaQA5wfxS9ShhQJZmTm8Os02jPlP9c2fehToeLz369r0pjAixP98N6FAy00DFPn5jNh")),ul)},hl={style:{base:{fontSize:"16px",color:"#ffffff","::placeholder":{color:"#9CA3AF"},backgroundColor:"transparent"},invalid:{color:"#EF4444",iconColor:"#EF4444"}},hidePostalCode:!0},pl=e=>{let{runName:n,amount:r,onSuccess:i,onCancel:s,allowSkip:a=!0}=e;const[o,l]=(0,t.useState)(!1);return(0,bi.jsx)("div",{className:"fixed inset-0 z-[1100] flex items-end justify-center bg-black/70 p-4 sm:items-center",children:(0,bi.jsxs)("div",{className:"w-full max-w-lg rounded-2xl border border-slate-600 bg-slate-900 p-5 sm:p-6 shadow-2xl max-h-[90vh] overflow-y-auto",children:[(0,bi.jsxs)("div",{className:"mb-6",children:[(0,bi.jsx)("h2",{className:"text-xl font-semibold text-white mb-2",children:"St\xf6d projektet (valfritt)"}),(0,bi.jsx)("p",{className:"text-gray-300 text-sm mb-2",children:n}),(0,bi.jsx)("p",{className:"text-gray-400 text-sm",children:"Vill du st\xf6dja utvecklingen av RouteQuest med en frivillig donation?"}),(0,bi.jsx)("div",{className:"mt-2 bg-emerald-900/30 border border-emerald-500/50 rounded p-2",children:(0,bi.jsx)("p",{className:"text-emerald-200 text-xs",children:"\ud83e\uddea Test-l\xe4ge aktiverat - ingen riktig betalning kr\xe4vs"})})]}),(0,bi.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),l(!0),await new Promise(e=>setTimeout(e,1e3)),i({paymentIntentId:"test_payment_".concat(Date.now()),testMode:!0})},className:"space-y-4",children:[(0,bi.jsxs)("div",{className:"bg-slate-800 rounded-lg p-4 border border-slate-600",children:[(0,bi.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,bi.jsx)("span",{className:"text-gray-300",children:"Belopp:"}),(0,bi.jsxs)("span",{className:"text-white font-semibold",children:[(r/100).toFixed(2)," kr"]})]}),(0,bi.jsx)("p",{className:"text-sm text-gray-400",children:"Test-l\xe4ge: Ingen riktig betalning kr\xe4vs"})]}),(0,bi.jsxs)("div",{className:"space-y-3 pt-4",children:[(0,bi.jsxs)("div",{className:"flex gap-3",children:[(0,bi.jsx)("button",{type:"button",onClick:s,disabled:o,className:"flex-1 rounded-lg bg-slate-700 px-4 py-2 font-semibold text-gray-200 hover:bg-slate-600 disabled:opacity-50",children:"Avbryt"}),(0,bi.jsx)("button",{type:"submit",disabled:o,className:"flex-1 rounded-lg bg-emerald-500 px-4 py-2 font-semibold text-black hover:bg-emerald-400 disabled:opacity-50",children:o?"Bearbetar...":"Forts\xe4tt (Test)"})]}),a&&(0,bi.jsx)("button",{type:"button",onClick:()=>{i({paymentIntentId:"skipped_payment_".concat(Date.now()),testMode:!0,skipped:!0})},disabled:o,className:"w-full rounded-lg bg-slate-700 px-4 py-2 font-semibold text-gray-300 hover:bg-slate-600 disabled:opacity-50 text-sm",children:"Forts\xe4tt utan donation"})]})]}),(0,bi.jsx)("div",{className:"mt-4 text-xs text-gray-400 text-center",children:"\ud83e\uddea Test-l\xe4ge aktiverat"})]})})},fl=e=>{let{runName:n,amount:r,onSuccess:i,onCancel:s,runId:a,participantId:o,allowSkip:l=!0}=e;const c=Bo("calls useStripe()").stripe,u=zo("calls useElements()").elements,[d,h]=(0,t.useState)(!1),[p,f]=(0,t.useState)(""),[m,g]=(0,t.useState)("");(0,t.useEffect)(()=>{(async()=>{if(!a||!r)return void f("Saknar n\xf6dv\xe4ndig information f\xf6r betalning");const e=await dl.createPaymentIntent({runId:a,participantId:o||"anonymous",amount:r});e.success?g(e.clientSecret):f(e.error)})()},[a,o,r]);return(0,bi.jsx)("div",{className:"fixed inset-0 z-[1100] flex items-end justify-center bg-black/70 p-4 sm:items-center",children:(0,bi.jsxs)("div",{className:"w-full max-w-lg rounded-2xl border border-slate-600 bg-slate-900 p-5 sm:p-6 shadow-2xl max-h-[90vh] overflow-y-auto",children:[(0,bi.jsxs)("div",{className:"mb-6",children:[(0,bi.jsx)("h2",{className:"text-xl font-semibold text-white mb-2",children:"St\xf6d projektet (valfritt)"}),(0,bi.jsx)("p",{className:"text-gray-300 text-sm mb-2",children:n}),(0,bi.jsx)("p",{className:"text-gray-400 text-sm",children:"Vill du st\xf6dja utvecklingen av RouteQuest med en frivillig donation?"})]}),(0,bi.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!d){h(!0),f("");try{if(!c||!u)return void f("Betalningssystem inte laddat");if(!u.getElement(Go))return void f("Kortf\xe4lt inte tillg\xe4ngligt");const e=await dl.confirmPayment({clientSecret:m,stripe:c,elements:u});e.success?i({paymentIntentId:e.paymentIntent.id,testMode:!1}):f(e.error)}catch(t){f("Ett ov\xe4ntat fel intr\xe4ffade"),console.error("[PaymentModal] Betalningsfel:",t)}finally{h(!1)}}},className:"space-y-4",children:[(0,bi.jsxs)("div",{className:"bg-slate-800 rounded-lg p-4 border border-slate-600",children:[(0,bi.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,bi.jsx)("span",{className:"text-gray-300",children:"Belopp:"}),(0,bi.jsxs)("span",{className:"text-white font-semibold",children:[(r/100).toFixed(2)," kr"]})]}),(0,bi.jsxs)("div",{className:"space-y-2",children:[(0,bi.jsx)("label",{className:"text-sm text-gray-300",children:"Kortnummer, datum och CVC"}),(0,bi.jsx)("div",{className:"bg-slate-700 rounded border border-slate-600 p-3",children:(0,bi.jsx)(Go,{options:hl})})]})]}),p&&(0,bi.jsx)("div",{className:"bg-red-900/30 border border-red-500/50 rounded p-3",children:(0,bi.jsx)("p",{className:"text-red-200 text-sm",children:p})}),(0,bi.jsxs)("div",{className:"space-y-3 pt-4",children:[(0,bi.jsxs)("div",{className:"flex gap-3",children:[(0,bi.jsx)("button",{type:"button",onClick:s,disabled:d,className:"flex-1 rounded-lg bg-slate-700 px-4 py-2 font-semibold text-gray-200 hover:bg-slate-600 disabled:opacity-50",children:"Avbryt"}),(0,bi.jsx)("button",{type:"submit",disabled:d||!c,className:"flex-1 rounded-lg bg-emerald-500 px-4 py-2 font-semibold text-black hover:bg-emerald-400 disabled:opacity-50",children:d?"Bearbetar...":"Donera ".concat((r/100).toFixed(2)," kr")})]}),l&&(0,bi.jsx)("button",{type:"button",onClick:()=>{i({paymentIntentId:"skipped_payment_".concat(Date.now()),testMode:!0,skipped:!0})},disabled:d,className:"w-full rounded-lg bg-slate-700 px-4 py-2 font-semibold text-gray-300 hover:bg-slate-600 disabled:opacity-50 text-sm",children:"Forts\xe4tt utan donation"})]})]}),(0,bi.jsx)("div",{className:"mt-4 text-xs text-gray-400 text-center",children:"\ud83d\udd12 S\xe4ker betalning via Stripe"})]})})},ml=e=>{let{isOpen:n,runName:r,amount:i=500,onSuccess:s,onCancel:a,runId:o,participantId:l,allowSkip:c=!0}=e;const[u,d]=(0,t.useState)(null);return(0,t.useEffect)(()=>{dl.getTestMode()||d(dl.getStripeInstance())},[]),n?dl.getTestMode()?(0,bi.jsx)(pl,{runName:r,amount:i,onSuccess:s,onCancel:a,allowSkip:c}):(0,bi.jsx)(Fo,{stripe:u,children:(0,bi.jsx)(fl,{runName:r,amount:i,onSuccess:s,onCancel:a,runId:o,participantId:l,allowSkip:c})}):null},gl=pi(),vl=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{const r=(0,Ti.A)((0,Ti.A)({},e),{},{userId:t,deviceId:n,createdAt:(0,si.O5)(),read:!1,resolved:!1,userAgent:navigator.userAgent,screenSize:"".concat(window.screen.width,"x").concat(window.screen.height),language:navigator.language});return(await(0,si.gS)((0,si.rJ)(gl,"feedback"),r)).id}catch(r){throw console.error("Error submitting feedback:",r),r}},yl=e=>{let{isOpen:n,onClose:r}=e;const{currentUser:i}=Ci(),[s,a]=(0,t.useState)({name:"",email:"",type:"general",message:""}),[o,l]=(0,t.useState)(!1),[c,u]=(0,t.useState)(!1),[d,h]=(0,t.useState)("");if(!n)return null;const p=()=>{a({name:"",email:"",type:"general",message:""}),u(!1),h(""),r()};return(0,bi.jsx)("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-[1200]",onClick:e=>{e.target===e.currentTarget&&p()},children:(0,bi.jsxs)("div",{className:"bg-slate-900 rounded-xl shadow-2xl border border-cyan-500/40 max-w-md w-full",onClick:e=>e.stopPropagation(),children:[(0,bi.jsxs)("div",{className:"bg-slate-900 border-b border-slate-700 p-6 flex items-center justify-between rounded-t-xl",children:[(0,bi.jsx)("h2",{className:"text-2xl font-bold bg-gradient-to-r from-cyan-400 to-indigo-400 bg-clip-text text-transparent",children:"Ge feedback"}),(0,bi.jsx)("button",{onClick:p,className:"text-gray-400 hover:text-gray-200 transition-colors p-2 hover:bg-slate-800 rounded-lg","aria-label":"St\xe4ng",children:(0,bi.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,bi.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,bi.jsx)("div",{className:"p-6",children:c?(0,bi.jsxs)("div",{className:"text-center py-8",children:[(0,bi.jsx)("svg",{className:"w-16 h-16 text-green-400 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,bi.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,bi.jsx)("h3",{className:"text-xl font-semibold text-white mb-2",children:"Tack f\xf6r din feedback!"}),(0,bi.jsx)("p",{className:"text-gray-400",children:"Vi uppskattar verkligen att du tog dig tid att dela med dig."})]}):(0,bi.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),s.message.trim()){l(!0),h("");try{const e=Xa(),t=null!==i&&void 0!==i&&i.isAnonymous?null:null===i||void 0===i?void 0:i.id;await vl((0,Ti.A)((0,Ti.A)({},s),{},{page:window.location.pathname}),t,e),u(!0),setTimeout(()=>{p()},2e3)}catch(t){console.error("Fel vid skickning av feedback:",t),h("Kunde inte skicka feedback. F\xf6rs\xf6k igen senare.")}finally{l(!1)}}else h("V\xe4nligen skriv ett meddelande")},className:"space-y-4",children:[(0,bi.jsx)("p",{className:"text-gray-300 text-sm mb-4",children:"Har du en id\xe9, hittat ett fel eller bara vill s\xe4ga hej? Vi skulle g\xe4rna h\xf6ra fr\xe5n dig!"}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-300 mb-2",children:"Namn (valfritt)"}),(0,bi.jsx)("input",{type:"text",id:"name",value:s.name,onChange:e=>a((0,Ti.A)((0,Ti.A)({},s),{},{name:e.target.value})),className:"w-full px-4 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white focus:ring-2 focus:ring-cyan-500 focus:outline-none",placeholder:"Ditt namn"})]}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-300 mb-2",children:"E-post (valfritt, om du vill ha svar)"}),(0,bi.jsx)("input",{type:"email",id:"email",value:s.email,onChange:e=>a((0,Ti.A)((0,Ti.A)({},s),{},{email:e.target.value})),className:"w-full px-4 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white focus:ring-2 focus:ring-cyan-500 focus:outline-none",placeholder:"din@email.se"})]}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("label",{htmlFor:"type",className:"block text-sm font-medium text-gray-300 mb-2",children:"Typ av feedback"}),(0,bi.jsxs)("select",{id:"type",value:s.type,onChange:e=>a((0,Ti.A)((0,Ti.A)({},s),{},{type:e.target.value})),className:"w-full px-4 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white focus:ring-2 focus:ring-cyan-500 focus:outline-none",children:[(0,bi.jsx)("option",{value:"general",children:"Allm\xe4n feedback"}),(0,bi.jsx)("option",{value:"bug",children:"Buggrapport"}),(0,bi.jsx)("option",{value:"feature",children:"Funktionsf\xf6rslag"}),(0,bi.jsx)("option",{value:"question",children:"Fr\xe5ga"})]})]}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("label",{htmlFor:"message",className:"block text-sm font-medium text-gray-300 mb-2",children:"Meddelande *"}),(0,bi.jsx)("textarea",{id:"message",value:s.message,onChange:e=>a((0,Ti.A)((0,Ti.A)({},s),{},{message:e.target.value})),rows:5,className:"w-full px-4 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white focus:ring-2 focus:ring-cyan-500 focus:outline-none resize-none",placeholder:"Ber\xe4tta vad du tycker...",required:!0})]}),d&&(0,bi.jsx)("div",{className:"bg-red-500/10 border border-red-500/50 rounded-lg p-3 text-red-400 text-sm",children:d}),(0,bi.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,bi.jsx)("button",{type:"button",onClick:p,className:"flex-1 bg-slate-700 hover:bg-slate-600 text-white font-semibold py-3 px-4 rounded-lg transition-colors",disabled:o,children:"Avbryt"}),(0,bi.jsx)("button",{type:"submit",className:"flex-1 bg-gradient-to-r from-cyan-600 to-indigo-600 hover:from-cyan-700 hover:to-indigo-700 text-white font-semibold py-3 px-4 rounded-lg transition-all shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",disabled:o,children:o?"Skickar...":"Skicka"})]})]})})]})})},xl=e=>{let{isOpen:r,onClose:i}=e;const[s,a]=(0,t.useState)(!1),[o,l]=(0,t.useState)(50),[c,u]=(0,t.useState)(!1),[d,h]=(0,t.useState)(!1),[p,f]=(0,t.useState)({isOpen:!1,title:"",message:"",type:"info"});if(!r)return null;return(0,bi.jsxs)(bi.Fragment,{children:[(0,bi.jsx)("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-start justify-center p-4 z-[1200] overflow-y-auto pt-20",onClick:e=>{e.target===e.currentTarget&&i()},children:(0,bi.jsxs)("div",{className:"bg-slate-900 rounded-xl shadow-2xl border border-purple-500/40 max-w-2xl w-full mb-8",onClick:e=>e.stopPropagation(),children:[(0,bi.jsxs)("div",{className:"bg-slate-900 border-b border-slate-700 p-6 flex items-center justify-between rounded-t-xl",children:[(0,bi.jsxs)("div",{className:"flex items-center gap-3",children:[(0,bi.jsx)("img",{src:"/logo-compass.svg",alt:"RouteQuest",className:"w-10 h-10"}),(0,bi.jsx)("h2",{className:"text-2xl font-bold bg-gradient-to-r from-cyan-400 to-indigo-400 bg-clip-text text-transparent",children:"Om RouteQuest"})]}),(0,bi.jsx)("button",{onClick:i,className:"text-gray-400 hover:text-gray-200 transition-colors p-2 hover:bg-slate-800 rounded-lg flex-shrink-0","aria-label":"St\xe4ng",children:(0,bi.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,bi.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,bi.jsxs)("div",{className:"p-6 space-y-6 text-gray-300",children:[(0,bi.jsxs)("div",{className:"text-sm text-gray-500",children:["Version ",n(8330).rE]}),(0,bi.jsxs)("section",{children:[(0,bi.jsx)("h3",{className:"text-lg font-semibold text-cyan-400 mb-2",children:"Vad \xe4r RouteQuest?"}),(0,bi.jsx)("p",{className:"leading-relaxed",children:"RouteQuest \xe4r en plattform f\xf6r att skapa och spela interaktiva tipspromenader. Skapa sp\xe4nnande rutter med fr\xe5gor och utmaningar, eller delta i redan skapade \xe4ventyr!"})]}),(0,bi.jsxs)("section",{children:[(0,bi.jsxs)("button",{onClick:()=>u(!c),className:"w-full flex items-center justify-between text-lg font-semibold text-cyan-400 hover:text-cyan-300 transition-colors mb-3",children:[(0,bi.jsx)("span",{children:"S\xe5 h\xe4r fungerar det"}),(0,bi.jsx)("svg",{className:"w-5 h-5 transition-transform ".concat(c?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,bi.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),c&&(0,bi.jsxs)("div",{className:"space-y-4",children:[(0,bi.jsxs)("div",{children:[(0,bi.jsx)("h4",{className:"font-semibold text-indigo-300 mb-1",children:"\ud83d\uddfa\ufe0f Skapa en runda"}),(0,bi.jsxs)("ul",{className:"list-disc list-inside space-y-1 text-sm ml-4",children:[(0,bi.jsx)("li",{children:"Klicka p\xe5 kartan f\xf6r att markera start och slut"}),(0,bi.jsx)("li",{children:"V\xe4lj sv\xe5righetsgrad och antal fr\xe5gor"}),(0,bi.jsx)("li",{children:"En rutt genereras automatiskt med fr\xe5gor l\xe4ngs v\xe4gen"}),(0,bi.jsx)("li",{children:"Dela QR-koden eller l\xe4nken med deltagare"})]})]}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("h4",{className:"font-semibold text-indigo-300 mb-1",children:"\ud83c\udfae Spela en runda"}),(0,bi.jsxs)("ul",{className:"list-disc list-inside space-y-1 text-sm ml-4",children:[(0,bi.jsx)("li",{children:"Skanna QR-koden eller \xf6ppna l\xe4nken"}),(0,bi.jsx)("li",{children:"Ange ditt namn och v\xe4lj spr\xe5k (svenska eller engelska)"}),(0,bi.jsx)("li",{children:"F\xf6lj rutten p\xe5 kartan och besvara fr\xe5gorna"}),(0,bi.jsx)("li",{children:"Se dina resultat och j\xe4mf\xf6r med andra deltagare"})]})]}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("h4",{className:"font-semibold text-indigo-300 mb-1",children:"\ud83d\udc64 Mina rundor"}),(0,bi.jsxs)("ul",{className:"list-disc list-inside space-y-1 text-sm ml-4",children:[(0,bi.jsx)("li",{children:"Se alla rundor du skapat och deltagit i"}),(0,bi.jsx)("li",{children:"F\xf6lj deltagarnas framsteg i realtid"}),(0,bi.jsx)("li",{children:"Avsluta rundor och se slutresultat"}),(0,bi.jsx)("li",{children:"Logga in f\xf6r att synka mellan enheter"})]})]})]})]}),(0,bi.jsxs)("section",{className:"bg-gradient-to-r from-purple-500/10 to-indigo-500/10 rounded-lg p-4 border border-purple-500/20",children:[(0,bi.jsx)("h3",{className:"text-lg font-semibold text-cyan-400 mb-2",children:"St\xf6d RouteQuest"}),(0,bi.jsx)("p",{className:"text-sm mb-3 leading-relaxed",children:"RouteQuest \xe4r gratis att anv\xe4nda! Om du tycker om tj\xe4nsten kan du st\xf6dja utvecklingen med en donation."}),(0,bi.jsxs)("div",{className:"flex items-center gap-3",children:[(0,bi.jsx)("input",{type:"number",min:"10",step:"10",value:o,onChange:e=>l(parseInt(e.target.value)||50),className:"w-24 px-3 py-2 bg-slate-800 border border-slate-600 rounded-lg text-white focus:ring-2 focus:ring-cyan-500 focus:outline-none"}),(0,bi.jsx)("span",{className:"text-gray-400",children:"SEK"}),(0,bi.jsx)("button",{onClick:()=>{a(!0)},className:"flex-1 bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white font-semibold py-2 px-4 rounded-lg transition-all shadow-lg",children:"Donera"})]})]}),(0,bi.jsxs)("section",{children:[(0,bi.jsx)("h3",{className:"text-lg font-semibold text-cyan-400 mb-3",children:"Kontakta oss"}),(0,bi.jsxs)("div",{className:"space-y-3",children:[(0,bi.jsxs)("button",{onClick:()=>h(!0),className:"w-full bg-gradient-to-r from-cyan-600 to-indigo-600 hover:from-cyan-700 hover:to-indigo-700 text-white font-semibold py-3 px-4 rounded-lg transition-all shadow-lg flex items-center justify-center gap-2",children:[(0,bi.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,bi.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),"Ge feedback / Kontakta oss"]}),(0,bi.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-400 justify-center",children:[(0,bi.jsx)("svg",{className:"w-4 h-4 text-indigo-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,bi.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"})}),(0,bi.jsx)("a",{href:"https://www.routequest.se",target:"_blank",rel:"noopener noreferrer",className:"text-cyan-300 hover:text-cyan-200 transition-colors",children:"www.routequest.se"})]})]})]}),(0,bi.jsxs)("div",{className:"text-center text-sm text-gray-500 pt-4 border-t border-slate-700",children:[(0,bi.jsx)("p",{className:"mb-2",children:"\xa9 2025 RouteQuest. Skapad med \u2764\ufe0f f\xf6r \xe4ventyrslystna sj\xe4lar."}),(0,bi.jsxs)("div",{className:"flex justify-center gap-4 text-xs",children:[(0,bi.jsx)("a",{href:"/privacy-policy.html",target:"_blank",rel:"noopener noreferrer",className:"text-cyan-400 hover:text-cyan-300 transition-colors",children:"Integritetspolicy"}),(0,bi.jsx)("span",{className:"text-gray-600",children:"|"}),(0,bi.jsx)("a",{href:"/terms-of-service.html",target:"_blank",rel:"noopener noreferrer",className:"text-cyan-400 hover:text-cyan-300 transition-colors",children:"Anv\xe4ndarvillkor"})]})]}),(0,bi.jsx)("div",{className:"mt-6",children:(0,bi.jsx)("button",{onClick:i,className:"w-full bg-slate-700 hover:bg-slate-600 text-white font-semibold py-3 px-4 rounded-lg transition-colors",children:"St\xe4ng"})})]})]})}),s&&(0,bi.jsx)(ml,{isOpen:s,runName:"RouteQuest Donation",runId:"donation",participantId:"donation",amount:100*o,allowSkip:!0,onSuccess:e=>{a(!1),e.skipped||f({isOpen:!0,title:"Tack f\xf6r din donation!",message:"Tack f\xf6r din donation! \ud83d\udc9a",type:"success"})},onCancel:()=>a(!1)}),(0,bi.jsx)(yl,{isOpen:d,onClose:()=>h(!1)}),(0,bi.jsx)(oa,{isOpen:p.isOpen,onClose:()=>f((0,Ti.A)((0,Ti.A)({},p),{},{isOpen:!1})),title:p.title,message:p.message,type:p.type})]})},bl=e=>{let{isOpen:n,onClose:r,onUnreadChange:i=()=>{}}=e;const{currentUser:s}=Ci(),[a,o]=(0,t.useState)([]),[l,c]=(0,t.useState)(!0);(0,t.useEffect)(()=>{if(!n)return;let e=!0;const t=Xa(),r=null!==s&&void 0!==s&&s.isAnonymous?null:null===s||void 0===s?void 0:s.uid;return(async()=>{c(!0);try{const n=await co(r,t);if(!e)return;o(n);const s=n.filter(e=>!e.read&&!e.deleted).length;i(s)}catch(n){console.error("Kunde inte h\xe4mta meddelanden:",n),e&&o([])}finally{e&&c(!1)}})(),()=>{e=!1}},[s,n,i]);const u=e=>{if(null===e||void 0===e||!e.toDate)return"";const t=e.toDate(),n=new Date-t,r=Math.floor(n/6e4),i=Math.floor(n/36e5),s=Math.floor(n/864e5);return r<60?"".concat(r,"m sedan"):i<24?"".concat(i,"h sedan"):s<7?"".concat(s,"d sedan"):t.toLocaleDateString("sv-SE")},d=e=>{switch(e){case"success":return(0,bi.jsx)("svg",{className:"w-5 h-5 text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,bi.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})});case"warning":return(0,bi.jsx)("svg",{className:"w-5 h-5 text-amber-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,bi.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})});case"error":return(0,bi.jsx)("svg",{className:"w-5 h-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,bi.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})});default:return(0,bi.jsx)("svg",{className:"w-5 h-5 text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,bi.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}};if(!n)return null;const h=a.filter(e=>!e.read).length;return(0,bi.jsxs)("div",{className:"absolute right-0 mt-2 w-96 bg-slate-900 rounded-lg border border-slate-700 shadow-xl z-50 max-h-[32rem] overflow-hidden flex flex-col",children:[(0,bi.jsxs)("div",{className:"px-4 py-3 border-b border-slate-700 flex items-center justify-between",children:[(0,bi.jsx)("h3",{className:"text-lg font-semibold text-gray-200",children:"Meddelanden"}),h>0&&(0,bi.jsx)("span",{className:"px-2 py-0.5 bg-cyan-500 rounded-full text-xs font-bold text-black",children:h})]}),(0,bi.jsx)("div",{className:"overflow-y-auto flex-1",children:l?(0,bi.jsx)("div",{className:"text-center py-8 text-gray-400",children:"Laddar..."}):0===a.length?(0,bi.jsx)("div",{className:"text-center py-8 text-gray-400",children:"Inga meddelanden"}):(0,bi.jsx)("div",{className:"divide-y divide-slate-700",children:a.map(e=>(0,bi.jsx)("div",{className:"p-4 hover:bg-slate-800/50 transition-colors ".concat(e.read?"":"bg-slate-800/30"),children:(0,bi.jsxs)("div",{className:"flex items-start gap-3",children:[(0,bi.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:d(e.type)}),(0,bi.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,bi.jsxs)("div",{className:"flex items-start justify-between gap-2 mb-1",children:[(0,bi.jsx)("h4",{className:"text-sm font-semibold text-gray-200 truncate",children:e.title}),!e.read&&(0,bi.jsx)("span",{className:"flex-shrink-0 w-2 h-2 bg-cyan-500 rounded-full"})]}),(0,bi.jsx)("p",{className:"text-sm text-gray-300 mb-2 line-clamp-2",children:e.message}),(0,bi.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,bi.jsx)("span",{className:"text-xs text-gray-500",children:u(e.createdAt)}),(0,bi.jsxs)("div",{className:"flex items-center gap-1",children:[!e.read&&(0,bi.jsx)("button",{onClick:()=>(async e=>{try{await uo(e),o(t=>{const n=t.map(t=>t.id===e?(0,Ti.A)((0,Ti.A)({},t),{},{read:!0}):t),r=n.filter(e=>!e.read&&!e.deleted).length;return i(r),n})}catch(t){console.error("Kunde inte markera meddelande som l\xe4st:",t)}})(e.id),className:"p-1.5 rounded hover:bg-slate-700 text-cyan-400 hover:text-cyan-300 transition-colors",title:"Markera som l\xe4st",children:(0,bi.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,bi.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,bi.jsx)("button",{onClick:()=>(async e=>{try{await ho(e),o(t=>{const n=t.filter(t=>t.id!==e),r=n.filter(e=>!e.read&&!e.deleted).length;return i(r),n})}catch(t){console.error("Kunde inte radera meddelande:",t)}})(e.id),className:"p-1.5 rounded hover:bg-slate-700 text-red-400 hover:text-red-300 transition-colors",title:"Radera",children:(0,bi.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,bi.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})]})]})},e.id))})}),(0,bi.jsx)("div",{className:"px-4 py-3 border-t border-slate-700",children:(0,bi.jsx)("button",{onClick:r,className:"w-full text-sm text-cyan-400 hover:text-cyan-300 transition-colors font-semibold",children:"St\xe4ng"})})]})},wl={queued:{label:"K\xf6ad",badge:"bg-slate-600 text-white"},pending:{label:"F\xf6rbereds",badge:"bg-slate-600 text-white"},processing:{label:"P\xe5g\xe5r",badge:"bg-amber-500 text-black animate-pulse"},completed:{label:"Klar",badge:"bg-emerald-500 text-black"},failed:{label:"Misslyckades",badge:"bg-red-500 text-white"},cancelled:{label:"Avbruten",badge:"bg-gray-500 text-white"}},_l=e=>{if(!e)return"\u2014";try{return e.toLocaleString("sv-SE",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch(t){return e.toString()}},kl=e=>e.label?e.label:"generation"===e.taskType?"AI-generering":"validation"===e.taskType?"AI-validering":"regenerateemoji"===e.taskType?"Emoji-regenerering":"batchregenerateemojis"===e.taskType?"Mass-regenerering Emojis":"Bakgrundsjobb",Nl=e=>{let{isOpen:t,tasks:n,unreadTaskIds:r,onMarkTaskSeen:i,onMarkAllSeen:s,onClose:a,isSuperUser:o}=e;const l=X();if(!t)return null;const c=n&&n.length>0;return(0,bi.jsx)("div",{className:"fixed top-16 right-4 z-[70] w-80 max-w-full",children:(0,bi.jsxs)("div",{className:"rounded-xl bg-slate-900/95 border border-slate-700 shadow-2xl overflow-hidden",children:[(0,bi.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b border-slate-800",children:[(0,bi.jsxs)("div",{children:[(0,bi.jsx)("h3",{className:"text-sm font-semibold text-white",children:"Bakgrundsjobb"}),(0,bi.jsx)("p",{className:"text-xs text-slate-400",children:"Utsprungna i den h\xe4r enheten"})]}),(0,bi.jsx)("button",{type:"button",onClick:a,className:"text-slate-400 hover:text-white transition-colors","aria-label":"St\xe4ng",children:"\u2715"})]}),(0,bi.jsx)("div",{className:"max-h-96 overflow-y-auto",children:c?(0,bi.jsx)("ul",{className:"divide-y divide-slate-800",children:n.map(e=>{var t;const n=wl[e.status]||wl.pending,s=r.has(e.id),a=["completed","failed","cancelled"].includes(e.status);return(0,bi.jsxs)("li",{className:"px-4 py-3 bg-slate-900 text-sm text-slate-200",children:[(0,bi.jsx)("div",{className:"flex items-center justify-between gap-2",children:(0,bi.jsxs)("div",{className:"flex-1",children:[(0,bi.jsxs)("div",{className:"flex items-center gap-2",children:[(0,bi.jsx)("span",{className:"font-semibold text-white",children:kl(e)}),(0,bi.jsx)("span",{className:"px-2 py-0.5 rounded-full text-[11px] font-semibold ".concat(n.badge),children:n.label})]}),e.description&&(0,bi.jsx)("p",{className:"text-xs text-slate-400 mt-1",children:e.description}),(0,bi.jsxs)("div",{className:"flex flex-col mt-2 text-[11px] text-slate-500 gap-0.5",children:[(0,bi.jsxs)("span",{children:["Start: ",_l(e.createdAt)]}),e.finishedAt&&(0,bi.jsxs)("span",{children:["Klart: ",_l(e.finishedAt)]}),null!=(null===(t=e.result)||void 0===t?void 0:t.count)&&(0,bi.jsxs)("span",{children:["Resultat: ",e.result.count," objekt"]}),e.error&&(0,bi.jsxs)("span",{className:"text-red-400",children:["Fel: ",e.error]})]})]})}),a&&(0,bi.jsxs)("div",{className:"flex items-center justify-between mt-3",children:[s?(0,bi.jsx)("span",{className:"text-xs font-semibold text-amber-400",children:"Nytt resultat"}):(0,bi.jsx)("span",{className:"text-xs text-slate-500",children:"Markerad som l\xe4st"}),s&&(0,bi.jsx)("button",{type:"button",onClick:()=>i(e.id),className:"text-xs text-cyan-300 hover:text-cyan-200 font-semibold",children:"Markera som l\xe4st"})]})]},e.id)})}):(0,bi.jsx)("div",{className:"px-4 py-6 text-center text-sm text-slate-400",children:"Inga aktiva jobb just nu. Starta en AI-generering eller validering f\xf6r att se status h\xe4r."})}),c&&(0,bi.jsxs)("div",{className:"border-t border-slate-800 px-4 py-3 flex items-center justify-between text-xs",children:[(0,bi.jsx)("button",{type:"button",onClick:s,className:"text-slate-400 hover:text-slate-200 transition-colors",children:"Markera allt som l\xe4st"}),o&&(0,bi.jsx)("button",{type:"button",onClick:()=>{a(),l("/superuser/tasks")},className:"text-cyan-300 hover:text-cyan-200 font-semibold",children:"\xd6ppna k\xf6\xf6versikt"})]})]})})},Sl=e=>{let{title:n="RouteQuest",children:r}=e;const i=X(),{currentUser:s,isAuthenticated:a,isSuperUser:o,logout:l}=Ci(),{status:c,coords:u,trackingEnabled:d,enableTracking:h,disableTracking:p}=vo(),[f,m]=(0,t.useState)(!1),[g,v]=(0,t.useState)(!1),[y,x]=(0,t.useState)(!1),[b,w]=(0,t.useState)(!1),[_,k]=(0,t.useState)(0),{myTrackedTasks:N,unreadTaskIds:S,unreadCount:j,hasActiveTrackedTasks:E,markTaskAsSeen:C,markAllTasksAsSeen:T}=Ea(),[A,I]=(0,t.useState)(()=>"undefined"===typeof window?"":xi.getAlias()),[P,L]=(0,t.useState)(()=>"undefined"===typeof window?"sv":localStorage.getItem("routequest:language")||"sv"),[R,O]=(0,t.useState)({isOpen:!1,title:"",message:"",type:"info"}),M=(0,t.useCallback)(()=>{try{xi.removeAlias(),xi.removeContact()}catch(e){console.warn("[Header] Kunde inte ta bort alias:",e)}I(""),m(!1)},[]);(0,t.useEffect)(()=>{if(f)try{I(xi.getAlias())}catch(e){console.warn("[Header] Kunde inte l\xe4sa g\xe4stalias:",e)}},[f]),(0,t.useEffect)(()=>{if("undefined"===typeof window)return;const e=e=>{e.key&&"geoquest:preferences"!==e.key||I(xi.getAlias())};return window.addEventListener("storage",e),window.addEventListener("userPreferences:changed",e),()=>{window.removeEventListener("storage",e),window.removeEventListener("userPreferences:changed",e)}},[]),(0,t.useEffect)(()=>{s&&!s.isAnonymous||I(xi.getAlias())},[s]),(0,t.useEffect)(()=>{let e=!0;const t=Xa(),n=null!==s&&void 0!==s&&s.isAnonymous?null:null===s||void 0===s?void 0:s.uid;return(async()=>{try{const r=await mo(n,t);e&&k(r)}catch(r){console.error("[Header] Failed to load unread message count:",r)}})(),()=>{e=!1}},[s]),(0,t.useEffect)(()=>{a||w(!1)},[a]),(0,t.useEffect)(()=>{y&&w(!1)},[y]),(0,t.useEffect)(()=>{b&&x(!1)},[b]);const D=e=>{L(e),"undefined"!==typeof window&&(localStorage.setItem("routequest:language",e),window.dispatchEvent(new Event("languageChange")))},F=a?0:Fa().length,z=a?0:za().length,U=F>0||z>0,B=(()=>{if(!d)return{color:"opacity-40",spin:!1,title:"GPS avst\xe4ngd",textColor:"text-gray-400"};switch(c){case"idle":case"pending":return{color:"opacity-60",spin:!0,title:"S\xf6ker GPS...",textColor:"text-gray-400"};case"active":const e=null!==u&&void 0!==u&&u.accuracy?Math.round(u.accuracy):null;return e&&e<20?{color:"drop-shadow-[0_0_8px_rgba(52,211,153,0.6)]",spin:!1,title:"\xb1".concat(e,"m"),textColor:"text-emerald-400"}:e&&e<50?{color:"drop-shadow-[0_0_8px_rgba(34,211,238,0.6)]",spin:!1,title:"\xb1".concat(e,"m"),textColor:"text-cyan-400"}:{color:"drop-shadow-[0_0_8px_rgba(251,191,36,0.6)]",spin:!1,title:e?"\xb1".concat(e,"m"):"GPS aktiv",textColor:"text-amber-400"};case"denied":return{color:"opacity-40 saturate-0",spin:!1,title:"GPS nekad",textColor:"text-red-400"};case"unsupported":return{color:"opacity-30",spin:!1,title:"GPS st\xf6ds ej",textColor:"text-gray-400"};default:return{color:"opacity-60",spin:!1,title:"GPS ej tillg\xe4nglig",textColor:"text-gray-400"}}})();return(0,bi.jsxs)(bi.Fragment,{children:[(0,bi.jsx)("header",{className:"bg-slate-900/95 backdrop-blur-sm border-b border-slate-700 fixed top-0 left-0 right-0 z-50",children:(0,bi.jsxs)("div",{className:"mx-auto w-full max-w-6xl px-3 py-2 grid grid-cols-[auto_1fr_auto] items-center gap-2 sm:gap-3",children:[(0,bi.jsx)("div",{className:"flex items-center gap-2",children:(0,bi.jsx)("button",{onClick:()=>i("/"),className:"hover:opacity-80 transition-opacity","aria-label":"G\xe5 till startsidan",children:(0,bi.jsx)("img",{src:"/logo-compass.svg",alt:"RouteQuest",className:"w-8 h-8 sm:w-9 sm:h-9 flex-shrink-0 transition-all ".concat(B.color," ").concat(B.spin?"animate-spin":""),style:B.spin?{animationDuration:"2s"}:{}})})}),(0,bi.jsxs)("div",{className:"text-center px-1 flex items-center justify-center overflow-hidden gap-1.5",children:[(0,bi.jsx)("h1",{className:"text-sm sm:text-base md:text-lg font-bold bg-gradient-to-r from-cyan-400 to-indigo-400 bg-clip-text text-transparent whitespace-nowrap",children:n}),o&&(0,bi.jsx)("span",{className:"px-1.5 py-0.5 bg-red-500/20 border border-red-500/50 rounded text-[10px] text-red-300",children:"SU"})]}),(0,bi.jsxs)("div",{className:"relative flex justify-end items-center gap-2",children:[r,(0,bi.jsxs)("button",{onClick:()=>m(!f),className:"p-1.5 rounded-lg hover:bg-slate-800 transition-colors relative","aria-label":"Meny",children:[(0,bi.jsxs)("div",{className:"w-5 h-5 flex flex-col justify-center gap-1",children:[(0,bi.jsx)("span",{className:"block h-0.5 bg-gray-300 transition-all ".concat(f?"rotate-45 translate-y-1.5":"")}),(0,bi.jsx)("span",{className:"block h-0.5 bg-gray-300 transition-all ".concat(f?"opacity-0":"")}),(0,bi.jsx)("span",{className:"block h-0.5 bg-gray-300 transition-all ".concat(f?"-rotate-45 -translate-y-1.5":"")})]}),j>0?(0,bi.jsx)("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-amber-500 rounded-full text-xs font-bold text-black flex items-center justify-center animate-pulse",children:j}):_>0?(0,bi.jsx)("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full text-xs font-bold text-white flex items-center justify-center animate-pulse",children:_}):E?(0,bi.jsx)("span",{className:"absolute -top-1 -right-1 w-3 h-3 bg-amber-400 rounded-full animate-ping"}):U?(0,bi.jsx)("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-cyan-500 rounded-full text-xs font-bold text-black flex items-center justify-center",children:F+z}):null]})]})]})}),f&&(0,bi.jsxs)(bi.Fragment,{children:[(0,bi.jsx)("div",{className:"fixed inset-0 z-[60]",onClick:()=>m(!1)}),(0,bi.jsx)("div",{className:"fixed top-[4.5rem] right-4 w-64 bg-slate-900 rounded-lg border border-slate-700 shadow-xl z-[70] max-h-[calc(100vh-6rem)] overflow-hidden",children:(0,bi.jsxs)("div",{className:"max-h-[calc(100vh-7rem)] overflow-y-auto",children:[a&&!(null!==s&&void 0!==s&&s.isAnonymous)&&(0,bi.jsxs)("div",{className:"px-4 py-3 border-b border-slate-700",children:[(0,bi.jsx)("p",{className:"text-sm text-gray-400",children:"Inloggad som"}),(0,bi.jsx)("p",{className:"font-semibold text-gray-200",children:null===s||void 0===s?void 0:s.name}),o&&(0,bi.jsx)("span",{className:"inline-block mt-1 px-2 py-0.5 bg-red-500/20 border border-red-500/50 rounded text-xs text-red-300",children:"SuperUser"})]}),(a&&(null===s||void 0===s?void 0:s.isAnonymous)||!a&&A)&&(0,bi.jsxs)("div",{className:"px-4 py-3 border-b border-slate-700",children:[(0,bi.jsx)("p",{className:"text-sm text-gray-400",children:"G\xe4st (ej inloggad)"}),A?(0,bi.jsxs)(bi.Fragment,{children:[(0,bi.jsx)("p",{className:"mt-1 text-sm font-semibold text-gray-200",children:A}),(0,bi.jsx)("button",{type:"button",onClick:M,className:"mt-2 text-xs font-semibold text-red-300 hover:text-red-200",children:"Ta bort alias"})]}):(0,bi.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"Alias visas h\xe4r n\xe4r du sparat ett."})]}),(0,bi.jsxs)("div",{className:"py-2",children:[(0,bi.jsxs)("button",{onClick:()=>{m(!1),x(!y)},className:"w-full px-4 py-2 text-left hover:bg-slate-800 transition-colors flex items-center justify-between",children:[(0,bi.jsx)("span",{className:"text-gray-200",children:"Meddelanden"}),_>0&&(0,bi.jsx)("span",{className:"px-2 py-0.5 bg-cyan-500 rounded text-xs font-bold text-black",children:_})]}),(0,bi.jsxs)("button",{onClick:()=>{m(!1),w(!0)},className:"w-full px-4 py-2 text-left hover:bg-slate-800 transition-colors flex items-center justify-between",children:[(0,bi.jsx)("span",{className:"text-gray-200",children:"Bakgrundsjobb"}),j>0?(0,bi.jsx)("span",{className:"px-2 py-0.5 bg-amber-500 rounded text-xs font-bold text-black",children:j}):E?(0,bi.jsx)("span",{className:"px-2 py-0.5 bg-amber-500/20 border border-amber-500/40 text-amber-300 rounded text-[11px] font-semibold",children:"P\xe5g\xe5r"}):null]}),(0,bi.jsxs)("button",{onClick:()=>{m(!1),i("/my-runs")},className:"w-full px-4 py-2 text-left hover:bg-slate-800 transition-colors flex items-center justify-between",children:[(0,bi.jsx)("span",{className:"text-gray-200",children:"Mina rundor"}),U&&(0,bi.jsx)("span",{className:"px-2 py-0.5 bg-cyan-500/20 border border-cyan-500/50 rounded text-xs text-cyan-300",children:F+z})]}),(0,bi.jsx)("div",{className:"my-2 border-t border-slate-700"}),(0,bi.jsx)("div",{className:"px-4 py-2 text-xs text-gray-500 font-semibold",children:"INST\xc4LLNINGAR"}),(0,bi.jsxs)("div",{className:"px-4 py-2",children:[(0,bi.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,bi.jsx)("span",{className:"text-sm text-gray-300",children:"GPS-sp\xe5rning"}),(0,bi.jsx)("button",{onClick:()=>{d?p():h()},className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors ".concat(d?"bg-emerald-500":"bg-slate-600"),children:(0,bi.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform ".concat(d?"translate-x-6":"translate-x-1")})})]}),(0,bi.jsxs)("div",{className:"text-xs space-y-1",children:[(0,bi.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,bi.jsx)("span",{className:B.textColor,children:"\u25cf"}),(0,bi.jsx)("span",{className:B.textColor+" font-medium",children:B.title})]}),d&&u&&u.lat&&u.lng&&(0,bi.jsxs)("div",{className:"font-mono text-[10px] text-gray-400 pl-4",children:[u.lat.toFixed(4),", ",u.lng.toFixed(4)]})]})]}),(0,bi.jsxs)("div",{className:"px-4 py-2",children:[(0,bi.jsx)("div",{className:"text-sm text-gray-300 mb-2",children:"Spr\xe5k"}),(0,bi.jsxs)("div",{className:"flex gap-2",children:[(0,bi.jsx)("button",{onClick:()=>D("sv"),className:"flex-1 px-3 py-1.5 rounded text-xs font-medium transition-colors ".concat("sv"===P?"bg-cyan-500 text-black":"bg-slate-700 text-gray-300 hover:bg-slate-600"),children:"Svenska"}),(0,bi.jsx)("button",{onClick:()=>D("en"),className:"flex-1 px-3 py-1.5 rounded text-xs font-medium transition-colors ".concat("en"===P?"bg-cyan-500 text-black":"bg-slate-700 text-gray-300 hover:bg-slate-600"),children:"English"})]})]}),o&&(0,bi.jsxs)(bi.Fragment,{children:[(0,bi.jsx)("div",{className:"my-2 border-t border-slate-700"}),(0,bi.jsx)("button",{onClick:()=>{m(!1),i("/superuser/notifications")},className:"w-full px-4 py-2 text-left hover:bg-slate-800 transition-colors text-red-300",children:"Systemnotiser"}),(0,bi.jsx)("button",{onClick:()=>{m(!1),i("/superuser/all-runs")},className:"w-full px-4 py-2 text-left hover:bg-slate-800 transition-colors text-red-300",children:"Alla rundor"}),(0,bi.jsx)("button",{onClick:()=>{m(!1),i("/superuser/users")},className:"w-full px-4 py-2 text-left hover:bg-slate-800 transition-colors text-red-300",children:"Alla anv\xe4ndare"}),(0,bi.jsx)("button",{onClick:()=>{m(!1),i("/admin/questions")},className:"w-full px-4 py-2 text-left hover:bg-slate-800 transition-colors text-red-300",children:"Fr\xe5gebank"}),(0,bi.jsx)("button",{onClick:()=>{m(!1),i("/superuser/analytics")},className:"w-full px-4 py-2 text-left hover:bg-slate-800 transition-colors text-red-300",children:"Bes\xf6ksstatistik"}),(0,bi.jsx)("button",{onClick:()=>{m(!1),i("/superuser/messages")},className:"w-full px-4 py-2 text-left hover:bg-slate-800 transition-colors text-red-300",children:"Meddelanden"}),(0,bi.jsxs)("button",{onClick:()=>{m(!1),i("/superuser/tasks")},className:"w-full px-4 py-2 text-left hover:bg-slate-800 transition-colors text-red-300 flex items-center justify-between",children:[(0,bi.jsx)("span",{children:"Bakgrundsjobb"}),j>0&&(0,bi.jsx)("span",{className:"px-2 py-0.5 bg-amber-500 rounded text-xs font-bold text-black",children:j})]}),(0,bi.jsx)("button",{onClick:()=>{m(!1),i("/superuser/logs")},className:"w-full px-4 py-2 text-left hover:bg-slate-800 transition-colors text-red-300",children:"\ud83d\udd34 Error Logs"}),"localhost"===window.location.hostname&&(0,bi.jsxs)(bi.Fragment,{children:[(0,bi.jsx)("div",{className:"my-2 border-t border-slate-700"}),(0,bi.jsx)("div",{className:"px-4 py-2 text-xs text-gray-500 font-semibold",children:"DEVELOPER TOOLS"}),(0,bi.jsx)("button",{onClick:async()=>{if(m(!1),window.confirm("Uppdatera alla fr\xe5gor med createdAt-f\xe4lt?\n\nDetta kan ta n\xe5gra sekunder."))try{const e=await fetch("https://europe-west1-geoquest2-7e45c.cloudfunctions.net/updateQuestionsCreatedAt"),t=await e.json();O({isOpen:!0,title:"Uppdatering klar",message:"\u2705 Klart!\n\nUppdaterade: ".concat(t.updated,"\nHade redan: ").concat(t.alreadyHad,"\nTotalt: ").concat(t.total),type:"success"}),setTimeout(()=>window.location.reload(),2e3)}catch(e){O({isOpen:!0,title:"Fel vid uppdatering",message:"\u274c Fel: ".concat(e.message),type:"error"})}},className:"w-full px-4 py-2 text-left hover:bg-slate-800 transition-colors text-yellow-300 text-sm",children:"\ud83d\udd27 Update Questions createdAt"})]})]}),(0,bi.jsx)("div",{className:"my-2 border-t border-slate-700"}),(0,bi.jsx)("button",{onClick:()=>{m(!1),v(!0)},className:"w-full px-4 py-2 text-left hover:bg-slate-800 transition-colors text-gray-200",children:"Om RouteQuest"}),(0,bi.jsxs)("div",{className:"px-4 py-3 text-xs text-gray-400",children:[(0,bi.jsxs)("div",{children:["Version ",io]}),(0,bi.jsxs)("div",{className:"text-gray-500 mt-1",children:["Build: ",new Date(so).toLocaleString("sv-SE",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(",","")]})]}),(0,bi.jsx)("div",{className:"my-2 border-t border-slate-700"}),!a||null!==s&&void 0!==s&&s.isAnonymous?(0,bi.jsx)("button",{onClick:()=>{m(!1),i("/login")},className:"w-full px-4 py-2 text-left hover:bg-slate-800 transition-colors text-cyan-300 font-semibold",children:"Logga in"}):(0,bi.jsx)("button",{onClick:()=>{l(),m(!1),i("/")},className:"w-full px-4 py-2 text-left hover:bg-slate-800 transition-colors text-red-300",children:"Logga ut"})]})]})})]}),(0,bi.jsx)(xl,{isOpen:g,onClose:()=>v(!1)}),b&&(0,bi.jsxs)(bi.Fragment,{children:[(0,bi.jsx)("div",{className:"fixed inset-0 z-[60]",onClick:()=>w(!1)}),(0,bi.jsx)(Nl,{isOpen:b,tasks:N,unreadTaskIds:S,onMarkTaskSeen:C,onMarkAllSeen:()=>{T(),w(!1)},onClose:()=>w(!1),isSuperUser:o})]}),y&&(0,bi.jsxs)(bi.Fragment,{children:[(0,bi.jsx)("div",{className:"fixed inset-0 z-[60]",onClick:()=>x(!1)}),(0,bi.jsx)("div",{className:"fixed top-16 right-4 z-[70]",children:(0,bi.jsx)(bl,{isOpen:y,onClose:()=>x(!1),onUnreadChange:k})})]}),(0,bi.jsx)(oa,{isOpen:R.isOpen,onClose:()=>O((0,Ti.A)((0,Ti.A)({},R),{},{isOpen:!1})),title:R.title,message:R.message,type:R.type})]})},jl=e=>{let{children:t,headerTitle:n,maxWidth:r="max-w-4xl",background:i="bg-slate-950",className:s="",disableHeader:a=!1}=e;return(0,bi.jsxs)("div",{className:"min-h-screen ".concat(i),children:[!a&&(0,bi.jsx)(Sl,{title:n}),(0,bi.jsx)("main",{className:"mx-auto w-full ".concat(r," px-4 sm:px-6 pt-[calc(5.75rem+env(safe-area-inset-top,0px))] pb-16 ").concat(s).trim(),children:t})]})},El=()=>{const e=X(),{isAuthenticated:n}=Ci(),[r,i]=(0,t.useState)(!1);return(0,bi.jsxs)(jl,{headerTitle:"RouteQuest",maxWidth:"max-w-3xl",className:"space-y-8",children:[(0,bi.jsx)("section",{className:"space-y-6 text-center",children:(0,bi.jsxs)("div",{className:"space-y-3",children:[(0,bi.jsx)("h1",{className:"text-3xl font-bold text-slate-100 sm:text-4xl",children:"V\xe4lkommen till RouteQuest"}),(0,bi.jsx)("p",{className:"text-base text-gray-300 sm:text-lg",children:"Skapa och spela digitala tipsrundor direkt i mobilen"})]})}),(0,bi.jsxs)("section",{className:"rounded-2xl border border-amber-500/30 bg-amber-500/5",children:[(0,bi.jsxs)("button",{type:"button",onClick:()=>i(!r),"aria-expanded":r,className:"flex w-full items-center justify-between gap-4 px-4 py-4 text-left transition-colors hover:bg-amber-500/10 sm:px-6",children:[(0,bi.jsxs)("div",{className:"flex items-center gap-3",children:[(0,bi.jsx)("span",{"aria-hidden":"true",className:"text-xl",children:"\ud83d\udea7"}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("h2",{className:"text-base font-semibold text-amber-200 sm:text-lg",children:"RouteQuest \xe4r i beta"}),(0,bi.jsx)("p",{className:"text-xs text-amber-100/80 sm:text-sm",children:"Vi slipar upplevelsen och v\xe4lkomnar din feedback."})]})]}),(0,bi.jsx)("span",{"aria-hidden":"true",className:"text-amber-200 transition-transform ".concat(r?"rotate-180":""),children:"\u25bc"})]}),r&&(0,bi.jsxs)("div",{className:"space-y-3 border-t border-amber-500/20 px-4 py-4 text-sm text-amber-50 sm:px-6",children:[(0,bi.jsx)("p",{children:"RouteQuest \xe4r under aktiv utveckling. H\xf6r g\xe4rna av dig om du saknar funktioner eller hittar problem \u2013 varje synpunkt hj\xe4lper oss fram\xe5t."}),(0,bi.jsxs)("p",{children:["Donationer g\xe5r direkt till drift och vidareutveckling. \xc4r du inte n\xf6jd? Mejla oss p\xe5"," ",(0,bi.jsx)("a",{href:"mailto:info@routequest.se",className:"text-cyan-300 underline hover:text-cyan-200",children:"info@routequest.se"})," ","s\xe5 hittar vi en l\xf6sning."]})]})]}),(0,bi.jsx)("section",{className:"space-y-6 text-center",children:(0,bi.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,bi.jsxs)("button",{type:"button",onClick:()=>{e("/generate")},className:"group flex flex-col items-center gap-4 rounded-2xl border border-slate-700 bg-slate-900/70 p-8 transition-all hover:border-cyan-400 hover:bg-slate-800/70",children:[(0,bi.jsx)("div",{className:"flex h-20 w-20 items-center justify-center rounded-full bg-cyan-500/20 text-cyan-100 shadow-inner shadow-cyan-500/20 transition-colors group-hover:bg-cyan-500/30 group-hover:text-white",children:(0,bi.jsxs)("svg",{className:"h-10 w-10",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:[(0,bi.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.6",d:"M9 20.25l-5.25-2.1a1 1 0 01-.6-.92V4.77c0-.69.7-1.18 1.35-.92L9 5.75m0 0l6-2.25m-6 2.25v14.5m6-16.75l5.25 2.25c.45.19.75.63.75 1.12v12.46c0 .69-.7 1.18-1.35.92L15 17.75m0 0l-6 2.5"}),(0,bi.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.6",d:"M14.75 8.75h4M16.75 6.75v4"})]})}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("h2",{className:"text-xl font-semibold text-slate-100",children:"Skapa runda"}),(0,bi.jsx)("p",{className:"mt-2 text-sm text-gray-400",children:"Generera en ny tipspromenad automatiskt"})]})]}),(0,bi.jsxs)("button",{type:"button",onClick:()=>{e("/join")},className:"group flex flex-col items-center gap-4 rounded-2xl border border-slate-700 bg-slate-900/70 p-8 transition-all hover:border-purple-400 hover:bg-slate-800/70",children:[(0,bi.jsx)("div",{className:"flex h-20 w-20 items-center justify-center rounded-full bg-purple-500/20 text-purple-100 shadow-inner shadow-purple-500/20 transition-colors group-hover:bg-purple-500/30 group-hover:text-white",children:(0,bi.jsxs)("svg",{className:"h-10 w-10",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:[(0,bi.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.6",d:"M18 9v3m1.5-1.5h-3M16.5 16.5a4.5 4.5 0 00-9 0m9-8.25a3 3 0 11-6 0 3 3 0 016 0z"}),(0,bi.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.6",d:"M9 16.5v-.75a2.25 2.25 0 012.25-2.25h.5A2.25 2.25 0 0114 15.75v.75"})]})}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("h2",{className:"text-xl font-semibold text-slate-100",children:"Anslut till runda"}),(0,bi.jsx)("p",{className:"mt-2 text-sm text-gray-400",children:"Ange kod f\xf6r att g\xe5 med i en befintlig runda"})]})]})]})}),(0,bi.jsxs)("section",{className:"space-y-6 text-center",children:[(0,bi.jsx)("h2",{className:"text-2xl font-semibold text-slate-100",children:"S\xe5 fungerar det"}),(0,bi.jsxs)("div",{className:"grid gap-4 text-left sm:grid-cols-3",children:[(0,bi.jsxs)("div",{className:"rounded-2xl border border-slate-700 bg-slate-900/70 p-5",children:[(0,bi.jsx)("div",{className:"mb-3 text-3xl",children:"\ud83d\udccd"}),(0,bi.jsx)("h3",{className:"text-lg font-semibold text-slate-100",children:"Automatisk ruttplanering"}),(0,bi.jsx)("p",{className:"mt-2 text-sm text-gray-400",children:"Ange l\xe4ngd och sv\xe5righetsgrad s\xe5 skapar vi en rutt med fr\xe5gor automatiskt"})]}),(0,bi.jsxs)("div",{className:"rounded-2xl border border-slate-700 bg-slate-900/70 p-5",children:[(0,bi.jsx)("div",{className:"mb-3 text-3xl",children:"\ud83d\uddfa\ufe0f"}),(0,bi.jsx)("h3",{className:"text-lg font-semibold text-slate-100",children:"Kartnavigering"}),(0,bi.jsx)("p",{className:"mt-2 text-sm text-gray-400",children:"F\xf6lj kartan till varje kontrollpunkt och svara p\xe5 fr\xe5gor l\xe4ngs v\xe4gen"})]}),(0,bi.jsxs)("div",{className:"rounded-2xl border border-slate-700 bg-slate-900/70 p-5",children:[(0,bi.jsx)("div",{className:"mb-3 text-3xl",children:"\ud83c\udfc6"}),(0,bi.jsx)("h3",{className:"text-lg font-semibold text-slate-100",children:"Live resultat"}),(0,bi.jsx)("p",{className:"mt-2 text-sm text-gray-400",children:"F\xf6lj po\xe4ngen i realtid och se vem som ligger b\xe4st till"})]})]})]}),(0,bi.jsxs)("section",{className:"space-y-4 text-center",children:[(0,bi.jsxs)("div",{className:"rounded-2xl border border-slate-700 bg-slate-900/70 p-6",children:[(0,bi.jsx)("h2",{className:"text-xl font-semibold text-slate-100",children:"Perfekt f\xf6r alla tillf\xe4llen"}),(0,bi.jsx)("p",{className:"mt-3 text-gray-300",children:"Anv\xe4nd RouteQuest f\xf6r teambuilding, familjeaktiviteter, skolprojekt eller bara f\xf6r att g\xf6ra en promenad mer engagerande. Ingen installation beh\xf6vs \u2013 allt fungerar direkt i webbl\xe4saren."})]}),!n&&(0,bi.jsx)("p",{className:"text-sm text-gray-400",children:"K\xf6r som g\xe4st eller skapa konto f\xf6r att spara rundor mellan enheter"})]})]})},Cl=()=>{const e=X(),{login:n}=Ci(),[r,i]=(0,t.useState)(""),[s,a]=(0,t.useState)(""),[o,l]=(0,t.useState)(""),[c,u]=(0,t.useState)(""),[d,h]=(0,t.useState)(!1);return(0,bi.jsxs)("div",{className:"min-h-screen bg-slate-950",children:[(0,bi.jsx)(Sl,{}),(0,bi.jsx)("div",{className:"mx-auto max-w-md px-4 py-12",children:(0,bi.jsxs)("div",{className:"rounded-lg border border-slate-700 bg-slate-900/60 p-8",children:[(0,bi.jsx)("h1",{className:"text-2xl font-bold mb-6 text-center",children:"Logga in"}),(0,bi.jsxs)("form",{onSubmit:async t=>{if(t.preventDefault(),r.trim()&&s){h(!0),u("");try{await n({email:r,password:s,name:o}),e("/")}catch(i){u((null===i||void 0===i?void 0:i.message)||"Kunde inte logga in. Kontrollera dina uppgifter.")}finally{h(!1)}}else u("Fyll i e-post och l\xf6senord.")},className:"space-y-4",children:[(0,bi.jsxs)("div",{children:[(0,bi.jsx)("label",{className:"block text-sm font-semibold text-gray-200 mb-1",children:"Namn (valfritt)"}),(0,bi.jsx)("input",{type:"text",autoComplete:"name",value:o,onChange:e=>l(e.target.value),className:"w-full rounded bg-slate-800 border border-slate-600 px-3 py-2",placeholder:"Ditt namn"})]}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("label",{className:"block text-sm font-semibold text-gray-200 mb-1",children:"E-post"}),(0,bi.jsx)("input",{type:"email",autoComplete:"username",value:r,onChange:e=>i(e.target.value),className:"w-full rounded bg-slate-800 border border-slate-600 px-3 py-2",placeholder:"din@epost.se",required:!0})]}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("label",{className:"block text-sm font-semibold text-gray-200 mb-1",children:"L\xf6senord"}),(0,bi.jsx)("input",{type:"password",autoComplete:"current-password",value:s,onChange:e=>a(e.target.value),className:"w-full rounded bg-slate-800 border border-slate-600 px-3 py-2",placeholder:"********",required:!0})]}),c&&(0,bi.jsx)("div",{className:"bg-red-900/30 border border-red-500/50 rounded-lg p-3 text-sm text-red-200",children:c}),(0,bi.jsx)("button",{type:"submit",disabled:d,className:"w-full rounded-lg px-4 py-3 font-semibold transition-colors bg-cyan-500 hover:bg-cyan-400 text-black disabled:opacity-50 disabled:cursor-not-allowed",children:d?"Loggar in...":"Logga in"})]}),(0,bi.jsx)("div",{className:"mt-6 text-center",children:(0,bi.jsxs)("p",{className:"text-sm text-gray-300",children:["Har du inget konto?"," ",(0,bi.jsx)(Te,{to:"/register",className:"text-cyan-300 hover:text-cyan-200",children:"Registrera dig h\xe4r"})]})})]})})]})},Tl=()=>{const e=X(),{register:n}=Ci(),[r,i]=(0,t.useState)(""),[s,a]=(0,t.useState)(""),[o,l]=(0,t.useState)(""),[c,u]=(0,t.useState)(""),[d,h]=(0,t.useState)(""),[p,f]=(0,t.useState)(!1);return(0,bi.jsxs)("div",{className:"min-h-screen bg-slate-950",children:[(0,bi.jsx)(Sl,{}),(0,bi.jsx)("div",{className:"mx-auto max-w-md px-4 py-12",children:(0,bi.jsxs)("div",{className:"rounded-lg border border-slate-700 bg-slate-900/60 p-8",children:[(0,bi.jsx)("h1",{className:"text-2xl font-bold mb-6 text-center",children:"Skapa konto"}),(0,bi.jsxs)("form",{onSubmit:async t=>{if(t.preventDefault(),r.trim()&&s.trim()&&o){f(!0),h("");try{await n({name:r,email:s,password:o,contact:c}),e("/")}catch(i){h((null===i||void 0===i?void 0:i.message)||"Kunde inte skapa konto.")}finally{f(!1)}}else h("Fyll i namn, e-post och l\xf6senord.")},className:"space-y-4",children:[(0,bi.jsxs)("div",{children:[(0,bi.jsx)("label",{className:"block text-sm font-semibold text-gray-200 mb-1",children:"Namn *"}),(0,bi.jsx)("input",{type:"text",autoComplete:"name",value:r,onChange:e=>i(e.target.value),className:"w-full rounded bg-slate-800 border border-slate-600 px-3 py-2",placeholder:"Ditt namn",required:!0})]}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("label",{className:"block text-sm font-semibold text-gray-200 mb-1",children:"E-post *"}),(0,bi.jsx)("input",{type:"email",autoComplete:"username",value:s,onChange:e=>a(e.target.value),className:"w-full rounded bg-slate-800 border border-slate-600 px-3 py-2",placeholder:"din@epost.se",required:!0})]}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("label",{className:"block text-sm font-semibold text-gray-200 mb-1",children:"L\xf6senord *"}),(0,bi.jsx)("input",{type:"password",autoComplete:"new-password",value:o,onChange:e=>l(e.target.value),className:"w-full rounded bg-slate-800 border border-slate-600 px-3 py-2",placeholder:"********",required:!0})]}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("label",{className:"block text-sm font-semibold text-gray-200 mb-1",children:"Kontakt (valfritt)"}),(0,bi.jsx)("input",{type:"text",autoComplete:"tel",value:c,onChange:e=>u(e.target.value),className:"w-full rounded bg-slate-800 border border-slate-600 px-3 py-2",placeholder:"Telefon eller annan kontakt"})]}),d&&(0,bi.jsx)("div",{className:"bg-red-900/30 border border-red-500/50 rounded-lg p-3 text-sm text-red-200",children:d}),(0,bi.jsx)("button",{type:"submit",disabled:p,className:"w-full rounded-lg px-4 py-3 font-semibold transition-colors bg-cyan-500 hover:bg-cyan-400 text-black disabled:opacity-50 disabled:cursor-not-allowed",children:p?"Skapar konto...":"Skapa konto"})]}),(0,bi.jsx)("div",{className:"mt-6 text-center",children:(0,bi.jsxs)("p",{className:"text-sm text-gray-300",children:["Har du redan ett konto?"," ",(0,bi.jsx)(Te,{to:"/login",className:"text-cyan-300 hover:text-cyan-200",children:"Logga in h\xe4r"})]})})]})})]})},Al=e=>{let{dataUrl:t,isLoading:n,error:r,description:i}=e;return n?(0,bi.jsx)("p",{className:"text-sm text-gray-400",children:"Genererar QR-kod..."}):r?(0,bi.jsx)("p",{className:"text-sm text-red-300",children:r}):(0,bi.jsxs)("div",{className:"rounded-lg bg-slate-900/60 p-4",children:[i&&(0,bi.jsx)("p",{className:"text-sm text-gray-400 mb-3",children:i}),t&&(0,bi.jsx)("img",{src:t,alt:"QR-kod",className:"w-full max-w-sm mx-auto rounded"})]})};function Il(e,t){return Object.freeze((0,Ti.A)((0,Ti.A)({},e),t))}const Pl=(0,t.createContext)(null),Ll=Pl.Provider;function Rl(){const e=(0,t.useContext)(Pl);if(null==e)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return e}function Ol(){return Rl().map}function Ml(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var Dl=n(228),Fl=n.n(Dl);const zl=["bounds","boundsOptions","center","children","className","id","placeholder","style","whenReady","zoom"];function Ul(){return Ul=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ul.apply(this,arguments)}function Bl(e,n){let{bounds:r,boundsOptions:i,center:s,children:a,className:o,id:l,placeholder:c,style:u,whenReady:d,zoom:h}=e,p=Ml(e,zl);const[f]=(0,t.useState)({className:o,id:l,style:u}),[m,g]=(0,t.useState)(null);(0,t.useImperativeHandle)(n,()=>{var e;return null!==(e=null===m||void 0===m?void 0:m.map)&&void 0!==e?e:null},[m]);const v=(0,t.useCallback)(e=>{if(null!==e&&null===m){const t=new Dl.Map(e,p);null!=s&&null!=h?t.setView(s,h):null!=r&&t.fitBounds(r,i),null!=d&&t.whenReady(d),g(function(e){return Object.freeze({__version:1,map:e})}(t))}},[]);(0,t.useEffect)(()=>()=>{null===m||void 0===m||m.map.remove()},[m]);const y=m?t.createElement(Ll,{value:m},a):null!==c&&void 0!==c?c:null;return t.createElement("div",Ul({},f,{ref:v}),y)}const Vl=(0,t.forwardRef)(Bl);function ql(e){function n(n,r){const{instance:i,context:s}=e(n).current;return(0,t.useImperativeHandle)(r,()=>i),null==n.children?null:t.createElement(Ll,{value:s},n.children)}return(0,t.forwardRef)(n)}function Kl(e,t,n){return Object.freeze({instance:e,context:t,container:n})}function Hl(e,n){return null==n?function(n,r){const i=(0,t.useRef)();return i.current||(i.current=e(n,r)),i}:function(r,i){const s=(0,t.useRef)();s.current||(s.current=e(r,i));const a=(0,t.useRef)(r),{instance:o}=s.current;return(0,t.useEffect)(function(){a.current!==r&&(n(o,r,a.current),a.current=r)},[o,r,i]),s}}function Wl(e,n){const r=(0,t.useRef)();(0,t.useEffect)(function(){return null!=n&&e.instance.on(n),r.current=n,function(){null!=r.current&&e.instance.off(r.current),r.current=null}},[e,n])}function Gl(e,t){var n;const r=null!==(n=e.pane)&&void 0!==n?n:t.pane;return r?(0,Ti.A)((0,Ti.A)({},e),{},{pane:r}):e}function Zl(e,n){(0,t.useEffect)(function(){var t;return(null!==(t=n.layerContainer)&&void 0!==t?t:n.map).addLayer(e.instance),function(){var t;null===(t=n.layerContainer)||void 0===t||t.removeLayer(e.instance),n.map.removeLayer(e.instance)}},[n,e])}function Ql(e){return function(n){const r=Rl(),i=e(Gl(n,r),r);return function(e,n){const r=(0,t.useRef)(n);(0,t.useEffect)(function(){n!==r.current&&null!=e.attributionControl&&(null!=r.current&&e.attributionControl.removeAttribution(r.current),null!=n&&e.attributionControl.addAttribution(n)),r.current=n},[e,n])}(r.map,n.attribution),Wl(i.current,n.eventHandlers),Zl(i.current,r),i}}function Jl(e){return function(n){const r=Rl(),i=e(Gl(n,r),r);return Wl(i.current,n.eventHandlers),Zl(i.current,r),function(e,n){const r=(0,t.useRef)();(0,t.useEffect)(function(){if(n.pathOptions!==r.current){var t;const i=null!==(t=n.pathOptions)&&void 0!==t?t:{};e.instance.setStyle(i),r.current=i}},[e,n])}(i.current,n),i}}const Yl=["url"],Xl=function(e){function n(n,r){const{instance:i}=e(n).current;return(0,t.useImperativeHandle)(r,()=>i),null}return(0,t.forwardRef)(n)}(Ql(Hl(function(e,t){let{url:n}=e,r=Ml(e,Yl);return Kl(new Dl.TileLayer(n,Gl(r,t)),t)},function(e,t,n){!function(e,t,n){const{opacity:r,zIndex:i}=t;null!=r&&r!==n.opacity&&e.setOpacity(r),null!=i&&i!==n.zIndex&&e.setZIndex(i)}(e,t,n);const{url:r}=t;null!=r&&r!==n.url&&e.setUrl(r)})));const $l=["positions"],ec=function(e,t){return ql(Jl(Hl(e,t)))}(function(e,t){let{positions:n}=e,r=Ml(e,$l);const i=new Dl.Polyline(n,r);return Kl(i,Il(t,{overlayContainer:i}))},function(e,t,n){t.positions!==n.positions&&e.setLatLngs(t.positions)}),tc=["position"],nc=function(e,t){return ql(Ql(Hl(e,t)))}(function(e,t){let{position:n}=e,r=Ml(e,tc);const i=new Dl.Marker(n,r);return Kl(i,Il(t,{overlayContainer:i}))},function(e,t,n){t.position!==n.position&&e.setLatLng(t.position),null!=t.icon&&t.icon!==n.icon&&e.setIcon(t.icon),null!=t.zIndexOffset&&t.zIndexOffset!==n.zIndexOffset&&e.setZIndexOffset(t.zIndexOffset),null!=t.opacity&&t.opacity!==n.opacity&&e.setOpacity(t.opacity),null!=e.dragging&&t.draggable!==n.draggable&&(!0===t.draggable?e.dragging.enable():e.dragging.disable())});n(8856);const rc=function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=n?36:32;return Fl().divIcon({html:'\n      <div style="\n        background: '.concat(t,";\n        color: white;\n        border: 3px solid white;\n        border-radius: 50%;\n        width: ").concat(i,"px;\n        height: ").concat(i,"px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: ").concat(n?"16px":"14px",";\n        font-weight: bold;\n        box-shadow: 0 2px 8px rgba(0,0,0,0.3);\n        ").concat(n?"box-shadow: 0 0 0 4px rgba(245, 158, 11, 0.3);":"","\n        ").concat(r?"cursor: pointer; transition: transform 0.2s;":"",'\n      "\n      ').concat(r?'class="clickable-checkpoint"':"","\n      >").concat(e,"</div>\n      ").concat(r?"\n        <style>\n          .clickable-checkpoint:hover {\n            transform: scale(1.15);\n          }\n        </style>\n      ":"","\n    "),className:"custom-checkpoint-icon",iconSize:[i,i],iconAnchor:[i/2,i/2]})},ic=e=>{let{positions:n}=e;const r=Ol();return(0,t.useEffect)(()=>{n&&n.length>0&&r.fitBounds(n,{padding:[50,50]})},[n,r]),null},sc=e=>{let{route:n}=e;const r=Ol();return(0,t.useEffect)(()=>{if(!r||!n||0===n.length)return;const e=Fl().polylineDecorator(n,{patterns:[{offset:25,repeat:120,symbol:Fl().Symbol.arrowHead({pixelSize:12,pathOptions:{color:"#FFFFFF",fillOpacity:.9,weight:1,stroke:!0,fill:!0}})}]});return e.addTo(r),()=>{r.hasLayer(e)&&r.removeLayer(e)}},[r,n]),null},ac=e=>{let{checkpoints:n,userPosition:r,activeOrder:i,answeredCount:s,route:a,startPoint:o,className:l="h-full",onCheckpointClick:c=null,manualMode:u=!1}=e;const d=(0,t.useMemo)(()=>n.map(e=>[e.location.lat,e.location.lng]),[n]),h=(0,t.useMemo)(()=>{if(a&&Array.isArray(a)&&a.length>1){if(a.every(e=>e&&"number"===typeof e.lat&&"number"===typeof e.lng&&!isNaN(e.lat)&&!isNaN(e.lng)))return a.map(e=>[e.lat,e.lng])}return d},[a,d]),p=(0,t.useMemo)(()=>{if(r)return[r.lat,r.lng];if(d.length>0){const e=d.map(e=>e[0]),t=d.map(e=>e[1]);return[e.reduce((e,t)=>e+t,0)/e.length,t.reduce((e,t)=>e+t,0)/t.length]}return Ds},[r,d]);return(0,bi.jsx)("div",{className:"w-full overflow-hidden relative ".concat(l),children:(0,bi.jsxs)(Vl,{center:p,zoom:13,style:{height:"100%",width:"100%"},className:"h-full w-full relative z-0",scrollWheelZoom:!0,zoomControl:!0,doubleClickZoom:!0,touchZoom:!0,dragging:!0,children:[(0,bi.jsx)(ic,{positions:d}),(0,bi.jsx)(Xl,{attribution:'\xa9 <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),h.length>1&&(0,bi.jsxs)(bi.Fragment,{children:[(0,bi.jsx)(ec,{positions:h,pathOptions:{color:"#000000",weight:8,opacity:.8}}),(0,bi.jsx)(ec,{positions:h,pathOptions:{color:"#06b6d4",weight:6,opacity:1,lineCap:"round",lineJoin:"round"}}),(0,bi.jsx)(sc,{route:h})]}),d.map((e,t)=>{const r=t<s,a=t===i,o=r?"#10b981":a?"#f59e0b":"#6366f1",l=n[t].questionId||n[t].order||t,d=u&&!r,h={position:e,icon:rc(t+1,o,a,d)};return d&&c&&(h.eventHandlers={click:()=>{c(t)}}),(0,bi.jsx)(nc,(0,Ti.A)({},h),l)}),o&&(0,bi.jsx)(nc,{position:[o.lat,o.lng],icon:Fl().divIcon({html:'\n      <div style="\n        background: #22c55e;\n        color: white;\n        border: 3px solid white;\n        border-radius: 50%;\n        width: 32px;\n        height: 32px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 16px;\n        font-weight: bold;\n        box-shadow: 0 2px 8px rgba(0,0,0,0.3);\n      ">\ud83c\udfc1</div>\n    ',className:"custom-start-finish-icon",iconSize:[32,32],iconAnchor:[16,16]})}),r&&(0,bi.jsx)(nc,{position:[r.lat,r.lng],icon:Fl().divIcon({html:'\n      <div style="\n        background: #3b82f6;\n        color: white;\n        border: 4px solid white;\n        border-radius: 50%;\n        width: 40px;\n        height: 40px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 20px;\n        font-weight: bold;\n        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.6), 0 0 0 4px rgba(59, 130, 246, 0.2);\n        animation: pulse 2s ease-in-out infinite;\n      ">\ud83d\udccd</div>\n      <style>\n        @keyframes pulse {\n          0%, 100% { transform: scale(1); }\n          50% { transform: scale(1.1); }\n        }\n      </style>\n    ',className:"custom-user-position-icon",iconSize:[40,40],iconAnchor:[20,20]})})]})})},oc=e=>{var t;return e?"undefined"!==typeof window&&null!==(t=window.location)&&void 0!==t&&t.origin?"".concat(window.location.origin,"/join?code=").concat(e):"/join?code=".concat(e):""};const lc=new class{constructor(){this.logsCollection=(0,si.rJ)(gi,"errorLogs"),this.breadcrumbs=[],this.maxBreadcrumbs=20,this.setupGlobalErrorHandler()}addBreadcrumb(e,t){const n={category:e,message:t,data:arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},timestamp:(new Date).toISOString(),url:"undefined"!==typeof window?window.location.pathname:"unknown"};this.breadcrumbs.push(n),this.breadcrumbs.length>this.maxBreadcrumbs&&this.breadcrumbs.shift()}clearBreadcrumbs(){this.breadcrumbs=[]}setupGlobalErrorHandler(){"undefined"!==typeof window&&(window.addEventListener("error",e=>{var t;this.logError({type:"uncaught_error",message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno,stack:null===(t=e.error)||void 0===t?void 0:t.stack})}),window.addEventListener("unhandledrejection",e=>{var t,n;this.logError({type:"unhandled_rejection",message:(null===(t=e.reason)||void 0===t?void 0:t.message)||String(e.reason),stack:null===(n=e.reason)||void 0===n?void 0:n.stack})}))}async logError(e){try{const t=Xa(),n="undefined"!==typeof navigator?navigator.userAgent:"unknown",r=this.parseStackTrace(e.stack);await(0,si.gS)(this.logsCollection,(0,Ti.A)((0,Ti.A)({},e),{},{deviceId:t,userAgent:n,url:"undefined"!==typeof window?window.location.href:"unknown",pathname:"undefined"!==typeof window?window.location.pathname:"unknown",timestamp:(0,si.O5)(),level:"error",stackInfo:r,browserInfo:{platform:"undefined"!==typeof navigator?navigator.platform:"unknown",language:"undefined"!==typeof navigator?navigator.language:"unknown",screenResolution:"undefined"!==typeof window?"".concat(window.screen.width,"x").concat(window.screen.height):"unknown",viewport:"undefined"!==typeof window?"".concat(window.innerWidth,"x").concat(window.innerHeight):"unknown"},breadcrumbs:[...this.breadcrumbs]})),console.error("\ud83d\udd34 Error logged:",e)}catch(t){console.error("Failed to log error to Firestore:",t)}}parseStackTrace(e){if(!e)return null;const t=e.split("\n"),n=[];for(const r of t.slice(0,5)){const e=r.match(/at\s+(.+?)\s+\((.+?):(\d+):(\d+)\)/),t=r.match(/(.+?)@(.+?):(\d+):(\d+)/),i=r.match(/(.+?):(\d+):(\d+)/);e?n.push({function:e[1].trim(),file:e[2],line:parseInt(e[3]),column:parseInt(e[4])}):t?n.push({function:t[1].trim(),file:t[2],line:parseInt(t[3]),column:parseInt(t[4])}):i&&n.push({file:i[1],line:parseInt(i[2]),column:parseInt(i[3])})}return n.length>0?n:null}async logGPSDebug(e){try{const t=Xa();await(0,si.gS)(this.logsCollection,(0,Ti.A)((0,Ti.A)({type:"gps_debug"},e),{},{deviceId:t,userAgent:"undefined"!==typeof navigator?navigator.userAgent:"unknown",url:"undefined"!==typeof window?window.location.href:"unknown",timestamp:(0,si.O5)(),level:"debug"}))}catch(t){console.error("Failed to log GPS debug to Firestore:",t)}}async logRouteGeneration(e){try{const t=Xa();await(0,si.gS)(this.logsCollection,(0,Ti.A)((0,Ti.A)({type:"route_generation"},e),{},{deviceId:t,userAgent:"undefined"!==typeof navigator?navigator.userAgent:"unknown",timestamp:(0,si.O5)(),level:"info"}))}catch(t){console.error("Failed to log route generation to Firestore:",t)}}async logInfo(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{const n=Xa();await(0,si.gS)(this.logsCollection,{type:"info",message:e,data:t,deviceId:n,userAgent:"undefined"!==typeof navigator?navigator.userAgent:"unknown",url:"undefined"!==typeof window?window.location.href:"unknown",timestamp:(0,si.O5)(),level:"info"})}catch(n){console.error("Failed to log info to Firestore:",n)}}};var cc=n(8970);const uc=(e,n)=>{const[r,i]=(0,t.useState)(""),[s,a]=(0,t.useState)(!1),[o,l]=(0,t.useState)("");return(0,t.useEffect)(()=>{if(!e)return void i("");let t=!1;a(!0),l("");const r=document.createElement("canvas");return cc.toCanvas(r,e,{width:n,margin:2,color:{dark:"#0f172a",light:"#f8fafc"},errorCorrectionLevel:"H"}).then(()=>{if(t)return;const e=r.getContext("2d"),s=new Image;s.src="/logo-compass.svg",s.onload=()=>{if(t)return;const a=.25*n,o=(n-a)/2,l=(n-a)/2;e.fillStyle="#f8fafc",e.fillRect(o,l,a,a),e.drawImage(s,o,l,a,a),i(r.toDataURL())},s.onerror=()=>{t||i(r.toDataURL())}}).catch(e=>{t||(console.warn("Kunde inte generera QR-kod",e),l("Kunde inte generera QR-kod."))}).finally(()=>{t||a(!1)}),()=>{t=!0}},[e,n]),{dataUrl:r,isLoading:s,error:o}},dc=()=>{const e=J();return(0,t.useEffect)(()=>{lc.addBreadcrumb("navigation","Navigated to ".concat(e.pathname),{pathname:e.pathname,search:e.search})},[e.pathname,e.search]),{logClick:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};lc.addBreadcrumb("user_action","Clicked: ".concat(e),t)},logFormSubmit:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};lc.addBreadcrumb("form","Submitted form: ".concat(e),t)},logApiCall:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};lc.addBreadcrumb("api","API call: ".concat(e),t)},logStateChange:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};lc.addBreadcrumb("state",e,t)}}},hc=e=>{let{dataUrl:t,onClose:n}=e;return t?(0,bi.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50",onClick:n,children:(0,bi.jsxs)("div",{className:"relative",children:[(0,bi.jsx)("img",{src:t,alt:"QR-kod",className:"max-w-full max-h-full p-4 bg-white rounded-lg"}),(0,bi.jsx)("button",{onClick:n,className:"absolute top-2 right-2 bg-white rounded-full p-2 text-black font-bold text-xl",children:"\xd7"})]})}):null},pc=e=>{let{checkpoints:t,route:n,userPosition:r,onClose:i}=e;return(0,bi.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50",onClick:i,children:(0,bi.jsxs)("div",{className:"relative w-full h-full p-4",children:[(0,bi.jsx)(ac,{checkpoints:t,route:n,userPosition:r,activeOrder:0,answeredCount:0}),(0,bi.jsx)("button",{onClick:i,className:"absolute top-8 right-8 bg-white rounded-full p-2 text-black font-bold text-xl",children:"\xd7"})]})})},fc={name:"",difficulty:"family",categories:[],lengthMeters:3e3,questionCount:9,preferGreenAreas:!1,allowRouteSelection:!1},mc=[{value:"children",label:"Barn (6-12 \xe5r)"},{value:"youth",label:"Ungdom (13-17 \xe5r)"},{value:"adults",label:"Vuxen (18+ \xe5r)"},{value:"family",label:"Familj (1/3 av varje)"}],gc=[{value:"Geografi",label:"Geografi"},{value:"Historia",label:"Historia"},{value:"Naturvetenskap",label:"Naturvetenskap"},{value:"Kultur",label:"Kultur"},{value:"Sport",label:"Sport"},{value:"Natur",label:"Natur"},{value:"Teknik",label:"Teknik"},{value:"Djur",label:"Djur"},{value:"G\xe5tor",label:"G\xe5tor"}],vc=()=>{const e=X(),{currentUser:n,loginAsGuest:r}=Ci(),{generateRun:i}=aa(),{coords:s,status:a,trackingEnabled:o}=vo(),{logFormSubmit:l,logStateChange:c}=dc(),[u,d]=(0,t.useState)(fc),h=t.useMemo(()=>xi.getAlias()||"",[]),[p,f]=(0,t.useState)(h),[m,g]=(0,t.useState)(()=>Boolean(h.trim())),[v,y]=(0,t.useState)(!1),[x,b]=(0,t.useState)(""),[w,_]=(0,t.useState)(null),[k,N]=(0,t.useState)(!1),[S,j]=(0,t.useState)(!1),[E,C]=(0,t.useState)(!1),[T,A]=(0,t.useState)(!1),[I,P]=(0,t.useState)(""),[L,R]=(0,t.useState)(()=>Math.floor(1e5*Math.random())),O=t.useMemo(()=>w?oc(w.joinCode):"",[w]),{dataUrl:M,isLoading:D,error:F}=uc(O,320),z=t.useRef(null),U=t.useCallback(async()=>{var e;if(null!==n&&void 0!==n&&n.id)return{id:n.id,name:n.name||""};const t=(null===p||void 0===p?void 0:p.trim())||(null===(e=u.name)||void 0===e?void 0:e.trim())||"G?st";try{xi.saveAlias(t),f(t),g(!0);const e=await r({alias:t});if(!e)throw new Error("G?st-inloggning misslyckades");return{id:e.uid||e.id||"anonymous",name:e.displayName||e.name||t||"G?st"}}catch(i){throw console.error("[GenerateRunPage] Kunde inte skapa g?stidentitet:",i),i}},[p,n,u.name,r]),B=t.useCallback(async()=>{if(w&&O){z.current&&clearTimeout(z.current);try{var e;"undefined"!==typeof navigator&&navigator.share?(await navigator.share({title:w.name||"RouteQuest",text:"Hang med pa min runda!",url:O}),P("Delat!")):"undefined"!==typeof navigator&&null!==(e=navigator.clipboard)&&void 0!==e&&e.writeText?(await navigator.clipboard.writeText(O),P("Lanken kopierades.")):P("Kopiera Lanken: "+O)}catch(n){var t;console.warn("[GenerateRunPage] Share failed",n),"undefined"!==typeof navigator&&null!==(t=navigator.clipboard)&&void 0!==t&&t.writeText?(await navigator.clipboard.writeText(O),P("Lanken kopierades.")):P("Kunde inte dela automatiskt.")}"undefined"!==typeof window&&(z.current=window.setTimeout(()=>{P("")},4e3))}},[w,O]);t.useEffect(()=>{z.current&&clearTimeout(z.current),P("")},[w]),t.useEffect(()=>()=>{z.current&&clearTimeout(z.current)},[]);const V=t.useMemo(()=>s&&s.lat&&s.lng?{lat:s.lat,lng:s.lng}:null,[s]),q=t.useRef(a),K=t.useRef(o);t.useEffect(()=>{const e=q.current!==a,t=K.current!==o;(e||t)&&(lc.logGPSDebug({message:"GenerateRunPage GPS status change",coords:s?{latitude:s.lat,longitude:s.lng,accuracy:s.accuracy}:null,gpsStatus:a,trackingEnabled:o,userPosition:V,statusChanged:e,trackingChanged:t}),q.current=a,K.current=o)},[s,a,o,V]);const H=e=>{const{name:t,value:n,type:r,checked:i}=e.target,s="checkbox"===r?i:n;d(e=>{const n=(0,Ti.A)({},e);if("questionCount"===t){const t=Math.max(3,Number(s)||3);if("family"===e.difficulty){const e=Math.max(3,3*Math.round(t/3));n.questionCount=e}else n.questionCount=t;return n}if("difficulty"===t){if(n.difficulty=s,"family"===s){const t=Math.max(3,3*Math.round((e.questionCount||9)/3));n.questionCount=t}return n}return n[t]=s,n})},W=async t=>{if(t.preventDefault(),b(""),null===n||void 0===n||!n.isAnonymous||p.trim()){l("Create Run Form",{name:u.name,difficulty:u.difficulty,lengthMeters:u.lengthMeters,hasGPS:!!V});try{if(!u.name.trim())return b("Ange ett namn p\xe5 rundan."),void c("Form validation failed: name missing");if(null!==n&&void 0!==n&&n.isAnonymous&&p.trim()){const e=p.trim();xi.saveAlias(e),g(!0),await r({alias:e})}const t=V?{lat:V.lat,lng:V.lng}:Ms;await lc.logRouteGeneration({message:"Route generation started - DETAILED",originPosition:t,hasGPS:!!V,gpsStatus:a,trackingEnabled:o,coords:s?{latitude:s.lat,longitude:s.lng,accuracy:s.accuracy}:null,userPosition:V,fallbackPosition:Ms,willUseFallback:!V,formData:{name:u.name,difficulty:u.difficulty,lengthMeters:u.lengthMeters,questionCount:u.questionCount}});const l=await U(),d=await i({name:u.name,difficulty:u.difficulty,audience:u.difficulty,categories:u.categories||[],lengthMeters:Number(u.lengthMeters),questionCount:Number(u.questionCount),allowAnonymous:!0,allowRouteSelection:u.allowRouteSelection,origin:t,seed:L,preferGreenAreas:u.preferGreenAreas},l);d&&(_(d),$a("create_run",{runId:d.id,difficulty:u.difficulty,categories:u.categories,questionCount:u.questionCount}),await lc.logInfo("Route generated successfully",{runId:d.id,usedGPS:!!V,originPosition:t}),u.allowRouteSelection?j(!1):(n||Ma(d),e("/join?code=".concat(d.joinCode),{replace:!0})))}catch(d){console.error("\u274c Fel vid generering:",d);const e="permission-denied"===(null===d||void 0===d?void 0:d.code)?"Behorighet saknas for att skapa rundan. Ladda om sidan eller logga in och forsok igen.":d.message;b("Kunde inte generera runda: ".concat(e)),await lc.logError({type:"route_generation_failed",message:d.message,stack:d.stack,gpsStatus:a,trackingEnabled:o,userPosition:V})}}else y(!0)};return(0,bi.jsxs)(jl,{headerTitle:"Skapa runda",maxWidth:"max-w-5xl",className:"space-y-10",children:[E&&(0,bi.jsx)(hc,{dataUrl:M,onClose:()=>C(!1)}),T&&(0,bi.jsx)(pc,{checkpoints:(null===w||void 0===w?void 0:w.checkpoints)||[],route:null===w||void 0===w?void 0:w.route,userPosition:V,onClose:()=>A(!1)}),v&&(0,bi.jsx)("div",{className:"fixed inset-0 z-[1200] flex items-center justify-center bg-black/70 p-4 backdrop-blur-sm",children:(0,bi.jsxs)("div",{className:"w-full max-w-md rounded-2xl border border-cyan-500/40 bg-slate-900 p-6 shadow-2xl",children:[(0,bi.jsx)("h2",{className:"text-xl font-semibold text-slate-100 mb-4",children:"Ange ditt alias"}),(0,bi.jsx)("p",{className:"text-sm text-gray-300 mb-6",children:"F\xf6r att skapa en runda beh\xf6ver vi veta vad du vill kallas. Aliaset sparas p\xe5 enheten."}),(0,bi.jsxs)("div",{className:"space-y-4",children:[(0,bi.jsxs)("div",{children:[(0,bi.jsx)("label",{className:"block text-sm font-semibold text-cyan-200 mb-2",children:"Alias"}),(0,bi.jsx)("input",{type:"text",value:p,onChange:e=>f(e.target.value),placeholder:"T.ex. Erik",autoFocus:!0,className:"w-full rounded-lg border border-slate-700 bg-slate-800 px-3 py-3 text-slate-100 focus:border-cyan-400 focus:outline-none"})]}),(0,bi.jsxs)("div",{className:"flex gap-3",children:[(0,bi.jsx)("button",{onClick:()=>y(!1),className:"flex-1 rounded-lg border border-slate-600 bg-slate-800 px-4 py-3 font-semibold text-slate-100 hover:bg-slate-700",children:"Avbryt"}),(0,bi.jsx)("button",{onClick:async()=>{if(!p.trim())return void b("Ange ett alias");const e=p.trim();xi.saveAlias(e),g(!0),await r({alias:e}),y(!1),W({preventDefault:()=>{}})},className:"flex-1 rounded-lg bg-cyan-500 px-4 py-3 font-semibold text-black hover:bg-cyan-400",children:"Forts\xe4tt"})]})]})]})}),w?(0,bi.jsxs)("section",{className:"grid gap-8 lg:grid-cols-[minmax(0,1.15fr)_minmax(0,0.85fr)]",children:[(0,bi.jsx)("article",{className:"space-y-6 rounded-2xl border border-purple-500/40 bg-slate-900/70 p-6 shadow-xl",children:S?(0,bi.jsxs)(bi.Fragment,{children:[(0,bi.jsxs)("div",{className:"space-y-2 text-center sm:text-left",children:[(0,bi.jsx)("h2",{className:"text-xl font-semibold text-slate-100",children:w.name}),(0,bi.jsxs)("p",{className:"text-sm text-gray-300",children:["L\ufffdngd: ",w.lengthMeters," m \ufffd ",w.questionCount," fr\ufffdgor"]}),(0,bi.jsxs)("p",{className:"text-sm text-gray-300",children:["Anslutningskod: ",(0,bi.jsx)("span",{className:"font-mono text-lg tracking-wide text-cyan-200",children:w.joinCode})]})]}),(0,bi.jsx)("div",{className:"cursor-pointer",onClick:()=>C(!0),children:(0,bi.jsx)(Al,{dataUrl:M,isLoading:D,error:F})}),(0,bi.jsxs)("div",{className:"flex flex-wrap justify-center gap-3 text-sm",children:[(0,bi.jsxs)("button",{type:"button",onClick:()=>e("/join?code=".concat(w.joinCode)),className:"inline-flex items-center gap-2 rounded-lg bg-emerald-500 px-4 py-2 font-semibold text-black transition-colors hover:bg-emerald-400 disabled:opacity-60",disabled:!(null!==w&&void 0!==w&&w.joinCode),children:[(0,bi.jsx)("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,bi.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})}),"Starta runda"]}),(0,bi.jsxs)("button",{type:"button",onClick:B,disabled:!O,className:"inline-flex items-center gap-2 rounded-lg border border-slate-600/70 px-3 py-2 text-slate-100 transition-colors hover:border-cyan-400/80 hover:text-cyan-200 disabled:opacity-60",children:[(0,bi.jsxs)("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:[(0,bi.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 3v8"}),(0,bi.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 6l3-3 3 3"}),(0,bi.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"})]}),"Dela"]}),(0,bi.jsxs)("button",{type:"button",onClick:()=>A(!0),className:"inline-flex items-center gap-2 rounded-lg border border-slate-600/70 px-3 py-2 text-slate-100 transition-colors hover:border-cyan-400/80 hover:text-cyan-200",children:[(0,bi.jsx)("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,bi.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 20l-5.447-2.724A2 2 0 013 15.382V5.618a2 2 0 011.105-1.795L9 2m6 0l4.895 1.823A2 2 0 0121 5.618v9.764a2 2 0 01-1.105 1.795L15 20m-6 0V2m6 18V2"})}),"Visa karta"]})]}),I&&(0,bi.jsx)("p",{className:"text-xs text-center text-emerald-200",children:I})]}):(0,bi.jsxs)(bi.Fragment,{children:[(0,bi.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,bi.jsxs)("div",{children:[(0,bi.jsx)("h2",{className:"text-xl font-semibold text-slate-100",children:"F\xf6rslag p\xe5 runda"}),(0,bi.jsx)("p",{className:"text-sm text-gray-300",children:"Granska kartan nedan. Spara rundan f\xf6r att visa QR-kod och dela lanken."})]}),(0,bi.jsx)("button",{type:"button",onClick:async()=>{b(""),N(!0);const e=Math.floor(1e5*Math.random());R(e);try{const t=V?{lat:V.lat,lng:V.lng}:Ms;await lc.logRouteGeneration({message:"Route REGENERATION - DETAILED",originPosition:t,hasGPS:!!V,gpsStatus:a,trackingEnabled:o,coords:s?{latitude:s.lat,longitude:s.lng,accuracy:s.accuracy}:null,userPosition:V,fallbackPosition:Ms,willUseFallback:!V});const n=await U(),r=await i({name:u.name,difficulty:u.difficulty,audience:u.difficulty,categories:u.categories||[],lengthMeters:Number(u.lengthMeters),questionCount:Number(u.questionCount),allowAnonymous:!0,allowRouteSelection:u.allowRouteSelection,origin:t,seed:e,preferGreenAreas:u.preferGreenAreas},n);r&&(_(r),j(!1))}catch(t){console.error("\u274c Fel vid regenerering:",t);const e="permission-denied"===(null===t||void 0===t?void 0:t.code)?"Behorighet saknas for att spara rundan. Ladda om sidan eller logga in och forsok igen.":t.message;b("Kunde inte regenerera runda: ".concat(e))}finally{N(!1)}},disabled:k,className:"rounded-full bg-yellow-500/90 p-3 text-black shadow-lg transition enabled:hover:bg-yellow-400 disabled:bg-slate-700 disabled:text-gray-400",title:"Generera om",children:k?(0,bi.jsxs)("svg",{className:"h-5 w-5 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,bi.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,bi.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):(0,bi.jsx)("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,bi.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]}),(0,bi.jsx)("div",{className:"h-[22rem] rounded-xl border border-slate-700 bg-slate-900/70",children:(0,bi.jsx)(ac,{checkpoints:w.checkpoints||[],userPosition:V,activeOrder:0,answeredCount:0,route:w.route})}),(0,bi.jsx)("button",{type:"button",onClick:()=>{w&&(n||Ma(w),z.current&&clearTimeout(z.current),P(""),j(!0))},className:"w-full rounded-xl bg-green-500 px-4 py-3 text-lg font-bold text-black transition-colors hover:bg-green-400",children:"Spara och visa QR-kod"})]})}),(0,bi.jsxs)("aside",{className:"space-y-6",children:[(0,bi.jsxs)("div",{className:"rounded-2xl border border-slate-700 bg-slate-900/70 p-6 text-sm text-gray-300 shadow-lg",children:[(0,bi.jsx)("h3",{className:"text-base font-semibold text-slate-100",children:"Tips f\xf6r en rolig runda"}),(0,bi.jsxs)("ul",{className:"mt-3 list-disc space-y-2 pl-5",children:[(0,bi.jsx)("li",{children:"Placera f\xf6rsta kontrollen d\xe4r alla enkelt samlas."}),(0,bi.jsx)("li",{children:"Variera fr\xe5getyp och tema f\xf6r b\xe4ttre engagemang."}),(0,bi.jsx)("li",{children:"Spara rundan i din meny om du vill \xe5teranv\xe4nda den senare."})]})]}),!S&&(0,bi.jsxs)("div",{className:"rounded-2xl border border-slate-700 bg-slate-900/70 p-6 text-sm text-gray-300",children:[(0,bi.jsx)("h3",{className:"text-base font-semibold text-slate-100",children:"Beh\xf6ver du \xe4ndra n\xe5got?"}),(0,bi.jsx)("p",{className:"mt-2",children:"G\xe5 tillbaka och justera l\xe4ngd, kategorier eller sv\xe5righetsgrad. Du kan generera om hur m\xe5nga g\xe5nger som helst."})]})]})]}):(0,bi.jsxs)("section",{className:"space-y-8",children:[(0,bi.jsxs)("div",{className:"rounded-2xl border border-slate-700 bg-slate-900/70 p-6 text-center shadow-lg",children:[(0,bi.jsx)("h1",{className:"text-2xl font-semibold text-slate-100",children:"Skapa en tipsrunda automatiskt"}),(0,bi.jsx)("p",{className:"mt-3 text-sm text-gray-300 sm:text-base",children:"Ange namn, sv\xe5righetsgrad och \xf6nskad l\xe4ngd. RouteQuest skapar en rutt och v\xe4ljer fr\xe5gor \xe5t dig."})]}),x&&(0,bi.jsx)("div",{className:"rounded-2xl border border-red-500/40 bg-red-900/40 px-4 py-3 text-red-100",children:x}),(null===n||void 0===n?void 0:n.isAnonymous)&&!m&&(0,bi.jsxs)("div",{className:"space-y-3 rounded-2xl border border-cyan-500/30 bg-cyan-500/5 p-4",children:[(0,bi.jsx)("h3",{className:"text-sm font-semibold text-cyan-200",children:"Ditt alias"}),(0,bi.jsxs)("div",{className:"space-y-1.5",children:[(0,bi.jsx)("label",{className:"block text-xs text-gray-400",children:"Alias (visas f\xf6r deltagare)"}),(0,bi.jsx)("input",{type:"text",value:p,onChange:e=>{f(e.target.value)},placeholder:"T.ex. Erik",className:"w-full rounded-lg border border-slate-700 bg-slate-800 px-3 py-2 text-slate-100 focus:border-cyan-400 focus:outline-none"})]}),(0,bi.jsx)("p",{className:"text-xs text-gray-400",children:"Aliaset sparas p\xe5 denna enhet och kommer ih\xe5g n\xe4sta g\xe5ng."})]}),(0,bi.jsxs)("form",{onSubmit:W,className:"mx-auto max-w-xl space-y-5 rounded-2xl border border-slate-700 bg-slate-900/70 p-6 shadow-xl",children:[(0,bi.jsxs)("div",{className:"space-y-1.5",children:[(0,bi.jsx)("label",{className:"block text-sm font-semibold text-purple-200",children:"Namn p\xe5 runda"}),(0,bi.jsx)("input",{name:"name",value:u.name,onChange:H,className:"w-full rounded-lg border border-slate-700 bg-slate-800 px-3 py-3 text-slate-100 focus:border-purple-400 focus:outline-none",placeholder:"T.ex. Stadsvandring",required:!0})]}),(0,bi.jsxs)("div",{className:"space-y-1.5",children:[(0,bi.jsx)("label",{className:"block text-sm font-semibold text-purple-200",children:"Sv\xe5righetsgrad"}),(0,bi.jsx)("select",{name:"difficulty",value:u.difficulty,onChange:H,className:"w-full rounded-lg border border-slate-700 bg-slate-800 px-3 py-3 text-slate-100 focus:border-purple-400 focus:outline-none",children:mc.map(e=>(0,bi.jsx)("option",{value:e.value,children:e.label},e.value))}),(0,bi.jsxs)("p",{className:"mt-1 text-xs text-gray-400",children:["children"===u.difficulty&&"Endast fr\xe5gor m\xe4rkta f\xf6r barn (ageGroups: children).","youth"===u.difficulty&&"Endast fr\xe5gor m\xe4rkta f\xf6r ungdomar (ageGroups: youth).","adults"===u.difficulty&&"Endast fr\xe5gor m\xe4rkta f\xf6r vuxna (ageGroups: adults).","family"===u.difficulty&&"Familjel\xe4ge blandar 1/3 barn-, 1/3 ungdoms- och 1/3 vuxenfr\xe5gor."]})]}),(0,bi.jsxs)("div",{className:"space-y-2",children:[(0,bi.jsxs)("label",{className:"block text-sm font-semibold text-purple-200",children:["Kategorier ",0===u.categories.length?"(Alla)":"(".concat(u.categories.length," valda)")]}),(0,bi.jsx)("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-3",children:gc.map(e=>{const t=u.categories.includes(e.value);return(0,bi.jsx)("button",{type:"button",onClick:()=>{return t=e.value,void d(e=>{const n=e.categories||[],r=n.includes(t);return(0,Ti.A)((0,Ti.A)({},e),{},{categories:r?n.filter(e=>e!==t):[...n,t]})});var t},className:"rounded-lg px-3 py-2 text-sm font-medium transition-colors ".concat(t?"bg-purple-500 text-black":"border border-slate-600 bg-slate-800 text-slate-100 hover:border-purple-400"),children:e.label},e.value)})}),(0,bi.jsx)("p",{className:"text-xs text-gray-400",children:"V\xe4lj kategorier eller l\xe4mna tomt f\xf6r alla."})]}),(0,bi.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2",children:[(0,bi.jsxs)("div",{className:"space-y-1.5",children:[(0,bi.jsx)("label",{className:"block text-sm font-semibold text-purple-200",children:"Rundans l\xe4ngd (meter)"}),(0,bi.jsx)("input",{type:"number",name:"lengthMeters",min:500,max:1e4,step:100,value:u.lengthMeters,onChange:H,className:"w-full rounded-lg border border-slate-700 bg-slate-800 px-3 py-3 text-slate-100 focus:border-purple-400 focus:outline-none"})]}),(0,bi.jsxs)("div",{className:"space-y-1.5",children:[(0,bi.jsx)("label",{className:"block text-sm font-semibold text-purple-200",children:"Antal fr\xe5gor"}),(0,bi.jsx)("input",{type:"number",name:"questionCount",min:3,max:20,step:"family"===u.difficulty?3:1,value:u.questionCount,onChange:H,className:"w-full rounded-lg border border-slate-700 bg-slate-800 px-3 py-3 text-slate-100 focus:border-purple-400 focus:outline-none"}),"family"===u.difficulty&&(0,bi.jsx)("p",{className:"text-xs text-gray-400",children:"Familjel\xe4ge anv\xe4nder en tredjedel per \xe5ldersgrupp. Antal fr\xe5gor rundas till n\xe4rmaste multipel av tre."})]})]}),(0,bi.jsxs)("label",{className:"flex items-center gap-2 text-sm font-semibold text-purple-200",children:[(0,bi.jsx)("input",{type:"checkbox",name:"preferGreenAreas",checked:u.preferGreenAreas,onChange:H,className:"rounded border-slate-600 bg-slate-800 text-purple-500 focus:ring-purple-500"}),"F\xf6redra parker och stigar"]}),(0,bi.jsxs)("label",{className:"flex items-center gap-2 text-sm font-semibold text-purple-200",children:[(0,bi.jsx)("input",{type:"checkbox",name:"allowRouteSelection",checked:u.allowRouteSelection,onChange:H,className:"rounded border-slate-600 bg-slate-800 text-purple-500 focus:ring-purple-500"}),(0,bi.jsxs)("div",{className:"flex-1",children:[(0,bi.jsx)("span",{children:"Visa karta innan start"}),(0,bi.jsx)("p",{className:"text-xs font-normal text-gray-400 mt-0.5",children:"Om ikryssad kan deltagare se kartan och generera om rutten innan de startar"})]})]}),(0,bi.jsx)("button",{type:"submit",className:"w-full rounded-xl bg-purple-500 px-4 py-3 font-semibold text-black transition-colors hover:bg-purple-400",children:"Skapa runda"})]})]})]})},yc=()=>{const e=X(),n=J(),{currentUser:r,loginAsGuest:i,isAuthInitialized:s}=Ci(),{joinRunByCode:a}=aa(),[o,l]=(0,t.useState)(""),c=(0,t.useMemo)(()=>xi.getAlias()||"",[]),[u,d]=(0,t.useState)(c),[h,p]=(0,t.useState)(()=>Boolean(c.trim())),[f,m]=(0,t.useState)(()=>xi.getContact()),[g,v]=(0,t.useState)(""),[y,x]=(0,t.useState)(""),b=(0,t.useCallback)(async t=>{v(""),x("");const n=t.trim().toUpperCase();if(n.length<4)return void v("Ange en giltig anslutningskod.");if(null!==r&&void 0!==r&&r.isAnonymous&&!u.trim())return void v("Ange ett alias f\xf6r att delta.");let s=r;if(null!==r&&void 0!==r&&r.isAnonymous&&u.trim()){const e=u.trim();xi.saveAlias(e),d(e),p(!0),f&&xi.saveContact(f),s=await i({alias:e,contact:f})}try{var o,l,c,h,m,g,y,b,w,_;const{run:t}=await a(n,{userId:null!==(o=s)&&void 0!==o&&o.isAnonymous?null:null===(l=s)||void 0===l?void 0:l.id,alias:null===(c=s)||void 0===c?void 0:c.name,contact:null===(h=s)||void 0===h?void 0:h.contact,isAnonymous:null===(m=s)||void 0===m?void 0:m.isAnonymous}),i={userId:null!==(g=s)&&void 0!==g&&g.isAnonymous?null:null===(y=s)||void 0===y?void 0:y.id,alias:null===(b=s)||void 0===b?void 0:b.name,contact:null===(w=s)||void 0===w?void 0:w.contact,isAnonymous:null===(_=s)||void 0===_?void 0:_.isAnonymous};r&&!r.isAnonymous||Da(t,i),$a("join_run",{runId:t.id,runName:t.name}),x("Du \xe4r nu ansluten till ".concat(t.name,"!")),setTimeout(()=>{e("/run/".concat(t.id,"/play"))},600)}catch(k){v(k.message)}},[r,u,f,i,a,e]);(0,t.useEffect)(()=>{if("undefined"===typeof window)return;const e=e=>{if(!e.key||"geoquest:preferences"===e.key){const e=xi.getAlias()||"";d(e),p(Boolean(e.trim())),m(xi.getContact())}};return window.addEventListener("storage",e),window.addEventListener("userPreferences:changed",e),()=>{window.removeEventListener("storage",e),window.removeEventListener("userPreferences:changed",e)}},[]),(0,t.useEffect)(()=>{if(!s)return;const e=new URLSearchParams(n.search).get("code");if(e){const t=e.toUpperCase();l(t),(r&&!r.isAnonymous||null!==r&&void 0!==r&&r.isAnonymous&&h)&&b(t)}},[n.search,r,s,h,b]);const w=null!==r&&void 0!==r&&r.isAnonymous?za():[];return(0,bi.jsxs)(jl,{headerTitle:"Anslut till runda",maxWidth:"max-w-2xl",className:"space-y-8",children:[(0,bi.jsxs)("section",{className:"space-y-3 text-center",children:[(0,bi.jsx)("h1",{className:"text-3xl font-semibold text-slate-100",children:"Skriv in din kod"}),(0,bi.jsx)("p",{className:"text-sm text-gray-300 sm:text-base",children:"Koden finns i QR-l\xe4nken eller p\xe5 kortet som delades med dig. Skanna g\xe4rna QR:n direkt om du har den."})]}),w.length>0&&(0,bi.jsxs)("div",{className:"rounded-2xl border border-cyan-500/30 bg-cyan-500/10 p-4 text-sm text-cyan-100",children:["Du har sparade rundor p\xe5 denna enhet. Du hittar dem under ",(0,bi.jsx)("span",{className:"font-semibold",children:"Mina rundor"})," i menyn."]}),g&&(0,bi.jsx)("div",{className:"rounded-2xl border border-red-500/40 bg-red-900/40 px-4 py-3 text-red-100",children:g}),y&&(0,bi.jsx)("div",{className:"rounded-2xl border border-emerald-500/40 bg-emerald-900/40 px-4 py-3 text-emerald-100",children:y}),(0,bi.jsxs)("form",{onSubmit:e=>{e.preventDefault(),b(o)},className:"space-y-5 rounded-2xl border border-slate-700 bg-slate-900/70 p-5 sm:p-6",children:[(0,bi.jsxs)("div",{children:[(0,bi.jsx)("label",{className:"mb-1 block text-sm font-semibold text-cyan-200",children:"Anslutningskod"}),(0,bi.jsx)("input",{value:o,onChange:e=>l(e.target.value.toUpperCase()),className:"w-full rounded-lg border border-slate-700 bg-slate-800 px-3 py-3 font-mono text-lg tracking-[0.4em] text-center text-slate-100 focus:border-cyan-400 focus:outline-none",placeholder:"ABC123",inputMode:"text"})]}),(null===r||void 0===r?void 0:r.isAnonymous)&&!h&&(0,bi.jsxs)("div",{className:"space-y-3 rounded-2xl border border-cyan-500/30 bg-cyan-500/5 p-4",children:[(0,bi.jsxs)("div",{children:[(0,bi.jsx)("h2",{className:"text-base font-semibold text-cyan-200",children:"Ditt alias"}),(0,bi.jsx)("p",{className:"text-xs text-gray-400",children:u?"Detta alias sparas p\xe5 din enhet och anv\xe4nds vid framtida anslutningar.":"Ange ett alias f\xf6r att delta."})]}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("label",{className:"mb-1 block text-sm font-semibold text-slate-200",children:"Alias"}),(0,bi.jsx)("input",{value:u,onChange:e=>{d(e.target.value)},className:"w-full rounded-lg border border-slate-700 bg-slate-800 px-3 py-2 text-slate-100 focus:border-cyan-400 focus:outline-none",placeholder:"T.ex. Erik"})]}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("label",{className:"mb-1 block text-sm font-semibold text-slate-200",children:"Kontakt (valfritt)"}),(0,bi.jsx)("input",{value:f,onChange:e=>{m(e.target.value),xi.saveContact(e.target.value)},className:"w-full rounded-lg border border-slate-700 bg-slate-800 px-3 py-2 text-slate-100 focus:border-cyan-400 focus:outline-none",placeholder:"E-post eller telefon"})]})]}),(null===r||void 0===r?void 0:r.isAnonymous)&&h&&(0,bi.jsxs)("div",{className:"space-y-1 rounded-2xl border border-cyan-500/30 bg-cyan-500/5 p-4 text-sm text-cyan-100",children:[(0,bi.jsxs)("p",{children:["Aliaset ",(0,bi.jsx)("span",{className:"font-semibold text-cyan-200",children:u})," anv\xe4nds automatiskt f\xf6r denna anslutning."]}),(0,bi.jsx)("p",{className:"text-xs text-gray-400",children:"Du kan ta bort aliaset via menyn om du vill ange ett nytt."})]}),(0,bi.jsx)("button",{type:"submit",className:"w-full rounded-xl bg-cyan-500 px-4 py-3 font-semibold text-black transition-colors hover:bg-cyan-400",children:"Anslut till runda"})]})]})},xc=e=>e*Math.PI/180,bc=(e,t)=>{if(!e||!t)return null;const{lat:n,lng:r}=e,{lat:i,lng:s}=t;if([n,r,i,s].some(e=>"number"!==typeof e))return null;const a=xc(i-n),o=xc(s-r),l=Math.sin(a/2)**2+Math.cos(xc(n))*Math.cos(xc(i))*Math.sin(o/2)**2,c=2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l));return Math.round(6371e3*c)},wc=e=>{let{questionId:n,questionText:r,onClose:i,onReported:s}=e;const[a,o]=(0,t.useState)(""),[l,c]=(0,t.useState)(!1),[u,d]=(0,t.useState)({isOpen:!1,title:"",message:"",type:"info"});return(0,bi.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,bi.jsxs)("div",{className:"bg-slate-800 rounded-lg shadow-xl max-w-md w-full p-6 border border-slate-700",children:[(0,bi.jsx)("h2",{className:"text-xl font-bold text-white mb-4",children:"Rapportera fr\xe5ga"}),r&&(0,bi.jsx)("div",{className:"mb-4 p-3 bg-slate-900 rounded border border-slate-700",children:(0,bi.jsx)("p",{className:"text-sm text-gray-300",children:r})}),(0,bi.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),a.trim()){c(!0);try{const e=localStorage.getItem("geoquest:user:alias")||"anonymous";await Is(n,a.trim(),e),s&&s(),d({isOpen:!0,title:"Rapport skickad",message:"Tack f\xf6r din rapport! Fr\xe5gan har skickats till granskning.",type:"success"}),setTimeout(()=>i(),2e3)}catch(t){console.error("Kunde inte rapportera fr\xe5ga:",t),d({isOpen:!0,title:"Kunde inte skicka rapport",message:t.message,type:"error"})}finally{c(!1)}}else d({isOpen:!0,title:"Anledning saknas",message:"Ange en anledning till rapporten",type:"warning"})},children:[(0,bi.jsxs)("div",{className:"mb-4",children:[(0,bi.jsx)("label",{className:"block text-sm font-semibold text-cyan-200 mb-2",children:"Varf\xf6r rapporterar du denna fr\xe5ga?"}),(0,bi.jsx)("textarea",{value:a,onChange:e=>o(e.target.value),className:"w-full rounded bg-slate-900 border border-slate-600 px-3 py-2 text-white min-h-[100px]",placeholder:"T.ex. 'Felaktigt svar', 'Tvetydiga alternativ', 'Ol\xe4mpligt inneh\xe5ll'...",required:!0,disabled:l}),(0,bi.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Din rapport hj\xe4lper oss att f\xf6rb\xe4ttra fr\xe5gebanken. Fr\xe5gan kommer att granskas av administrat\xf6rer."})]}),(0,bi.jsxs)("div",{className:"flex gap-3",children:[(0,bi.jsx)("button",{type:"button",onClick:i,className:"flex-1 rounded bg-slate-700 px-4 py-2 font-semibold text-white hover:bg-slate-600",disabled:l,children:"Avbryt"}),(0,bi.jsx)("button",{type:"submit",className:"flex-1 rounded bg-yellow-600 px-4 py-2 font-semibold text-white hover:bg-yellow-500 disabled:bg-slate-600 disabled:text-gray-400",disabled:l,children:l?"Skickar...":"\u26a0\ufe0f Rapportera"})]})]}),(0,bi.jsx)(oa,{isOpen:u.isOpen,onClose:()=>d((0,Ti.A)((0,Ti.A)({},u),{},{isOpen:!1})),title:u.title,message:u.message,type:u.type})]})})},_c=()=>{var e,n;const{runId:r}=$(),i=X(),{currentRun:s,currentParticipant:a,loadRunById:o,submitAnswer:l,completeRunForParticipant:c,refreshParticipants:u}=aa(),{trackingEnabled:d,coords:h}=vo(),[p,f]=(0,t.useState)(null),[m,g]=(0,t.useState)(null),[v,y]=(0,t.useState)(""),[x,b]=(0,t.useState)(!0),[w,_]=(0,t.useState)(null),[k,N]=(0,t.useState)(null),[S,j]=(0,t.useState)(!1),[E,C]=(0,t.useState)(null),[T,A]=(0,t.useState)(!1),[I,P]=(0,t.useState)(()=>"undefined"!==typeof window&&localStorage.getItem("routequest:language")||"sv");(0,t.useEffect)(()=>{const e=()=>{const e=localStorage.getItem("routequest:language")||"sv";P(e)};return window.addEventListener("storage",e),window.addEventListener("languageChange",e),()=>{window.removeEventListener("storage",e),window.removeEventListener("languageChange",e)}},[]),(0,t.useEffect)(()=>{try{s&&s.id===r||o(r)}catch(e){y(e.message)}},[s,o,r]),(0,t.useEffect)(()=>{u().catch(e=>console.warn("Kunde inte uppdatera deltagare",e))},[u]);const L=!d;(0,t.useEffect)(()=>{f(null),g(null),b(!L)},[null===a||void 0===a?void 0:a.currentOrder,L]);const R=(0,t.useMemo)(()=>s?s.questionIds.map(e=>{const t=ys(e,I);return t||(console.warn("[PlayRunPage] Fr\xe5ga med ID ".concat(e," hittades inte i questionService")),{id:e,text:"Fr\xe5ga ".concat(e," kunde inte laddas"),options:["Ladda om sidan","F\xf6rs\xf6k igen","Kontakta admin","Hoppa \xf6ver"],explanation:"Denna fr\xe5ga kunde inte laddas fr\xe5n databasen.",correctOption:0})}):[],[s,I]),O=(0,t.useMemo)(()=>a?Math.max(0,a.currentOrder-1):0,[a]),M=(null===s||void 0===s||null===(e=s.checkpoints)||void 0===e?void 0:e[O])||null;(0,t.useEffect)(()=>{if(!h||!M)return void _(null);const e=bc(h,M.location);_(e)},[h,M]),(0,t.useEffect)(()=>{if(!h||null===s||void 0===s||!s.startPoint)return void N(null);const e=bc(h,s.startPoint);N(e)},[h,null===s||void 0===s?void 0:s.startPoint]);const D=d&&null!=w&&w<=25,F=d&&null!=k&&k<=25,z=s?oc(s.joinCode):"",{dataUrl:U,isLoading:B,error:V}=uc(z,280),q=(L&&x||!L&&D)&&R[O]||null,K=(null===a||void 0===a||null===(n=a.answers)||void 0===n?void 0:n.length)||0,H=K>=R.length,W=H&&(L||F),G=async()=>{await c(),i("/run/".concat(s.id,"/results"))};return v?(0,bi.jsxs)("div",{className:"mx-auto max-w-2xl px-4 py-8",children:[(0,bi.jsx)("h1",{className:"text-2xl font-semibold mb-4",children:"N\xe5got gick fel"}),(0,bi.jsx)("p",{className:"text-red-300 mb-4",children:v})]}):s&&a?(0,bi.jsxs)("div",{className:"h-dvh flex flex-col",children:[(0,bi.jsx)("style",{children:"\n          @media (max-width: 768px) { .leaflet-container { height: 100% !important; } }\n        "}),(0,bi.jsx)(Sl,{title:"".concat(s.name," (").concat(Math.min((null===a||void 0===a?void 0:a.currentOrder)||1,R.length),"/").concat(R.length,")"),children:(0,bi.jsx)("button",{onClick:()=>A(!0),className:"rounded-lg bg-purple-500 px-3 py-1.5 text-sm font-semibold text-white hover:bg-purple-400",title:"Dela runda",children:"\ud83d\udce4 Dela"})}),(0,bi.jsx)("div",{className:"h-16"}),(0,bi.jsxs)("main",{className:"flex-1 relative overflow-hidden",children:[(0,bi.jsx)(ac,{checkpoints:s.checkpoints||[],userPosition:h,activeOrder:O,answeredCount:K,route:s.route,startPoint:s.startPoint,manualMode:!d,onCheckpointClick:()=>{b(!0)}}),q&&(0,bi.jsx)("div",{className:"absolute inset-x-4 bottom-4 z-30",children:(0,bi.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),null===p||!q)return;const{correct:t}=await l({questionId:q.id,answerIndex:p});g(t?"R\xe4tt svar!":"Tyv\xe4rr fel svar."),f(null),setTimeout(()=>{g(null)},2e3),L&&setTimeout(()=>{b(!1)},2e3)},className:"bg-slate-900/95 backdrop-blur-sm rounded-xl border border-cyan-400/40 p-4 shadow-xl",children:[(0,bi.jsxs)("div",{className:"mb-3",children:[(0,bi.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,bi.jsx)("h2",{className:"text-lg font-semibold text-white flex-1",children:q.text}),(0,bi.jsxs)("div",{className:"ml-3 flex items-center gap-2",children:[q.category&&(0,bi.jsx)("span",{className:"inline-flex items-center rounded-full bg-purple-500/20 px-2.5 py-0.5 text-xs font-medium text-purple-200",children:q.category}),(0,bi.jsx)("span",{className:"inline-flex items-center rounded-full bg-cyan-500/20 px-2.5 py-0.5 text-xs font-medium text-cyan-200",children:I.toUpperCase()})]})]}),(0,bi.jsx)("button",{type:"button",onClick:()=>{C({id:q.id,text:q.text}),j(!0)},className:"text-xs text-yellow-400 hover:text-yellow-300 underline",children:"\u26a0\ufe0f Rapportera problem med fr\xe5gan"})]}),(0,bi.jsx)("div",{className:"space-y-2 mb-4",children:q.options.map((e,t)=>(0,bi.jsxs)("label",{className:"flex cursor-pointer items-center gap-3 rounded-lg border px-3 py-2 transition ".concat(p===t?"border-cyan-400 bg-cyan-500/20":"border-slate-600 bg-slate-800/40 hover:border-cyan-500/60"),children:[(0,bi.jsx)("input",{type:"radio",name:"answer",value:t,checked:p===t,onChange:()=>f(t),className:"text-cyan-500"}),(0,bi.jsx)("span",{className:"text-white text-sm",children:e})]},e))}),(0,bi.jsx)("button",{type:"submit",disabled:null===p,className:"w-full rounded-lg bg-cyan-500 px-4 py-2 font-semibold text-black hover:bg-cyan-400 disabled:cursor-not-allowed disabled:bg-slate-700 disabled:text-gray-400",children:"L\xe4mna svar"}),m&&(0,bi.jsx)("div",{className:"rounded-lg px-3 py-2 text-sm mt-3 ".concat(m.includes("R\xe4tt")?"bg-emerald-900/60 text-emerald-100 border border-emerald-500/40":"bg-amber-900/60 text-amber-100 border border-amber-500/40"),children:m})]})}),H&&(0,bi.jsx)("div",{className:"absolute inset-x-4 top-4 z-30",children:(0,bi.jsx)("div",{className:"backdrop-blur-sm rounded-xl border p-4 text-center shadow-xl ".concat(W?"bg-emerald-900/95 border-emerald-500/40":"bg-amber-900/95 border-amber-500/40"),children:W?(0,bi.jsxs)(bi.Fragment,{children:[(0,bi.jsx)("h2",{className:"text-lg font-semibold text-emerald-200 mb-2",children:"\ud83c\udf89 Runda avslutad!"}),(0,bi.jsx)("p",{className:"text-emerald-100 text-sm mb-3",children:"Du har svarat p\xe5 alla fr\xe5gor och \xe4r tillbaka vid startpunkten!"}),(0,bi.jsx)("button",{type:"button",onClick:G,className:"w-full rounded-lg bg-emerald-500 px-4 py-2 font-semibold text-black hover:bg-emerald-400",children:"Se resultat och st\xe4llning"})]}):(0,bi.jsxs)(bi.Fragment,{children:[(0,bi.jsx)("h2",{className:"text-lg font-semibold text-amber-200 mb-2",children:"\ud83d\udeb6 Alla fr\xe5gor besvarade!"}),(0,bi.jsx)("p",{className:"text-amber-100 text-sm mb-3",children:L?"Du har svarat p\xe5 alla fr\xe5gor. Klicka f\xf6r att se resultat.":"G\xe5 tillbaka till startpunkten for att avsluta rundan."}),L?(0,bi.jsx)("button",{type:"button",onClick:G,className:"w-full rounded-lg bg-amber-500 px-4 py-2 font-semibold text-black hover:bg-amber-400",children:"Se resultat och st\xe4llning"}):(0,bi.jsxs)("p",{className:"text-xs text-amber-200",children:["Avst\xe5nd till startpunkt: ",k?(Z=k,null==Z?"-":Z<1e3?"".concat(Z," m"):"".concat((Z/1e3).toFixed(1)," km")):"?"]})]})})})]}),S&&E&&(0,bi.jsx)(wc,{questionId:E.id,questionText:E.text,onClose:()=>{j(!1),C(null)},onReported:()=>{j(!1),C(null)}}),T&&(0,bi.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm p-4",onClick:()=>A(!1),children:(0,bi.jsxs)("div",{className:"bg-slate-900 rounded-2xl border border-cyan-500/40 p-6 max-w-md w-full shadow-2xl",onClick:e=>e.stopPropagation(),children:[(0,bi.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,bi.jsxs)("h2",{className:"text-xl font-bold text-white",children:["Dela ",s.name]}),(0,bi.jsx)("button",{onClick:()=>A(!1),className:"text-gray-400 hover:text-white text-2xl leading-none",children:"\xd7"})]}),(0,bi.jsxs)("div",{className:"space-y-4",children:[(0,bi.jsxs)("div",{className:"text-center",children:[(0,bi.jsx)("p",{className:"text-sm text-gray-300 mb-3",children:"Skanna QR-koden eller anv\xe4nd koden f\xf6r att bjuda in fler deltagare"}),(0,bi.jsx)("div",{className:"flex justify-center mb-4",children:(0,bi.jsx)(Al,{dataUrl:U,isLoading:B,error:V})})]}),(0,bi.jsxs)("div",{className:"bg-slate-800 rounded-lg p-4 border border-slate-600",children:[(0,bi.jsx)("p",{className:"text-xs text-gray-400 mb-1",children:"Anslutningskod:"}),(0,bi.jsx)("p",{className:"text-2xl font-mono font-bold text-cyan-400 tracking-widest text-center",children:s.joinCode})]}),(0,bi.jsxs)("div",{className:"flex gap-2",children:[(0,bi.jsx)("button",{onClick:()=>{navigator.clipboard.writeText(s.joinCode)},className:"flex-1 rounded-lg bg-purple-500 px-4 py-2 font-semibold text-white hover:bg-purple-400",children:"Kopiera kod"}),(0,bi.jsx)("button",{onClick:()=>{navigator.clipboard.writeText(z)},className:"flex-1 rounded-lg bg-cyan-500 px-4 py-2 font-semibold text-black hover:bg-cyan-400",children:"Kopiera l\xe4nk"})]}),(0,bi.jsx)("div",{className:"text-xs text-gray-400 text-center",children:(0,bi.jsx)("a",{href:z,target:"_blank",rel:"noopener noreferrer",className:"text-cyan-400 hover:underline break-all",children:z})})]})]})})]}):(0,bi.jsx)("div",{className:"mx-auto max-w-2xl px-4 py-8 text-center",children:(0,bi.jsx)("p",{className:"text-gray-300",children:"H\xe4mtar rundainformation\u2026"})});var Z},kc={active:{label:"Aktiv",dotClass:"bg-emerald-400",pillClass:"text-emerald-200 border border-emerald-500/40 bg-emerald-500/10"},inactive:{label:"Fr\xe5nkopplad",dotClass:"bg-amber-400",pillClass:"text-amber-200 border border-amber-500/40 bg-amber-500/10"},finished:{label:"Klar",dotClass:"bg-slate-400",pillClass:"text-slate-200 border border-slate-500/40 bg-slate-500/10"}},Nc=e=>kc[e]||kc.inactive,Sc=()=>{const{runId:e}=$(),n=X(),{currentRun:r,participants:i,loadRunById:s,refreshParticipants:a,closeRun:o,deleteRun:l}=aa(),[c,u]=(0,t.useState)(!1),[d,h]=(0,t.useState)(!1),[p,f]=(0,t.useState)("sv"),m=r?oc(r.joinCode):"",{dataUrl:g,isLoading:v,error:y}=uc(m,320);(0,t.useEffect)(()=>{r&&r.id===e||s(e).catch(e=>console.warn("Kunde inte ladda runda",e))},[r,s,e]),(0,t.useEffect)(()=>{const e=setInterval(()=>{a().catch(e=>console.warn("Kunde inte uppdatera deltagare",e))},5e3);return()=>clearInterval(e)},[a]);const x=(0,t.useMemo)(()=>r?r.questionIds.reduce((e,t)=>{const n=ys(t,p);return n&&(e[t]=n),e},{}):{},[r,p]);if(!r)return(0,bi.jsx)("div",{className:"mx-auto max-w-3xl px-4 py-8 text-center",children:(0,bi.jsx)("p",{className:"text-gray-300",children:"H\xe4mtar rundainformation..."})});const b=[...i].sort((e,t)=>t.score-e.score);return(0,bi.jsxs)("div",{className:"min-h-screen bg-slate-950 text-white",children:[c&&(0,bi.jsx)(hc,{dataUrl:g,onClose:()=>u(!1)}),d&&(0,bi.jsx)(pc,{checkpoints:r.checkpoints,route:r.route,onClose:()=>h(!1)}),(0,bi.jsx)("header",{className:"bg-slate-900 border-b border-slate-800 px-4 py-3 sticky top-0 z-40",children:(0,bi.jsxs)("div",{className:"flex items-center justify-between",children:[(0,bi.jsx)("h1",{className:"text-lg font-bold truncate",children:r.name}),(0,bi.jsx)("button",{onClick:()=>n("/"),className:"rounded bg-slate-700 px-3 py-2 text-sm font-semibold hover:bg-slate-600",children:"Tillbaka"})]})}),(0,bi.jsxs)("div",{className:"px-4 py-6 space-y-6",children:[(0,bi.jsxs)("div",{className:"rounded-lg border border-cyan-500/40 bg-slate-900/60 p-6 text-center",children:[(0,bi.jsx)("h2",{className:"text-lg font-semibold mb-4 text-cyan-200",children:"Bjud in deltagare"}),(0,bi.jsx)("div",{className:"flex justify-center cursor-pointer",onClick:()=>u(!0),children:(0,bi.jsx)(Al,{dataUrl:g,isLoading:v,error:y})}),(0,bi.jsxs)("div",{className:"mt-4",children:[(0,bi.jsx)("p",{className:"text-sm text-gray-300 mb-2",children:"Anslutningskod:"}),(0,bi.jsx)("div",{className:"text-2xl font-mono font-bold text-white bg-slate-800 rounded-lg py-2 px-4",children:r.joinCode})]}),(0,bi.jsx)("div",{className:"mt-4 text-center",children:(0,bi.jsx)("a",{href:m,target:"_blank",rel:"noopener noreferrer",className:"text-purple-300 hover:underline break-all",children:m})})]}),(0,bi.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,bi.jsx)("button",{onClick:()=>n("/run/".concat(e,"/results")),className:"rounded-lg bg-emerald-500 px-4 py-3 font-semibold text-black hover:bg-emerald-400",children:"Se resultat"}),(0,bi.jsx)("button",{onClick:()=>h(!0),className:"rounded-lg bg-blue-500 px-4 py-3 font-semibold text-black hover:bg-blue-400",children:"Visa karta"}),(0,bi.jsx)("button",{onClick:async()=>{window.confirm("\xc4r du s\xe4ker p\xe5 att du vill avsluta spelet? Nya spelare kommer inte kunna ansluta.")&&await o()},className:"rounded-lg bg-orange-600 px-4 py-3 font-semibold text-white hover:bg-orange-500",children:"Avsluta spel"})]}),(0,bi.jsxs)("div",{className:"rounded-lg border border-slate-600 bg-slate-900/60 p-4",children:[(0,bi.jsxs)("h2",{className:"text-lg font-semibold mb-4 text-cyan-200",children:["Live Leaderboard (",i.length,")"]}),0===i.length?(0,bi.jsx)("div",{className:"text-center py-8",children:(0,bi.jsx)("p",{className:"text-gray-400",children:"V\xe4ntar p\xe5 att spelare ska ansluta..."})}):(0,bi.jsx)("div",{className:"space-y-3",children:b.map((e,t)=>{const n=Nc(e.status);return(0,bi.jsx)("div",{className:"rounded-lg border border-slate-700 bg-slate-800/40 p-4",children:(0,bi.jsxs)("div",{className:"flex items-center justify-between",children:[(0,bi.jsxs)("div",{className:"flex items-center gap-3",children:[(0,bi.jsxs)("span",{className:"text-xl",children:[t+1,"."]}),(0,bi.jsx)("p",{className:"font-semibold",children:e.alias})]}),(0,bi.jsxs)("div",{className:"text-right",children:[(0,bi.jsxs)("p",{className:"text-lg font-bold text-cyan-300",children:[e.score," po\xe4ng"]}),(0,bi.jsxs)("span",{className:"inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-xs font-medium ".concat(n.pillClass),children:[(0,bi.jsx)("span",{className:"h-1.5 w-1.5 rounded-full ".concat(n.dotClass)}),n.label]})]})]})},e.id)})})]}),(0,bi.jsxs)("div",{className:"rounded-lg border border-slate-600 bg-slate-900/60 p-4",children:[(0,bi.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,bi.jsxs)("h2",{className:"text-lg font-semibold text-cyan-200",children:["Fr\xe5gor (",r.questionIds.length,")"]}),(0,bi.jsxs)("div",{className:"flex gap-1 rounded-lg bg-slate-800 p-1",children:[(0,bi.jsx)("button",{type:"button",onClick:()=>f("sv"),className:"rounded-md px-3 py-1.5 text-sm font-semibold transition ".concat("sv"===p?"bg-cyan-500 text-black":"text-gray-300 hover:text-white"),children:"\ud83c\uddf8\ud83c\uddea SV"}),(0,bi.jsx)("button",{type:"button",onClick:()=>f("en"),className:"rounded-md px-3 py-1.5 text-sm font-semibold transition ".concat("en"===p?"bg-cyan-500 text-black":"text-gray-300 hover:text-white"),children:"\ud83c\uddec\ud83c\udde7 EN"})]})]}),(0,bi.jsx)("div",{className:"space-y-3",children:r.questionIds.map((e,t)=>{const n=x[e];return(0,bi.jsxs)("div",{className:"border border-slate-700 bg-slate-800/40 rounded-lg p-3",children:[(0,bi.jsxs)("p",{className:"text-sm font-semibold text-cyan-300",children:["Fr\xe5ga #",t+1]}),(0,bi.jsx)("p",{className:"text-sm text-gray-300",children:n?n.text:"Laddar fr\xe5ga..."})]},e)})})]}),(0,bi.jsx)("div",{className:"text-center mt-4",children:(0,bi.jsx)("button",{onClick:async()=>{window.confirm("\xc4r du s\xe4ker p\xe5 att du vill radera denna runda permanent? Detta g\xe5r inte att \xe5ngra.")&&(await l(),n("/"))},className:"text-red-500 hover:underline",children:"Radera runda"})})]})]})},jc=()=>{const{runId:e}=$(),n=X(),{currentRun:r,participants:i,currentParticipant:s,loadRunById:a,refreshParticipants:o}=aa(),{currentUser:l,isAuthenticated:c}=Ci(),[u,d]=(0,t.useState)(!1),[h,p]=(0,t.useState)(!1),[f,m]=(0,t.useState)(""),[g]=(0,t.useState)(()=>"undefined"!==typeof window&&localStorage.getItem("geoquest:language")||"sv");(0,t.useEffect)(()=>{r&&r.id===e||a(e).catch(e=>console.warn("Kunde inte ladda runda",e))},[r,a,e]),(0,t.useEffect)(()=>{o().catch(e=>console.warn("Kunde inte uppdatera deltagare",e))},[o]);const v=(0,t.useMemo)(()=>[...i].sort((e,t)=>t.score!==e.score?t.score-e.score:(e.completedAt||"").localeCompare(t.completedAt||"")),[i]),y=(0,t.useMemo)(()=>s&&null!==r&&void 0!==r&&r.questionIds?r.questionIds.map((e,t)=>{var n;let r=ys(e,g);r||(r=ys(e,"sv")),r||(r=vs(e)),r||(console.warn("[RunResultsPage] Fr\xe5ga med ID ".concat(e," hittades inte")),r={id:e,text:"Fr\xe5ga ".concat(e," kunde inte laddas"),options:["Kunde inte ladda alternativ"],correctOption:0,explanation:"Denna fr\xe5ga kunde inte laddas fr\xe5n databasen."});const i=null===(n=s.answers)||void 0===n?void 0:n.find(t=>t.questionId===e),a=(null===i||void 0===i?void 0:i.correct)||!1,o=null===i||void 0===i?void 0:i.answerIndex;return{questionNumber:t+1,question:r.text,options:r.options,correctOption:r.correctOption,userSelectedOption:o,isCorrect:a,explanation:r.explanation}}):[],[s,r,g]),x=r&&l&&(r.createdBy===l.id||r.createdByName===l.name);return r?(0,bi.jsxs)("div",{className:"min-h-screen bg-slate-950",children:[(0,bi.jsx)(Sl,{title:"Resultat - ".concat(r.name)}),(0,bi.jsxs)("div",{className:"mx-auto max-w-4xl px-4 pt-24 pb-8 space-y-6",children:[(0,bi.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6",children:[(0,bi.jsx)("div",{children:(0,bi.jsxs)("p",{className:"text-gray-400",children:["Status: ",r.status]})}),(0,bi.jsx)("div",{className:"flex flex-col sm:flex-row gap-2",children:s&&(0,bi.jsxs)("button",{type:"button",onClick:()=>d(!u),className:"rounded-lg bg-slate-700 px-3 py-1.5 text-sm font-semibold text-gray-200 hover:bg-slate-600",children:[u?"D\xf6lj":"Visa"," mina svar"]})})]}),f&&(0,bi.jsx)("div",{className:"rounded-2xl border border-emerald-500/40 bg-emerald-900/30 px-4 py-3 text-emerald-100",children:f}),(0,bi.jsxs)("section",{className:"rounded border border-emerald-500/40 bg-emerald-900/20 p-6",children:[(0,bi.jsx)("h2",{className:"text-xl font-semibold mb-3 text-emerald-200",children:"Ledartavla"}),(0,bi.jsxs)("ol",{className:"space-y-2",children:[0===v.length&&(0,bi.jsx)("li",{className:"text-gray-300",children:"Inga svar registrerade \xe4nnu."}),v.map((e,t)=>{const n=Nc(e.status);return(0,bi.jsxs)("li",{className:"flex items-center justify-between rounded bg-emerald-900/40 px-3 py-2",children:[(0,bi.jsxs)("div",{className:"flex items-center gap-2",children:[(0,bi.jsx)("span",{className:"h-2 w-2 rounded-full ".concat(n.dotClass)}),(0,bi.jsxs)("span",{children:["#",t+1," ",e.alias,e.isAnonymous?" (anonym)":""]})]}),(0,bi.jsxs)("div",{className:"flex items-center gap-2",children:[(0,bi.jsxs)("span",{className:"font-semibold",children:[e.score," po\xe4ng"]}),(0,bi.jsx)("span",{className:"inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-xs font-semibold ".concat(n.pillClass),children:n.label})]})]},e.id)})]})]}),u&&s&&y.length>0&&(0,bi.jsxs)("section",{className:"rounded border border-cyan-500/40 bg-cyan-900/10 p-6",children:[(0,bi.jsxs)("h2",{className:"text-xl font-semibold mb-3 text-cyan-200",children:["Dina detaljerade resultat (",s.score,"/",y.length," r\xe4tt)"]}),(0,bi.jsx)("div",{className:"space-y-4",children:y.map(e=>(0,bi.jsxs)("div",{className:"rounded-lg border p-4 ".concat(e.isCorrect?"border-emerald-500/40 bg-emerald-900/20":"border-red-500/40 bg-red-900/20"),children:[(0,bi.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,bi.jsxs)("h3",{className:"font-semibold text-white",children:["Fr\xe5ga ",e.questionNumber,": ",e.question]}),(0,bi.jsx)("span",{className:"inline-flex items-center rounded-full px-2 py-1 text-xs font-semibold ".concat(e.isCorrect?"bg-emerald-500/20 text-emerald-200":"bg-red-500/20 text-red-200"),children:e.isCorrect?"\u2713 R\xe4tt":"\u2717 Fel"})]}),(0,bi.jsx)("div",{className:"space-y-2 mb-3",children:e.options.map((t,n)=>{const r=n===e.correctOption,i=n===e.userSelectedOption;return(0,bi.jsxs)("div",{className:"rounded px-3 py-2 text-sm ".concat(r&&i?"bg-emerald-500/30 border border-emerald-500/50 text-emerald-100":i&&!r?"bg-red-500/30 border border-red-500/50 text-red-100":r?"bg-emerald-500/20 border border-emerald-500/30 text-emerald-200":"bg-slate-800/50 border border-slate-600 text-gray-300"),children:[t,i&&(0,bi.jsx)("span",{className:"ml-2 text-xs",children:"\u2190 Ditt svar"}),r&&(0,bi.jsx)("span",{className:"ml-2 text-xs",children:"\u2190 R\xe4tt svar"})]},n)})}),e.explanation&&(0,bi.jsxs)("div",{className:"bg-slate-800/50 rounded-lg p-3 text-sm text-gray-300",children:[(0,bi.jsx)("span",{className:"font-semibold text-cyan-200",children:"F\xf6rklaring: "}),e.explanation]})]},e.questionNumber))})]}),(0,bi.jsxs)("section",{className:"rounded border border-slate-600 bg-slate-900/60 p-6",children:[(0,bi.jsx)("h2",{className:"text-xl font-semibold mb-3",children:"Detaljer"}),(0,bi.jsx)("div",{className:"overflow-x-auto",children:(0,bi.jsxs)("table",{className:"min-w-full divide-y divide-slate-800 text-sm",children:[(0,bi.jsx)("thead",{className:"bg-slate-800/70",children:(0,bi.jsxs)("tr",{children:[(0,bi.jsx)("th",{className:"px-3 py-2 text-left",children:"Deltagare"}),(0,bi.jsx)("th",{className:"px-3 py-2 text-left",children:"R\xe4tt svar"}),(0,bi.jsx)("th",{className:"px-3 py-2 text-left",children:"Tidsst\xe4mpel"})]})}),(0,bi.jsx)("tbody",{className:"divide-y divide-slate-800",children:v.map(e=>(0,bi.jsxs)("tr",{children:[(0,bi.jsx)("td",{className:"px-3 py-2",children:e.alias}),(0,bi.jsxs)("td",{className:"px-3 py-2",children:[e.score," / ",r.questionCount]}),(0,bi.jsx)("td",{className:"px-3 py-2 text-gray-400",children:e.completedAt?new Date(e.completedAt).toLocaleString():"P\xe5g\xe5ende"})]},e.id))})]})})]}),(0,bi.jsxs)("div",{className:"flex flex-wrap gap-3",children:[s&&(0,bi.jsx)("button",{type:"button",onClick:()=>n("/run/".concat(r.id,"/play")),className:"rounded bg-cyan-500 px-4 py-2 font-semibold text-black hover:bg-cyan-400",children:"Tillbaka till rundan"}),x&&(0,bi.jsx)("button",{type:"button",onClick:()=>n("/run/".concat(r.id,"/admin")),className:"rounded bg-indigo-600 px-4 py-2 font-semibold text-white hover:bg-indigo-700",children:"Administrera"}),c&&(0,bi.jsx)("button",{type:"button",onClick:()=>n("/my-runs"),className:"rounded bg-purple-600 px-4 py-2 font-semibold text-white hover:bg-purple-700",children:"Mina rundor"}),(0,bi.jsx)("button",{type:"button",onClick:()=>{m(""),p(!0)},disabled:h,className:"rounded bg-emerald-600 px-4 py-2 font-semibold text-white transition-colors hover:bg-emerald-500 disabled:opacity-60",children:"St\xf6d RouteQuest (20 kr)"}),(0,bi.jsx)("button",{type:"button",onClick:()=>n("/"),className:"rounded bg-slate-700 px-4 py-2 font-semibold text-gray-200 hover:bg-slate-600",children:"Startsidan"})]}),(0,bi.jsx)(ml,{isOpen:h,runName:(null===r||void 0===r?void 0:r.name)||"",amount:2e3,onSuccess:e=>{p(!1),m("Tack f\xf6r ditt st\xf6d! Donationen registrerades."),null!==e&&void 0!==e&&e.paymentIntentId&&r&&no(2e3,e.paymentIntentId,{runId:r.id,context:"results"})},onCancel:()=>{p(!1)},runId:null===r||void 0===r?void 0:r.id,participantId:null===s||void 0===s?void 0:s.id,allowSkip:!1})]})]}):(0,bi.jsxs)("div",{className:"min-h-screen bg-slate-950",children:[(0,bi.jsx)(Sl,{title:"Resultat"}),(0,bi.jsx)("div",{className:"mx-auto max-w-2xl px-4 pt-24 text-center",children:(0,bi.jsx)("p",{className:"text-gray-300",children:"H\xe4mtar resultat..."})})]})},Ec=e=>{let{currentPage:t,totalItems:n,itemsPerPage:r,onPageChange:i}=e;const s=Math.ceil(n/r);if(s<=1)return null;const a=e=>{e>=1&&e<=s&&i(e)};return(0,bi.jsxs)("div",{className:"flex items-center justify-center gap-2 mt-8",children:[(0,bi.jsx)("button",{onClick:()=>a(t-1),disabled:1===t,className:"px-3 py-1 rounded-md text-sm font-medium bg-slate-700 text-gray-300 hover:bg-slate-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"F\xf6reg\xe5ende"}),(()=>{const e=[];for(let n=1;n<=s;n++)e.push((0,bi.jsx)("button",{onClick:()=>a(n),className:"px-3 py-1 rounded-md text-sm font-medium ".concat(t===n?"bg-cyan-500 text-black":"bg-slate-700 text-gray-300 hover:bg-slate-600"),children:n},n));return e})(),(0,bi.jsx)("button",{onClick:()=>a(t+1),disabled:t===s,className:"px-3 py-1 rounded-md text-sm font-medium bg-slate-700 text-gray-300 hover:bg-slate-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"N\xe4sta"})]})},Cc=()=>{const e=X(),{currentUser:n,isAuthenticated:r}=Ci(),[i,s]=(0,t.useState)([]),[a,o]=(0,t.useState)(!0),[l,c]=(0,t.useState)(new Set),[u,d]=(0,t.useState)(1),[h,p]=(0,t.useState)(25),[f,m]=(0,t.useState)({isOpen:!1,title:"",message:"",type:"info"});(0,t.useEffect)(()=>{(async()=>{o(!0);try{let e=[];if(r&&n){const t=await ea.listRuns();e=t.filter(e=>e.createdBy===n.id||e.createdByName===n.name)}else{const t=Fa(),n=t.map(e=>e.runId);if(n.length>0&&(e=await ea.listRunsByIds(n),e.length<n.length)){console.warn("[MyRunsPage] Varning: Hittade bara",e.length,"av",n.length,"rundor i Firestore");const r=n.filter(t=>!e.some(e=>e.id===t));if(console.warn("[MyRunsPage] Saknade rundor:",r),r.length>0){const e=t.filter(e=>!r.includes(e.runId));localStorage.setItem("geoquest:local:createdRuns",JSON.stringify(e))}}}const t=e.sort((e,t)=>new Date(t.createdAt)-new Date(e.createdAt));s(t)}catch(e){console.error("Kunde inte ladda rundor:",e)}finally{o(!1)}})()},[n,r]);const g=e=>{if(!e)return"Ok\xe4nt datum";try{return new Date(e).toLocaleDateString("sv-SE",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return"Ok\xe4nt datum"}},v=e=>{switch(e){case"hosted":return"Administrerad";case"generated":return"Auto-genererad";default:return e||"Ok\xe4nd"}},y=e=>{switch(e){case"active":return"Aktiv";case"completed":return"Avslutad";case"draft":return"Utkast";default:return e||"Ok\xe4nd"}},x=e=>{switch(e){case"active":return"text-green-400";case"completed":default:return"text-gray-400";case"draft":return"text-yellow-400"}},b=Math.ceil(i.length/h),w=(u-1)*h,_=w+h,k=i.slice(w,_);return a?(0,bi.jsxs)("div",{className:"min-h-screen bg-slate-950",children:[(0,bi.jsx)(Sl,{title:"Mina rundor"}),(0,bi.jsx)("div",{className:"max-w-4xl mx-auto text-center pt-24 px-4",children:(0,bi.jsx)("div",{className:"text-lg text-gray-100",children:"Laddar dina rundor..."})})]}):(0,bi.jsxs)("div",{className:"min-h-screen bg-slate-950",children:[(0,bi.jsx)(Sl,{title:"Mina rundor"}),(0,bi.jsx)("div",{className:"max-w-6xl mx-auto pt-24 px-4 pb-8",children:0===i.length?(0,bi.jsxs)("div",{className:"text-center py-12",children:[(0,bi.jsx)("div",{className:"text-gray-300 text-lg mb-4",children:"Du har inte skapat n\xe5gra rundor \xe4n"}),(0,bi.jsx)("button",{onClick:()=>e("/generate"),className:"bg-green-600 hover:bg-green-700 px-6 py-3 rounded font-medium text-white",children:"Generera din f\xf6rsta runda"})]}):(0,bi.jsxs)(bi.Fragment,{children:[(0,bi.jsx)("div",{className:"mb-6 flex flex-wrap items-center justify-between gap-4",children:(0,bi.jsxs)("div",{className:"flex gap-3",children:[(0,bi.jsx)("button",{onClick:()=>e("/generate"),className:"bg-green-600 hover:bg-green-700 px-4 py-2 rounded font-medium text-white",children:"Generera runda"}),(0,bi.jsx)("button",{onClick:()=>{l.size===i.length?c(new Set):c(new Set(i.map(e=>e.id)))},className:"bg-slate-700 hover:bg-slate-600 px-4 py-2 rounded font-medium text-white",children:l.size===i.length?"Avmarkera alla":"Markera alla"}),l.size>0&&(0,bi.jsxs)("button",{onClick:async()=>{if(0!==l.size&&window.confirm("\xc4r du s\xe4ker p\xe5 att du vill radera ".concat(l.size," runda(r)?")))try{if(r){const e=Array.from(l).map(e=>ea.deleteRun(e));await Promise.all(e)}const e=Fa().filter(e=>!l.has(e.runId));localStorage.setItem("geoquest:local:createdRuns",JSON.stringify(e)),s(e=>e.filter(e=>!l.has(e.id))),c(new Set)}catch(e){console.error("Kunde inte radera rundor:",e),m({isOpen:!0,title:"Kunde inte radera rundor",message:"Kunde inte radera alla rundor. Se konsolen f\xf6r detaljer.",type:"error"})}},className:"bg-red-500 hover:bg-red-400 px-4 py-2 rounded font-medium text-white",children:["Radera markerade (",l.size,")"]})]})}),(0,bi.jsx)(Ec,{currentPage:u,totalPages:b,onPageChange:d,itemsPerPage:h,totalItems:i.length,onItemsPerPageChange:p}),(0,bi.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:k.map(t=>{var n;return(0,bi.jsxs)("div",{className:"bg-slate-800 border rounded-lg p-6 hover:bg-slate-750 transition-colors ".concat(l.has(t.id)?"border-cyan-500":"border-slate-600"),children:[(0,bi.jsxs)("div",{className:"flex items-start gap-3 mb-3",children:[(0,bi.jsx)("input",{type:"checkbox",checked:l.has(t.id),onChange:()=>{return e=t.id,void c(t=>{const n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n});var e},className:"mt-1 w-5 h-5 rounded"}),(0,bi.jsx)("div",{className:"flex-1 min-w-0",children:(0,bi.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,bi.jsx)("h3",{className:"text-lg font-semibold text-white truncate",children:t.name||"Namnl\xf6s runda"}),(0,bi.jsx)("span",{className:"text-sm font-medium ".concat(x(t.status)),children:y(t.status)})]})})]}),(0,bi.jsxs)("div",{className:"text-sm text-gray-300 space-y-2 mb-4",children:[(0,bi.jsxs)("div",{className:"flex justify-between",children:[(0,bi.jsx)("span",{children:"Typ:"}),(0,bi.jsx)("span",{children:v(t.type)})]}),(0,bi.jsxs)("div",{className:"flex justify-between",children:[(0,bi.jsx)("span",{children:"Skapad:"}),(0,bi.jsx)("span",{children:g(t.createdAt)})]}),(0,bi.jsxs)("div",{className:"flex justify-between",children:[(0,bi.jsx)("span",{children:"Fr\xe5gor:"}),(0,bi.jsx)("span",{children:t.questionCount||(null===(n=t.checkpoints)||void 0===n?void 0:n.length)||0})]}),(0,bi.jsxs)("div",{className:"flex justify-between",children:[(0,bi.jsx)("span",{children:"L\xe4ngd:"}),(0,bi.jsx)("span",{children:t.lengthMeters?"".concat(Math.round(t.lengthMeters/1e3)," km"):"Ok\xe4nd"})]}),(0,bi.jsxs)("div",{className:"flex justify-between",children:[(0,bi.jsx)("span",{children:"Kod:"}),(0,bi.jsx)("span",{className:"font-mono text-purple-300",children:t.joinCode||"Ingen"})]})]}),t.description&&(0,bi.jsx)("p",{className:"text-sm text-gray-400 mb-4 line-clamp-2",children:t.description}),(0,bi.jsxs)("div",{className:"flex gap-2",children:[(0,bi.jsx)("button",{onClick:()=>e("/run/".concat(t.id,"/admin")),className:"flex-1 bg-indigo-600 hover:bg-indigo-700 px-3 py-2 rounded text-sm font-medium",children:"Administrera"}),(0,bi.jsx)("button",{onClick:()=>e("/run/".concat(t.id,"/results")),className:"flex-1 bg-slate-600 hover:bg-slate-700 px-3 py-2 rounded text-sm font-medium",children:"Resultat"}),(0,bi.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("\xc4r du s\xe4ker p\xe5 att du vill radera denna runda?"))try{r&&await ea.deleteRun(e);const t=Fa().filter(t=>t.runId!==e);localStorage.setItem("geoquest:local:createdRuns",JSON.stringify(t)),s(t=>t.filter(t=>t.id!==e))}catch(t){console.error("Kunde inte radera runda:",t),m({isOpen:!0,title:"Kunde inte radera runda",message:"Kunde inte radera rundan. Se konsolen f\xf6r detaljer.",type:"error"})}})(t.id),className:"bg-red-500 hover:bg-red-400 px-3 py-2 rounded text-sm font-medium",title:"Radera runda",children:"\ud83d\uddd1\ufe0f"})]})]},t.id)})}),(0,bi.jsx)(Ec,{currentPage:u,totalPages:b,onPageChange:d,itemsPerPage:h,totalItems:i.length,onItemsPerPageChange:p})]})}),(0,bi.jsx)(oa,{isOpen:f.isOpen,onClose:()=>m((0,Ti.A)((0,Ti.A)({},f),{},{isOpen:!1})),title:f.title,message:f.message,type:f.type})]})},Tc=(e,t)=>{if(!e)return console.error("subscribeToTask called with no taskId."),()=>{};const n=(0,si.H9)(gi,"backgroundTasks",e);return(0,si.aQ)(n,n=>{n.exists()?t((0,Ti.A)({id:n.id},n.data())):(console.warn("Task with ID ".concat(e," not found.")),t(null))},t=>{console.error("Error listening to task ".concat(e,":"),t)})},Ac=e=>e?new Promise((t,n)=>{const r=Tc(e,e=>{if(e)if("completed"===e.status)r(),t(e);else if("failed"===e.status||"cancelled"===e.status){const t=e.error||"Background task failed";r(),n(new Error(t))}})}):Promise.reject(new Error("No taskId provided")),Ic=()=>{const[e,n]=(0,t.useState)([]),[r,i]=(0,t.useState)(!1),[s,a]=(0,t.useState)(85),[o,l]=(0,t.useState)(new Set),[c,u]=(0,t.useState)({isOpen:!1,title:"",message:"",type:"info"}),d=()=>{i(!0);try{const e=Ns("sv",s/100),t=[],r=new Set;for(const n of e){const e=n.pairId||[n.question1.id,n.question2.id].sort().join("-");r.has(e)?console.warn("[DuplicateQuestionsPanel] Skippar dublett av dublett:",e):(r.add(e),t.push(n))}n(t)}catch(e){console.error("Fel vid dubletts\xf6kning:",e)}finally{i(!1)}},h=async e=>{if(window.confirm("\xc4r du s\xe4ker p\xe5 att du vill ta bort denna fr\xe5ga?"))try{await ws(e),l(t=>new Set([...t,e])),setTimeout(d,500)}catch(t){u({isOpen:!0,title:"Kunde inte ta bort fr\xe5ga",message:t.message,type:"error"})}},p=e.filter(e=>!o.has(e.question1.id)&&!o.has(e.question2.id));return(0,bi.jsxs)("div",{className:"bg-slate-800 rounded-lg p-6 border border-slate-700",children:[(0,bi.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,bi.jsxs)("div",{children:[(0,bi.jsx)("h2",{className:"text-xl font-bold text-white",children:"Dubblettfr\xe5gor"}),(0,bi.jsx)("p",{className:"text-sm text-gray-400 mt-1",children:"S\xf6k efter liknande fr\xe5gor i databasen"})]}),(0,bi.jsxs)("div",{className:"flex gap-2",children:[(0,bi.jsx)("button",{onClick:d,disabled:r,className:"px-4 py-2 bg-cyan-500 text-black rounded-lg font-semibold hover:bg-cyan-400 disabled:bg-slate-600 disabled:text-gray-400",children:r?"S\xf6ker...":"\ud83d\udd0d S\xf6k dubletter"}),p.length>0&&(0,bi.jsxs)("button",{onClick:async()=>{const e="Detta kommer att automatiskt ta bort ".concat(p.length," dublettfr\xe5gor.\n\n")+"F\xf6r varje par beh\xe5lls den f\xf6rsta fr\xe5gan och den andra tas bort.\n\n\xc4r du s\xe4ker p\xe5 att du vill forts\xe4tta?";if(!window.confirm(e))return;i(!0);let t=0;const n=[];try{for(const i of p)try{await ws(i.question2.id),t++,l(e=>new Set([...e,i.question2.id]))}catch(r){console.error("[AutoClean] Fel vid borttagning av ".concat(i.question2.id,":"),r),n.push("".concat(i.question2.id,": ").concat(r.message))}const e="Automatisk dublettrensning klar!\n\n"+"Borttagna fr\xe5gor: ".concat(t,"\n")+(n.length>0?"Fel: ".concat(n.length,"\n\n").concat(n.join("\n")):"");u({isOpen:!0,title:"Dublettrensning klar",message:e,type:n.length>0?"warning":"success"}),setTimeout(d,1e3)}catch(r){u({isOpen:!0,title:"Fel vid rensning",message:r.message,type:"error"})}finally{i(!1)}},disabled:r,className:"px-4 py-2 bg-red-500 text-white rounded-lg font-semibold hover:bg-red-400 disabled:bg-slate-600 disabled:text-gray-400",children:["\ud83e\uddf9 Auto-rensa (",p.length,")"]})]})]}),(0,bi.jsxs)("div",{className:"mb-6",children:[(0,bi.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Likhetstr\xf6sk: ",s,"%"]}),(0,bi.jsx)("input",{type:"range",min:"70",max:"100",value:s,onChange:e=>a(Number(e.target.value)),className:"w-full"}),(0,bi.jsxs)("div",{className:"flex justify-between text-xs text-gray-400 mt-1",children:[(0,bi.jsx)("span",{children:"70% - M\xe5nga tr\xe4ffar"}),(0,bi.jsx)("span",{children:"100% - Endast identiska"})]})]}),0===p.length&&!r&&(0,bi.jsx)("div",{className:"text-center py-8 text-gray-400",children:0===e.length?'Klicka p\xe5 "S\xf6k dubletter" f\xf6r att b\xf6rja':"\u2705 Inga dubletter hittades!"}),p.length>0&&(0,bi.jsxs)("div",{className:"space-y-4",children:[(0,bi.jsxs)("div",{className:"text-sm text-gray-300 mb-4",children:["Hittade ",p.length," potentiella dubletter"]}),p.map((e,t)=>{var n,r;return(0,bi.jsxs)("div",{className:"bg-slate-900 rounded-lg p-4 border border-amber-500/30",children:[(0,bi.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,bi.jsxs)("span",{className:"text-xs font-bold text-amber-400",children:[e.similarity,"% likhet"]}),(0,bi.jsxs)("span",{className:"text-xs text-gray-500",children:["Dublett #",t+1]})]}),(0,bi.jsx)("div",{className:"mb-3 pb-3 border-b border-slate-700",children:(0,bi.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,bi.jsxs)("div",{className:"flex-1",children:[(0,bi.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,bi.jsx)("div",{className:"text-xs text-gray-400",children:"Fr\xe5ga 1:"}),(0,bi.jsx)("code",{className:"text-xs px-1.5 py-0.5 bg-slate-800 text-cyan-400 rounded font-mono",children:e.question1.id})]}),(0,bi.jsx)("div",{className:"text-sm text-white",children:e.text1}),(0,bi.jsxs)("div",{className:"mt-1 flex gap-2 flex-wrap",children:[(0,bi.jsx)("span",{className:"text-xs px-2 py-0.5 bg-purple-500/20 text-purple-300 rounded",children:e.question1.difficulty}),(0,bi.jsx)("span",{className:"text-xs px-2 py-0.5 bg-blue-500/20 text-blue-300 rounded",children:e.question1.audience}),(0,bi.jsx)("span",{className:"text-xs text-gray-500",children:null===(n=e.question1.categories)||void 0===n?void 0:n.join(", ")})]})]}),(0,bi.jsx)("button",{onClick:()=>h(e.question1.id),className:"ml-4 px-3 py-1 bg-red-500/20 text-red-300 rounded text-xs hover:bg-red-500/30 flex-shrink-0",children:"Ta bort"})]})}),(0,bi.jsx)("div",{children:(0,bi.jsxs)("div",{className:"flex items-start justify-between",children:[(0,bi.jsxs)("div",{className:"flex-1",children:[(0,bi.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,bi.jsx)("div",{className:"text-xs text-gray-400",children:"Fr\xe5ga 2:"}),(0,bi.jsx)("code",{className:"text-xs px-1.5 py-0.5 bg-slate-800 text-cyan-400 rounded font-mono",children:e.question2.id})]}),(0,bi.jsx)("div",{className:"text-sm text-white",children:e.text2}),(0,bi.jsxs)("div",{className:"mt-1 flex gap-2 flex-wrap",children:[(0,bi.jsx)("span",{className:"text-xs px-2 py-0.5 bg-purple-500/20 text-purple-300 rounded",children:e.question2.difficulty}),(0,bi.jsx)("span",{className:"text-xs px-2 py-0.5 bg-blue-500/20 text-blue-300 rounded",children:e.question2.audience}),(0,bi.jsx)("span",{className:"text-xs text-gray-500",children:null===(r=e.question2.categories)||void 0===r?void 0:r.join(", ")})]})]}),(0,bi.jsx)("button",{onClick:()=>h(e.question2.id),className:"ml-4 px-3 py-1 bg-red-500/20 text-red-300 rounded text-xs hover:bg-red-500/30 flex-shrink-0",children:"Ta bort"})]})})]},"".concat(e.question1.id,"-").concat(e.question2.id))})]}),(0,bi.jsx)(oa,{isOpen:c.isOpen,onClose:()=>u((0,Ti.A)((0,Ti.A)({},c),{},{isOpen:!1})),title:c.title,message:c.message,type:c.type})]})},Pc=()=>{const[e,n]=(0,t.useState)(null),[r,i]=(0,t.useState)(!1),[s,a]=(0,t.useState)(null),[o,l]=(0,t.useState)({isOpen:!1,title:"",message:"",type:"info"});return(0,bi.jsxs)("div",{className:"bg-slate-800 rounded-lg p-6 border border-slate-700",children:[(0,bi.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,bi.jsxs)("div",{children:[(0,bi.jsx)("h2",{className:"text-xl font-bold text-white",children:"Validering av fr\xe5gor"}),(0,bi.jsx)("p",{className:"text-sm text-gray-400 mt-1",children:"Kontrollera att alla fr\xe5gor i databasen \xe4r korrekt formaterade"})]}),(0,bi.jsx)("button",{onClick:async()=>{i(!0),n(null);try{const i=await gs(),s=i.length;if(0===s)return void n({total:0,valid:0,invalid:0,results:[]});a({current:0,total:s});const o=[];let l=0,c=0;for(let n=0;n<s;n+=1){const u=i[n],d=ks(u,"sv"),h=d.errors||[],p={validationType:"structure",valid:d.valid,issues:h,reasoning:d.valid?"Strukturvalidering: Godk\xe4nd":"Strukturvalidering: ".concat(h.join(", ")),checkedAt:(new Date).toISOString()};if(d.valid){l+=1;try{await Es(u.id,p)}catch(r){console.error("[ValidationPanel] Kunde inte uppdatera strukturvalidering:",r)}}else{var e,t;c+=1;const i=(null===(e=u.languages)||void 0===e||null===(t=e.sv)||void 0===t?void 0:t.text)||u.text||"";o.push({index:n,questionId:u.id,questionText:i,errors:h,valid:!1});try{await Cs(u.id,p)}catch(r){console.error("[ValidationPanel] Kunde inte markera fr\xe5ga som ogiltig:",r)}}a({current:n+1,total:s})}n({total:s,valid:l,invalid:c,results:o})}catch(r){console.error("Fel vid validering:",r),l({isOpen:!0,title:"Fel vid validering",message:"Kunde inte validera fr\xe5gor: "+r.message,type:"error"})}finally{a(null),i(!1)}},disabled:r,className:"px-4 py-2 bg-cyan-500 text-black rounded-lg font-semibold hover:bg-cyan-400 disabled:bg-slate-600 disabled:text-gray-400",children:r?"Validerar...":"\u2705 Validera alla fr\xe5gor"})]}),s&&(0,bi.jsxs)("div",{className:"mb-4 rounded-lg border border-cyan-500/30 bg-cyan-500/10 p-4",children:[(0,bi.jsxs)("div",{className:"flex items-center justify-between text-sm text-cyan-200",children:[(0,bi.jsx)("span",{children:"Validerar fr\xe5gor..."}),(0,bi.jsxs)("span",{children:[s.current," / ",s.total]})]}),(0,bi.jsx)("div",{className:"mt-2 h-2 w-full rounded bg-slate-900",children:(0,bi.jsx)("div",{className:"h-full rounded bg-cyan-400 transition-all",style:{width:"".concat(s.total>0?Math.min(100,Math.round(s.current/s.total*100)):0,"%")}})})]}),e&&(0,bi.jsxs)("div",{className:"space-y-4",children:[(0,bi.jsxs)("div",{className:"bg-slate-900 rounded-lg p-4 border border-slate-700",children:[(0,bi.jsx)("h3",{className:"text-lg font-semibold text-white mb-3",children:"\xd6versikt"}),(0,bi.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,bi.jsxs)("div",{className:"text-center",children:[(0,bi.jsx)("div",{className:"text-3xl font-bold text-cyan-400",children:e.total}),(0,bi.jsx)("div",{className:"text-sm text-gray-400 mt-1",children:"Totalt fr\xe5gor"})]}),(0,bi.jsxs)("div",{className:"text-center",children:[(0,bi.jsx)("div",{className:"text-3xl font-bold text-green-400",children:e.valid}),(0,bi.jsx)("div",{className:"text-sm text-gray-400 mt-1",children:"Giltiga"})]}),(0,bi.jsxs)("div",{className:"text-center",children:[(0,bi.jsx)("div",{className:"text-3xl font-bold text-red-400",children:e.invalid}),(0,bi.jsx)("div",{className:"text-sm text-gray-400 mt-1",children:"Ogiltiga"})]})]})]}),e.invalid>0?(0,bi.jsxs)("div",{className:"bg-red-500/10 border border-red-500/30 rounded-lg p-4",children:[(0,bi.jsxs)("h3",{className:"text-lg font-semibold text-red-400 mb-3",children:["\u26a0\ufe0f Hittade ",e.invalid," ogiltiga fr\xe5gor"]}),(0,bi.jsx)("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:e.results.map((e,t)=>(0,bi.jsx)("div",{className:"bg-slate-900 rounded p-3 border border-red-500/20",children:(0,bi.jsx)("div",{className:"flex items-start justify-between mb-2",children:(0,bi.jsxs)("div",{className:"flex-1",children:[(0,bi.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,bi.jsxs)("span",{className:"text-xs text-gray-400",children:["Fr\xe5ga #",e.index+1,":"]}),(0,bi.jsx)("code",{className:"text-xs px-1.5 py-0.5 bg-slate-800 text-cyan-400 rounded font-mono",children:e.questionId})]}),(0,bi.jsxs)("div",{className:"text-sm text-white mb-2",children:[e.questionText.substring(0,80),e.questionText.length>80?"...":""]}),(0,bi.jsx)("div",{className:"space-y-1",children:e.errors.map((e,t)=>(0,bi.jsxs)("div",{className:"text-xs text-red-300 flex items-start gap-2",children:[(0,bi.jsx)("span",{className:"text-red-400",children:"\u2022"}),(0,bi.jsx)("span",{children:e})]},t))})]})})},e.questionId||t))})]}):(0,bi.jsxs)("div",{className:"bg-green-500/10 border border-green-500/30 rounded-lg p-6 text-center",children:[(0,bi.jsx)("div",{className:"text-4xl mb-2",children:"\u2705"}),(0,bi.jsx)("div",{className:"text-lg font-semibold text-green-400",children:"Alla fr\xe5gor \xe4r giltiga!"}),(0,bi.jsxs)("div",{className:"text-sm text-gray-400 mt-2",children:["Alla ",e.total," fr\xe5gor i databasen \xe4r korrekt formaterade."]})]})]}),!e&&!r&&!s&&(0,bi.jsx)("div",{className:"text-center py-8 text-gray-400",children:'Klicka p\xe5 "Validera alla fr\xe5gor" f\xf6r att b\xf6rja'}),(0,bi.jsx)(oa,{isOpen:o.isOpen,onClose:()=>l((0,Ti.A)((0,Ti.A)({},o),{},{isOpen:!1})),title:o.title,message:o.message,type:o.type})]})},Lc=e=>{var n,r;let{question:i,index:s,expandedQuestion:a,setExpandedQuestion:o,handleDeleteQuestion:l,handleManualApprove:c,handleManualReject:u,handleApproveReported:d,handleRejectReported:h,isSelected:p,onSelect:f,registerTask:m,validatingQuestions:g,regeneratingEmojis:v,onValidationStart:y,onValidationEnd:x,setIndividualValidationTasks:b,setDialogConfig:w}=e;const[_,k]=(0,t.useState)("sv"),[N,S]=(0,t.useState)(!1),j=(null===(n=i.languages)||void 0===n?void 0:n.sv)||{text:i.text,options:i.options,explanation:i.explanation},E=null===(r=i.languages)||void 0===r?void 0:r.en,C=a===i.id,T="sv"===_?j:E,A=j&&E,I=Array.isArray(i.categories)?i.categories:i.category?[i.category]:[],P=(Array.isArray(i.ageGroups)?i.ageGroups:[]).map(e=>{switch(e){case"children":return"Barn";case"youth":return"Ungdom";case"adults":return"Vuxna";default:return e}}),L=i.targetAudience,R=i.aiValidationResult,O=i.structureValidationResult||("structure"===(null===R||void 0===R?void 0:R.validationType)?R:null),M=R&&"structure"!==R.validationType?R:null,D=!0===(null===O||void 0===O?void 0:O.valid),F=!1===(null===O||void 0===O?void 0:O.valid),z=!0===i.manuallyApproved||!0===i.aiValidated||!0===(null===M||void 0===M?void 0:M.valid),U=!0===i.manuallyRejected||M&&!1===M.valid;return(0,bi.jsxs)("div",{className:"rounded-lg border transition-all duration-300 p-4 ".concat(g&&g.has(i.id)?"border-yellow-400 bg-yellow-50/5 animate-pulse":v&&v.has(i.id)?"border-blue-400 bg-blue-50/5 animate-pulse":p?"border-cyan-500 bg-slate-900/60":"border-slate-700 bg-slate-900/60"),children:[(0,bi.jsxs)("div",{className:"flex items-start gap-4",children:[(0,bi.jsx)("input",{type:"checkbox",checked:p,onChange:()=>f(i.id),className:"mt-1 h-5 w-5 rounded border-gray-600 bg-slate-800 text-cyan-500 focus:ring-cyan-500"}),(0,bi.jsxs)("div",{className:"flex-1",children:[g&&g.has(i.id)&&(0,bi.jsxs)("div",{className:"mb-2 flex items-center text-yellow-400",children:[(0,bi.jsx)("div",{className:"animate-spin mr-2",children:"\u23f3"}),(0,bi.jsx)("span",{className:"text-sm font-medium",children:"AI-validering p\xe5g\xe5r..."})]}),v&&v.has(i.id)&&(0,bi.jsxs)("div",{className:"mb-2 flex items-center text-blue-400",children:[(0,bi.jsx)("div",{className:"animate-spin mr-2",children:"\ud83c\udfa8"}),(0,bi.jsx)("span",{className:"text-sm font-medium",children:"Emoji-regenerering p\xe5g\xe5r..."})]}),(0,bi.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,bi.jsxs)("div",{className:"flex-1",children:[(0,bi.jsxs)("div",{className:"flex items-center gap-3 mb-2 flex-wrap",children:[(0,bi.jsxs)("span",{className:"text-sm font-mono text-gray-400",children:["#",s+1]}),!0===i.reported&&(0,bi.jsxs)("span",{className:"inline-flex items-center rounded-full bg-yellow-500/20 px-2.5 py-0.5 text-xs font-medium text-yellow-300",title:"Rapporterad av anv\xe4ndare - i karant\xe4n",children:["\u26a0\ufe0f Rapporterad (",i.reportCount||1,")"]}),!0===i.aiValidated&&!0===i.manuallyApproved&&!i.reported&&(0,bi.jsx)("span",{className:"inline-flex items-center rounded-full bg-blue-500/20 px-2.5 py-0.5 text-xs font-medium text-blue-300",title:"Manuellt godk\xe4nd efter granskning",children:"\u2713 Manuell OK"}),!0===i.manuallyRejected&&!i.reported&&(0,bi.jsx)("span",{className:"inline-flex items-center rounded-full bg-orange-500/20 px-2.5 py-0.5 text-xs font-medium text-orange-300",title:"Manuellt underk\xe4nd efter granskning",children:"\u2717 Manuellt underk\xe4nd"}),F&&(0,bi.jsx)("span",{className:"inline-flex items-center rounded-full bg-red-500/20 px-2.5 py-0.5 text-xs font-medium text-red-300",title:"Strukturvalidering - problem hittades",children:"\u2717 Struktur-fel"}),D&&!F&&(0,bi.jsx)("span",{className:"inline-flex items-center rounded-full bg-emerald-500/20 px-2.5 py-0.5 text-xs font-medium text-emerald-200",title:"Strukturvalidering - godk\xe4nd",children:"\u2713 Struktur-OK"}),z&&!0!==i.manuallyRejected&&(0,bi.jsx)("span",{className:"inline-flex items-center rounded-full bg-green-500/20 px-2.5 py-0.5 text-xs font-medium text-green-300",title:"AI-validerad - Alla providers godk\xe4nde",children:"\u2713 AI-OK"}),U&&(0,bi.jsx)("span",{className:"inline-flex items-center rounded-full bg-red-500/20 px-2.5 py-0.5 text-xs font-medium text-red-300",title:"AI-validering - problem hittades",children:"\u2717 AI-fel"}),i.createdAt&&(0,bi.jsx)("span",{className:"text-xs text-gray-500",children:i.createdAt.toDate?i.createdAt.toDate().toLocaleString("sv-SE",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):new Date(i.createdAt).toLocaleString("sv-SE",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}),P.map((e,t)=>(0,bi.jsx)("span",{className:"inline-flex items-center rounded-full bg-cyan-500/15 px-2.5 py-0.5 text-xs font-medium text-cyan-200",children:e},"age-".concat(i.id,"-").concat(e,"-").concat(t))),I.map((e,t)=>(0,bi.jsx)("span",{className:"inline-flex items-center rounded-full bg-purple-500/20 px-2.5 py-0.5 text-xs font-medium text-purple-200",children:e},"cat-".concat(i.id,"-").concat(e,"-").concat(t))),L&&(0,bi.jsx)("span",{className:"inline-flex items-center rounded-full bg-emerald-500/15 px-2.5 py-0.5 text-xs font-medium text-emerald-200",children:"swedish"===L?"Svensk m\xe5lgrupp":L}),i.difficulty&&(0,bi.jsx)("span",{className:"inline-flex items-center rounded-full bg-slate-700/60 px-2.5 py-0.5 text-xs font-medium text-gray-200",children:"kid"===i.difficulty?"Legacy: Barn":"family"===i.difficulty?"Legacy: Familj":"adult"===i.difficulty?"Legacy: Vuxen":"Legacy: ".concat(i.difficulty)}),A&&(0,bi.jsxs)("div",{className:"flex items-center rounded-full bg-slate-800 p-0.5",children:[(0,bi.jsx)("button",{onClick:()=>k("sv"),className:"px-2 py-0.5 text-xs rounded-full ".concat("sv"===_?"bg-cyan-500 text-black":"text-gray-300"),children:"SV"}),(0,bi.jsx)("button",{onClick:()=>k("en"),className:"px-2 py-0.5 text-xs rounded-full ".concat("en"===_?"bg-cyan-500 text-black":"text-gray-300"),children:"EN"})]})]}),(0,bi.jsxs)("div",{className:"flex items-center gap-4",children:[i.illustration&&(0,bi.jsx)("span",{className:"text-2xl",title:i.illustration.includes("<svg")?"SVG Illustration":"Emoji",children:i.illustration.includes("<svg")?"\ud83d\uddbc\ufe0f":i.illustration}),(0,bi.jsx)("button",{onClick:()=>o(C?null:i.id),className:"text-lg font-semibold text-left hover:text-cyan-300 transition-colors flex-1",children:(null===T||void 0===T?void 0:T.text)||("en"===_?"(No English text)":"(Ingen svensk text)")})]})]}),(0,bi.jsx)("div",{className:"flex gap-2",children:!0===i.reported?(0,bi.jsxs)(bi.Fragment,{children:[(0,bi.jsx)("button",{onClick:()=>d(i.id),className:"rounded bg-green-600 px-3 py-1 text-sm font-semibold text-white hover:bg-green-500",title:"Godk\xe4nn rapporterad fr\xe5ga - ta bort fr\xe5n karant\xe4n",children:"\u2713 Godk\xe4nn"}),(0,bi.jsx)("button",{onClick:()=>h(i.id),className:"rounded bg-red-600 px-3 py-1 text-sm font-semibold text-white hover:bg-red-500",title:"Underk\xe4nn rapporterad fr\xe5ga",children:"\u2717 Underk\xe4nn"})]}):(0,bi.jsxs)(bi.Fragment,{children:[!i.manuallyApproved&&(0,bi.jsx)("button",{onClick:()=>c(i.id),className:"rounded bg-blue-600 px-3 py-1 text-sm font-semibold text-white hover:bg-blue-500",title:"Godk\xe4nn manuellt efter granskning",children:"\u2713 Godk\xe4nn"}),!i.manuallyRejected&&(0,bi.jsx)("button",{onClick:()=>u(i.id),className:"rounded bg-orange-600 px-3 py-1 text-sm font-semibold text-white hover:bg-orange-500",title:"Underk\xe4nn manuellt",children:"\u2717 Underk\xe4nn"}),(0,bi.jsx)("button",{onClick:()=>l(i.id),className:"rounded bg-red-600 px-3 py-1 text-sm font-semibold text-white hover:bg-red-500",children:"Ta bort"})]})})]})]})]}),C&&(0,bi.jsxs)("div",{className:"mt-4 pt-4 border-t border-slate-700 space-y-4",children:[i.illustration&&(()=>{const e=i.illustrationGeneratedAt||i.migrationSvgUpdatedAt,t=i.illustrationProvider||i.migrationSvgProvider,n=!i.illustration.includes("<svg");return(0,bi.jsxs)("div",{className:"bg-slate-800/40 rounded border border-slate-600 p-4",children:[(0,bi.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,bi.jsx)("p",{className:"text-sm font-semibold text-gray-300",children:"Illustration:"}),(e||t)&&(0,bi.jsxs)("p",{className:"text-xs text-gray-400",children:[e&&(0,bi.jsx)(bi.Fragment,{children:e.toDate?e.toDate().toLocaleString("sv-SE",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):new Date(e).toLocaleString("sv-SE",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}),t&&" \xb7 ".concat(t.charAt(0).toUpperCase()+t.slice(1))]})]}),(0,bi.jsx)("div",{className:"mx-auto w-full max-w-xs",children:n?(0,bi.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,bi.jsx)("span",{className:"text-8xl",role:"img","aria-label":"Question illustration",children:i.illustration})}):(0,bi.jsx)("div",{className:"rounded bg-white/5 p-3 shadow-inner [&_svg]:mx-auto [&_svg]:block [&_svg]:h-auto [&_svg]:max-h-60 [&_svg]:w-full",dangerouslySetInnerHTML:{__html:i.illustration}})})]})})(),(0,bi.jsxs)("div",{className:"space-y-2",children:[(0,bi.jsxs)("p",{className:"text-sm font-semibold text-gray-300 mb-2",children:["Svarsalternativ (",_.toUpperCase(),"):"]}),((null===T||void 0===T?void 0:T.options)||[]).map((e,t)=>(0,bi.jsxs)("div",{className:"flex items-center gap-3 rounded border px-3 py-2 ".concat(t===i.correctOption?"border-emerald-500 bg-emerald-500/20 text-emerald-100":"border-slate-600 bg-slate-800/40 text-gray-300"),children:[(0,bi.jsxs)("span",{className:"text-sm font-mono",children:[String.fromCharCode(65+t),":"]}),(0,bi.jsx)("span",{children:e}),t===i.correctOption&&(0,bi.jsx)("span",{className:"ml-auto text-xs font-semibold text-emerald-200",children:"R\xc4TT SVAR"})]},t))]}),(null===T||void 0===T?void 0:T.explanation)&&(0,bi.jsxs)("div",{className:"p-3 bg-slate-800/40 rounded border border-slate-600",children:[(0,bi.jsxs)("p",{className:"text-sm font-semibold text-gray-300 mb-1",children:["F\xf6rklaring (",_.toUpperCase(),"):"]}),(0,bi.jsx)("p",{className:"text-sm text-gray-300",children:T.explanation})]}),O&&(0,bi.jsxs)("div",{className:"p-4 rounded border ".concat(O.valid?"bg-emerald-500/10 border-emerald-500/30":"bg-red-500/10 border-red-500/30"),children:[(0,bi.jsx)("div",{className:"flex items-center gap-2 mb-2",children:(0,bi.jsx)("span",{className:"text-sm font-bold ".concat(O.valid?"text-emerald-300":"text-red-300"),children:O.valid?"\u2713 Strukturvalidering: GODK\xc4ND":"\u2717 Strukturvalidering: UNDERK\xc4ND"})}),O.issues&&O.issues.length>0&&(0,bi.jsxs)("div",{className:"mb-3",children:[(0,bi.jsx)("p",{className:"text-xs font-semibold text-red-300 mb-1",children:"Problem:"}),(0,bi.jsx)("ul",{className:"list-disc list-inside space-y-1",children:O.issues.map((e,t)=>(0,bi.jsx)("li",{className:"text-xs text-red-200",children:e},"structure-issue-".concat(t)))})]}),O.reasoning&&(0,bi.jsxs)("div",{className:"mb-2",children:[(0,bi.jsx)("p",{className:"text-xs font-semibold text-gray-300 mb-1",children:"Motivering:"}),(0,bi.jsx)("p",{className:"text-xs text-gray-300 whitespace-pre-wrap",children:O.reasoning})]}),O.checkedAt&&(0,bi.jsxs)("p",{className:"text-xs text-gray-400 mt-2",children:["Kontrollerad: ",new Date(O.checkedAt).toLocaleString("sv-SE")]})]}),M&&(0,bi.jsxs)("div",{className:"p-4 rounded border ".concat(i.manuallyRejected?"bg-orange-500/10 border-orange-500/30":i.aiValidated?i.manuallyApproved?"bg-blue-500/10 border-blue-500/30":"bg-green-500/10 border-green-500/30":"bg-red-500/10 border-red-500/30"),children:[(0,bi.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,bi.jsx)("span",{className:"text-sm font-bold ".concat(i.manuallyRejected?"text-orange-300":i.aiValidated?i.manuallyApproved?"text-blue-300":"text-green-300":"text-red-300"),children:i.manuallyRejected?"\u2717 Manuellt underk\xe4nd":"manual"===M.validationType?"\u2713 Manuellt godk\xe4nd":i.aiValidated?"\u2713 AI-validering: GODK\xc4ND":"\u2717 AI-validering: UNDERK\xc4ND"}),M.providersChecked&&(0,bi.jsxs)("span",{className:"text-xs text-gray-400",children:["(",M.providersChecked," providers)"]})]}),M.issues&&M.issues.length>0&&(0,bi.jsxs)("div",{className:"mb-3",children:[(0,bi.jsx)("p",{className:"text-xs font-semibold text-red-300 mb-1",children:"Problem:"}),(0,bi.jsx)("ul",{className:"list-disc list-inside space-y-1",children:M.issues.map((e,t)=>(0,bi.jsx)("li",{className:"text-xs text-red-200",children:e},t))})]}),M.reasoning&&(0,bi.jsxs)("div",{className:"mb-2",children:[(0,bi.jsx)("p",{className:"text-xs font-semibold text-gray-300 mb-1",children:"Motivering:"}),(0,bi.jsx)("p",{className:"text-xs text-gray-300 whitespace-pre-wrap",children:M.reasoning})]}),M.providerResults&&(0,bi.jsxs)("div",{className:"mt-3 pt-3 border-t border-slate-600",children:[(0,bi.jsx)("p",{className:"text-xs font-semibold text-gray-300 mb-2",children:"Provider-resultat:"}),(0,bi.jsx)("div",{className:"space-y-2",children:Object.entries(M.providerResults).map(e=>{let[t,n]=e;const r=t.charAt(0).toUpperCase()+t.slice(1);let i="text-amber-300",s="\u26a0",a=(null===n||void 0===n?void 0:n.error)||"Otillg\xe4nglig";return!0===(null===n||void 0===n?void 0:n.valid)?(i="text-green-300",s="\u2713",a="Godk\xe4nd"):!1===(null===n||void 0===n?void 0:n.valid)&&(i="text-red-300",s="\u2717",a=Array.isArray(null===n||void 0===n?void 0:n.issues)&&n.issues.length>0?n.issues.join(", "):"Underk\xe4nd"),(0,bi.jsxs)("div",{className:"flex items-start gap-2",children:[(0,bi.jsxs)("span",{className:"text-xs font-bold ".concat(i),children:[s," ",r,":"]}),(0,bi.jsx)("span",{className:"text-xs text-gray-300 flex-1",children:a})]},t)})})]}),i.manuallyApprovedAt&&(0,bi.jsxs)("p",{className:"text-xs text-gray-400 mt-2",children:["Manuellt godk\xe4nd: ",i.manuallyApprovedAt.toDate?i.manuallyApprovedAt.toDate().toLocaleString("sv-SE"):new Date(i.manuallyApprovedAt).toLocaleString("sv-SE")]}),i.manuallyRejectedAt&&(0,bi.jsxs)("p",{className:"text-xs text-gray-400 mt-2",children:["Manuellt underk\xe4nd: ",i.manuallyRejectedAt.toDate?i.manuallyRejectedAt.toDate().toLocaleString("sv-SE"):new Date(i.manuallyRejectedAt).toLocaleString("sv-SE")]}),i.aiValidatedAt&&!i.manuallyApprovedAt&&!i.manuallyRejectedAt&&(0,bi.jsxs)("p",{className:"text-xs text-gray-400 mt-2",children:["Validerad: ",i.aiValidatedAt.toDate?i.aiValidatedAt.toDate().toLocaleString("sv-SE"):new Date(i.aiValidatedAt).toLocaleString("sv-SE")]})]}),i.reports&&i.reports.length>0&&(0,bi.jsxs)("div",{className:"p-4 rounded border bg-yellow-500/10 border-yellow-500/30",children:[(0,bi.jsx)("div",{className:"flex items-center gap-2 mb-2",children:(0,bi.jsxs)("span",{className:"text-sm font-bold text-yellow-300",children:["\u26a0\ufe0f Anv\xe4ndarrapporter (",i.reports.length,")"]})}),(0,bi.jsx)("div",{className:"space-y-2",children:i.reports.map((e,t)=>(0,bi.jsxs)("div",{className:"bg-slate-900 rounded p-2 border border-yellow-500/20",children:[(0,bi.jsxs)("div",{className:"text-xs text-yellow-200 mb-1",children:[(0,bi.jsx)("strong",{children:"Rapporterad av:"})," ",e.reportedBy||"Anonym"]}),(0,bi.jsxs)("div",{className:"text-xs text-yellow-200 mb-1",children:[(0,bi.jsx)("strong",{children:"Anledning:"})," ",e.reason||"Ingen anledning angiven"]}),(0,bi.jsxs)("div",{className:"text-xs text-gray-400",children:[e.reportedAt&&new Date(e.reportedAt).toLocaleString("sv-SE"),e.resolved&&(0,bi.jsxs)("span",{className:"ml-2 text-green-300",children:["(","approved"===e.resolution?"Godk\xe4nd":"Underk\xe4nd"," - ",new Date(e.resolvedAt).toLocaleString("sv-SE"),")"]})]})]},t))})]}),(0,bi.jsxs)("div",{className:"text-sm text-gray-400 space-y-1",children:[(0,bi.jsxs)("p",{children:["ID: ",i.id]}),i.source&&(0,bi.jsxs)("p",{children:["K\xe4lla: ",i.source]}),i.createdBy&&(0,bi.jsxs)("p",{children:["Skapad av: ",i.createdBy]})]}),(0,bi.jsxs)("div",{className:"flex flex-wrap gap-2 mt-4 pt-4 border-t border-slate-700",children:[(0,bi.jsx)("button",{onClick:async()=>{if(i.id&&(!g||!g.has(i.id))){y&&y(i.id);try{const t=await Ss(i.id),n=null===t||void 0===t?void 0:t.taskId;if(n&&"function"===typeof m){var e;const t=(null===(e=i.languages)||void 0===e?void 0:e.sv)||{text:i.text,options:i.options,explanation:i.explanation},r=["Fr\xe5ga ".concat(i.id),t.text.length>80?"".concat(t.text.slice(0,80),"\u2026"):t.text];m(n,{taskType:"validation",label:"AI-validering",description:r.join(" \u2013 "),createdAt:new Date}),b(e=>new Map(e).set(n,i.id))}}catch(t){console.error("[AdminQuestionsPage] Kunde inte starta AI-validering:",t),w({isOpen:!0,title:"Fel vid AI-validering",message:"Kunde inte starta AI-validering: ".concat(t.message),type:"error"})}finally{x&&x(i.id)}}},disabled:g&&g.has(i.id),className:"px-3 py-1 text-xs rounded-md transition-colors ".concat(g&&g.has(i.id)?"bg-gray-600 text-gray-400 opacity-50 cursor-not-allowed":"bg-green-600 hover:bg-green-700 text-white"),children:g&&g.has(i.id)?"\u23f3 Validerar...":"\u2705 AI-validera"}),(0,bi.jsx)("button",{onClick:async()=>{if(!N){S(!0);try{const e=await Ls(i.id);null!==e&&void 0!==e&&e.taskId&&"function"===typeof m&&m(e.taskId,{taskType:"regenerateemoji",label:"Emoji-regenerering",description:"Genererar nya emojis f\xf6r fr\xe5ga ".concat(i.id),createdAt:new Date})}catch(e){console.error("[AdminQuestionsPage] Kunde inte regenerera emojis:",e),w({isOpen:!0,title:"Fel vid emoji-generering",message:"Kunde inte generera emojis: ".concat(e.message),type:"error"})}finally{S(!1)}}},disabled:N||g&&g.has(i.id)||v&&v.has(i.id),className:"px-3 py-1 text-xs rounded-md transition-colors ".concat(N||g&&g.has(i.id)||v&&v.has(i.id)?"bg-gray-600 text-gray-400 opacity-50 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white"),children:N||v&&v.has(i.id)?"\u23f3 Genererar...":"\ud83c\udfa8 Nya emojis"}),!0===i.reported&&(0,bi.jsxs)(bi.Fragment,{children:[(0,bi.jsx)("button",{onClick:()=>d(i.id),className:"px-3 py-1 text-xs bg-green-600 hover:bg-green-700 text-white rounded-md",children:"\u2705 Godk\xe4nn rapport"}),(0,bi.jsx)("button",{onClick:()=>h(i.id),className:"px-3 py-1 text-xs bg-red-600 hover:bg-red-700 text-white rounded-md",children:"\u274c Underk\xe4nn rapport"})]}),(0,bi.jsx)("button",{onClick:()=>l(i.id),className:"px-3 py-1 text-xs bg-red-600 hover:bg-red-700 text-white rounded-md",children:"\ud83d\uddd1\ufe0f Radera"})]})]})]})},Rc=()=>{var e,n,r,i,s,a,o,l;const c=X(),{isSuperUser:u}=Ci(),{registerTask:d}=Ea(),[h,p]=(0,t.useState)([]),[f,m]=(0,t.useState)(!0),[g,v]=(0,t.useState)(!1),[y,x]=(0,t.useState)(!1),[b,w]=(0,t.useState)(!1),[_,k]=(0,t.useState)(new Set),[N,S]=(0,t.useState)(new Set),[j,E]=(0,t.useState)(!1),[C,T]=(0,t.useState)(new Map),[A,I]=(0,t.useState)(!1),[P,L]=(0,t.useState)(10),[R,O]=(0,t.useState)(""),[M,D]=(0,t.useState)(""),[F,z]=(0,t.useState)("random"),[U,B]=(0,t.useState)(null),[V,q]=(0,t.useState)(!1),[K,H]=(0,t.useState)(null),[W,G]=(0,t.useState)(""),[Z,Q]=(0,t.useState)("all"),[J,Y]=(0,t.useState)("all"),[$,ee]=(0,t.useState)("all"),[te,ne]=(0,t.useState)("all"),[re,ie]=(0,t.useState)(new Set),[se,ae]=(0,t.useState)(1),[oe,le]=(0,t.useState)("questions"),ce=(0,t.useRef)(!0),[ue,de]=(0,t.useState)({isOpen:!1,title:"",message:"",type:"info"});(0,t.useEffect)(()=>{(()=>{try{m(!0);const e=ms();p(e||[])}catch(e){console.error("Kunde inte ladda fr\xe5gor:",e),p([])}finally{m(!1)}})();const e=_s(e=>{p(e||[])});return()=>e()},[]),(0,t.useEffect)(()=>{u||c("/")},[u,c]),(0,t.useEffect)(()=>()=>{ce.current=!1},[]),(0,t.useEffect)(()=>{if(!u)return;const e=pi();return(0,si.aQ)((0,si.P)((0,si.rJ)(e,"backgroundTasks"),(0,si._M)("taskType","in",["validation","batchvalidation","regenerateemoji","batchregenerateemojis"]),(0,si._M)("status","in",["processing","queued","pending"])),e=>{const t=e.docs.map(e=>(0,Ti.A)({id:e.id},e.data())),n=new Set,r=new Set;let i=!1;t.forEach(e=>{var t,s;if("batchvalidation"===e.taskType)i=!0,null!==(t=e.payload)&&void 0!==t&&t.questions&&e.payload.questions.forEach(e=>{e.id&&n.add(e.id)}),null!==(s=e.progress)&&void 0!==s&&s.questionIds&&e.progress.questionIds.forEach(e=>n.add(e));else if("validation"===e.taskType){const t=C.get(e.id);t&&n.add(t)}else if("batchregenerateemojis"===e.taskType){var a;null!==(a=e.payload)&&void 0!==a&&a.questionIds&&e.payload.questionIds.forEach(e=>r.add(e))}else if("regenerateemoji"===e.taskType){var o;null!==(o=e.payload)&&void 0!==o&&o.questionId&&r.add(e.payload.questionId)}}),k(n),S(r),E(i);const s=new Set(t.map(e=>e.id));T(e=>{const t=new Map;for(const[n,r]of e.entries())s.has(n)&&t.set(n,r);return t})},e=>{console.error("Error listening to background tasks:",e)})},[u,C]),(0,t.useEffect)(()=>{A&&!U&&he()},[A]);const he=async()=>{q(!0);try{const r=await fetch("https://europe-west1-geoquest2-7e45c.cloudfunctions.net/getAIStatus"),i=await r.json();B(i.providers);const s=Object.values(i.providers).some(e=>e.available);var e,t,n;if(!s)null!==(e=i.providers.gemini)&&void 0!==e&&e.available?z("gemini"):null!==(t=i.providers.anthropic)&&void 0!==t&&t.available?z("anthropic"):null!==(n=i.providers.openai)&&void 0!==n&&n.available&&z("openai")}catch(r){console.error("Failed to fetch AI status:",r),B({gemini:{available:!1,message:"Kunde inte h\xe4mta status"},anthropic:{available:!1,message:"Kunde inte h\xe4mta status"},openai:{available:!1,message:"Kunde inte h\xe4mta status"}})}finally{q(!1)}},pe=new Set,fe=new Set,me=new Set;h.forEach(e=>{(Array.isArray(e.categories)?e.categories:e.category?[e.category]:[]).forEach(e=>{e&&pe.add(e)});(Array.isArray(e.ageGroups)?e.ageGroups:[]).forEach(e=>{e&&fe.add(e)});const t=e.targetAudience||e.audience;t&&me.add(t)});const ge=["all",...Array.from(pe).sort((e,t)=>e.localeCompare(t,"sv"))],ve=["children","youth","adults"],ye=["all",...Array.from(fe).sort((e,t)=>{const n=ve.indexOf(e),r=ve.indexOf(t);return-1===n||-1===r?e.localeCompare(t):n-r})],xe=["all",...Array.from(me).sort((e,t)=>e.localeCompare(t,"sv"))],be=W.trim().toLowerCase(),we=Z.toLowerCase(),_e=te.toLowerCase(),ke=h.filter(e=>{var t,n,r,i,s,a,o,l;const c=(null===(t=e.languages)||void 0===t||null===(n=t.sv)||void 0===n?void 0:n.text)||e.text||"",u=(null===(r=e.languages)||void 0===r||null===(i=r.en)||void 0===i?void 0:i.text)||"",d=(null===(s=e.languages)||void 0===s||null===(a=s.sv)||void 0===a?void 0:a.options)||e.options||[],h=(null===(o=e.languages)||void 0===o||null===(l=o.en)||void 0===l?void 0:l.options)||[],p=Array.isArray(e.categories)?e.categories:e.category?[e.category]:[],f=p.map(e=>e.toLowerCase()),m=Array.isArray(e.ageGroups)?e.ageGroups:[],g=m.map(e=>e.toLowerCase()),v=(e.targetAudience||e.audience||"").toLowerCase(),y=!be||[c,u,...d,...h,e.id,...p,...m,e.targetAudience].filter(Boolean).some(e=>e.toLowerCase().includes(be)),x="all"===Z||f.includes(we),b="all"===$||g.includes($.toLowerCase()),w="all"===te||v===_e,_=e.aiValidationResult,k=e.structureValidationResult||("structure"===(null===_||void 0===_?void 0:_.validationType)?_:null),N=_&&"structure"!==_.validationType?_:null,S=Boolean(k),j=!0===(null===k||void 0===k?void 0:k.valid),E=!1===(null===k||void 0===k?void 0:k.valid),C=!0===e.manuallyApproved||!0===e.aiValidated||!0===(null===N||void 0===N?void 0:N.valid),T=!0===e.manuallyRejected||N&&!1===N.valid;let A=!0;return"validated"===J?A=C&&(!S||j):"failed"===J?A=T||E:"unvalidated"===J?A=!S&&!C&&!T&&!e.reported:"reported"===J?A=!0===e.reported:"manual-approved"===J?A=!0===e.manuallyApproved:"manual-rejected"===J?A=!0===e.manuallyRejected:"structure-approved"===J?A=j:"structure-rejected"===J&&(A=E),y&&x&&b&&w&&A}),Ne=ke.slice(10*(se-1),10*se),Se=async e=>{if(window.confirm("Godk\xe4nn denna fr\xe5ga manuellt?\n\nDetta markerar fr\xe5gan som validerad oavsett AI-valideringens resultat."))try{await Ts(e),de({isOpen:!0,title:"Fr\xe5ga godk\xe4nd",message:"Fr\xe5gan har markerats som manuellt godk\xe4nd!",type:"success"})}catch(t){console.error("Kunde inte godk\xe4nna fr\xe5ga:",t),de({isOpen:!0,title:"Fel vid godk\xe4nnande",message:"Kunde inte godk\xe4nna fr\xe5ga: "+t.message,type:"error"})}},je=async e=>{const t=window.prompt("Underk\xe4nn denna fr\xe5ga manuellt?\n\nAnge anledning (valfritt):");if(null!==t)try{await As(e,t),de({isOpen:!0,title:"Fr\xe5ga underk\xe4nd",message:"Fr\xe5gan har markerats som manuellt underk\xe4nd!",type:"success"})}catch(n){console.error("Kunde inte underk\xe4nna fr\xe5ga:",n),de({isOpen:!0,title:"Fel vid underk\xe4nnande",message:"Kunde inte underk\xe4nna fr\xe5ga: "+n.message,type:"error"})}},Ee=async e=>{if(window.confirm("Godk\xe4nn denna rapporterade fr\xe5ga?\n\nDetta tar bort den fr\xe5n karant\xe4n och g\xf6r den tillg\xe4nglig f\xf6r rundor igen."))try{await Ps(e),de({isOpen:!0,title:"Rapporterad fr\xe5ga godk\xe4nd",message:"Fr\xe5gan har godk\xe4nts och tagits bort fr\xe5n karant\xe4n!",type:"success"})}catch(t){console.error("Kunde inte godk\xe4nna rapporterad fr\xe5ga:",t),de({isOpen:!0,title:"Fel vid godk\xe4nnande",message:"Kunde inte godk\xe4nna fr\xe5ga: "+t.message,type:"error"})}},Ce=async e=>{if(window.confirm("Underk\xe4nn denna rapporterade fr\xe5ga?\n\nDetta markerar fr\xe5gan som manuellt underk\xe4nd baserat p\xe5 anv\xe4ndarrapporterna."))try{await Rs(e),de({isOpen:!0,title:"Rapporterad fr\xe5ga underk\xe4nd",message:"Fr\xe5gan har underk\xe4nts baserat p\xe5 anv\xe4ndarrapporter!",type:"success"})}catch(t){console.error("Kunde inte underk\xe4nna rapporterad fr\xe5ga:",t),de({isOpen:!0,title:"Fel vid underk\xe4nnande",message:"Kunde inte underk\xe4nna fr\xe5ga: "+t.message,type:"error"})}},Te=async e=>{if(window.confirm("\xc4r du s\xe4ker p\xe5 att du vill ta bort denna fr\xe5ga?"))try{await ws(e),p(t=>t.filter(t=>t.id!==e))}catch(t){console.error("Kunde inte ta bort fr\xe5ga:",t),de({isOpen:!0,title:"Fel vid radering",message:t.message||"Kunde inte ta bort fr\xe5gan. F\xf6rs\xf6k igen.",type:"error"})}},Ae=e=>{ie(t=>{const n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})},Ie=e=>{k(t=>new Set([...t,e]))},Pe=e=>{k(t=>{const n=new Set(t);return n.delete(e),n})},Le=ke,Re=re.size>0&&re.size===Le.length;return u?(0,bi.jsxs)("div",{className:"min-h-screen bg-slate-950",children:[(0,bi.jsx)(Sl,{title:"Fr\xe5gebank"}),(0,bi.jsxs)("div",{className:"mx-auto max-w-6xl px-4 pt-24 pb-8",children:[(0,bi.jsxs)("div",{className:"mb-6 flex gap-2 border-b border-slate-700",children:[(0,bi.jsxs)("button",{onClick:()=>le("questions"),className:"px-4 py-2 font-semibold transition-colors ".concat("questions"===oe?"text-cyan-400 border-b-2 border-cyan-400":"text-gray-400 hover:text-gray-300"),children:["\ud83d\udcdd Fr\xe5gor (",h.length,")"]}),(0,bi.jsx)("button",{onClick:()=>le("duplicates"),className:"px-4 py-2 font-semibold transition-colors ".concat("duplicates"===oe?"text-amber-400 border-b-2 border-amber-400":"text-gray-400 hover:text-gray-300"),children:"\ud83d\udd0d Dubletter"}),(0,bi.jsx)("button",{onClick:()=>le("validation"),className:"px-4 py-2 font-semibold transition-colors ".concat("validation"===oe?"text-green-400 border-b-2 border-green-400":"text-gray-400 hover:text-gray-300"),children:"\u2713 Validering"})]}),"validation"===oe?(0,bi.jsx)(Pc,{}):"duplicates"===oe?(0,bi.jsx)(Ic,{}):(0,bi.jsxs)(bi.Fragment,{children:[(0,bi.jsxs)("div",{className:"mb-6 flex flex-col gap-4",children:[(0,bi.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-5 gap-4",children:[(0,bi.jsxs)("div",{children:[(0,bi.jsx)("label",{className:"block text-sm font-semibold text-cyan-200 mb-2",children:"S\xf6k fr\xe5gor"}),(0,bi.jsx)("input",{type:"text",value:W,onChange:e=>G(e.target.value),className:"w-full rounded bg-slate-800 border border-slate-600 px-3 py-2",placeholder:"S\xf6k i fr\xe5getext, svarsalternativ eller ID..."})]}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("label",{className:"block text-sm font-semibold text-cyan-200 mb-2",children:"Kategori"}),(0,bi.jsx)("select",{value:Z,onChange:e=>Q(e.target.value),className:"w-full rounded bg-slate-800 border border-slate-600 px-3 py-2",children:ge.map(e=>(0,bi.jsx)("option",{value:e,children:"all"===e?"Alla kategorier":e},e))})]}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("label",{className:"block text-sm font-semibold text-cyan-200 mb-2",children:"Valideringsstatus"}),(0,bi.jsxs)("select",{value:J,onChange:e=>Y(e.target.value),className:"w-full rounded bg-slate-800 border border-slate-600 px-3 py-2",children:[(0,bi.jsx)("option",{value:"all",children:"Alla"}),(0,bi.jsx)("option",{value:"validated",children:"Godk\xe4nda (AI)"}),(0,bi.jsx)("option",{value:"failed",children:"Underk\xe4nda (AI)"}),(0,bi.jsx)("option",{value:"manual-approved",children:"Manuellt godk\xe4nda"}),(0,bi.jsx)("option",{value:"manual-rejected",children:"Manuellt underk\xe4nda"}),(0,bi.jsx)("option",{value:"structure-approved",children:"Strukturellt godk\xe4nda"}),(0,bi.jsx)("option",{value:"structure-rejected",children:"Strukturellt underk\xe4nda"}),(0,bi.jsx)("option",{value:"unvalidated",children:"Ej validerade"}),(0,bi.jsx)("option",{value:"reported",children:"Rapporterade (karant\xe4n)"})]})]}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("label",{className:"block text-sm font-semibold text-cyan-200 mb-2",children:"\xc5ldersgrupp"}),(0,bi.jsx)("select",{value:$,onChange:e=>ee(e.target.value),className:"w-full rounded bg-slate-800 border border-slate-600 px-3 py-2",children:ye.map(e=>(0,bi.jsx)("option",{value:e,children:"all"===e?"Alla \xe5ldersgrupper":("children"===e?"Barn":"youth"===e&&"Ungdom")||"adults"===e&&"Vuxna"||e},e))})]}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("label",{className:"block text-sm font-semibold text-cyan-200 mb-2",children:"M\xe5lgrupp"}),(0,bi.jsx)("select",{value:te,onChange:e=>ne(e.target.value),className:"w-full rounded bg-slate-800 border border-slate-600 px-3 py-2",children:xe.map(e=>(0,bi.jsx)("option",{value:e,children:"all"===e?"Alla m\xe5lgrupper":"swedish"===e?"Svensk m\xe5lgrupp":e.charAt(0).toUpperCase()+e.slice(1)},e))})]})]}),(0,bi.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,bi.jsxs)("p",{className:"text-sm text-gray-400",children:["Beh\xf6ver du k\xf6ra struktur- eller AI-validering p\xe5 nytt? Anv\xe4nd fliken"," ",(0,bi.jsx)("span",{className:"text-cyan-300",children:"Validering"})," f\xf6r strukturvalidering. F\xf6r AI-validering, anv\xe4nd knapparna p\xe5 individuella fr\xe5gor eller batch-funktionen ovan."]}),(0,bi.jsx)("button",{onClick:()=>I(!0),disabled:g,className:"rounded bg-gradient-to-r from-purple-600 to-indigo-600 px-4 py-2 font-semibold text-white hover:from-purple-700 hover:to-indigo-700 disabled:bg-slate-700 disabled:text-gray-400 flex items-center gap-2",children:g?"\ud83e\udd16 Genererar...":"\ud83e\udd16 AI-Generera fr\xe5gor"})]})]}),(0,bi.jsxs)("div",{className:"mb-4 flex items-center justify-between bg-slate-800/50 border border-slate-700 rounded-lg p-2",children:[(0,bi.jsxs)("div",{className:"flex items-center gap-3",children:[(0,bi.jsx)("input",{type:"checkbox",checked:Re,onChange:()=>{re.size===Le.length?ie(new Set):ie(new Set(Le.map(e=>e.id)))},disabled:0===Le.length,className:"h-5 w-5 rounded border-gray-600 bg-slate-800 text-cyan-500 focus:ring-cyan-500 disabled:opacity-50"}),(0,bi.jsx)("label",{className:"text-sm text-gray-300",children:re.size>0?"".concat(re.size," valda"):"Markera alla"})]}),(0,bi.jsxs)("div",{className:"flex items-center gap-2",children:[(0,bi.jsx)("button",{onClick:async()=>{if(0===re.size)return;if(!window.confirm("\xc4r du s\xe4ker p\xe5 att du vill k\xf6ra AI-validering p\xe5 ".concat(re.size," fr\xe5ga(r)? Detta kan medf\xf6ra kostnader.")))return;w(!0),E(!0);const e=Array.from(re);k(new Set(e));try{const{taskId:t}=await js(e);t&&d(t,{taskType:"batchvalidation",label:"AI-validering (batch)",description:"Validerar ".concat(e.length," fr\xe5gor med AI."),createdAt:new Date}),ie(new Set)}catch(t){console.error("Kunde inte starta batch AI-validering:",t),de({isOpen:!0,title:"Fel vid AI-validering",message:"Ett fel uppstod vid start av AI-validering: "+t.message,type:"error"})}finally{w(!1)}},disabled:0===re.size||b||j,className:"rounded bg-purple-600 px-3 py-1.5 text-sm font-semibold text-white hover:bg-purple-500 disabled:bg-slate-700 disabled:cursor-not-allowed",children:b||j?"\ud83e\udd16 Validerar...":"\ud83e\udd16 AI-validera"}),(0,bi.jsx)("button",{onClick:async()=>{if(0!==re.size&&window.confirm("\xc4r du s\xe4ker p\xe5 att du vill regenerera emojis f\xf6r ".concat(re.size," fr\xe5ga(r)?"))){x(!0);try{const e=Array.from(re),{taskId:t}=await Ki({questionIds:e});t&&d(t,{taskType:"batchregenerateemojis",label:"Mass-regenerering Emojis",description:"Genererar om emojis f\xf6r ".concat(e.length," fr\xe5gor."),createdAt:new Date}),ie(new Set)}catch(e){console.error("Kunde inte starta mass-regenerering av emojis:",e),de({isOpen:!0,title:"Fel vid mass-regenerering",message:"Ett fel uppstod vid start av mass-regenerering: "+e.message,type:"error"})}finally{x(!1)}}},disabled:0===re.size||y,className:"rounded bg-teal-600 px-3 py-1.5 text-sm font-semibold text-white hover:bg-teal-500 disabled:bg-slate-700 disabled:cursor-not-allowed",children:y?"\ud83c\udfa8 Genererar...":"\ud83c\udfa8 Regenerera Emojis"}),(0,bi.jsx)("button",{onClick:async()=>{if(0!==re.size&&window.confirm("\xc4r du s\xe4ker p\xe5 att du vill radera ".concat(re.size," fr\xe5ga(r)?")))try{await Oi(Array.from(re)),p(e=>e.filter(e=>!re.has(e.id))),ie(new Set)}catch(e){console.error("Kunde inte radera markerade fr\xe5gor:",e),de({isOpen:!0,title:"Fel vid radering",message:"Ett fel uppstod vid radering. Vissa fr\xe5gor kan vara kvar.",type:"error"})}},disabled:0===re.size,className:"rounded bg-red-600 px-3 py-1.5 text-sm font-semibold text-white hover:bg-red-500 disabled:bg-slate-700 disabled:cursor-not-allowed",children:"Radera markerade"})]})]}),j&&(0,bi.jsxs)("div",{className:"mb-4 p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg",children:[(0,bi.jsxs)("div",{className:"flex items-center gap-2 text-yellow-300",children:[(0,bi.jsx)("div",{className:"animate-spin",children:"\u23f3"}),(0,bi.jsx)("span",{className:"font-medium",children:"Batch-validering p\xe5g\xe5r..."})]}),(0,bi.jsxs)("div",{className:"mt-1 text-sm text-yellow-200",children:[_.size," fr\xe5gor kvar att validera"]})]}),N.size>0&&(0,bi.jsxs)("div",{className:"mb-4 p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg",children:[(0,bi.jsxs)("div",{className:"flex items-center gap-2 text-blue-300",children:[(0,bi.jsx)("div",{className:"animate-spin",children:"\ud83c\udfa8"}),(0,bi.jsx)("span",{className:"font-medium",children:"Emoji-regenerering p\xe5g\xe5r..."})]}),(0,bi.jsxs)("div",{className:"mt-1 text-sm text-blue-200",children:[N.size," fr\xe5gor kvar att bearbeta"]})]}),f?(0,bi.jsx)("div",{className:"text-center py-8",children:(0,bi.jsx)("p",{className:"text-gray-300",children:"Laddar fr\xe5gor..."})}):(0,bi.jsxs)("div",{children:[(0,bi.jsx)("div",{className:"mb-4 flex items-center justify-between",children:(0,bi.jsxs)("p",{className:"text-sm text-gray-400",children:["Visar ",ke.length," av ",h.length," fr\xe5gor"]})}),0===ke.length?(0,bi.jsx)("div",{className:"text-center py-8",children:(0,bi.jsx)("p",{className:"text-gray-300",children:W||"all"!==Z?"Inga fr\xe5gor matchade dina filter.":"Inga fr\xe5gor hittades i systemet."})}):(0,bi.jsxs)("div",{className:"space-y-4",children:[Ne.map((e,t)=>{const n=10*(se-1)+t;return(0,bi.jsx)(Lc,{question:e,index:n,expandedQuestion:K,setExpandedQuestion:H,handleDeleteQuestion:Te,handleManualApprove:Se,handleManualReject:je,handleApproveReported:Ee,handleRejectReported:Ce,registerTask:d,isSelected:re.has(e.id),onSelect:Ae,validatingQuestions:_,regeneratingEmojis:N,onValidationStart:Ie,onValidationEnd:Pe,setIndividualValidationTasks:T,setDialogConfig:de},"".concat(e.id,"-").concat(t))}),(0,bi.jsx)(Ec,{currentPage:se,totalItems:ke.length,itemsPerPage:10,onPageChange:e=>{ae(e)}})]})]}),A&&(0,bi.jsx)("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-[1200]",children:(0,bi.jsxs)("div",{className:"bg-slate-900 rounded-xl shadow-2xl border border-purple-500/40 max-w-md w-full max-h-[90vh] overflow-y-auto p-6",children:[(0,bi.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,bi.jsx)("h3",{className:"text-xl font-bold bg-gradient-to-r from-cyan-400 to-indigo-400 bg-clip-text text-transparent",children:"\ud83e\udd16 AI-Generera fr\xe5gor"}),(0,bi.jsx)("button",{onClick:()=>I(!1),className:"text-gray-400 hover:text-gray-200 transition-colors",children:(0,bi.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,bi.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,bi.jsx)("p",{className:"text-gray-300 text-sm mb-4",children:"Generera fr\xe5gor med AI som automatiskt f\xe5r b\xe5de svensk och engelsk text, kategori och sv\xe5righetsgrad."}),V?(0,bi.jsxs)("div",{className:"bg-slate-800 rounded-lg p-4 mb-4 flex items-center gap-3",children:[(0,bi.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-cyan-400"}),(0,bi.jsx)("span",{className:"text-gray-300 text-sm",children:"Kontrollerar AI-providers..."})]}):U&&(0,bi.jsx)("div",{className:"space-y-2 mb-4",children:Object.entries(U).map(e=>{let[t,n]=e;const r=t.charAt(0).toUpperCase()+t.slice(1);return(0,bi.jsxs)("div",{className:"rounded-lg p-3 text-sm ".concat(n.available?"bg-green-500/10 border border-green-500/30":"bg-red-500/10 border border-red-500/30"),children:[(0,bi.jsxs)("div",{className:"flex items-center gap-2",children:[(0,bi.jsx)("span",{className:"text-lg",children:n.available?"\u2705":"\u274c"}),(0,bi.jsx)("span",{className:"font-semibold",children:r}),(0,bi.jsx)("span",{className:"ml-auto text-xs ".concat(n.available?"text-green-400":"text-red-400"),children:n.available?"Tillg\xe4nglig":n.configured?"Ej tillg\xe4nglig":"Inte konfigurerad"})]}),n.model&&(0,bi.jsxs)("p",{className:"text-xs text-gray-400 mt-1",children:["Model: ",n.model]}),!n.available&&n.error&&(0,bi.jsxs)("p",{className:"text-xs text-red-200 mt-1",children:["Fel: ",n.error]}),!n.available&&n.errorStatus&&(0,bi.jsxs)("p",{className:"text-[11px] text-red-200/80 mt-1",children:["Statuskod: ",n.errorStatus]})]},t)})}),(0,bi.jsxs)("div",{className:"space-y-4",children:[(0,bi.jsxs)("div",{children:[(0,bi.jsx)("label",{className:"block text-sm font-semibold text-cyan-200 mb-2",children:"Antal fr\xe5gor (1-50)"}),(0,bi.jsx)("input",{type:"number",min:"1",max:"50",value:P,onChange:e=>L(parseInt(e.target.value)||10),className:"w-full rounded bg-slate-800 border border-slate-600 px-3 py-2 text-white focus:ring-2 focus:ring-cyan-500 focus:outline-none"})]}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("label",{className:"block text-sm font-semibold text-cyan-200 mb-2",children:"Kategori (valfri)"}),(0,bi.jsxs)("select",{value:R,onChange:e=>O(e.target.value),className:"w-full rounded bg-slate-800 border border-slate-600 px-3 py-2 text-white focus:ring-2 focus:ring-cyan-500 focus:outline-none",children:[(0,bi.jsx)("option",{value:"",children:"Blandad"}),(0,bi.jsx)("option",{value:"Geografi",children:"Geografi"}),(0,bi.jsx)("option",{value:"Historia",children:"Historia"}),(0,bi.jsx)("option",{value:"Naturvetenskap",children:"Naturvetenskap"}),(0,bi.jsx)("option",{value:"Kultur",children:"Kultur"}),(0,bi.jsx)("option",{value:"Sport",children:"Sport"}),(0,bi.jsx)("option",{value:"Natur",children:"Natur"}),(0,bi.jsx)("option",{value:"Teknik",children:"Teknik"}),(0,bi.jsx)("option",{value:"Djur",children:"Djur"}),(0,bi.jsx)("option",{value:"G\xe5tor",children:"G\xe5tor"})]})]}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("label",{className:"block text-sm font-semibold text-cyan-200 mb-2",children:"\xc5ldersgrupp (valfri)"}),(0,bi.jsxs)("select",{value:M,onChange:e=>D(e.target.value),className:"w-full rounded bg-slate-800 border border-slate-600 px-3 py-2 text-white focus:ring-2 focus:ring-cyan-500 focus:outline-none",children:[(0,bi.jsx)("option",{value:"",children:"Blandad"}),(0,bi.jsx)("option",{value:"children",children:"Barn (6-12 \xe5r)"}),(0,bi.jsx)("option",{value:"youth",children:"Ungdomar (13-25 \xe5r)"}),(0,bi.jsx)("option",{value:"adults",children:"Vuxna (25+ \xe5r)"})]})]}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("label",{className:"block text-sm font-semibold text-cyan-200 mb-2",children:"AI-Provider"}),(0,bi.jsxs)("select",{value:F,onChange:e=>z(e.target.value),className:"w-full rounded bg-slate-800 border border-slate-600 px-3 py-2 text-white focus:ring-2 focus:ring-cyan-500 focus:outline-none",disabled:!U||Object.values(U).every(e=>!e.available),children:[U&&Object.values(U).some(e=>e.available)&&(0,bi.jsx)("option",{value:"random",children:"\ud83c\udfb2 Slumpm\xe4ssig (rekommenderad)"}),(null===U||void 0===U||null===(e=U.gemini)||void 0===e?void 0:e.available)&&(0,bi.jsx)("option",{value:"gemini",children:"Gemini (Google) - Snabb & Gratis"}),(null===U||void 0===U||null===(n=U.anthropic)||void 0===n?void 0:n.available)&&(0,bi.jsx)("option",{value:"anthropic",children:"Claude (Anthropic) - H\xf6g kvalitet"}),(null===U||void 0===U||null===(r=U.openai)||void 0===r?void 0:r.available)&&(0,bi.jsx)("option",{value:"openai",children:"GPT-4 (OpenAI) - Balanserad"}),(!U||Object.values(U).every(e=>!e.available))&&(0,bi.jsx)("option",{value:"",children:"Ingen provider tillg\xe4nglig"})]})]}),"random"===F&&U&&Object.values(U).some(e=>e.available)&&(0,bi.jsx)("div",{className:"bg-gradient-to-r from-purple-500/10 to-cyan-500/10 border border-purple-500/30 rounded-lg p-3",children:(0,bi.jsx)("p",{className:"text-xs text-purple-200",children:"\ud83c\udfb2 Slumpm\xe4ssig provider ger b\xe4st variation och kvalitet. Systemet v\xe4ljer automatiskt mellan tillg\xe4ngliga AI-providers f\xf6r varje fr\xe5ga."})}),"gemini"===F&&(null===U||void 0===U||null===(i=U.gemini)||void 0===i?void 0:i.available)&&(0,bi.jsx)("div",{className:"bg-cyan-500/10 border border-cyan-500/30 rounded-lg p-3",children:(0,bi.jsx)("p",{className:"text-xs text-cyan-200",children:"\ud83d\udca1 Gemini \xe4r Google's AI-modell. Den \xe4r helt gratis att anv\xe4nda och genererar fr\xe5gor snabbt p\xe5 b\xe5de svenska och engelska."})}),"anthropic"===F&&(null===U||void 0===U||null===(s=U.anthropic)||void 0===s?void 0:s.available)&&(0,bi.jsx)("div",{className:"bg-purple-500/10 border border-purple-500/30 rounded-lg p-3",children:(0,bi.jsx)("p",{className:"text-xs text-purple-200",children:"\ud83d\udca1 Claude \xe4r Anthropic's AI-modell. H\xf6g kvalitet med $5 gratis kredit per m\xe5nad (ca 500-1000 fr\xe5gor)."})}),"openai"===F&&(null===U||void 0===U||null===(a=U.openai)||void 0===a?void 0:a.available)&&(0,bi.jsx)("div",{className:"bg-green-500/10 border border-green-500/30 rounded-lg p-3",children:(0,bi.jsx)("p",{className:"text-xs text-green-200",children:"\ud83d\udca1 GPT-4 \xe4r OpenAI's AI-modell. Balanserad mellan kvalitet och kostnad. Kr\xe4ver betalning efter gratis-krediter."})}),(0,bi.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,bi.jsx)("button",{onClick:()=>I(!1),className:"flex-1 rounded-lg bg-slate-700 px-4 py-2 font-semibold text-gray-200 hover:bg-slate-600",children:"Avbryt"}),(0,bi.jsx)("button",{onClick:async()=>{v(!0),I(!1);const e=Math.ceil(1.5*P);try{const{taskId:t}=await Ui({amount:e,category:R||void 0,ageGroup:M||void 0,provider:F});if(t){const e="random"===F?"Blandade providers":F.toUpperCase(),n=[];if(n.push("".concat(P," fr\xe5gor")),R&&n.push(R),M){const e={children:"Barn",youth:"Ungdomar",adults:"Vuxna"};n.push(e[M]||M)}n.push(e),d(t,{taskType:"generation",label:"AI-generering",description:n.join(" \xb7 "),createdAt:new Date})}if(!t)throw new Error("Bakgrundsjobbet saknar taskId.");await Ac(t)}catch(t){console.error("Kunde inte generera fr\xe5gor:",t),de({isOpen:!0,title:"Fel vid AI-generering",message:"Kunde inte generera fr\xe5gor: ".concat(t.message),type:"error"})}finally{ce.current&&v(!1)}},disabled:!U||"random"!==F&&!(null!==(o=U[F])&&void 0!==o&&o.available)||"random"===F&&!Object.values(U).some(e=>e.available),className:"flex-1 rounded-lg px-4 py-2 font-semibold text-white transition-colors ".concat(U&&("random"===F&&Object.values(U).some(e=>e.available)||null!==(l=U[F])&&void 0!==l&&l.available)?"bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700":"bg-gray-600 cursor-not-allowed opacity-50"),children:"Generera"})]})]})]})})]})]}),(0,bi.jsx)(oa,{isOpen:ue.isOpen,onClose:()=>de((0,Ti.A)((0,Ti.A)({},ue),{},{isOpen:!1})),title:ue.title,message:ue.message,type:ue.type})]}):null},Oc=()=>{const e=X(),{isSuperUser:n}=Ci(),[r,i]=(0,t.useState)([]),[s,a]=(0,t.useState)(!0),[o,l]=(0,t.useState)(new Set),[c,u]=(0,t.useState)(""),[d,h]=(0,t.useState)({isOpen:!1,title:"",message:"",type:"info"});(0,t.useEffect)(()=>{if(!n)return void e("/");(async()=>{try{a(!0);const e=await ea.listRuns();i(e||[])}catch(e){console.error("Kunde inte ladda rundor:",e),i([])}finally{a(!1)}})()},[n,e]);const p=r.filter(e=>{var t,n,r;return(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(c.toLowerCase()))||(null===(n=e.createdByName)||void 0===n?void 0:n.toLowerCase().includes(c.toLowerCase()))||(null===(r=e.joinCode)||void 0===r?void 0:r.toLowerCase().includes(c.toLowerCase()))});return n?(0,bi.jsxs)("div",{className:"min-h-screen bg-slate-950",children:[(0,bi.jsx)(Sl,{title:"Alla rundor"}),(0,bi.jsxs)("div",{className:"mx-auto max-w-6xl px-4 pt-24 pb-8",children:[(0,bi.jsxs)("div",{className:"mb-6 flex flex-col md:flex-row gap-4 items-center justify-between",children:[(0,bi.jsx)("input",{type:"text",placeholder:"S\xf6k rundor...",value:c,onChange:e=>u(e.target.value),className:"w-full md:w-96 rounded bg-slate-800 border border-slate-600 px-4 py-2 text-gray-200"}),(0,bi.jsxs)("div",{className:"flex gap-2",children:[(0,bi.jsx)("button",{onClick:()=>{o.size===p.length?l(new Set):l(new Set(p.map(e=>e.id)))},className:"rounded bg-slate-700 px-4 py-2 font-semibold text-gray-200 hover:bg-slate-600",children:o.size===p.length?"Avmarkera alla":"Markera alla"}),o.size>0&&(0,bi.jsxs)("button",{onClick:async()=>{if(0!==o.size&&window.confirm("\xc4r du s\xe4ker p\xe5 att du vill radera ".concat(o.size," runda(r)?")))try{const e=Array.from(o).map(e=>ea.deleteRun(e));await Promise.all(e),i(e=>e.filter(e=>!o.has(e.id))),l(new Set)}catch(e){console.error("Kunde inte radera rundor:",e),h({isOpen:!0,title:"Kunde inte radera rundor",message:"Kunde inte radera alla rundor. Se konsolen f\xf6r detaljer.",type:"error"})}},className:"rounded bg-red-500 px-4 py-2 font-semibold text-white hover:bg-red-400",children:["Radera markerade (",o.size,")"]})]})]}),s?(0,bi.jsx)("div",{className:"text-center py-12 text-gray-400",children:"Laddar rundor..."}):0===p.length?(0,bi.jsx)("div",{className:"text-center py-12 text-gray-400",children:"Inga rundor hittades"}):(0,bi.jsx)("div",{className:"space-y-2",children:p.map(e=>{var t;return(0,bi.jsx)("div",{className:"rounded-lg border p-4 transition-colors ".concat(o.has(e.id)?"border-cyan-500 bg-cyan-900/20":"border-slate-700 bg-slate-900/60"),children:(0,bi.jsxs)("div",{className:"flex items-start gap-4",children:[(0,bi.jsx)("input",{type:"checkbox",checked:o.has(e.id),onChange:()=>{return t=e.id,void l(e=>{const n=new Set(e);return n.has(t)?n.delete(t):n.add(t),n});var t},className:"mt-1 w-5 h-5 rounded"}),(0,bi.jsxs)("div",{className:"flex-1",children:[(0,bi.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,bi.jsx)("h3",{className:"text-lg font-semibold text-gray-200",children:e.name}),(0,bi.jsx)("span",{className:"px-3 py-1 bg-slate-800 rounded text-sm font-mono text-cyan-300",children:e.joinCode})]}),(0,bi.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-sm text-gray-400",children:[(0,bi.jsxs)("div",{children:[(0,bi.jsx)("span",{className:"font-semibold",children:"Skapare:"})," ",e.createdByName||"Anonym"]}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("span",{className:"font-semibold",children:"L\xe4ngd:"})," ",e.lengthMeters,"m"]}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("span",{className:"font-semibold",children:"Fr\xe5gor:"})," ",e.questionCount||(null===(t=e.checkpoints)||void 0===t?void 0:t.length)||0]}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("span",{className:"font-semibold",children:"Sv\xe5righet:"})," ",e.difficulty||"N/A"]})]}),e.createdAt&&(0,bi.jsxs)("div",{className:"mt-2 text-xs text-gray-500",children:["Skapad: ",new Date(e.createdAt).toLocaleString("sv-SE")]})]})]})},e.id)})})]}),(0,bi.jsx)(oa,{isOpen:d.isOpen,onClose:()=>h((0,Ti.A)((0,Ti.A)({},d),{},{isOpen:!1})),title:d.title,message:d.message,type:d.type})]}):null},Mc=()=>{const e=X(),{isSuperUser:n,currentUser:r}=Ci(),[i,s]=(0,t.useState)([]),[a,o]=(0,t.useState)(!0),[l,c]=(0,t.useState)(new Set),[u,d]=(0,t.useState)(""),[h,p]=(0,t.useState)({isOpen:!1,title:"",message:"",type:"info"});(0,t.useEffect)(()=>{if(!n)return void e("/");(async()=>{try{o(!0);const e=pi(),t=(0,si.rJ)(e,"users"),n=(await(0,si.getDocs)(t)).docs.map(e=>(0,Ti.A)({id:e.id},e.data()));s(n||[])}catch(e){console.error("Kunde inte ladda anv\xe4ndare:",e),s([])}finally{o(!1)}})()},[n,e]);const f=i.filter(e=>{var t,n,r;return(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(u.toLowerCase()))||(null===(n=e.email)||void 0===n?void 0:n.toLowerCase().includes(u.toLowerCase()))||(null===(r=e.id)||void 0===r?void 0:r.toLowerCase().includes(u.toLowerCase()))});return n?(0,bi.jsxs)("div",{className:"min-h-screen bg-slate-950",children:[(0,bi.jsx)(Sl,{title:"Alla anv\xe4ndare"}),(0,bi.jsxs)("div",{className:"mx-auto max-w-6xl px-4 pt-24 pb-8",children:[(0,bi.jsxs)("div",{className:"mb-6 flex flex-col md:flex-row gap-4 items-center justify-between",children:[(0,bi.jsx)("input",{type:"text",placeholder:"S\xf6k anv\xe4ndare...",value:u,onChange:e=>d(e.target.value),className:"w-full md:w-96 rounded bg-slate-800 border border-slate-600 px-4 py-2 text-gray-200"}),(0,bi.jsxs)("div",{className:"flex gap-2",children:[(0,bi.jsx)("button",{onClick:()=>{const e=f.filter(e=>e.id!==(null===r||void 0===r?void 0:r.id));l.size===e.length?c(new Set):c(new Set(e.map(e=>e.id)))},className:"rounded bg-slate-700 px-4 py-2 font-semibold text-gray-200 hover:bg-slate-600",children:l.size===f.filter(e=>e.id!==(null===r||void 0===r?void 0:r.id)).length?"Avmarkera alla":"Markera alla"}),l.size>0&&(0,bi.jsxs)("button",{onClick:async()=>{if(0!==l.size&&window.confirm("\xc4r du s\xe4ker p\xe5 att du vill radera ".concat(l.size," anv\xe4ndare?")))try{const e=pi(),t=Array.from(l).map(t=>(0,si.deleteDoc)((0,si.H9)(e,"users",t)));await Promise.all(t),s(e=>e.filter(e=>!l.has(e.id))),c(new Set)}catch(e){console.error("Kunde inte radera anv\xe4ndare:",e),p({isOpen:!0,title:"Kunde inte radera anv\xe4ndare",message:"Kunde inte radera alla anv\xe4ndare. Se konsolen f\xf6r detaljer.",type:"error"})}},className:"rounded bg-red-500 px-4 py-2 font-semibold text-white hover:bg-red-400",children:["Radera markerade (",l.size,")"]})]})]}),a?(0,bi.jsx)("div",{className:"text-center py-12 text-gray-400",children:"Laddar anv\xe4ndare..."}):0===f.length?(0,bi.jsx)("div",{className:"text-center py-12 text-gray-400",children:"Inga anv\xe4ndare hittades"}):(0,bi.jsx)("div",{className:"space-y-2",children:f.map(e=>{var t,n;const i=e.id===(null===r||void 0===r?void 0:r.id),s=!0===e.superUser;return(0,bi.jsx)("div",{className:"rounded-lg border p-4 transition-colors ".concat(i?"border-yellow-500 bg-yellow-900/20":l.has(e.id)?"border-cyan-500 bg-cyan-900/20":"border-slate-700 bg-slate-900/60"),children:(0,bi.jsxs)("div",{className:"flex items-start gap-4",children:[(0,bi.jsx)("input",{type:"checkbox",checked:l.has(e.id),onChange:()=>{var t;(t=e.id)!==(null===r||void 0===r?void 0:r.id)&&c(e=>{const n=new Set(e);return n.has(t)?n.delete(t):n.add(t),n})},disabled:i,className:"mt-1 w-5 h-5 rounded disabled:opacity-30"}),(0,bi.jsxs)("div",{className:"flex-1",children:[(0,bi.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,bi.jsx)("h3",{className:"text-lg font-semibold text-gray-200",children:e.name}),i&&(0,bi.jsx)("span",{className:"px-2 py-0.5 bg-yellow-500/20 border border-yellow-500/50 rounded text-xs text-yellow-300",children:"Du"}),s&&(0,bi.jsx)("span",{className:"px-2 py-0.5 bg-red-500/20 border border-red-500/50 rounded text-xs text-red-300",children:"SuperUser"})]}),(0,bi.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 text-sm text-gray-400",children:[(0,bi.jsxs)("div",{children:[(0,bi.jsx)("span",{className:"font-semibold",children:"Kontakt:"})," ",(null===(t=e.profile)||void 0===t?void 0:t.contact)||e.email||e.contact||"Ej angiven"]}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("span",{className:"font-semibold",children:"Namn:"})," ",(null===(n=e.profile)||void 0===n?void 0:n.displayName)||e.name||"Ej angiven"]}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("span",{className:"font-semibold",children:"ID:"})," ",e.id]})]}),e.createdAt&&(0,bi.jsxs)("div",{className:"mt-2 text-xs text-gray-500",children:["Registrerad: ",new Date(e.createdAt).toLocaleString("sv-SE")]})]})]})},e.id)})})]}),(0,bi.jsx)(oa,{isOpen:h.isOpen,onClose:()=>p((0,Ti.A)((0,Ti.A)({},h),{},{isOpen:!1})),title:h.title,message:h.message,type:h.type})]}):null},Dc=()=>{var e,n,r;const i=X(),{isSuperUser:s,currentUser:a}=Ci(),[o,l]=(0,t.useState)(null),[c,u]=(0,t.useState)([]),[d,h]=(0,t.useState)(!0),[p,f]=(0,t.useState)("all"),[m,g]=(0,t.useState)("all"),[v,y]=(0,t.useState)("all"),[x,b]=(0,t.useState)("all"),[w,_]=(0,t.useState)("all"),[k,N]=(0,t.useState)(!1),[S,j]=(0,t.useState)(new Set),[E,C]=(0,t.useState)(!1),[T,A]=(0,t.useState)(""),[I,P]=(0,t.useState)(""),[L,R]=(0,t.useState)(!1),[O,M]=(0,t.useState)({isOpen:!1,title:"",message:"",type:"info"});(0,t.useEffect)(()=>{if(!s)return void i("/");(async()=>{try{h(!0);const e=await ro();l(e);const t=await eo({limit:100});u(t)}catch(e){console.error("Kunde inte ladda analytics:",e)}finally{h(!1)}})()},[s,i]);const D=c.filter(e=>{var t;if("all"!==p&&e.eventType!==p)return!1;if("all"!==v&&e.deviceType!==v)return!1;if("all"!==x&&e.os!==x)return!1;if("all"!==w&&e.browser!==w)return!1;if("all"!==m&&null!==(t=e.timestamp)&&void 0!==t&&t.toDate){const t=e.timestamp.toDate(),n=new Date,r=864e5;switch(m){case"today":if(t<new Date(n.getFullYear(),n.getMonth(),n.getDate()))return!1;break;case"week":if(t<new Date(n.getTime()-7*r))return!1;break;case"month":if(t<new Date(n.getTime()-30*r))return!1}}return!0}),F=e=>null!==e&&void 0!==e&&e.toDate?new Date(e.toDate()).toLocaleString("sv-SE"):"N/A",z=e=>(e/100).toFixed(2)+" kr",U=[...new Set(c.map(e=>e.deviceType).filter(Boolean))],B=[...new Set(c.map(e=>e.os).filter(Boolean))],V=[...new Set(c.map(e=>e.browser).filter(Boolean))],q=c.reduce((e,t)=>{var n,r;return!e[t.deviceId]||(null===(n=t.timestamp)||void 0===n?void 0:n.toDate())>(null===(r=e[t.deviceId].timestamp)||void 0===r?void 0:r.toDate())?e[t.deviceId]={deviceId:t.deviceId,deviceType:t.deviceType,os:t.os,browser:t.browser,userId:t.userId,lastSeen:t.timestamp,eventCount:1}:e[t.deviceId].eventCount++,e},{}),K=Object.values(q),H=e=>{const t=new Set(S);t.has(e)?t.delete(e):t.add(e),j(t)},W=()=>{j(new Set)},G={totalEvents:D.length,uniqueDevices:new Set(D.map(e=>e.deviceId)).size,uniqueUsers:new Set(D.filter(e=>e.userId).map(e=>e.userId)).size,eventsByType:D.reduce((e,t)=>(e[t.eventType]=(e[t.eventType]||0)+1,e),{}),donations:{count:D.filter(e=>"donation"===e.eventType).length,total:D.filter(e=>{var t;return"donation"===e.eventType&&(null===(t=e.metadata)||void 0===t?void 0:t.amount)}).reduce((e,t)=>e+t.metadata.amount,0)}};return s?(0,bi.jsxs)("div",{className:"min-h-screen bg-slate-950",children:[(0,bi.jsx)(Sl,{title:"Bes\xf6ksstatistik"}),(0,bi.jsx)("div",{className:"mx-auto max-w-7xl px-4 pt-24 pb-8 space-y-8",children:d?(0,bi.jsx)("div",{className:"text-center py-12 text-gray-400",children:"Laddar statistik..."}):(0,bi.jsxs)(bi.Fragment,{children:[(0,bi.jsx)("div",{className:"rounded-lg border border-slate-700 bg-slate-900/60 p-4",children:(0,bi.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,bi.jsxs)("div",{children:[(0,bi.jsx)("label",{className:"block text-sm font-semibold text-cyan-200 mb-2",children:"Tidsperiod"}),(0,bi.jsxs)("select",{value:m,onChange:e=>g(e.target.value),className:"w-full rounded bg-slate-800 border border-slate-600 px-3 py-2 text-gray-200",children:[(0,bi.jsx)("option",{value:"all",children:"All tid"}),(0,bi.jsx)("option",{value:"today",children:"Idag"}),(0,bi.jsx)("option",{value:"week",children:"Senaste 7 dagarna"}),(0,bi.jsx)("option",{value:"month",children:"Senaste 30 dagarna"})]})]}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("label",{className:"block text-sm font-semibold text-cyan-200 mb-2",children:"H\xe4ndelsetyp"}),(0,bi.jsxs)("select",{value:p,onChange:e=>f(e.target.value),className:"w-full rounded bg-slate-800 border border-slate-600 px-3 py-2 text-gray-200",children:[(0,bi.jsx)("option",{value:"all",children:"Alla h\xe4ndelser"}),(0,bi.jsx)("option",{value:"page_view",children:"Sidvisningar"}),(0,bi.jsx)("option",{value:"create_run",children:"Skapade rundor"}),(0,bi.jsx)("option",{value:"join_run",children:"Anslutningar"}),(0,bi.jsx)("option",{value:"donation",children:"Donationer"}),(0,bi.jsx)("option",{value:"device_linked",children:"L\xe4nkade enheter"})]})]}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("label",{className:"block text-sm font-semibold text-cyan-200 mb-2",children:"Enhetstyp"}),(0,bi.jsxs)("select",{value:v,onChange:e=>y(e.target.value),className:"w-full rounded bg-slate-800 border border-slate-600 px-3 py-2 text-gray-200",children:[(0,bi.jsx)("option",{value:"all",children:"Alla enhetstyper"}),U.map(e=>(0,bi.jsx)("option",{value:e,children:e},e))]})]}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("label",{className:"block text-sm font-semibold text-cyan-200 mb-2",children:"Operativsystem"}),(0,bi.jsxs)("select",{value:x,onChange:e=>b(e.target.value),className:"w-full rounded bg-slate-800 border border-slate-600 px-3 py-2 text-gray-200",children:[(0,bi.jsx)("option",{value:"all",children:"Alla OS"}),B.map(e=>(0,bi.jsx)("option",{value:e,children:e},e))]})]}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("label",{className:"block text-sm font-semibold text-cyan-200 mb-2",children:"Webbl\xe4sare"}),(0,bi.jsxs)("select",{value:w,onChange:e=>_(e.target.value),className:"w-full rounded bg-slate-800 border border-slate-600 px-3 py-2 text-gray-200",children:[(0,bi.jsx)("option",{value:"all",children:"Alla webbl\xe4sare"}),V.map(e=>(0,bi.jsx)("option",{value:e,children:e},e))]})]}),(0,bi.jsx)("div",{className:"flex items-end",children:(0,bi.jsx)("button",{onClick:()=>N(!k),className:"w-full px-4 py-2 bg-cyan-500 hover:bg-cyan-400 text-black rounded-lg font-semibold transition-colors",children:k?"D\xf6lj enhetslista":"Visa unika enheter"})})]})}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("h2",{className:"text-lg font-semibold text-gray-300 mb-3",children:"\ud83d\udcca Total statistik (all tid)"}),(0,bi.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,bi.jsxs)("div",{className:"rounded-lg border border-purple-500/40 bg-purple-900/20 p-6",children:[(0,bi.jsx)("h3",{className:"text-sm font-semibold text-purple-200 mb-2",children:"Totala h\xe4ndelser"}),(0,bi.jsx)("p",{className:"text-3xl font-bold text-purple-100",children:(null===o||void 0===o?void 0:o.totalVisits)||0})]}),(0,bi.jsxs)("div",{className:"rounded-lg border border-cyan-500/40 bg-cyan-900/20 p-6",children:[(0,bi.jsx)("h3",{className:"text-sm font-semibold text-cyan-200 mb-2",children:"Unika enheter"}),(0,bi.jsx)("p",{className:"text-3xl font-bold text-cyan-100",children:(null===o||void 0===o?void 0:o.uniqueDevices)||0})]}),(0,bi.jsxs)("div",{className:"rounded-lg border border-green-500/40 bg-green-900/20 p-6",children:[(0,bi.jsx)("h3",{className:"text-sm font-semibold text-green-200 mb-2",children:"Donationer"}),(0,bi.jsx)("p",{className:"text-3xl font-bold text-green-100",children:(null===o||void 0===o||null===(e=o.donations)||void 0===e?void 0:e.count)||0}),(0,bi.jsx)("p",{className:"text-sm text-green-300 mt-1",children:z((null===o||void 0===o||null===(n=o.donations)||void 0===n?void 0:n.total)||0)})]}),(0,bi.jsxs)("div",{className:"rounded-lg border border-amber-500/40 bg-amber-900/20 p-6",children:[(0,bi.jsx)("h3",{className:"text-sm font-semibold text-amber-200 mb-2",children:"Skapade rundor"}),(0,bi.jsx)("p",{className:"text-3xl font-bold text-amber-100",children:(null===o||void 0===o||null===(r=o.eventsByType)||void 0===r?void 0:r.create_run)||0})]})]})]}),("all"!==m||"all"!==p)&&(0,bi.jsxs)("div",{children:[(0,bi.jsxs)("h2",{className:"text-lg font-semibold text-gray-300 mb-3",children:["\ud83d\udd0d Filtrerad statistik",(0,bi.jsxs)("span",{className:"text-sm font-normal text-gray-400 ml-2",children:["(","today"===m?"Idag":"week"===m?"Senaste 7 dagarna":"month"===m?"Senaste 30 dagarna":"All tid","all"!==p&&" \u2022 ".concat(p),")"]})]}),(0,bi.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,bi.jsxs)("div",{className:"rounded-lg border border-purple-500/40 bg-purple-900/20 p-6",children:[(0,bi.jsx)("h3",{className:"text-sm font-semibold text-purple-200 mb-2",children:"H\xe4ndelser"}),(0,bi.jsx)("p",{className:"text-3xl font-bold text-purple-100",children:G.totalEvents})]}),(0,bi.jsxs)("div",{className:"rounded-lg border border-cyan-500/40 bg-cyan-900/20 p-6",children:[(0,bi.jsx)("h3",{className:"text-sm font-semibold text-cyan-200 mb-2",children:"Unika enheter"}),(0,bi.jsx)("p",{className:"text-3xl font-bold text-cyan-100",children:G.uniqueDevices}),(0,bi.jsxs)("p",{className:"text-xs text-cyan-300 mt-1",children:[G.uniqueUsers," anv\xe4ndare"]})]}),(0,bi.jsxs)("div",{className:"rounded-lg border border-green-500/40 bg-green-900/20 p-6",children:[(0,bi.jsx)("h3",{className:"text-sm font-semibold text-green-200 mb-2",children:"Donationer"}),(0,bi.jsx)("p",{className:"text-3xl font-bold text-green-100",children:G.donations.count}),(0,bi.jsx)("p",{className:"text-sm text-green-300 mt-1",children:z(G.donations.total)})]}),(0,bi.jsxs)("div",{className:"rounded-lg border border-amber-500/40 bg-amber-900/20 p-6",children:[(0,bi.jsx)("h3",{className:"text-sm font-semibold text-amber-200 mb-2",children:"Skapade rundor"}),(0,bi.jsx)("p",{className:"text-3xl font-bold text-amber-100",children:G.eventsByType.create_run||0})]})]})]}),(0,bi.jsxs)("div",{className:"rounded-lg border border-slate-700 bg-slate-900/60 p-6",children:[(0,bi.jsx)("h2",{className:"text-xl font-semibold text-gray-200 mb-4",children:"H\xe4ndelser per typ"}),(0,bi.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Object.entries((null===o||void 0===o?void 0:o.eventsByType)||{}).map(e=>{let[t,n]=e;return(0,bi.jsxs)("div",{className:"rounded bg-slate-800/60 p-3",children:[(0,bi.jsx)("p",{className:"text-sm text-gray-400",children:t}),(0,bi.jsx)("p",{className:"text-2xl font-bold text-gray-100",children:n})]},t)})})]}),k&&(0,bi.jsxs)("div",{className:"rounded-lg border border-cyan-500/40 bg-cyan-900/10 p-6",children:[(0,bi.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,bi.jsxs)("h2",{className:"text-xl font-semibold text-gray-200",children:["\ud83d\udcf1 Unika enheter (",K.length,")"]}),(0,bi.jsxs)("div",{className:"flex gap-2",children:[S.size>0&&(0,bi.jsxs)(bi.Fragment,{children:[(0,bi.jsxs)("button",{onClick:()=>C(!0),className:"px-4 py-2 bg-green-500 hover:bg-green-400 text-black rounded-lg font-semibold transition-colors",children:["Skicka meddelande (",S.size,")"]}),(0,bi.jsx)("button",{onClick:W,className:"px-4 py-2 bg-red-500 hover:bg-red-400 text-white rounded-lg font-semibold transition-colors",children:"Avmarkera alla"})]}),(0,bi.jsx)("button",{onClick:S.size===K.length?W:()=>{j(new Set(K.map(e=>e.deviceId)))},className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-gray-200 rounded-lg font-semibold transition-colors",children:S.size===K.length?"Avmarkera alla":"Markera alla"})]})]}),(0,bi.jsx)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:K.map(e=>(0,bi.jsx)("div",{onClick:()=>H(e.deviceId),className:"rounded border p-4 cursor-pointer transition-all ".concat(S.has(e.deviceId)?"border-cyan-500 bg-cyan-900/30 ring-2 ring-cyan-500/50":"border-slate-700 bg-slate-800/40 hover:border-slate-600"),children:(0,bi.jsx)("div",{className:"flex items-start justify-between gap-4",children:(0,bi.jsxs)("div",{className:"flex-1",children:[(0,bi.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,bi.jsx)("input",{type:"checkbox",checked:S.has(e.deviceId),onChange:()=>H(e.deviceId),className:"w-4 h-4",onClick:e=>e.stopPropagation()}),(0,bi.jsx)("span",{className:"font-mono text-sm text-gray-300",children:e.deviceId})]}),(0,bi.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-sm",children:[e.deviceType&&(0,bi.jsxs)("div",{className:"flex items-center gap-1",children:[(0,bi.jsx)("span",{className:"text-gray-400",children:"Typ:"}),(0,bi.jsx)("span",{className:"text-cyan-200",children:e.deviceType})]}),e.os&&(0,bi.jsxs)("div",{className:"flex items-center gap-1",children:[(0,bi.jsx)("span",{className:"text-gray-400",children:"OS:"}),(0,bi.jsx)("span",{className:"text-cyan-200",children:e.os})]}),e.browser&&(0,bi.jsxs)("div",{className:"flex items-center gap-1",children:[(0,bi.jsx)("span",{className:"text-gray-400",children:"Webbl\xe4sare:"}),(0,bi.jsx)("span",{className:"text-cyan-200",children:e.browser})]}),(0,bi.jsxs)("div",{className:"flex items-center gap-1",children:[(0,bi.jsx)("span",{className:"text-gray-400",children:"H\xe4ndelser:"}),(0,bi.jsx)("span",{className:"text-cyan-200",children:e.eventCount})]})]}),e.userId&&(0,bi.jsxs)("div",{className:"mt-2 text-xs text-gray-400",children:["Anv\xe4ndare: ",e.userId.substring(0,12),"..."]}),(0,bi.jsxs)("div",{className:"mt-1 text-xs text-gray-500",children:["Senast sedd: ",F(e.lastSeen)]})]})})},e.deviceId))})]}),E&&(0,bi.jsxs)(bi.Fragment,{children:[(0,bi.jsx)("div",{className:"fixed inset-0 bg-black/60 z-40",onClick:()=>C(!1)}),(0,bi.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:(0,bi.jsxs)("div",{className:"bg-slate-900 rounded-lg border border-slate-700 p-6 max-w-lg w-full",children:[(0,bi.jsxs)("h3",{className:"text-xl font-bold text-gray-200 mb-4",children:["Skicka meddelande till ",S.size," enheter"]}),(0,bi.jsxs)("div",{className:"space-y-4",children:[(0,bi.jsxs)("div",{children:[(0,bi.jsx)("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Titel"}),(0,bi.jsx)("input",{type:"text",value:T,onChange:e=>A(e.target.value),className:"w-full rounded bg-slate-800 border border-slate-600 px-3 py-2 text-gray-200",placeholder:"Meddelandetitel..."})]}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("label",{className:"block text-sm font-semibold text-gray-300 mb-2",children:"Meddelande"}),(0,bi.jsx)("textarea",{value:I,onChange:e=>P(e.target.value),className:"w-full rounded bg-slate-800 border border-slate-600 px-3 py-2 text-gray-200 min-h-32",placeholder:"Skriv ditt meddelande h\xe4r..."})]}),(0,bi.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,bi.jsx)("button",{onClick:()=>C(!1),disabled:L,className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-gray-200 rounded-lg font-semibold transition-colors disabled:opacity-50",children:"Avbryt"}),(0,bi.jsx)("button",{onClick:async()=>{if(T.trim()&&I.trim())if(0!==S.size){R(!0);try{const e=Array.from(S).map(e=>{const t=K.find(t=>t.deviceId===e);return lo({title:T,message:I,userId:(null===t||void 0===t?void 0:t.userId)||null,deviceId:e,adminId:(null===a||void 0===a?void 0:a.uid)||null,type:"system",metadata:{sentFrom:"analytics_page",sentBy:"superuser"}})});await Promise.all(e),M({isOpen:!0,title:"Meddelande skickat",message:"Meddelande skickat till ".concat(S.size," enheter"),type:"success"}),C(!1),A(""),P(""),j(new Set)}catch(e){console.error("Kunde inte skicka meddelande:",e),M({isOpen:!0,title:"Kunde inte skicka meddelande",message:"Kunde inte skicka meddelande. Se konsolen f\xf6r detaljer.",type:"error"})}finally{R(!1)}}else M({isOpen:!0,title:"Ingen markering",message:"V\xe4lj minst en enhet att skicka till",type:"warning"});else M({isOpen:!0,title:"Ogiltigt meddelande",message:"Titel och meddelande f\xe5r inte vara tomma",type:"warning"})},disabled:L,className:"px-4 py-2 bg-green-500 hover:bg-green-400 text-black rounded-lg font-semibold transition-colors disabled:opacity-50",children:L?"Skickar...":"Skicka"})]})]})]})})]}),(0,bi.jsxs)("div",{className:"rounded-lg border border-slate-700 bg-slate-900/60 p-6",children:[(0,bi.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,bi.jsxs)("h2",{className:"text-xl font-semibold text-gray-200",children:["Senaste h\xe4ndelser",(0,bi.jsxs)("span",{className:"text-sm font-normal text-gray-400 ml-2",children:["(",D.length," av ",c.length,")"]})]})}),(0,bi.jsx)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:0===D.length?(0,bi.jsx)("div",{className:"text-center py-8 text-gray-400",children:"Inga h\xe4ndelser hittades"}):D.map(e=>{var t,n,r;return(0,bi.jsx)("div",{className:"rounded border border-slate-700 bg-slate-800/40 p-3 text-sm",children:(0,bi.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,bi.jsxs)("div",{className:"flex-1",children:[(0,bi.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,bi.jsx)("span",{className:"inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ".concat("donation"===e.eventType?"bg-green-500/20 text-green-200":"create_run"===e.eventType?"bg-purple-500/20 text-purple-200":"join_run"===e.eventType?"bg-cyan-500/20 text-cyan-200":"page_view"===e.eventType?"bg-slate-500/20 text-slate-200":"bg-amber-500/20 text-amber-200"),children:e.eventType}),e.userId&&(0,bi.jsxs)("span",{className:"text-xs text-gray-400",children:["User: ",e.userId.substring(0,8),"..."]})]}),(0,bi.jsxs)("div",{className:"text-gray-300",children:["Device: ",(0,bi.jsx)("span",{className:"font-mono text-xs",children:e.deviceId})]}),(e.deviceType||e.os||e.browser)&&(0,bi.jsxs)("div",{className:"flex gap-3 text-xs mt-1",children:[e.deviceType&&(0,bi.jsx)("span",{className:"text-cyan-300",children:e.deviceType}),e.os&&(0,bi.jsx)("span",{className:"text-cyan-300",children:e.os}),e.browser&&(0,bi.jsx)("span",{className:"text-cyan-300",children:e.browser})]}),(null===(t=e.metadata)||void 0===t?void 0:t.path)&&(0,bi.jsxs)("div",{className:"text-gray-400",children:["Path: ",e.metadata.path]}),(null===(n=e.metadata)||void 0===n?void 0:n.runId)&&(0,bi.jsxs)("div",{className:"text-gray-400",children:["Run: ",e.metadata.runName||e.metadata.runId]}),(null===(r=e.metadata)||void 0===r?void 0:r.amount)&&(0,bi.jsxs)("div",{className:"text-green-300 font-semibold",children:["Belopp: ",z(e.metadata.amount)]})]}),(0,bi.jsx)("div",{className:"text-xs text-gray-500 text-right",children:F(e.timestamp)})]})},e.id)})})]})]})}),(0,bi.jsx)(oa,{isOpen:O.isOpen,onClose:()=>M((0,Ti.A)((0,Ti.A)({},O),{},{isOpen:!1})),title:O.title,message:O.message,type:O.type})]}):null},Fc=()=>{const e=X(),{isSuperUser:n,currentUser:r}=Ci(),[i,s]=(0,t.useState)([]),[a,o]=(0,t.useState)(!0),[l,c]=(0,t.useState)(!1),[u,d]=(0,t.useState)({isOpen:!1,title:"",message:"",type:"info"}),[h,p]=(0,t.useState)({title:"",body:"",type:"info",targetType:"all",targetId:""});(0,t.useEffect)(()=>{n?f():e("/")},[n,e]);const f=async()=>{try{o(!0);const e=await fo();s(e)}catch(e){console.error("Kunde inte ladda meddelanden:",e)}finally{o(!1)}},m=e=>{switch(e){case"info":return"bg-blue-500/20 text-blue-200 border-blue-500/50";case"success":return"bg-green-500/20 text-green-200 border-green-500/50";case"warning":return"bg-amber-500/20 text-amber-200 border-amber-500/50";case"error":return"bg-red-500/20 text-red-200 border-red-500/50";default:return"bg-slate-500/20 text-slate-200 border-slate-500/50"}},g=e=>"all"===e.targetType?"Alla anv\xe4ndare":"user"===e.targetType?"Anv\xe4ndare: ".concat(e.targetId):"device"===e.targetType?"Enhet: ".concat(e.targetId):"Ok\xe4nd mottagare";return n?(0,bi.jsxs)("div",{className:"min-h-screen bg-slate-950",children:[(0,bi.jsx)(Sl,{title:"Meddelanden"}),(0,bi.jsxs)("div",{className:"mx-auto max-w-6xl px-4 pt-24 pb-8 space-y-6",children:[(0,bi.jsxs)("div",{className:"flex justify-between items-center",children:[(0,bi.jsx)("h2",{className:"text-2xl font-bold text-gray-200",children:"Hantera meddelanden"}),(0,bi.jsx)("button",{onClick:()=>c(!l),className:"rounded bg-purple-500 px-4 py-2 font-semibold text-black hover:bg-purple-400",children:l?"Avbryt":"+ Nytt meddelande"})]}),l&&(0,bi.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{await lo(h,r.id),p({title:"",body:"",type:"info",targetType:"all",targetId:""}),c(!1),await f(),d({isOpen:!0,title:"Meddelande skickat",message:"Meddelande skickat!",type:"success"})}catch(t){console.error("Kunde inte skicka meddelande:",t),d({isOpen:!0,title:"Kunde inte skicka meddelande",message:"Kunde inte skicka meddelande. Se konsolen f\xf6r detaljer.",type:"error"})}},className:"rounded-lg border border-purple-500/40 bg-slate-900/60 p-6 space-y-4",children:[(0,bi.jsx)("h3",{className:"text-xl font-semibold text-purple-200",children:"Skapa nytt meddelande"}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("label",{className:"mb-1 block text-sm font-semibold text-gray-200",children:"Rubrik"}),(0,bi.jsx)("input",{type:"text",value:h.title,onChange:e=>p((0,Ti.A)((0,Ti.A)({},h),{},{title:e.target.value})),className:"w-full rounded bg-slate-800 border border-slate-600 px-3 py-2 text-gray-200",required:!0})]}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("label",{className:"mb-1 block text-sm font-semibold text-gray-200",children:"Meddelande"}),(0,bi.jsx)("textarea",{value:h.body,onChange:e=>p((0,Ti.A)((0,Ti.A)({},h),{},{body:e.target.value})),className:"w-full rounded bg-slate-800 border border-slate-600 px-3 py-2 text-gray-200 min-h-32",required:!0})]}),(0,bi.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,bi.jsxs)("div",{children:[(0,bi.jsx)("label",{className:"mb-1 block text-sm font-semibold text-gray-200",children:"Typ"}),(0,bi.jsxs)("select",{value:h.type,onChange:e=>p((0,Ti.A)((0,Ti.A)({},h),{},{type:e.target.value})),className:"w-full rounded bg-slate-800 border border-slate-600 px-3 py-2 text-gray-200",children:[(0,bi.jsx)("option",{value:"info",children:"Info"}),(0,bi.jsx)("option",{value:"success",children:"Framg\xe5ng"}),(0,bi.jsx)("option",{value:"warning",children:"Varning"}),(0,bi.jsx)("option",{value:"error",children:"Fel"})]})]}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("label",{className:"mb-1 block text-sm font-semibold text-gray-200",children:"Mottagare"}),(0,bi.jsxs)("select",{value:h.targetType,onChange:e=>p((0,Ti.A)((0,Ti.A)({},h),{},{targetType:e.target.value,targetId:""})),className:"w-full rounded bg-slate-800 border border-slate-600 px-3 py-2 text-gray-200",children:[(0,bi.jsx)("option",{value:"all",children:"Alla"}),(0,bi.jsx)("option",{value:"user",children:"Specifik anv\xe4ndare"}),(0,bi.jsx)("option",{value:"device",children:"Specifik enhet"})]})]}),"all"!==h.targetType&&(0,bi.jsxs)("div",{children:[(0,bi.jsx)("label",{className:"mb-1 block text-sm font-semibold text-gray-200",children:"user"===h.targetType?"Anv\xe4ndar-ID":"Enhets-ID"}),(0,bi.jsx)("input",{type:"text",value:h.targetId,onChange:e=>p((0,Ti.A)((0,Ti.A)({},h),{},{targetId:e.target.value})),className:"w-full rounded bg-slate-800 border border-slate-600 px-3 py-2 text-gray-200",required:!0})]})]}),(0,bi.jsx)("button",{type:"submit",className:"w-full rounded bg-purple-500 px-4 py-3 font-bold text-black hover:bg-purple-400",children:"Skicka meddelande"})]}),(0,bi.jsxs)("div",{className:"space-y-3",children:[(0,bi.jsx)("h3",{className:"text-lg font-semibold text-gray-200",children:"Skickade meddelanden"}),a?(0,bi.jsx)("div",{className:"text-center py-12 text-gray-400",children:"Laddar meddelanden..."}):0===i.length?(0,bi.jsx)("div",{className:"text-center py-12 text-gray-400",children:"Inga meddelanden hittades"}):i.map(e=>{return(0,bi.jsx)("div",{className:"rounded-lg border border-slate-700 bg-slate-900/60 p-4",children:(0,bi.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,bi.jsxs)("div",{className:"flex-1",children:[(0,bi.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,bi.jsx)("h4",{className:"text-lg font-semibold text-gray-200",children:e.title}),(0,bi.jsx)("span",{className:"px-2 py-0.5 border rounded text-xs font-medium ".concat(m(e.type)),children:e.type})]}),(0,bi.jsx)("p",{className:"text-gray-300 mb-3",children:e.body}),(0,bi.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-400",children:[(0,bi.jsxs)("span",{children:["Mottagare: ",g(e)]}),(0,bi.jsx)("span",{children:"\u2022"}),(0,bi.jsxs)("span",{children:["Skapat: ",(t=e.createdAt,null!==t&&void 0!==t&&t.toDate?new Date(t.toDate()).toLocaleString("sv-SE"):"N/A")]}),e.read&&(0,bi.jsxs)(bi.Fragment,{children:[(0,bi.jsx)("span",{children:"\u2022"}),(0,bi.jsx)("span",{className:"text-green-400",children:"L\xe4st"})]})]})]}),(0,bi.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("\xc4r du s\xe4ker p\xe5 att du vill radera detta meddelande?"))try{await po(e),await f()}catch(t){console.error("Kunde inte radera meddelande:",t),d({isOpen:!0,title:"Kunde inte radera meddelande",message:"Kunde inte radera meddelande.",type:"error"})}})(e.id),className:"text-red-400 hover:text-red-300 transition-colors p-2",title:"Radera",children:(0,bi.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,bi.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})},e.id);var t})]})]}),(0,bi.jsx)(oa,{isOpen:u.isOpen,onClose:()=>d((0,Ti.A)((0,Ti.A)({},u),{},{isOpen:!1})),title:u.title,message:u.message,type:u.type})]}):null},zc=pi(),Uc=()=>{const e=X(),{isSuperUser:n}=Ci(),[r,i]=(0,t.useState)([]),[s,a]=(0,t.useState)(!0),[o,l]=(0,t.useState)("all");(0,t.useEffect)(()=>{if(!n)return void e("/");const t=(0,si.P)((0,si.rJ)(zc,"notifications"),(0,si._M)("targetAudience","==","superusers"),(0,si.My)("createdAt","desc")),r=(0,si.aQ)(t,e=>{const t=e.docs.map(e=>(0,Ti.A)({id:e.id},e.data()));i(t),a(!1)},e=>{console.error("Kunde inte ladda notifikationer:",e),a(!1)});return()=>r()},[n,e]);const c=r.filter(e=>"unread"===o?!e.read:"success"===o?"question_import"===e.type:"error"!==o||"question_import_error"===e.type),u=r.filter(e=>!e.read).length,d=e=>{if(null===e||void 0===e||!e.toDate)return"N/A";const t=e.toDate(),n=new Date-t,r=Math.floor(n/6e4),i=Math.floor(n/36e5),s=Math.floor(n/864e5);return r<1?"Just nu":r<60?"".concat(r," min sedan"):i<24?"".concat(i," timmar sedan"):s<7?"".concat(s," dagar sedan"):t.toLocaleDateString("sv-SE")},h=e=>{switch(e){case"question_import":return"\u2705";case"question_import_error":return"\u274c";default:return"\ud83d\udce2"}},p=e=>{switch(e){case"question_import":return"border-green-500/40 bg-green-900/20";case"question_import_error":return"border-red-500/40 bg-red-900/20";default:return"border-cyan-500/40 bg-cyan-900/20"}};return n?(0,bi.jsxs)("div",{className:"min-h-screen bg-slate-950",children:[(0,bi.jsx)(Sl,{title:"Systemnotiser"}),(0,bi.jsxs)("div",{className:"mx-auto max-w-4xl px-4 pt-24 pb-8 space-y-6",children:[(0,bi.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,bi.jsxs)("div",{children:[(0,bi.jsx)("h2",{className:"text-2xl font-bold text-gray-200",children:"Systemnotiser"}),(0,bi.jsx)("p",{className:"text-sm text-gray-400",children:u>0?"".concat(u," ol\xe4sta notiser"):"Inga ol\xe4sta notiser"})]}),u>0&&(0,bi.jsx)("button",{onClick:async()=>{const e=r.filter(e=>!e.read).map(e=>(0,si.mZ)((0,si.H9)(zc,"notifications",e.id),{read:!0}));try{await Promise.all(e)}catch(t){console.error("Kunde inte markera alla som l\xe4sta:",t)}},className:"px-4 py-2 bg-cyan-500 hover:bg-cyan-400 text-black rounded-lg font-semibold transition-colors",children:"Markera alla som l\xe4sta"})]}),(0,bi.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,bi.jsxs)("button",{onClick:()=>l("all"),className:"px-4 py-2 rounded-lg font-semibold transition-colors ".concat("all"===o?"bg-cyan-500 text-black":"bg-slate-800 text-gray-300 hover:bg-slate-700"),children:["Alla (",r.length,")"]}),(0,bi.jsxs)("button",{onClick:()=>l("unread"),className:"px-4 py-2 rounded-lg font-semibold transition-colors ".concat("unread"===o?"bg-cyan-500 text-black":"bg-slate-800 text-gray-300 hover:bg-slate-700"),children:["Ol\xe4sta (",u,")"]}),(0,bi.jsxs)("button",{onClick:()=>l("success"),className:"px-4 py-2 rounded-lg font-semibold transition-colors ".concat("success"===o?"bg-cyan-500 text-black":"bg-slate-800 text-gray-300 hover:bg-slate-700"),children:["Lyckade (",r.filter(e=>"question_import"===e.type).length,")"]}),(0,bi.jsxs)("button",{onClick:()=>l("error"),className:"px-4 py-2 rounded-lg font-semibold transition-colors ".concat("error"===o?"bg-cyan-500 text-black":"bg-slate-800 text-gray-300 hover:bg-slate-700"),children:["Fel (",r.filter(e=>"question_import_error"===e.type).length,")"]})]}),(0,bi.jsx)("div",{className:"space-y-3",children:s?(0,bi.jsx)("div",{className:"text-center py-12 text-gray-400",children:"Laddar notiser..."}):0===c.length?(0,bi.jsx)("div",{className:"text-center py-12 text-gray-400",children:"all"===o?"Inga notiser \xe4nnu":"Inga notiser matchar filtret"}):c.map(e=>(0,bi.jsx)("div",{className:"rounded-lg border p-4 transition-all ".concat(p(e.type)," ").concat(e.read?"":"ring-2 ring-cyan-500/50"),onClick:()=>!e.read&&(async e=>{try{const t=(0,si.H9)(zc,"notifications",e);await(0,si.mZ)(t,{read:!0})}catch(t){console.error("Kunde inte markera som l\xe4st:",t)}})(e.id),children:(0,bi.jsxs)("div",{className:"flex items-start gap-3",children:[(0,bi.jsx)("span",{className:"text-2xl flex-shrink-0",children:h(e.type)}),(0,bi.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,bi.jsxs)("div",{className:"flex items-start justify-between gap-2 mb-1",children:[(0,bi.jsxs)("h3",{className:"font-semibold text-gray-200",children:[e.title,!e.read&&(0,bi.jsx)("span",{className:"ml-2 px-2 py-0.5 bg-cyan-500 text-black text-xs rounded-full",children:"Nytt"})]}),(0,bi.jsx)("span",{className:"text-xs text-gray-400 whitespace-nowrap",children:d(e.createdAt)})]}),(0,bi.jsx)("p",{className:"text-sm text-gray-300 mb-2",children:e.message}),e.data&&(0,bi.jsxs)("div",{className:"text-xs text-gray-400 space-y-1",children:[e.data.count&&(0,bi.jsxs)("div",{children:["Antal fr\xe5gor: ",(0,bi.jsx)("strong",{className:"text-gray-300",children:e.data.count})]}),e.data.provider&&(0,bi.jsxs)("div",{children:["AI-provider: ",(0,bi.jsx)("strong",{className:"text-gray-300",children:e.data.provider})]}),e.data.error&&(0,bi.jsxs)("div",{className:"text-red-300",children:["Fel: ",e.data.error]})]})]})]})},e.id))})]})]}):null},Bc=()=>{const[e,n]=(0,t.useState)([]),[r,i]=(0,t.useState)([]),[s,a]=(0,t.useState)(!0),[o,l]=(0,t.useState)("all"),[c,u]=(0,t.useState)("all"),[d,h]=(0,t.useState)(50),[p,f]=(0,t.useState)([]),[m,g]=(0,t.useState)(new Set),[v,y]=(0,t.useState)(!1),[x,b]=(0,t.useState)(!0),[w,_]=(0,t.useState)({isOpen:!1,title:"",message:"",type:"info"}),k=(0,t.useCallback)(async()=>{a(!0);try{const e=(0,si.rJ)(gi,"errorLogs"),t=500,n=(0,si.P)(e,(0,si.My)("timestamp","desc"),(0,si.AB)(t)),r=(await(0,si.getDocs)(n)).docs.map(e=>{var t;return(0,Ti.A)((0,Ti.A)({id:e.id},e.data()),{},{timestamp:null===(t=e.data().timestamp)||void 0===t?void 0:t.toDate()})});i(r);const s=[...new Set(r.map(e=>e.deviceId).filter(Boolean))];f(s)}catch(e){console.error("Failed to load logs:",e)}finally{a(!1)}},[]);(0,t.useEffect)(()=>{if(!x)return;const e=(0,si.rJ)(gi,"errorLogs"),t=(0,si.P)(e,(0,si.My)("timestamp","desc"),(0,si.AB)(500)),n=(0,si.aQ)(t,e=>{const t=e.docs.map(e=>{var t;return(0,Ti.A)((0,Ti.A)({id:e.id},e.data()),{},{timestamp:null===(t=e.data().timestamp)||void 0===t?void 0:t.toDate()})});i(t);const n=[...new Set(t.map(e=>e.deviceId).filter(Boolean))];f(n),a(!1)},e=>{console.error("Error listening to logs:",e),a(!1)});return()=>n()},[x]),(0,t.useEffect)(()=>{let e=[...r];"all"!==o&&(e=e.filter(e=>e.level===o)),"all"!==c&&(e=e.filter(e=>e.deviceId===c)),e=e.slice(0,d),n(e)},[r,o,c,d]);const N=e=>{switch(e){case"error":return"bg-red-900/40 border-red-500/40 text-red-200";case"debug":return"bg-blue-900/40 border-blue-500/40 text-blue-200";case"info":return"bg-emerald-900/40 border-emerald-500/40 text-emerald-200";default:return"bg-slate-900/40 border-slate-500/40 text-slate-200"}},S=e=>{switch(e){case"error":return"\ud83d\udd34";case"debug":return"\ud83d\udccd";case"info":return"\u2139\ufe0f";default:return"\ud83d\udcdd"}};return(0,bi.jsxs)(jl,{headerTitle:"Error Logs",maxWidth:"max-w-6xl",children:[(0,bi.jsxs)("div",{className:"space-y-6",children:[(0,bi.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[(0,bi.jsxs)("div",{className:"flex items-center gap-3",children:[(0,bi.jsx)("h1",{className:"text-3xl font-bold text-slate-100",children:"Error Logs & Debug Info"}),x&&(0,bi.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1 bg-green-900/40 border border-green-500/40 rounded-full",children:[(0,bi.jsxs)("span",{className:"relative flex h-2 w-2",children:[(0,bi.jsx)("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"}),(0,bi.jsx)("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-green-500"})]}),(0,bi.jsx)("span",{className:"text-xs text-green-300 font-semibold",children:"LIVE"})]})]}),(0,bi.jsxs)("div",{className:"flex gap-2",children:[(0,bi.jsx)("button",{onClick:()=>b(!x),className:"px-4 py-2 rounded-lg font-semibold transition-colors ".concat(x?"bg-green-600 text-white hover:bg-green-700":"bg-slate-700 text-gray-300 hover:bg-slate-600"),children:x?"\u23f8\ufe0f Pausa live":"\u25b6\ufe0f Aktivera live"}),(0,bi.jsx)("button",{onClick:k,disabled:x,className:"px-4 py-2 bg-cyan-500 text-black rounded-lg font-semibold hover:bg-cyan-400 disabled:bg-slate-600 disabled:text-gray-400",children:"Uppdatera"}),m.size>0&&(0,bi.jsx)("button",{onClick:async()=>{if(0===m.size)return;if(window.confirm("\xc4r du s\xe4ker p\xe5 att du vill ta bort ".concat(m.size," logg").concat(1!==m.size?"ar":"","?"))){y(!0);try{const e=Array.from(m),t=500;for(let n=0;n<e.length;n+=t){const r=(0,si.wP)(gi);e.slice(n,n+t).forEach(e=>{const t=(0,si.H9)(gi,"errorLogs",e);r.delete(t)}),await r.commit()}i(e=>e.filter(e=>!m.has(e.id))),g(new Set),_({isOpen:!0,title:"Loggar borttagna",message:"".concat(e.length," logg").concat(1!==e.length?"ar":""," togs bort"),type:"success"})}catch(e){console.error("Failed to delete logs:",e),_({isOpen:!0,title:"Kunde inte ta bort loggar",message:e.message,type:"error"})}finally{y(!1)}}},disabled:v,className:"px-4 py-2 bg-red-600 text-white rounded-lg font-semibold hover:bg-red-700 disabled:bg-gray-600",children:v?"Tar bort...":"\ud83d\uddd1\ufe0f Ta bort valda (".concat(m.size,")")})]})]}),e.length>0&&(0,bi.jsxs)("div",{className:"flex items-center gap-3 bg-slate-800/50 rounded-lg p-3",children:[(0,bi.jsxs)("button",{onClick:()=>{g(new Set(e.map(e=>e.id)))},className:"px-3 py-1 bg-slate-700 text-white rounded text-sm hover:bg-slate-600",children:["Markera alla (",e.length,")"]}),(0,bi.jsx)("button",{onClick:()=>{g(new Set)},className:"px-3 py-1 bg-slate-700 text-white rounded text-sm hover:bg-slate-600",children:"Avmarkera alla"}),(0,bi.jsx)("div",{className:"flex-1"}),(0,bi.jsx)("button",{onClick:async()=>{if(!window.confirm("\u26a0\ufe0f VARNING! Du \xe4r p\xe5 v\xe4g att ta bort ALLA loggar i systemet.\n\nDetta inkluderar ALLA ".concat(r.length,"+ loggar, oavsett filter.\n\n\xc4r du s\xe4ker p\xe5 att du vill forts\xe4tta?")))return;if(window.confirm("\u26a0\ufe0f SISTA CHANSEN!\n\nDetta kommer att PERMANENT ta bort alla felloggar och debug-information.\n\nDetta kan INTE \xe5ngras!\n\nKlicka OK f\xf6r att radera alla loggar.")){y(!0);try{const e=(0,si.rJ)(gi,"errorLogs"),t=(0,si.P)(e,(0,si.My)("timestamp","desc")),n=(await(0,si.getDocs)(t)).docs.map(e=>e.id),r=500;for(let i=0;i<n.length;i+=r){const e=(0,si.wP)(gi);n.slice(i,i+r).forEach(t=>{const n=(0,si.H9)(gi,"errorLogs",t);e.delete(n)}),await e.commit()}await k(),g(new Set),_({isOpen:!0,title:"Alla loggar raderade",message:"Alla ".concat(n.length," loggar har raderats"),type:"success"})}catch(e){console.error("Failed to delete all logs:",e),_({isOpen:!0,title:"Kunde inte ta bort loggar",message:e.message,type:"error"})}finally{y(!1)}}},disabled:v,className:"px-3 py-1 bg-red-700 text-white rounded text-sm hover:bg-red-800 disabled:bg-gray-600 font-semibold",children:"\ud83d\uddd1\ufe0f Radera alla loggar"})]}),(0,bi.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,bi.jsxs)("button",{onClick:()=>l("all"),className:"px-4 py-2 rounded-lg font-semibold transition-colors ".concat("all"===o?"bg-slate-700 text-white":"bg-slate-800 text-gray-400 hover:text-white"),children:["Alla (",e.length,")"]}),(0,bi.jsx)("button",{onClick:()=>l("error"),className:"px-4 py-2 rounded-lg font-semibold transition-colors ".concat("error"===o?"bg-red-700 text-white":"bg-slate-800 text-gray-400 hover:text-white"),children:"\ud83d\udd34 Errors"}),(0,bi.jsx)("button",{onClick:()=>l("debug"),className:"px-4 py-2 rounded-lg font-semibold transition-colors ".concat("debug"===o?"bg-blue-700 text-white":"bg-slate-800 text-gray-400 hover:text-white"),children:"\ud83d\udccd GPS Debug"}),(0,bi.jsx)("button",{onClick:()=>l("info"),className:"px-4 py-2 rounded-lg font-semibold transition-colors ".concat("info"===o?"bg-emerald-700 text-white":"bg-slate-800 text-gray-400 hover:text-white"),children:"\u2139\ufe0f Info"})]}),(0,bi.jsxs)("div",{className:"space-y-2",children:[(0,bi.jsx)("span",{className:"text-sm text-gray-400",children:"Filtrera enhet:"}),(0,bi.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,bi.jsx)("button",{onClick:()=>u("all"),className:"px-3 py-1 rounded text-sm ".concat("all"===c?"bg-purple-600 text-white":"bg-slate-800 text-gray-400 hover:text-white"),children:"Alla enheter"}),p.slice(0,10).map(e=>(0,bi.jsxs)("button",{onClick:()=>u(e),className:"px-3 py-1 rounded text-sm font-mono ".concat(c===e?"bg-purple-600 text-white":"bg-slate-800 text-gray-400 hover:text-white"),title:e,children:[e.substring(0,8),"..."]},e))]})]}),(0,bi.jsxs)("div",{className:"flex items-center gap-2",children:[(0,bi.jsx)("span",{className:"text-sm text-gray-400",children:"Visa:"}),[50,100,200].map(e=>(0,bi.jsx)("button",{onClick:()=>h(e),className:"px-3 py-1 rounded text-sm ".concat(d===e?"bg-cyan-600 text-white":"bg-slate-800 text-gray-400 hover:text-white"),children:e},e))]}),s?(0,bi.jsxs)("div",{className:"text-center py-12",children:[(0,bi.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-cyan-500"}),(0,bi.jsx)("p",{className:"mt-4 text-gray-400",children:"Laddar loggar..."})]}):0===e.length?(0,bi.jsx)("div",{className:"text-center py-12 text-gray-400",children:"Inga loggar hittades"}):(0,bi.jsx)("div",{className:"space-y-4",children:e.map(e=>{var t,n,r,i,s;return(0,bi.jsx)("div",{className:"rounded-2xl border p-4 ".concat(N(e.level)," ").concat(m.has(e.id)?"ring-2 ring-cyan-500":""),children:(0,bi.jsxs)("div",{className:"flex items-start gap-4",children:[(0,bi.jsx)("input",{type:"checkbox",checked:m.has(e.id),onChange:()=>{return t=e.id,void g(e=>{const n=new Set(e);return n.has(t)?n.delete(t):n.add(t),n});var t},className:"mt-1 h-5 w-5 rounded border-gray-600 bg-slate-800 text-cyan-500 focus:ring-cyan-500 cursor-pointer"}),(0,bi.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,bi.jsxs)("div",{className:"flex items-center gap-2",children:[(0,bi.jsx)("span",{className:"text-xl",children:S(e.level)}),(0,bi.jsx)("span",{className:"font-semibold",children:e.type}),(0,bi.jsx)("span",{className:"text-xs opacity-60",children:null===(t=e.timestamp)||void 0===t?void 0:t.toLocaleString("sv-SE")})]}),e.message&&(0,bi.jsx)("p",{className:"text-sm font-mono",children:e.message}),"error"===e.level&&(0,bi.jsxs)("div",{className:"bg-red-900/20 rounded p-3 text-xs space-y-2",children:[(0,bi.jsx)("div",{className:"font-semibold text-red-300",children:"\ud83d\udccd Error Location:"}),e.filename&&(0,bi.jsxs)("div",{className:"font-mono",children:[(0,bi.jsx)("span",{className:"text-gray-400",children:"File: "}),(0,bi.jsx)("span",{className:"text-red-200",children:e.filename}),e.lineno&&(0,bi.jsxs)("span",{className:"text-red-300",children:[" : line ",e.lineno]}),e.colno&&(0,bi.jsxs)("span",{className:"text-red-300",children:[" : col ",e.colno]})]}),e.pathname&&(0,bi.jsxs)("div",{className:"font-mono",children:[(0,bi.jsx)("span",{className:"text-gray-400",children:"Page: "}),(0,bi.jsx)("span",{className:"text-red-200",children:e.pathname})]}),e.stackInfo&&e.stackInfo.length>0&&(0,bi.jsxs)("div",{className:"space-y-1 mt-2",children:[(0,bi.jsx)("div",{className:"font-semibold text-red-300",children:"Call Stack:"}),e.stackInfo.map((e,t)=>(0,bi.jsxs)("div",{className:"font-mono pl-2 border-l-2 border-red-500/30",children:[e.function&&(0,bi.jsx)("div",{className:"text-yellow-300",children:e.function}),(0,bi.jsxs)("div",{className:"text-red-200",children:[e.file,":",e.line,":",e.column]})]},t))]}),e.browserInfo&&(0,bi.jsxs)("div",{className:"mt-2 pt-2 border-t border-red-500/20",children:[(0,bi.jsx)("div",{className:"font-semibold text-red-300 mb-1",children:"Browser Info:"}),(0,bi.jsxs)("div",{className:"grid grid-cols-2 gap-1",children:[(0,bi.jsxs)("div",{children:[(0,bi.jsx)("span",{className:"text-gray-400",children:"Platform:"})," ",e.browserInfo.platform]}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("span",{className:"text-gray-400",children:"Language:"})," ",e.browserInfo.language]}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("span",{className:"text-gray-400",children:"Screen:"})," ",e.browserInfo.screenResolution]}),(0,bi.jsxs)("div",{children:[(0,bi.jsx)("span",{className:"text-gray-400",children:"Viewport:"})," ",e.browserInfo.viewport]})]})]})]}),"gps_debug"===e.type&&(0,bi.jsxs)("div",{className:"bg-black/20 rounded p-3 text-xs font-mono space-y-1",children:[(0,bi.jsxs)("div",{children:["GPS Status: ",(0,bi.jsx)("span",{className:"text-cyan-300",children:e.gpsStatus})]}),(0,bi.jsxs)("div",{children:["Tracking Enabled: ",(0,bi.jsx)("span",{className:"text-cyan-300",children:String(e.trackingEnabled)})]}),e.coords&&(0,bi.jsxs)(bi.Fragment,{children:[(0,bi.jsxs)("div",{children:["Latitude: ",(0,bi.jsx)("span",{className:"text-cyan-300",children:e.coords.latitude})]}),(0,bi.jsxs)("div",{children:["Longitude: ",(0,bi.jsx)("span",{className:"text-cyan-300",children:e.coords.longitude})]}),(0,bi.jsxs)("div",{children:["Accuracy: ",(0,bi.jsxs)("span",{className:"text-cyan-300",children:[e.coords.accuracy,"m"]})]})]})]}),"route_generation"===e.type&&(0,bi.jsxs)("div",{className:"bg-black/20 rounded p-3 text-xs font-mono space-y-1",children:[(0,bi.jsxs)("div",{children:["Has GPS: ",(0,bi.jsx)("span",{className:"text-cyan-300",children:String(e.hasGPS)})]}),(0,bi.jsxs)("div",{children:["Origin: ",(0,bi.jsxs)("span",{className:"text-cyan-300",children:[null===(n=e.originPosition)||void 0===n||null===(r=n.lat)||void 0===r?void 0:r.toFixed(4),", ",null===(i=e.originPosition)||void 0===i||null===(s=i.lng)||void 0===s?void 0:s.toFixed(4)]})]}),e.formData&&(0,bi.jsxs)(bi.Fragment,{children:[(0,bi.jsxs)("div",{children:["Name: ",(0,bi.jsx)("span",{className:"text-cyan-300",children:e.formData.name})]}),(0,bi.jsxs)("div",{children:["Length: ",(0,bi.jsxs)("span",{className:"text-cyan-300",children:[e.formData.lengthMeters,"m"]})]})]})]}),e.breadcrumbs&&e.breadcrumbs.length>0&&(0,bi.jsxs)("details",{className:"bg-purple-900/20 border border-purple-500/30 rounded p-3",children:[(0,bi.jsxs)("summary",{className:"text-xs cursor-pointer font-semibold text-purple-300",children:["\ud83c\udf5e User Activity Trail (",e.breadcrumbs.length," events)"]}),(0,bi.jsx)("div",{className:"mt-2 space-y-2 max-h-60 overflow-y-auto",children:e.breadcrumbs.map((e,t)=>(0,bi.jsxs)("div",{className:"text-xs border-l-2 border-purple-500/30 pl-2",children:[(0,bi.jsxs)("div",{className:"flex items-center gap-2",children:[(0,bi.jsx)("span",{className:"text-purple-400 font-mono",children:new Date(e.timestamp).toLocaleTimeString("sv-SE")}),(0,bi.jsx)("span",{className:"px-1.5 py-0.5 bg-purple-500/20 rounded text-purple-300 text-[10px] font-semibold",children:e.category}),(0,bi.jsx)("span",{className:"text-gray-300",children:e.message})]}),e.url&&(0,bi.jsx)("div",{className:"text-gray-500 font-mono text-[10px] mt-0.5",children:e.url}),e.data&&Object.keys(e.data).length>0&&(0,bi.jsx)("div",{className:"text-gray-400 font-mono text-[10px] mt-0.5",children:JSON.stringify(e.data)})]},t))})]}),e.stack&&(0,bi.jsxs)("details",{className:"bg-black/20 rounded p-3",children:[(0,bi.jsx)("summary",{className:"text-xs cursor-pointer",children:"Stack Trace"}),(0,bi.jsx)("pre",{className:"text-xs mt-2 overflow-x-auto whitespace-pre-wrap",children:e.stack})]}),(0,bi.jsxs)("div",{className:"text-xs opacity-60 space-y-1",children:[(0,bi.jsxs)("div",{children:["Device ID: ",e.deviceId]}),(0,bi.jsxs)("div",{children:["URL: ",e.url]}),e.userAgent&&(0,bi.jsxs)("div",{children:["User Agent: ",e.userAgent]})]})]})]})},e.id)})})]}),(0,bi.jsx)(oa,{isOpen:w.isOpen,onClose:()=>_((0,Ti.A)((0,Ti.A)({},w),{},{isOpen:!1})),title:w.title,message:w.message,type:w.type})]})},Vc=new Set(["completed","failed","cancelled"]),qc={queued:"K\xf6ad",pending:"F\xf6rbereds",processing:"P\xe5g\xe5r",completed:"Klar",failed:"Misslyckades",cancelled:"Avbruten"},Kc={queued:"bg-slate-700/70 text-slate-200",pending:"bg-slate-700/70 text-slate-200",processing:"bg-amber-500/20 text-amber-300 border border-amber-500/30",completed:"bg-emerald-500/20 text-emerald-200 border border-emerald-500/30",failed:"bg-red-500/20 text-red-300 border border-red-500/40",cancelled:"bg-slate-600/30 text-slate-200 border border-slate-500/40"},Hc=e=>{if(!e)return"\u2014";try{return e.toLocaleString("sv-SE",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch(t){return e.toString()}},Wc=(e,t)=>{if(!e||!t)return"\u2014";const n=t.getTime()-e.getTime();if(Number.isNaN(n)||n<0)return"\u2014";const r=Math.round(n/1e3);if(r<60)return"".concat(r,"s");const i=Math.floor(r/60);if(i<60){const e=r%60;return"".concat(i,"m ").concat(e,"s")}const s=Math.floor(i/60),a=i%60;return"".concat(s,"h ").concat(a,"m")},Gc=()=>{const e=X(),{allTasks:n,refreshAllTasks:r}=Ea(),{currentUser:i}=Ci(),[s,a]=(0,t.useState)("all"),[o,l]=(0,t.useState)("all"),[c,u]=(0,t.useState)(""),[d,h]=(0,t.useState)(!1),[p,f]=(0,t.useState)(null),[m,g]=(0,t.useState)(!1),[v,y]=(0,t.useState)(null),[x,b]=(0,t.useState)(new Set),[w,_]=(0,t.useState)(!1),[k,N]=(0,t.useState)({isOpen:!1,title:"",message:"",type:"info"}),[S,j]=(0,t.useState)(!1),E=(0,t.useMemo)(()=>n&&0!==n.length?[...n].sort((e,t)=>{const n=e.createdAt instanceof Date?e.createdAt.getTime():0,r=t.createdAt instanceof Date?t.createdAt.getTime():0;return n!==r?r-n:e.id.localeCompare(t.id)}):[],[n]),C=(0,t.useMemo)(()=>E.filter(e=>{if("all"!==s&&e.status!==s)return!1;if("all"!==o&&e.taskType!==o)return!1;if(c.trim()){var t,n,r;if(![e.id,e.userId,null===(t=e.result)||void 0===t?void 0:t.provider,null===(n=e.payload)||void 0===n?void 0:n.category,null===(r=e.payload)||void 0===r?void 0:r.difficulty,e.error,e.taskType].filter(Boolean).join(" ").toLowerCase().includes(c.toLowerCase()))return!1}return!0}),[E,s,o,c]),T=(0,t.useMemo)(()=>{const e=Date.now()-864e5,t={total:n.length,active:0,completed:0,failed:0,queued:0,last24hCompleted:0};return n.reduce((t,n)=>(Vc.has(n.status)?"completed"===n.status?(t.completed+=1,n.finishedAt&&n.finishedAt.getTime()>=e&&(t.last24hCompleted+=1)):"failed"===n.status&&(t.failed+=1):("queued"!==n.status&&"pending"!==n.status||(t.queued+=1),"processing"===n.status&&(t.active+=1)),t),t)},[n]);return(0,bi.jsxs)("div",{className:"min-h-screen bg-slate-950 text-gray-100",children:[(0,bi.jsx)(Sl,{title:"Bakgrundsjobb"}),(0,bi.jsxs)("main",{className:"max-w-6xl mx-auto px-4 py-6 space-y-6 pt-24",children:[(0,bi.jsxs)("section",{className:"grid grid-cols-1 gap-4 md:grid-cols-4",children:[(0,bi.jsxs)("div",{className:"rounded-xl bg-slate-900 border border-slate-800 p-4",children:[(0,bi.jsx)("div",{className:"text-xs uppercase tracking-wide text-slate-500",children:"Totalt"}),(0,bi.jsx)("div",{className:"mt-2 text-2xl font-semibold text-white",children:T.total})]}),(0,bi.jsxs)("div",{className:"rounded-xl bg-slate-900 border border-slate-800 p-4",children:[(0,bi.jsx)("div",{className:"text-xs uppercase tracking-wide text-slate-500",children:"Aktiva"}),(0,bi.jsx)("div",{className:"mt-2 text-2xl font-semibold text-amber-300",children:T.active})]}),(0,bi.jsxs)("div",{className:"rounded-xl bg-slate-900 border border-slate-800 p-4",children:[(0,bi.jsx)("div",{className:"text-xs uppercase tracking-wide text-slate-500",children:"Klara 24h"}),(0,bi.jsx)("div",{className:"mt-2 text-2xl font-semibold text-emerald-300",children:T.last24hCompleted})]}),(0,bi.jsxs)("div",{className:"rounded-xl bg-slate-900 border border-slate-800 p-4",children:[(0,bi.jsx)("div",{className:"text-xs uppercase tracking-wide text-slate-500",children:"Misslyckade"}),(0,bi.jsx)("div",{className:"mt-2 text-2xl font-semibold text-red-300",children:T.failed})]})]}),(0,bi.jsxs)("section",{className:"rounded-xl bg-slate-900 border border-slate-800 p-4",children:[(0,bi.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[(0,bi.jsxs)("div",{children:[(0,bi.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Developer Tools"}),(0,bi.jsx)("p",{className:"text-sm text-slate-400 mt-1",children:"Migrera fr\xe5gor, st\xe4da gamla jobb eller konfigurera AI-providers"})]}),(0,bi.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,bi.jsx)("button",{onClick:()=>e("/superuser/ai-providers"),className:"px-4 py-2 bg-cyan-600 hover:bg-cyan-500 text-white rounded-lg font-semibold transition-colors whitespace-nowrap",children:"\u2699\ufe0f AI Providers"}),(0,bi.jsx)("button",{onClick:async()=>{if(window.confirm("\u26a0\ufe0f Vill du k\xf6ra om AI-kategorisering p\xe5 alla befintliga fr\xe5gor med striktare sv\xe5righetsniv\xe5er?\n\nDetta kommer att:\n- Uppdatera ageGroups f\xf6r alla fr\xe5gor\n- Anv\xe4nd striktare kriterier f\xf6r barn/ungdom/vuxen\n- K\xf6ras som en bakgrundsuppgift\n\nFortse tt?")){j(!0);try{if(!i)throw new Error("Du m\xe5ste vara inloggad f\xf6r att k\xf6ra migration");const e=fi().currentUser;if(!e)throw new Error("Kunde inte hitta Firebase-anv\xe4ndare");const t=await e.getIdToken(),n=await fetch("https://europe-west1-geoquest2-7e45c.cloudfunctions.net/queueMigration",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}}),r=await n.json();n.ok?N({isOpen:!0,title:"Migration startad",message:"AI-migration har k\xf6ats som bakgrundsjobb. Du kan f\xf6lja progress nedan.",type:"success"}):N({isOpen:!0,title:"Kunde inte starta migration",message:r.error||"Ok\xe4nt fel",type:"error"})}catch(e){N({isOpen:!0,title:"Fel vid migration",message:e.message,type:"error"})}finally{j(!1),await r()}}},disabled:S,className:"px-4 py-2 bg-purple-600 hover:bg-purple-500 disabled:bg-slate-700 disabled:text-slate-400 text-white rounded-lg font-semibold transition-colors whitespace-nowrap",children:S?"\ud83d\udd04 K\xf6r migration...":"\ud83d\udd04 Migrera fr\xe5gor"}),(0,bi.jsx)("button",{onClick:async()=>{if(window.confirm("Vill du st\xe4da h\xe4ngande bakgrundsjobb (\xe4ldre \xe4n 30 minuter)?")){h(!0),f(null);try{const e=await fetch("https://europe-west1-geoquest2-7e45c.cloudfunctions.net/cleanupStuckTasks"),t=await e.json();e.ok?f({success:!0,message:"St\xe4dat ".concat(t.cleaned," h\xe4ngande jobb (").concat(t.processingChecked," processing, ").concat(t.queuedChecked," queued)")}):f({success:!1,message:t.error||"N\xe5got gick fel"})}catch(e){f({success:!1,message:"Fel: ".concat(e.message)})}finally{h(!1),await r(),setTimeout(()=>f(null),5e3)}}},disabled:d,className:"px-4 py-2 bg-amber-600 hover:bg-amber-500 disabled:bg-slate-700 disabled:text-slate-400 text-white rounded-lg font-semibold transition-colors whitespace-nowrap",children:d?"\ud83e\uddf9 St\xe4dar...":"\ud83e\uddf9 St\xe4da h\xe4ngande"}),(0,bi.jsx)("button",{onClick:async()=>{if(window.confirm("Vill du ta bort alla gamla klara och misslyckade jobb (\xe4ldre \xe4n 24 timmar)?\n\nDetta g\xe5r INTE att \xe5ngra!")){g(!0),y(null);try{const e=await fetch("https://europe-west1-geoquest2-7e45c.cloudfunctions.net/deleteOldTasks"),t=await e.json();e.ok?y({success:!0,message:"Raderat ".concat(t.deleted," gamla jobb (").concat(t.completedDeleted," klara, ").concat(t.failedDeleted," misslyckade)")}):y({success:!1,message:t.error||"N\xe5got gick fel"})}catch(e){y({success:!1,message:"Fel: ".concat(e.message)})}finally{g(!1),await r(),setTimeout(()=>y(null),5e3)}}},disabled:m,className:"px-4 py-2 bg-red-600 hover:bg-red-500 disabled:bg-slate-700 disabled:text-slate-400 text-white rounded-lg font-semibold transition-colors whitespace-nowrap",children:m?"\ud83d\uddd1\ufe0f Raderar...":"\ud83d\uddd1\ufe0f Radera gamla"})]})]}),p&&(0,bi.jsx)("div",{className:"mt-4 p-3 rounded-lg ".concat(p.success?"bg-green-500/10 border border-green-500/30 text-green-300":"bg-red-500/10 border border-red-500/30 text-red-300"),children:p.message}),v&&(0,bi.jsx)("div",{className:"mt-3 p-3 rounded-lg ".concat(v.success?"bg-green-500/10 border border-green-500/30 text-green-300":"bg-red-500/10 border border-red-500/30 text-red-300"),children:v.message})]}),(0,bi.jsxs)("section",{className:"rounded-xl bg-slate-900 border border-slate-800 p-4",children:[(0,bi.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4",children:[(0,bi.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,bi.jsxs)("select",{value:s,onChange:e=>a(e.target.value),className:"bg-slate-950 border border-slate-700 px-3 py-1.5 rounded-md text-sm text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",children:[(0,bi.jsx)("option",{value:"all",children:"Alla statusar"}),Object.keys(qc).map(e=>(0,bi.jsx)("option",{value:e,children:qc[e]},e))]}),(0,bi.jsxs)("select",{value:o,onChange:e=>l(e.target.value),className:"bg-slate-950 border border-slate-700 px-3 py-1.5 rounded-md text-sm text-white focus:outline-none focus:ring-2 focus:ring-cyan-500",children:[(0,bi.jsx)("option",{value:"all",children:"Alla typer"}),(0,bi.jsx)("option",{value:"generation",children:"Generering"}),(0,bi.jsx)("option",{value:"validation",children:"Validering"}),(0,bi.jsx)("option",{value:"batchvalidation",children:"Batch-validering"}),(0,bi.jsx)("option",{value:"migration",children:"Migrering"}),(0,bi.jsx)("option",{value:"regenerateemoji",children:"Emoji-regenerering"}),(0,bi.jsx)("option",{value:"batchregenerateemojis",children:"Mass-regenerering Emojis"})]})]}),(0,bi.jsx)("input",{type:"search",value:c,onChange:e=>u(e.target.value),placeholder:"S\xf6k p\xe5 jobbid, anv\xe4ndare eller provider",className:"w-full md:w-72 bg-slate-950 border border-slate-700 px-3 py-1.5 rounded-md text-sm text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-cyan-500"})]}),x.size>0&&(0,bi.jsx)("div",{className:"mb-4 bg-slate-800 rounded-lg p-3 border border-cyan-500/30",children:(0,bi.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,bi.jsxs)("div",{className:"text-sm text-white",children:[(0,bi.jsx)("span",{className:"font-semibold",children:x.size})," jobb valda"]}),(0,bi.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,bi.jsx)("button",{onClick:async()=>{if(0!==x.size){if(window.confirm("Vill du stoppa ".concat(x.size," valda jobb?"))){_(!0);try{const e=Array.from(x),t=await fetch("https://europe-west1-geoquest2-7e45c.cloudfunctions.net/bulkStopTasks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({taskIds:e})}),n=await t.json();t.ok?(N({isOpen:!0,title:"Jobb stoppade",message:"Stoppat ".concat(n.stopped," jobb"),type:"success"}),b(new Set)):N({isOpen:!0,title:"Kunde inte stoppa jobb",message:n.error||"Ok\xe4nt fel",type:"error"})}catch(e){N({isOpen:!0,title:"Fel vid stopp",message:e.message,type:"error"})}finally{_(!1),await r()}}}else N({isOpen:!0,title:"Ingen markering",message:"V\xe4lj minst ett jobb att stoppa",type:"warning"})},disabled:w,className:"px-3 py-1.5 bg-amber-600 hover:bg-amber-500 disabled:bg-slate-700 disabled:text-slate-400 text-white text-sm rounded-md font-semibold transition-colors",children:"\u23f8\ufe0f Stoppa valda"}),(0,bi.jsx)("button",{onClick:async()=>{if(0!==x.size){if(window.confirm("\u26a0\ufe0f VARNING: Vill du radera ".concat(x.size," valda jobb permanent?\n\nDetta g\xe5r INTE att \xe5ngra!"))){_(!0);try{const e=Array.from(x),t=await fetch("https://europe-west1-geoquest2-7e45c.cloudfunctions.net/bulkDeleteTasks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({taskIds:e})}),n=await t.json();t.ok?(N({isOpen:!0,title:"Jobb raderade",message:"Raderat ".concat(n.deleted," jobb"),type:"success"}),b(new Set)):N({isOpen:!0,title:"Kunde inte radera jobb",message:n.error||"Ok\xe4nt fel",type:"error"})}catch(e){N({isOpen:!0,title:"Fel vid radering",message:e.message,type:"error"})}finally{_(!1),await r()}}}else N({isOpen:!0,title:"Ingen markering",message:"V\xe4lj minst ett jobb att radera",type:"warning"})},disabled:w,className:"px-3 py-1.5 bg-red-600 hover:bg-red-500 disabled:bg-slate-700 disabled:text-slate-400 text-white text-sm rounded-md font-semibold transition-colors",children:"\ud83d\uddd1\ufe0f Radera valda"})]})]})}),(0,bi.jsx)("div",{className:"mt-4 overflow-x-auto",children:(0,bi.jsxs)("table",{className:"min-w-full text-sm border-separate",style:{borderSpacing:0},children:[(0,bi.jsx)("thead",{children:(0,bi.jsxs)("tr",{className:"text-left text-xs uppercase tracking-wide text-slate-400",children:[(0,bi.jsx)("th",{className:"px-4 py-2 border-b border-slate-800 w-10",children:(0,bi.jsx)("input",{type:"checkbox",checked:C.length>0&&x.size===C.length,onChange:()=>{x.size===C.length?b(new Set):b(new Set(C.map(e=>e.id)))},className:"w-4 h-4 bg-slate-700 border-slate-600 rounded focus:ring-2 focus:ring-cyan-500"})}),(0,bi.jsx)("th",{className:"px-4 py-2 border-b border-slate-800",children:"Jobb"}),(0,bi.jsx)("th",{className:"px-4 py-2 border-b border-slate-800",children:"Status"}),(0,bi.jsx)("th",{className:"px-4 py-2 border-b border-slate-800",children:"Start"}),(0,bi.jsx)("th",{className:"px-4 py-2 border-b border-slate-800",children:"Klart"}),(0,bi.jsx)("th",{className:"px-4 py-2 border-b border-slate-800",children:"Tid"}),(0,bi.jsx)("th",{className:"px-4 py-2 border-b border-slate-800",children:"Anv\xe4ndare"}),(0,bi.jsx)("th",{className:"px-4 py-2 border-b border-slate-800",children:"Detaljer"}),(0,bi.jsx)("th",{className:"px-4 py-2 border-b border-slate-800",children:"\xc5tg\xe4rder"})]})}),(0,bi.jsx)("tbody",{children:0===C.length?(0,bi.jsx)("tr",{children:(0,bi.jsx)("td",{colSpan:9,className:"px-4 py-8 text-center text-slate-500",children:"Inga jobb matchar dina filter just nu."})}):C.map(e=>{var t,n,i,s,a,o,l;const c=Kc[e.status]||Kc.pending,u=qc[e.status]||e.status,d=[];null!==(t=e.payload)&&void 0!==t&&t.category&&d.push("Kategori: ".concat(e.payload.category)),null!==(n=e.payload)&&void 0!==n&&n.difficulty&&d.push("Niv\xe5: ".concat(e.payload.difficulty)),null!==(i=e.payload)&&void 0!==i&&i.amount&&d.push("Antal: ".concat(e.payload.amount)),null!==(s=e.result)&&void 0!==s&&s.provider&&d.push("Provider: ".concat(e.result.provider)),"batchvalidation"===e.taskType&&e.result&&"completed"===e.status?null!=e.result.validated&&null!=e.result.failed&&(d.push("\u2713 ".concat(e.result.validated," godk\xe4nda")),d.push("\u2717 ".concat(e.result.failed," underk\xe4nda"))):"generation"===e.taskType&&e.result&&"completed"===e.status?e.result.details?(null!=e.result.details.imported&&d.push("\u2713 ".concat(e.result.details.imported," importerade")),e.result.details.duplicatesBlocked>0&&d.push("\u2298 ".concat(e.result.details.duplicatesBlocked," dubletter blockerade")),e.result.details.category&&d.push("Kategori: ".concat(e.result.details.category)),e.result.details.ageGroup&&d.push("\xc5ldersgrupp: ".concat(e.result.details.ageGroup))):null!=e.result.count&&d.push("Resultat: ".concat(e.result.count)):null!=(null===(a=e.result)||void 0===a?void 0:a.count)&&d.push("Resultat: ".concat(e.result.count)),e.error&&d.push("Fel: ".concat(e.error));const h=e.progress&&(e.progress.total>0||e.progress.phase),p=h&&e.progress.total>0?Math.round(e.progress.completed/e.progress.total*100):0;return(0,bi.jsxs)("tr",{className:"border-b border-slate-800/60",children:[(0,bi.jsx)("td",{className:"px-4 py-3 align-top",children:(0,bi.jsx)("input",{type:"checkbox",checked:x.has(e.id),onChange:()=>{return t=e.id,void b(e=>{const n=new Set(e);return n.has(t)?n.delete(t):n.add(t),n});var t},className:"w-4 h-4 bg-slate-700 border-slate-600 rounded focus:ring-2 focus:ring-cyan-500"})}),(0,bi.jsxs)("td",{className:"px-4 py-3 align-top",children:[(0,bi.jsxs)("div",{className:"flex items-center gap-2",children:[(0,bi.jsx)("div",{className:"text-white font-semibold",children:"generation"===e.taskType?"AI-generering":"batchvalidation"===e.taskType?"AI-validering (batch)":"validation"===e.taskType?"AI-validering":"migration"===e.taskType?"AI-migrering":"regenerateemoji"===e.taskType?"Emoji-regenerering":"batchregenerateemojis"===e.taskType?"Mass-regenerering Emojis":"Bakgrundsjobb"}),"batchvalidation"===e.taskType&&(null===(o=e.payload)||void 0===o||null===(l=o.questions)||void 0===l?void 0:l.length)&&(0,bi.jsxs)("span",{className:"text-xs px-2 py-0.5 bg-purple-500/20 text-purple-200 rounded",children:[e.payload.questions.length," fr\xe5gor"]})]}),(0,bi.jsxs)("div",{className:"text-xs text-slate-500",children:[e.id.substring(0,8),"..."]}),h&&"processing"===e.status&&(0,bi.jsxs)("div",{className:"mt-2 space-y-1",children:[e.progress.total>0&&(0,bi.jsx)("div",{className:"w-full bg-slate-700 rounded-full h-2 overflow-hidden",children:(0,bi.jsx)("div",{className:"bg-cyan-500 h-full transition-all duration-300",style:{width:"".concat(p,"%")}})}),(0,bi.jsxs)("div",{className:"text-xs text-slate-400",children:[e.progress.phase&&(0,bi.jsx)("div",{className:"font-semibold",children:e.progress.phase}),e.progress.total>0&&(0,bi.jsxs)("div",{children:[e.progress.completed," / ",e.progress.total,"batchvalidation"===e.taskType&&e.progress.validated>0&&" (".concat(e.progress.validated," godk\xe4nda, ").concat(e.progress.failed," underk\xe4nda)"),"migration"===e.taskType&&e.progress.details&&" - ".concat(e.progress.details)]}),e.progress.details&&(0,bi.jsx)("div",{className:"text-slate-500",children:e.progress.details})]})]}),h&&"completed"===e.status&&(0,bi.jsxs)("div",{className:"mt-1 text-xs text-slate-400",children:["batchvalidation"===e.taskType&&null!=e.progress.validated&&"".concat(e.progress.validated," godk\xe4nda, ").concat(e.progress.failed," underk\xe4nda"),"generation"===e.taskType&&e.progress.details&&e.progress.details,"migration"===e.taskType&&e.progress.details&&e.progress.details]})]}),(0,bi.jsx)("td",{className:"px-4 py-3 align-top",children:(0,bi.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-[11px] font-semibold ".concat(c),children:u})}),(0,bi.jsx)("td",{className:"px-4 py-3 align-top text-slate-300",children:Hc(e.createdAt)}),(0,bi.jsx)("td",{className:"px-4 py-3 align-top text-slate-300",children:Hc(e.finishedAt)}),(0,bi.jsx)("td",{className:"px-4 py-3 align-top text-slate-300",children:e.createdAt&&e.finishedAt?Wc(e.createdAt,e.finishedAt):"\u2014"}),(0,bi.jsx)("td",{className:"px-4 py-3 align-top text-slate-300",children:e.userId||"Ok\xe4nd"}),(0,bi.jsx)("td",{className:"px-4 py-3 align-top text-slate-300 text-xs space-y-1",children:d.length>0?d.map((e,t)=>(0,bi.jsx)("div",{children:e},t)):(0,bi.jsx)("span",{className:"text-slate-500",children:"Ingen metadata"})}),(0,bi.jsx)("td",{className:"px-4 py-3 align-top",children:(0,bi.jsxs)("div",{className:"flex gap-2",children:[("processing"===e.status||"queued"===e.status||"pending"===e.status)&&(0,bi.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("Vill du stoppa detta jobb?"))try{const t=await fetch("https://europe-west1-geoquest2-7e45c.cloudfunctions.net/stopTask",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({taskId:e})}),n=await t.json();t.ok?N({isOpen:!0,title:"Jobb stoppat",message:"Jobb stoppat: ".concat(n.message),type:"success"}):N({isOpen:!0,title:"Kunde inte stoppa jobb",message:n.error||"Ok\xe4nt fel",type:"error"})}catch(t){N({isOpen:!0,title:"Fel vid stopp",message:t.message,type:"error"})}finally{await r()}})(e.id),className:"px-2 py-1 bg-amber-600 hover:bg-amber-500 text-white text-xs rounded font-semibold transition-colors",title:"Stoppa jobb",children:"\u23f8\ufe0f"}),(0,bi.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("Vill du radera detta jobb permanent?\n\nDetta g\xe5r INTE att \xe5ngra!"))try{const t=await fetch("https://europe-west1-geoquest2-7e45c.cloudfunctions.net/deleteTask",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({taskId:e})}),n=await t.json();t.ok?N({isOpen:!0,title:"Jobb raderat",message:"Jobb raderat!",type:"success"}):N({isOpen:!0,title:"Kunde inte radera jobb",message:n.error||"Ok\xe4nt fel",type:"error"})}catch(t){N({isOpen:!0,title:"Fel vid radering",message:t.message,type:"error"})}finally{_(!1),await r()}})(e.id),className:"px-2 py-1 bg-red-600 hover:bg-red-500 text-white text-xs rounded font-semibold transition-colors",title:"Radera jobb",children:"\ud83d\uddd1\ufe0f"})]})})]},e.id)})})]})})]})]}),(0,bi.jsx)(oa,{isOpen:k.isOpen,onClose:()=>N((0,Ti.A)((0,Ti.A)({},k),{},{isOpen:!1})),title:k.title,message:k.message,type:k.type})]})},Zc=()=>{const{isSuperUser:e}=Ci(),n=X(),[r,i]=(0,t.useState)(!0),[s,a]=(0,t.useState)(!1),[o,l]=(0,t.useState)(null),[c,u]=(0,t.useState)(null),[d,h]=(0,t.useState)({generation:{anthropic:!0,openai:!0,gemini:!0},validation:{anthropic:!0,openai:!0,gemini:!0},migration:{anthropic:!0,openai:!1,gemini:!1},illustration:{anthropic:!0,openai:!0,gemini:!0}});(0,t.useEffect)(()=>{e?p():n("/")},[e,n]);const p=async()=>{i(!0),l(null);try{const e=await fetch("https://europe-west1-geoquest2-7e45c.cloudfunctions.net/getProviderSettings"),t=await e.json();if(!e.ok)throw new Error(t.error||"Failed to load settings");h(e=>(0,Ti.A)((0,Ti.A)({},e),t.settings))}catch(e){l("Kunde inte ladda inst\xe4llningar: ".concat(e.message))}finally{i(!1)}};if(!e)return null;if(r)return(0,bi.jsxs)("div",{className:"min-h-screen bg-slate-950 text-white",children:[(0,bi.jsx)(Sl,{title:"AI Provider-inst\xe4llningar"}),(0,bi.jsx)("div",{className:"flex items-center justify-center pt-32",children:(0,bi.jsx)("div",{className:"text-lg text-slate-400",children:"Laddar inst\xe4llningar..."})})]});const f=[{key:"anthropic",name:"Anthropic Claude",color:"bg-orange-500"},{key:"openai",name:"OpenAI GPT-4",color:"bg-green-500"},{key:"gemini",name:"Google Gemini",color:"bg-blue-500"}];return(0,bi.jsxs)("div",{className:"min-h-screen bg-slate-950 text-white",children:[(0,bi.jsx)(Sl,{title:"AI Provider-inst\xe4llningar"}),(0,bi.jsxs)("main",{className:"max-w-4xl mx-auto px-4 py-6 space-y-6 pt-24",children:[(0,bi.jsxs)("section",{className:"rounded-xl bg-slate-900 border border-slate-800 p-6",children:[(0,bi.jsx)("h2",{className:"text-lg font-semibold text-cyan-200 mb-2",children:"Om Provider-inst\xe4llningar"}),(0,bi.jsx)("p",{className:"text-slate-300 text-sm leading-relaxed",children:"H\xe4r kan du konfigurera vilka AI-providers som ska anv\xe4ndas f\xf6r olika \xe4ndam\xe5l. Providers som \xe4r inaktiverade kommer inte att anv\xe4ndas, \xe4ven om de \xe4r konfigurerade med API-nycklar."}),(0,bi.jsxs)("div",{className:"mt-4 space-y-2 text-sm text-slate-400",children:[(0,bi.jsxs)("div",{children:["\u2022 ",(0,bi.jsx)("strong",{className:"text-slate-300",children:"Generering:"})," Providers roteras slumpm\xe4ssigt f\xf6r variation"]}),(0,bi.jsxs)("div",{children:["\u2022 ",(0,bi.jsx)("strong",{className:"text-slate-300",children:"Validering:"})," Alla aktiverade providers anv\xe4nds parallellt f\xf6r h\xf6gre kvalitet"]}),(0,bi.jsxs)("div",{children:["\u2022 ",(0,bi.jsx)("strong",{className:"text-slate-300",children:"Migrering:"})," Endast en provider anv\xe4nds (rekommenderat: Anthropic)"]})]})]}),o&&(0,bi.jsx)("div",{className:"rounded-xl bg-red-900/40 border border-red-500/40 p-4 text-red-200",children:o}),c&&(0,bi.jsx)("div",{className:"rounded-xl bg-green-900/40 border border-green-500/40 p-4 text-green-200",children:c}),[{key:"generation",title:"Generering",description:"Vilka providers ska anv\xe4ndas f\xf6r att generera nya fr\xe5gor",icon:"\ud83c\udfaf"},{key:"validation",title:"Validering",description:"Vilka providers ska anv\xe4ndas f\xf6r att validera fr\xe5gor (fler = b\xe4ttre kvalitet)",icon:"\u2713"},{key:"illustration",title:"Illustration (SVG)",description:"Vilka providers ska anv\xe4ndas f\xf6r att generera SVG-illustrationer till fr\xe5gor",icon:"\ud83c\udfa8"},{key:"migration",title:"Migrering",description:"Vilka providers ska anv\xe4ndas f\xf6r schema-migrering (rekommenderat: endast Anthropic)",icon:"\ud83d\udd04"}].map(e=>(0,bi.jsxs)("section",{className:"rounded-xl bg-slate-900 border border-slate-800 p-6",children:[(0,bi.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,bi.jsxs)("div",{children:[(0,bi.jsxs)("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[(0,bi.jsx)("span",{children:e.icon}),e.title]}),(0,bi.jsx)("p",{className:"text-sm text-slate-400 mt-1",children:e.description})]}),(0,bi.jsxs)("div",{className:"text-xs text-slate-500",children:[d[e.key]?Object.values(d[e.key]).filter(Boolean).length:0," / ",f.length," aktiva"]})]}),(0,bi.jsx)("div",{className:"space-y-3",children:f.map(t=>{const n=!!d[e.key]&&d[e.key][t.key];return(0,bi.jsxs)("div",{className:"flex items-center justify-between p-4 rounded-lg border transition-colors ".concat(n?"bg-slate-800 border-cyan-500/30":"bg-slate-900/50 border-slate-700"),children:[(0,bi.jsxs)("div",{className:"flex items-center gap-3",children:[(0,bi.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(t.color)}),(0,bi.jsx)("span",{className:"font-medium ".concat(n?"text-white":"text-slate-500"),children:t.name})]}),(0,bi.jsx)("button",{onClick:()=>((e,t)=>{h(n=>(0,Ti.A)((0,Ti.A)({},n),{},{[e]:(0,Ti.A)((0,Ti.A)({},n[e]||{}),{},{[t]:!n[e]||!n[e][t]})}))})(e.key,t.key),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors ".concat(n?"bg-cyan-500":"bg-slate-700"),children:(0,bi.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform ".concat(n?"translate-x-6":"translate-x-1")})})]},t.key)})})]},e.key)),(0,bi.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,bi.jsx)("button",{onClick:async()=>{a(!0),l(null),u(null);try{const e=vi.currentUser;if(!e)throw new Error("Du m\xe5ste vara inloggad");const t=await e.getIdToken(),n=await fetch("https://europe-west1-geoquest2-7e45c.cloudfunctions.net/updateProviderSettings",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({settings:d})}),r=await n.json();if(!n.ok)throw new Error(r.error||"Failed to save settings");u("\u2705 Inst\xe4llningar sparade!"),setTimeout(()=>u(null),5e3)}catch(e){l("Kunde inte spara inst\xe4llningar: ".concat(e.message))}finally{a(!1)}},disabled:s,className:"flex-1 min-w-[200px] rounded-lg bg-cyan-500 px-6 py-3 font-bold text-black hover:bg-cyan-400 disabled:bg-slate-700 disabled:text-slate-400 transition-colors",children:s?"\ud83d\udcbe Sparar...":"\ud83d\udcbe Spara inst\xe4llningar"}),(0,bi.jsx)("button",{onClick:()=>n("/superuser/tasks"),className:"rounded-lg bg-slate-700 px-6 py-3 font-semibold text-white hover:bg-slate-600 transition-colors",children:"Tillbaka"})]})]})]})},Qc=async e=>{if(!mi())return console.warn("[Migration] Firebase \xe4r inte konfigurerat"),{success:!1,error:"Firebase \xe4r inte konfigurerat"};if(Ba())return console.info("[Migration] Data har redan migrerats tidigare"),{success:!0,alreadyMigrated:!0};const{createdRuns:t,joinedRuns:n}=qa();if(0===t.length&&0===n.length)return console.info("[Migration] Ingen lokal data att migrera"),{success:!0,noData:!0};const r=pi(),i={createdRuns:{success:0,failed:0},joinedRuns:{success:0,failed:0}};try{for(const n of t)try{const t=(0,si.H9)(r,"runs",n.id);await(0,si.BN)(t,(0,Ti.A)((0,Ti.A)({},n),{},{migratedFrom:"localStorage",migratedAt:(0,si.O5)(),ownerId:e}),{merge:!0}),i.createdRuns.success++}catch(s){console.error("[Migration] Kunde inte migrera skapad runda:",s),i.createdRuns.failed++}for(const t of n)try{const n=(0,si.H9)(r,"runs",t.runId,"participants",t.participantData.id);await(0,si.BN)(n,(0,Ti.A)((0,Ti.A)({},t.participantData),{},{userId:e,migratedFrom:"localStorage",migratedAt:(0,si.O5)()}),{merge:!0}),i.joinedRuns.success++}catch(s){console.error("[Migration] Kunde inte migrera deltagen runda:",s),i.joinedRuns.failed++}return Va(),{success:!0,results:i,totalMigrated:i.createdRuns.success+i.joinedRuns.success}}catch(s){return console.error("[Migration] Fel vid migrering:",s),{success:!1,error:s.message,results:i}}},Jc=()=>Ua()&&!Ba(),Yc=e=>{let{onClose:n}=e;const{currentUser:r}=Ci(),[i,s]=(0,t.useState)(!1),[a,o]=(0,t.useState)(""),[l,c]=(0,t.useState)(!1),{createdRuns:u,joinedRuns:d}=qa();return l?(0,bi.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,bi.jsx)("div",{className:"bg-slate-900 rounded-lg border border-emerald-500/50 p-6 max-w-md w-full",children:(0,bi.jsxs)("div",{className:"text-center",children:[(0,bi.jsx)("div",{className:"text-5xl mb-4",children:"\u2705"}),(0,bi.jsx)("h2",{className:"text-2xl font-bold text-emerald-300 mb-2",children:"Migrering klar!"}),(0,bi.jsx)("p",{className:"text-gray-300",children:"Dina rundor har sparats i ditt konto"})]})})}):(0,bi.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,bi.jsxs)("div",{className:"bg-slate-900 rounded-lg border border-slate-700 p-6 max-w-md w-full",children:[(0,bi.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Flytta dina rundor till kontot?"}),(0,bi.jsxs)("div",{className:"mb-6",children:[(0,bi.jsx)("p",{className:"text-gray-300 mb-4",children:"Vi har hittat rundor som du har skapat eller deltagit i utan att vara inloggad. Vill du flytta dessa till ditt konto?"}),(0,bi.jsxs)("div",{className:"bg-slate-800 rounded-lg p-4 space-y-2",children:[u.length>0&&(0,bi.jsxs)("div",{className:"flex items-center gap-2",children:[(0,bi.jsx)("span",{className:"text-2xl",children:"\u2728"}),(0,bi.jsxs)("span",{className:"text-gray-200",children:[(0,bi.jsx)("strong",{children:u.length})," skapade rund",1===u.length?"a":"or"]})]}),d.length>0&&(0,bi.jsxs)("div",{className:"flex items-center gap-2",children:[(0,bi.jsx)("span",{className:"text-2xl",children:"\ud83c\udfaf"}),(0,bi.jsxs)("span",{className:"text-gray-200",children:[(0,bi.jsx)("strong",{children:d.length})," deltagen",1===d.length?"":"a"," rund",1===d.length?"a":"or"]})]})]})]}),a&&(0,bi.jsx)("div",{className:"mb-4 bg-red-900/30 border border-red-500/50 rounded-lg p-3 text-sm text-red-200",children:a}),(0,bi.jsxs)("div",{className:"flex gap-3",children:[(0,bi.jsx)("button",{onClick:()=>{Va(),null===n||void 0===n||n()},disabled:i,className:"flex-1 px-4 py-2 rounded-lg bg-slate-700 hover:bg-slate-600 text-gray-200 font-semibold transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Hoppa \xf6ver"}),(0,bi.jsx)("button",{onClick:async()=>{if(r){s(!0),o("");try{const e=await Qc(r.id);e.success?(c(!0),setTimeout(()=>{null===n||void 0===n||n()},2e3)):o(e.error||"Kunde inte migrera data")}catch(e){o(e.message||"Ett ov\xe4ntat fel uppstod")}finally{s(!1)}}else o("Du m\xe5ste vara inloggad f\xf6r att migrera data")},disabled:i,className:"flex-1 px-4 py-2 rounded-lg bg-gradient-to-r from-cyan-500 to-indigo-600 hover:from-cyan-400 hover:to-indigo-500 text-white font-semibold transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:i?"Flyttar...":"Ja, flytta"})]}),(0,bi.jsx)("p",{className:"mt-4 text-xs text-gray-400 text-center",children:"Om du hoppar \xf6ver sparas rundorna fortfarande lokalt, men de kopplas inte till ditt konto"})]})})},Xc=()=>{const{currentUser:e,isAuthenticated:n}=Ci(),[r,i]=(0,t.useState)(!1),s=(0,t.useRef)(!1);return(0,t.useEffect)(()=>{if(n&&e&&!e.isAnonymous&&!s.current){s.current=!0;Jc()&&setTimeout(()=>{i(!0)},500)}},[n,e]),r?(0,bi.jsx)(Yc,{onClose:()=>i(!1)}):null},$c=e=>{let{localRunCount:n,onComplete:r,currentUser:i}=e;const[s,a]=(0,t.useState)(!1),[o,l]=(0,t.useState)("");return(0,bi.jsx)("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:(0,bi.jsxs)("div",{className:"bg-slate-800 rounded-lg border border-slate-600 max-w-md w-full p-6",children:[(0,bi.jsx)("h2",{className:"text-xl font-bold text-white mb-4",children:"Importera dina rundor"}),o?(0,bi.jsx)("div",{className:"mb-4",children:(0,bi.jsx)("p",{className:"text-gray-300",children:o})}):(0,bi.jsxs)(bi.Fragment,{children:[(0,bi.jsxs)("p",{className:"text-gray-300 mb-2",children:["Du har ",(0,bi.jsx)("span",{className:"font-bold text-cyan-300",children:n})," runda",1!==n?"r":""," som skapades innan du loggade in."]}),(0,bi.jsx)("p",{className:"text-gray-300 mb-6",children:"Vill du koppla dessa till ditt konto?"})]}),!o&&(0,bi.jsxs)("div",{className:"flex gap-3",children:[(0,bi.jsx)("button",{onClick:async()=>{a(!0),l("Importerar rundor...");try{const t=Fa().map(e=>e.runId);if(0===t.length)return l("Inga rundor att importera."),void setTimeout(()=>r(!0),1500);const n=await ea.listRunsByIds(t);if(0===n.length)return l("Inga giltiga rundor hittades att importera."),localStorage.setItem("geoquest:local:createdRuns",JSON.stringify([])),void setTimeout(()=>r(!0),1500);let s=0,a=0;for(const r of n)try{await ea.updateRun(r.id,{createdBy:i.id,createdByName:i.name||i.email||"Anv\xe4ndare"}),s++}catch(e){console.error("[LocalRunsImport] Kunde inte uppdatera runda:",r.id,e),a++}s>0&&localStorage.setItem("geoquest:local:createdRuns",JSON.stringify([])),l(0===a?"".concat(s," rundor importerades! \ud83c\udf89"):"".concat(s," rundor importerades, ").concat(a," misslyckades.")),setTimeout(()=>r(!0),2e3)}catch(e){console.error("[LocalRunsImport] Import misslyckades:",e),l("Import misslyckades. F\xf6rs\xf6k igen senare."),setTimeout(()=>r(!1),3e3)}finally{a(!1)}},disabled:s,className:"flex-1 bg-green-600 hover:bg-green-700 disabled:bg-slate-700 disabled:text-gray-400 px-4 py-3 rounded font-medium text-white transition-colors",children:s?"Importerar...":"Ja, importera"}),(0,bi.jsx)("button",{onClick:()=>{r(!1)},disabled:s,className:"flex-1 bg-slate-600 hover:bg-slate-700 disabled:bg-slate-700 disabled:text-gray-400 px-4 py-3 rounded font-medium text-white transition-colors",children:"Hoppa \xf6ver"})]}),o&&(0,bi.jsx)("p",{className:"text-sm text-gray-500 mt-4",children:"St\xe4nger automatiskt..."})]})})},eu=()=>{const[e,n]=(0,t.useState)(null),[r,i]=(0,t.useState)(!1);(0,t.useEffect)(()=>{const e=e=>{e.preventDefault(),n(e);const t=window.matchMedia("(display-mode: standalone)").matches,r=localStorage.getItem("geoquest:installPromptSeen");t||r||setTimeout(()=>i(!0),1e4)};return window.addEventListener("beforeinstallprompt",e),window.matchMedia("(display-mode: standalone)").matches&&i(!1),()=>{window.removeEventListener("beforeinstallprompt",e)}},[]);const s=()=>{i(!1),localStorage.setItem("geoquest:installPromptSeen","true")},a=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,o=window.navigator.standalone||window.matchMedia("(display-mode: standalone)").matches;return a&&!o&&r?(0,bi.jsx)("div",{className:"fixed bottom-4 left-4 right-4 z-50 animate-slide-up",children:(0,bi.jsxs)("div",{className:"bg-slate-900 rounded-xl shadow-2xl p-4 border border-purple-500/40",children:[(0,bi.jsx)("button",{onClick:s,className:"absolute top-2 right-2 text-white/80 hover:text-white","aria-label":"St\xe4ng",children:(0,bi.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,bi.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})}),(0,bi.jsxs)("div",{className:"flex items-start gap-3 pr-6",children:[(0,bi.jsx)("div",{className:"flex-shrink-0",children:(0,bi.jsx)("img",{src:"/logo-compass.svg",alt:"RouteQuest",className:"w-12 h-12"})}),(0,bi.jsxs)("div",{className:"flex-1",children:[(0,bi.jsx)("h3",{className:"text-white font-bold text-lg mb-1",children:"Installera RouteQuest!"}),(0,bi.jsx)("p",{className:"text-gray-300 text-sm mb-2",children:"F\xe5 snabb \xe5tkomst till tipspromenader direkt fr\xe5n din hemsk\xe4rm."}),(0,bi.jsxs)("div",{className:"bg-slate-800 rounded-lg p-3 text-gray-300 text-xs space-y-1",children:[(0,bi.jsxs)("p",{children:["1. Tryck p\xe5 ",(0,bi.jsx)("strong",{className:"text-white",children:"Dela"}),"-knappen nedan"]}),(0,bi.jsxs)("p",{children:["2. V\xe4lj ",(0,bi.jsx)("strong",{className:"text-white",children:'"L\xe4gg till p\xe5 hemsk\xe4rmen"'})]})]})]})]})]})}):r&&e?(0,bi.jsx)("div",{className:"fixed bottom-4 left-4 right-4 z-50 animate-slide-up",children:(0,bi.jsxs)("div",{className:"bg-slate-900 rounded-xl shadow-2xl p-4 border border-purple-500/40",children:[(0,bi.jsx)("button",{onClick:s,className:"absolute top-2 right-2 text-white/80 hover:text-white","aria-label":"St\xe4ng",children:(0,bi.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,bi.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})}),(0,bi.jsxs)("div",{className:"flex items-start gap-3 pr-6",children:[(0,bi.jsx)("div",{className:"flex-shrink-0",children:(0,bi.jsx)("img",{src:"/logo-compass.svg",alt:"RouteQuest",className:"w-12 h-12"})}),(0,bi.jsxs)("div",{className:"flex-1",children:[(0,bi.jsx)("h3",{className:"text-white font-bold text-lg mb-1",children:"Installera RouteQuest!"}),(0,bi.jsx)("p",{className:"text-gray-300 text-sm mb-3",children:"F\xe5 snabb \xe5tkomst till tipspromenader direkt fr\xe5n din hemsk\xe4rm. Fungerar offline!"}),(0,bi.jsx)("button",{onClick:async()=>{e&&(e.prompt(),await e.userChoice,n(null),i(!1),localStorage.setItem("geoquest:installPromptSeen","true"))},className:"w-full bg-purple-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-400 transition-colors",children:"\ud83d\udcf2 Installera nu"})]})]})]})}):null},tu={info:{container:"border-cyan-500/60 bg-slate-900/95",accent:"bg-cyan-500",icon:"\u2139\ufe0f"},success:{container:"border-emerald-500/60 bg-slate-900/95",accent:"bg-emerald-500",icon:"\u2705"},warning:{container:"border-amber-500/60 bg-slate-900/95",accent:"bg-amber-500",icon:"\u26a0\ufe0f"},error:{container:"border-red-500/60 bg-slate-900/95",accent:"bg-red-500",icon:"\u274c"}},nu=()=>{const{toasts:e,dismissToast:t}=xa();return e.length?(0,bi.jsx)("div",{className:"fixed top-4 right-4 z-[80] flex flex-col gap-3 max-w-sm w-full",children:e.map(e=>{const n=tu[e.variant]||tu.info;return(0,bi.jsxs)("div",{className:"relative overflow-hidden rounded-xl border shadow-lg shadow-slate-900/40 backdrop-blur ".concat(n.container),children:[(0,bi.jsx)("div",{className:"absolute inset-y-0 left-0 w-1 ".concat(n.accent)}),(0,bi.jsxs)("div",{className:"flex items-start gap-3 px-4 py-3",children:[(0,bi.jsx)("div",{className:"text-xl leading-none",children:n.icon}),(0,bi.jsxs)("div",{className:"flex-1",children:[(0,bi.jsx)("div",{className:"text-sm font-semibold text-white",children:e.title}),e.message&&(0,bi.jsx)("div",{className:"mt-1 text-xs text-slate-300 whitespace-pre-line",children:e.message})]}),(0,bi.jsx)("button",{type:"button",className:"text-slate-400 hover:text-white transition-colors","aria-label":"St\xe4ng",onClick:()=>t(e.id),children:"\xd7"})]})]},e.id)})}):null};var ru=n(4737);const iu=()=>{const[e,n]=(0,t.useState)([]),[r,i]=(0,t.useState)(!0),[s,a]=(0,t.useState)(!1);(0,t.useEffect)(()=>{o();const e=setInterval(o,3e5);return()=>clearInterval(e)},[]);const o=async()=>{try{const e=await ru.D.getProblematicServices();n(e)}catch(e){console.error("Kunde inte kontrollera tj\xe4nstestatus:",e)}finally{i(!1)}};if(r||0===e.length)return null;const l=e.filter(e=>"down"===e.status||"error"===e.status).length>0;return(0,bi.jsxs)(bi.Fragment,{children:[(0,bi.jsx)("button",{onClick:()=>a(!0),className:"fixed bottom-4 right-4 z-40 flex h-14 w-14 items-center justify-center rounded-full border shadow-lg transition-all hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 ".concat(l?"bg-red-900/80 border-red-400 text-red-100 focus:ring-red-400":"bg-amber-900/80 border-amber-400 text-amber-100 focus:ring-amber-400"),"aria-label":"Visa status f\xf6r externa tj\xe4nster",children:(0,bi.jsxs)("div",{className:"relative flex items-center justify-center",children:[(0,bi.jsx)("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,bi.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,bi.jsx)("span",{className:"absolute -top-2 -right-2 rounded-full bg-black/70 px-2 py-0.5 text-xs font-semibold text-white",children:e.length})]})}),s&&(0,bi.jsxs)("div",{className:"fixed inset-0 z-50 flex items-end justify-end sm:items-center sm:justify-center",children:[(0,bi.jsx)("button",{className:"absolute inset-0 bg-black/60","aria-label":"St\xe4ng dialogen",onClick:()=>a(!1)}),(0,bi.jsxs)("div",{className:"relative m-4 w-full max-w-md overflow-hidden rounded-xl border border-slate-700 bg-slate-900 shadow-2xl",children:[(0,bi.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b ".concat(l?"border-red-500/40 bg-red-900/20":"border-amber-500/40 bg-amber-900/20"),children:[(0,bi.jsxs)("div",{className:"flex items-center gap-3",children:[(0,bi.jsx)("svg",{className:"h-6 w-6 ".concat(l?"text-red-300":"text-amber-300"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,bi.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,bi.jsxs)("div",{className:"flex flex-col",children:[(0,bi.jsxs)("span",{className:"text-sm font-semibold text-gray-100",children:[e.length," ",1===e.length?"tj\xe4nst p\xe5verkas":"tj\xe4nster p\xe5verkas"]}),(0,bi.jsx)("span",{className:"text-xs text-gray-400",children:l?"Kritiska st\xf6rningar uppt\xe4ckta":"Mindre st\xf6rningar uppt\xe4ckta"})]})]}),(0,bi.jsx)("button",{onClick:()=>a(!1),className:"rounded-md p-1 text-gray-400 hover:bg-white/10 hover:text-gray-200 focus:outline-none focus:ring-2 focus:ring-cyan-400","aria-label":"St\xe4ng",children:(0,bi.jsx)("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,bi.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,bi.jsx)("div",{className:"max-h-80 overflow-y-auto px-4 py-4 space-y-3",children:e.map((e,t)=>(0,bi.jsxs)("div",{className:"flex items-start gap-3 rounded-lg border border-white/5 bg-white/5 p-3 text-sm",children:[(0,bi.jsx)("div",{className:"mt-1 h-2.5 w-2.5 flex-shrink-0 rounded-full ".concat("down"===e.status||"error"===e.status?"bg-red-500":"bg-amber-500")}),(0,bi.jsxs)("div",{className:"flex-1",children:[(0,bi.jsx)("p",{className:"font-semibold text-gray-100",children:e.name}),(0,bi.jsx)("p",{className:"text-gray-300",children:e.message}),e.since&&(0,bi.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Sedan: ",new Date(e.since).toLocaleString("sv-SE")]})]})]},t))}),(0,bi.jsxs)("div",{className:"flex items-center justify-between border-t border-slate-700 bg-black/30 px-4 py-3",children:[(0,bi.jsx)("button",{onClick:()=>a(!1),className:"text-sm text-gray-300 hover:text-gray-100 transition-colors",children:"St\xe4ng"}),(0,bi.jsx)("button",{onClick:()=>{i(!0),o()},className:"text-sm font-semibold text-cyan-400 hover:text-cyan-200 transition-colors",children:"Uppdatera status"})]})]})]})]})},su=e=>{let{children:t}=e;const{isSuperUser:n,isAuthInitialized:r}=Ci();return r?n?t:(0,bi.jsx)(fe,{to:"/",replace:!0}):(0,bi.jsx)("div",{className:"p-8 text-center text-gray-300",children:"Kontrollerar beh\xf6righet ..."})},au=()=>(0,bi.jsxs)(ve,{children:[(0,bi.jsx)(me,{path:"/",element:(0,bi.jsx)(El,{})}),(0,bi.jsx)(me,{path:"/login",element:(0,bi.jsx)(Cl,{})}),(0,bi.jsx)(me,{path:"/register",element:(0,bi.jsx)(Tl,{})}),(0,bi.jsx)(me,{path:"/my-runs",element:(0,bi.jsx)(Cc,{})}),(0,bi.jsx)(me,{path:"/generate",element:(0,bi.jsx)(vc,{})}),(0,bi.jsx)(me,{path:"/join",element:(0,bi.jsx)(yc,{})}),(0,bi.jsx)(me,{path:"/run/:runId/play",element:(0,bi.jsx)(_c,{})}),(0,bi.jsx)(me,{path:"/run/:runId/results",element:(0,bi.jsx)(jc,{})}),(0,bi.jsx)(me,{path:"/run/:runId/admin",element:(0,bi.jsx)(Sc,{})}),(0,bi.jsx)(me,{path:"/superuser/all-runs",element:(0,bi.jsx)(su,{children:(0,bi.jsx)(Oc,{})})}),(0,bi.jsx)(me,{path:"/superuser/users",element:(0,bi.jsx)(su,{children:(0,bi.jsx)(Mc,{})})}),(0,bi.jsx)(me,{path:"/admin/questions",element:(0,bi.jsx)(su,{children:(0,bi.jsx)(Rc,{})})}),(0,bi.jsx)(me,{path:"/superuser/analytics",element:(0,bi.jsx)(su,{children:(0,bi.jsx)(Dc,{})})}),(0,bi.jsx)(me,{path:"/superuser/messages",element:(0,bi.jsx)(su,{children:(0,bi.jsx)(Fc,{})})}),(0,bi.jsx)(me,{path:"/superuser/tasks",element:(0,bi.jsx)(su,{children:(0,bi.jsx)(Gc,{})})}),(0,bi.jsx)(me,{path:"/superuser/notifications",element:(0,bi.jsx)(su,{children:(0,bi.jsx)(Uc,{})})}),(0,bi.jsx)(me,{path:"/superuser/logs",element:(0,bi.jsx)(su,{children:(0,bi.jsx)(Bc,{})})}),(0,bi.jsx)(me,{path:"/superuser/ai-providers",element:(0,bi.jsx)(su,{children:(0,bi.jsx)(Zc,{})})}),(0,bi.jsx)(me,{path:"*",element:(0,bi.jsx)(fe,{to:"/",replace:!0})})]}),ou=e=>{let{children:n}=e;const[r]=Pe(),i=r.get("ver")||r.get("version"),s=i&&i!==io;return(0,t.useEffect)(()=>{s&&console.error("\u274c Version mismatch! URL expects: ".concat(i,", Running: ").concat(io))},[s,i]),s?(0,bi.jsx)("div",{className:"min-h-screen bg-slate-950 flex items-center justify-center p-4",children:(0,bi.jsx)("div",{className:"max-w-2xl w-full bg-slate-900 border-2 border-red-500 rounded-2xl p-8 shadow-2xl",children:(0,bi.jsxs)("div",{className:"text-center space-y-6",children:[(0,bi.jsx)("div",{className:"text-6xl",children:"\u26a0\ufe0f"}),(0,bi.jsx)("h1",{className:"text-3xl font-bold text-red-400",children:"Felaktig version!"}),(0,bi.jsxs)("div",{className:"bg-slate-800 rounded-lg p-6 space-y-3",children:[(0,bi.jsxs)("p",{className:"text-gray-300",children:["URL:en f\xf6rv\xe4ntar sig version ",(0,bi.jsx)("span",{className:"font-mono font-bold text-cyan-400",children:i})]}),(0,bi.jsxs)("p",{className:"text-gray-300",children:["Men du k\xf6r version ",(0,bi.jsx)("span",{className:"font-mono font-bold text-amber-400",children:io})]})]}),(0,bi.jsxs)("div",{className:"space-y-3",children:[(0,bi.jsx)("p",{className:"text-gray-400 text-sm",children:"Detta beror troligen p\xe5 att din webbl\xe4sare har cachat en gammal version av sidan."}),(0,bi.jsx)("button",{onClick:()=>{const e=new URL(window.location.href);e.searchParams.delete("ver"),e.searchParams.delete("version"),window.location.href=e.toString()},className:"w-full px-6 py-3 bg-cyan-500 text-black rounded-lg font-bold text-lg hover:bg-cyan-400 transition-colors",children:"Ladda utan versionskontroll"}),(0,bi.jsx)("button",{onClick:()=>{window.location.reload(!0)},className:"w-full px-6 py-3 bg-slate-700 text-white rounded-lg font-semibold hover:bg-slate-600 transition-colors",children:"Tvinga omladdning (Ctrl+Shift+R)"})]})]})})}):(0,bi.jsx)(bi.Fragment,{children:n})},lu=()=>{const e=J(),{currentUser:n,isAuthInitialized:r}=Ci();return(0,t.useEffect)(()=>{$a("page_view",{path:e.pathname})},[e.pathname]),(0,t.useEffect)(()=>{r&&n&&!n.isAnonymous&&to(n.id)},[n,r]),null},cu=()=>{const{currentUser:e,isAuthInitialized:n,isSuperUser:r}=Ci(),[i,s]=(0,t.useState)(!1),[a,o]=(0,t.useState)(0);(0,t.useEffect)(()=>{if(n&&e&&!e.isAnonymous){if(r)return;const t="geoquest:import:handled:".concat(e.id);if("true"===localStorage.getItem(t))return;const n=Fa(),i=(null===n||void 0===n?void 0:n.length)||0;i>0?(o(i),s(!0)):localStorage.setItem(t,"true")}},[e,n,r]),(0,t.useEffect)(()=>{n&&!e&&s(!1)},[e,n]);return i?(0,bi.jsx)($c,{localRunCount:a,currentUser:e,onComplete:t=>{if(e&&!e.isAnonymous){const t="geoquest:import:handled:".concat(e.id);localStorage.setItem(t,"true")}s(!1)}}):null},uu=()=>(dc(),null),du=()=>{const{isSuperUser:e}=Ci();return e?(0,bi.jsx)(bi.Fragment,{children:(0,bi.jsx)(iu,{})}):null};const hu=function(){return(0,bi.jsx)(Ei,{children:(0,bi.jsx)(ya,{children:(0,bi.jsx)(ja,{children:(0,bi.jsx)(sa,{children:(0,bi.jsx)(ou,{children:(0,bi.jsxs)("div",{className:"min-h-screen bg-slate-950 text-gray-100",children:[(0,bi.jsx)(uu,{}),(0,bi.jsx)(lu,{}),(0,bi.jsx)(Xc,{}),(0,bi.jsx)(cu,{}),(0,bi.jsx)(eu,{}),(0,bi.jsx)(au,{}),(0,bi.jsx)(nu,{}),(0,bi.jsx)(du,{})]})})})})})})};i.createRoot(document.getElementById("root")).render((0,bi.jsx)(t.StrictMode,{children:(0,bi.jsx)(je,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:(0,bi.jsx)(hu,{})})}))})()})();
//# sourceMappingURL=main.14cb2de4.js.map